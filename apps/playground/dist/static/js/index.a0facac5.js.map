{"version":3,"file":"static/js/index.a0facac5.js","sources":["webpack://playground/../../packages/shared/dist/es/env/types.mjs","webpack://playground/../../packages/shared/dist/es/utils.mjs","webpack://playground/../../packages/shared/dist/es/env/basic.mjs","webpack://playground/../../packages/shared/dist/es/common.mjs","webpack://playground/../../packages/shared/dist/es/logger.mjs","webpack://playground/../../packages/shared/dist/es/env/init-debug.mjs","webpack://playground/../../packages/shared/dist/es/env/global-config-manager.mjs","webpack://playground/../../packages/shared/dist/es/env/constants.mjs","webpack://playground/../../packages/shared/dist/es/env/helper.mjs","webpack://playground/../../packages/shared/dist/es/env/parse.mjs","webpack://playground/../../packages/shared/dist/es/env/decide-model-config.mjs","webpack://playground/../../packages/shared/dist/es/env/model-config-manager.mjs","webpack://playground/../../packages/shared/dist/es/env/utils.mjs","webpack://playground/../../packages/shared/dist/es/extractor/tree.mjs","webpack://playground/../../packages/shared/dist/es/img/transform.mjs","webpack://playground/@sqaitech/core/./src/ai-model/common.ts","webpack://playground/@sqaitech/core/./src/ai-model/inspect.ts","webpack://playground/@sqaitech/core/./src/ai-model/llm-planning.ts","webpack://playground/../../packages/shared/dist/es/us-keyboard-layout.mjs","webpack://playground/@sqaitech/core/./src/ai-model/ui-tars-planning.ts","webpack://playground/@sqaitech/core/./src/yaml/utils.ts","webpack://playground/@sqaitech/core/./src/yaml/player.ts","webpack://playground/@sqaitech/playground/./src/common.ts","webpack://playground/@sqaitech/playground/./src/adapters/base.ts","webpack://playground/@sqaitech/playground/./src/adapters/local-execution.ts","webpack://playground/@sqaitech/playground/./src/adapters/remote-execution.ts","webpack://playground/@sqaitech/playground/./src/sdk/index.ts","webpack://playground/../../packages/visualizer/dist/es/utils/color.mjs","webpack://playground/../../packages/visualizer/dist/es/component/logo/index.mjs","webpack://playground/../../packages/visualizer/dist/es/store/store.mjs","webpack://playground/../../packages/visualizer/dist/es/component/env-config/index.mjs","webpack://playground/../../packages/visualizer/dist/es/component/nav-actions/index.mjs","webpack://playground/../../packages/visualizer/dist/es/utils/constants.mjs","webpack://playground/../../packages/visualizer/dist/es/utils/index.mjs","webpack://playground/@sqaitech/core/./src/agent/ui-utils.ts","webpack://playground/@sqaitech/core/./src/insight/index.ts","webpack://playground/@sqaitech/core/./src/agent/utils.ts","webpack://playground/@sqaitech/core/./src/agent/task-cache.ts","webpack://playground/@sqaitech/core/./src/agent/tasks.ts","webpack://playground/@sqaitech/core/./src/agent/agent.ts","webpack://playground/../../packages/visualizer/dist/es/utils/replay-scripts.mjs","webpack://playground/../../packages/shared/dist/es/baseDB.mjs","webpack://playground/../../packages/visualizer/dist/es/component/universal-playground/providers/indexeddb-storage-provider.mjs","webpack://playground/../../packages/visualizer/dist/es/component/universal-playground/providers/storage-provider.mjs","webpack://playground/../../packages/visualizer/dist/es/component/blackboard/index.mjs","webpack://playground/../../packages/visualizer/dist/es/component/shiny-text/index.mjs","webpack://playground/../../packages/visualizer/dist/es/component/misc/index.mjs","webpack://playground/../../packages/visualizer/dist/es/component/context-preview/index.mjs","webpack://playground/../../packages/visualizer/dist/es/component/env-config-reminder/index.mjs","webpack://playground/../../packages/visualizer/dist/es/icons/global-perspective.mjs","webpack://playground/../../packages/visualizer/dist/es/icons/player-setting.mjs","webpack://playground/../../packages/visualizer/dist/es/icons/show-marker.mjs","webpack://playground/../../packages/visualizer/dist/es/utils/pixi-loader.mjs","webpack://playground/../../packages/visualizer/dist/es/component/player/index.mjs","webpack://playground/../../packages/visualizer/dist/es/component/playground-result/index.mjs","webpack://playground/../../packages/visualizer/dist/es/icons/avatar.mjs","webpack://playground/../../packages/visualizer/dist/es/store/history.mjs","webpack://playground/../../packages/visualizer/dist/es/types.mjs","webpack://playground/@sqaitech/core/./src/device/index.ts","webpack://playground/../../packages/visualizer/dist/es/utils/playground-utils.mjs","webpack://playground/../../packages/visualizer/dist/es/icons/setting.mjs","webpack://playground/../../packages/visualizer/dist/es/component/config-selector/index.mjs","webpack://playground/../../packages/visualizer/dist/es/component/form-field/index.mjs","webpack://playground/../../packages/visualizer/dist/es/icons/close.mjs","webpack://playground/../../packages/visualizer/dist/es/icons/history.mjs","webpack://playground/../../packages/visualizer/dist/es/icons/magnifying-glass.mjs","webpack://playground/../../packages/visualizer/dist/es/component/history-selector/index.mjs","webpack://playground/../../packages/visualizer/dist/es/component/prompt-input/index.mjs","webpack://playground/../../packages/visualizer/dist/es/component/universal-playground/index.mjs","webpack://playground/../../packages/visualizer/dist/es/hooks/usePlaygroundState.mjs","webpack://playground/../../packages/visualizer/dist/es/hooks/usePlaygroundExecution.mjs","webpack://playground/./src/components/screenshot-viewer/index.tsx","webpack://playground/./src/App.tsx","webpack://playground/./src/index.tsx","webpack://playground/webpack/runtime/compat_get_default_export","webpack://playground/webpack/runtime/create_fake_namespace_object","webpack://playground/webpack/runtime/define_property_getters","webpack://playground/webpack/runtime/ensure_chunk","webpack://playground/webpack/runtime/get javascript chunk filename","webpack://playground/webpack/runtime/get mini-css chunk filename","webpack://playground/webpack/runtime/global","webpack://playground/webpack/runtime/has_own_property","webpack://playground/webpack/runtime/load_script","webpack://playground/webpack/runtime/make_namespace_object","webpack://playground/webpack/runtime/node_module_decorator","webpack://playground/webpack/runtime/on_chunk_loaded","webpack://playground/webpack/runtime/public_path","webpack://playground/webpack/runtime/jsonp_chunk_loading"],"sourcesContent":["const SQAI_OPENAI_INIT_CONFIG_JSON = 'SQAI_OPENAI_INIT_CONFIG_JSON';\nconst SQAI_MODEL_NAME = 'SQAI_MODEL_NAME';\nconst SQAI_LANGSMITH_DEBUG = 'SQAI_LANGSMITH_DEBUG';\nconst SQAI_DEBUG_AI_PROFILE = 'SQAI_DEBUG_AI_PROFILE';\nconst SQAI_DEBUG_AI_RESPONSE = 'SQAI_DEBUG_AI_RESPONSE';\nconst SQAI_DANGEROUSLY_PRINT_ALL_CONFIG = 'SQAI_DANGEROUSLY_PRINT_ALL_CONFIG';\nconst SQAI_DEBUG_MODE = 'SQAI_DEBUG_MODE';\nconst SQAI_MCP_USE_PUPPETEER_MODE = 'SQAI_MCP_USE_PUPPETEER_MODE';\nconst SQAI_MCP_CHROME_PATH = 'SQAI_MCP_CHROME_PATH';\nconst SQAI_MCP_ANDROID_MODE = 'SQAI_MCP_ANDROID_MODE';\nconst DOCKER_CONTAINER = 'DOCKER_CONTAINER';\nconst SQAI_FORCE_DEEP_THINK = 'SQAI_FORCE_DEEP_THINK';\nconst SQAI_OPENAI_SOCKS_PROXY = 'SQAI_OPENAI_SOCKS_PROXY';\nconst SQAI_OPENAI_HTTP_PROXY = 'SQAI_OPENAI_HTTP_PROXY';\nconst OPENAI_API_KEY = 'OPENAI_API_KEY';\nconst OPENAI_BASE_URL = 'OPENAI_BASE_URL';\nconst OPENAI_MAX_TOKENS = 'OPENAI_MAX_TOKENS';\nconst SQAI_ADB_PATH = 'SQAI_ADB_PATH';\nconst SQAI_ADB_REMOTE_HOST = 'SQAI_ADB_REMOTE_HOST';\nconst SQAI_ADB_REMOTE_PORT = 'SQAI_ADB_REMOTE_PORT';\nconst SQAI_ANDROID_IME_STRATEGY = 'SQAI_ANDROID_IME_STRATEGY';\nconst SQAI_IOS_DEVICE_UDID = 'SQAI_IOS_DEVICE_UDID';\nconst SQAI_IOS_SIMULATOR_UDID = 'SQAI_IOS_SIMULATOR_UDID';\nconst SQAI_CACHE = 'SQAI_CACHE';\nconst SQAI_USE_VLM_UI_TARS = 'SQAI_USE_VLM_UI_TARS';\nconst SQAI_USE_QWEN_VL = 'SQAI_USE_QWEN_VL';\nconst SQAI_USE_QWEN3_VL = 'SQAI_USE_QWEN3_VL';\nconst SQAI_USE_DOUBAO_VISION = 'SQAI_USE_DOUBAO_VISION';\nconst SQAI_USE_GEMINI = 'SQAI_USE_GEMINI';\nconst SQAI_USE_VL_MODEL = 'SQAI_USE_VL_MODEL';\nconst MATCH_BY_POSITION = 'MATCH_BY_POSITION';\nconst SQAI_API_TYPE = 'SQAI-API-TYPE';\nconst SQAI_REPORT_TAG_NAME = 'SQAI_REPORT_TAG_NAME';\nconst SQAI_REPLANNING_CYCLE_LIMIT = 'SQAI_REPLANNING_CYCLE_LIMIT';\nconst SQAI_PREFERRED_LANGUAGE = 'SQAI_PREFERRED_LANGUAGE';\nconst SQAI_USE_AZURE_OPENAI = 'SQAI_USE_AZURE_OPENAI';\nconst SQAI_AZURE_OPENAI_SCOPE = 'SQAI_AZURE_OPENAI_SCOPE';\nconst SQAI_AZURE_OPENAI_INIT_CONFIG_JSON = 'SQAI_AZURE_OPENAI_INIT_CONFIG_JSON';\nconst SQAI_CACHE_MAX_FILENAME_LENGTH = 'SQAI_CACHE_MAX_FILENAME_LENGTH';\nconst AZURE_OPENAI_ENDPOINT = 'AZURE_OPENAI_ENDPOINT';\nconst AZURE_OPENAI_KEY = 'AZURE_OPENAI_KEY';\nconst AZURE_OPENAI_API_VERSION = 'AZURE_OPENAI_API_VERSION';\nconst AZURE_OPENAI_DEPLOYMENT = 'AZURE_OPENAI_DEPLOYMENT';\nconst SQAI_USE_ANTHROPIC_SDK = 'SQAI_USE_ANTHROPIC_SDK';\nconst ANTHROPIC_API_KEY = 'ANTHROPIC_API_KEY';\nconst SQAI_RUN_DIR = 'SQAI_RUN_DIR';\nconst SQAI_OPENAI_BASE_URL = 'SQAI_OPENAI_BASE_URL';\nconst SQAI_OPENAI_API_KEY = 'SQAI_OPENAI_API_KEY';\nconst SQAI_OPENAI_USE_AZURE = 'SQAI_OPENAI_USE_AZURE';\nconst SQAI_AZURE_OPENAI_KEY = 'SQAI_AZURE_OPENAI_KEY';\nconst SQAI_AZURE_OPENAI_ENDPOINT = 'SQAI_AZURE_OPENAI_ENDPOINT';\nconst SQAI_AZURE_OPENAI_API_VERSION = 'SQAI_AZURE_OPENAI_API_VERSION';\nconst SQAI_AZURE_OPENAI_DEPLOYMENT = 'SQAI_AZURE_OPENAI_DEPLOYMENT';\nconst SQAI_ANTHROPIC_API_KEY = 'SQAI_ANTHROPIC_API_KEY';\nconst SQAI_VL_MODE = 'SQAI_VL_MODE';\nconst SQAI_VQA_MODEL_NAME = 'SQAI_VQA_MODEL_NAME';\nconst SQAI_VQA_OPENAI_SOCKS_PROXY = 'SQAI_VQA_OPENAI_SOCKS_PROXY';\nconst SQAI_VQA_OPENAI_HTTP_PROXY = 'SQAI_VQA_OPENAI_HTTP_PROXY';\nconst SQAI_VQA_OPENAI_BASE_URL = 'SQAI_VQA_OPENAI_BASE_URL';\nconst SQAI_VQA_OPENAI_API_KEY = 'SQAI_VQA_OPENAI_API_KEY';\nconst SQAI_VQA_OPENAI_INIT_CONFIG_JSON = 'SQAI_VQA_OPENAI_INIT_CONFIG_JSON';\nconst SQAI_VQA_OPENAI_USE_AZURE = 'SQAI_VQA_OPENAI_USE_AZURE';\nconst SQAI_VQA_USE_AZURE_OPENAI = 'SQAI_VQA_USE_AZURE_OPENAI';\nconst SQAI_VQA_AZURE_OPENAI_SCOPE = 'SQAI_VQA_AZURE_OPENAI_SCOPE';\nconst SQAI_VQA_AZURE_OPENAI_KEY = 'SQAI_VQA_AZURE_OPENAI_KEY';\nconst SQAI_VQA_AZURE_OPENAI_ENDPOINT = 'SQAI_VQA_AZURE_OPENAI_ENDPOINT';\nconst SQAI_VQA_AZURE_OPENAI_API_VERSION = 'SQAI_VQA_AZURE_OPENAI_API_VERSION';\nconst SQAI_VQA_AZURE_OPENAI_DEPLOYMENT = 'SQAI_VQA_AZURE_OPENAI_DEPLOYMENT';\nconst SQAI_VQA_AZURE_OPENAI_INIT_CONFIG_JSON = 'SQAI_VQA_AZURE_OPENAI_INIT_CONFIG_JSON';\nconst SQAI_VQA_USE_ANTHROPIC_SDK = 'SQAI_VQA_USE_ANTHROPIC_SDK';\nconst SQAI_VQA_ANTHROPIC_API_KEY = 'SQAI_VQA_ANTHROPIC_API_KEY';\nconst SQAI_VQA_VL_MODE = 'SQAI_VQA_VL_MODE';\nconst SQAI_PLANNING_MODEL_NAME = 'SQAI_PLANNING_MODEL_NAME';\nconst SQAI_PLANNING_OPENAI_SOCKS_PROXY = 'SQAI_PLANNING_OPENAI_SOCKS_PROXY';\nconst SQAI_PLANNING_OPENAI_HTTP_PROXY = 'SQAI_PLANNING_OPENAI_HTTP_PROXY';\nconst SQAI_PLANNING_OPENAI_BASE_URL = 'SQAI_PLANNING_OPENAI_BASE_URL';\nconst SQAI_PLANNING_OPENAI_API_KEY = 'SQAI_PLANNING_OPENAI_API_KEY';\nconst SQAI_PLANNING_OPENAI_INIT_CONFIG_JSON = 'SQAI_PLANNING_OPENAI_INIT_CONFIG_JSON';\nconst SQAI_PLANNING_OPENAI_USE_AZURE = 'SQAI_PLANNING_OPENAI_USE_AZURE';\nconst SQAI_PLANNING_USE_AZURE_OPENAI = 'SQAI_PLANNING_USE_AZURE_OPENAI';\nconst SQAI_PLANNING_AZURE_OPENAI_SCOPE = 'SQAI_PLANNING_AZURE_OPENAI_SCOPE';\nconst SQAI_PLANNING_AZURE_OPENAI_KEY = 'SQAI_PLANNING_AZURE_OPENAI_KEY';\nconst SQAI_PLANNING_AZURE_OPENAI_ENDPOINT = 'SQAI_PLANNING_AZURE_OPENAI_ENDPOINT';\nconst SQAI_PLANNING_AZURE_OPENAI_API_VERSION = 'SQAI_PLANNING_AZURE_OPENAI_API_VERSION';\nconst SQAI_PLANNING_AZURE_OPENAI_DEPLOYMENT = 'SQAI_PLANNING_AZURE_OPENAI_DEPLOYMENT';\nconst SQAI_PLANNING_AZURE_OPENAI_INIT_CONFIG_JSON = 'SQAI_PLANNING_AZURE_OPENAI_INIT_CONFIG_JSON';\nconst SQAI_PLANNING_USE_ANTHROPIC_SDK = 'SQAI_PLANNING_USE_ANTHROPIC_SDK';\nconst SQAI_PLANNING_ANTHROPIC_API_KEY = 'SQAI_PLANNING_ANTHROPIC_API_KEY';\nconst SQAI_PLANNING_VL_MODE = 'SQAI_PLANNING_VL_MODE';\nconst SQAI_GROUNDING_MODEL_NAME = 'SQAI_GROUNDING_MODEL_NAME';\nconst SQAI_GROUNDING_OPENAI_SOCKS_PROXY = 'SQAI_GROUNDING_OPENAI_SOCKS_PROXY';\nconst SQAI_GROUNDING_OPENAI_HTTP_PROXY = 'SQAI_GROUNDING_OPENAI_HTTP_PROXY';\nconst SQAI_GROUNDING_OPENAI_BASE_URL = 'SQAI_GROUNDING_OPENAI_BASE_URL';\nconst SQAI_GROUNDING_OPENAI_API_KEY = 'SQAI_GROUNDING_OPENAI_API_KEY';\nconst SQAI_GROUNDING_OPENAI_INIT_CONFIG_JSON = 'SQAI_GROUNDING_OPENAI_INIT_CONFIG_JSON';\nconst SQAI_GROUNDING_OPENAI_USE_AZURE = 'SQAI_GROUNDING_OPENAI_USE_AZURE';\nconst SQAI_GROUNDING_USE_AZURE_OPENAI = 'SQAI_GROUNDING_USE_AZURE_OPENAI';\nconst SQAI_GROUNDING_AZURE_OPENAI_SCOPE = 'SQAI_GROUNDING_AZURE_OPENAI_SCOPE';\nconst SQAI_GROUNDING_AZURE_OPENAI_KEY = 'SQAI_GROUNDING_AZURE_OPENAI_KEY';\nconst SQAI_GROUNDING_AZURE_OPENAI_ENDPOINT = 'SQAI_GROUNDING_AZURE_OPENAI_ENDPOINT';\nconst SQAI_GROUNDING_AZURE_OPENAI_API_VERSION = 'SQAI_GROUNDING_AZURE_OPENAI_API_VERSION';\nconst SQAI_GROUNDING_AZURE_OPENAI_DEPLOYMENT = 'SQAI_GROUNDING_AZURE_OPENAI_DEPLOYMENT';\nconst SQAI_GROUNDING_AZURE_OPENAI_INIT_CONFIG_JSON = 'SQAI_GROUNDING_AZURE_OPENAI_INIT_CONFIG_JSON';\nconst SQAI_GROUNDING_USE_ANTHROPIC_SDK = 'SQAI_GROUNDING_USE_ANTHROPIC_SDK';\nconst SQAI_GROUNDING_ANTHROPIC_API_KEY = 'SQAI_GROUNDING_ANTHROPIC_API_KEY';\nconst SQAI_GROUNDING_VL_MODE = 'SQAI_GROUNDING_VL_MODE';\nconst OPENAI_USE_AZURE = 'OPENAI_USE_AZURE';\nconst UNUSED_ENV_KEYS = [\n    SQAI_DANGEROUSLY_PRINT_ALL_CONFIG\n];\nconst BASIC_ENV_KEYS = [\n    SQAI_DEBUG_MODE,\n    SQAI_DEBUG_AI_PROFILE,\n    SQAI_DEBUG_AI_RESPONSE,\n    SQAI_RUN_DIR\n];\nconst BOOLEAN_ENV_KEYS = [\n    SQAI_CACHE,\n    SQAI_LANGSMITH_DEBUG,\n    SQAI_FORCE_DEEP_THINK,\n    SQAI_MCP_USE_PUPPETEER_MODE,\n    SQAI_MCP_ANDROID_MODE\n];\nconst NUMBER_ENV_KEYS = [\n    SQAI_CACHE_MAX_FILENAME_LENGTH,\n    SQAI_REPLANNING_CYCLE_LIMIT\n];\nconst STRING_ENV_KEYS = [\n    OPENAI_MAX_TOKENS,\n    SQAI_ADB_PATH,\n    SQAI_ADB_REMOTE_HOST,\n    SQAI_ADB_REMOTE_PORT,\n    SQAI_ANDROID_IME_STRATEGY,\n    SQAI_IOS_DEVICE_UDID,\n    SQAI_IOS_SIMULATOR_UDID,\n    SQAI_REPORT_TAG_NAME,\n    SQAI_PREFERRED_LANGUAGE,\n    MATCH_BY_POSITION,\n    SQAI_MCP_CHROME_PATH,\n    DOCKER_CONTAINER\n];\nconst GLOBAL_ENV_KEYS = [\n    ...BOOLEAN_ENV_KEYS,\n    ...NUMBER_ENV_KEYS,\n    ...STRING_ENV_KEYS\n];\nconst MODEL_ENV_KEYS = [\n    SQAI_MODEL_NAME,\n    SQAI_OPENAI_INIT_CONFIG_JSON,\n    SQAI_OPENAI_API_KEY,\n    SQAI_OPENAI_BASE_URL,\n    SQAI_OPENAI_USE_AZURE,\n    SQAI_OPENAI_SOCKS_PROXY,\n    SQAI_OPENAI_HTTP_PROXY,\n    SQAI_USE_AZURE_OPENAI,\n    SQAI_AZURE_OPENAI_SCOPE,\n    SQAI_AZURE_OPENAI_INIT_CONFIG_JSON,\n    SQAI_USE_ANTHROPIC_SDK,\n    SQAI_USE_VLM_UI_TARS,\n    SQAI_USE_QWEN_VL,\n    SQAI_USE_QWEN3_VL,\n    SQAI_USE_DOUBAO_VISION,\n    SQAI_USE_GEMINI,\n    SQAI_USE_VL_MODEL,\n    ANTHROPIC_API_KEY,\n    SQAI_AZURE_OPENAI_ENDPOINT,\n    SQAI_AZURE_OPENAI_KEY,\n    SQAI_AZURE_OPENAI_API_VERSION,\n    SQAI_AZURE_OPENAI_DEPLOYMENT,\n    SQAI_VL_MODE,\n    OPENAI_API_KEY,\n    OPENAI_BASE_URL,\n    OPENAI_USE_AZURE,\n    ANTHROPIC_API_KEY,\n    AZURE_OPENAI_ENDPOINT,\n    AZURE_OPENAI_KEY,\n    AZURE_OPENAI_API_VERSION,\n    AZURE_OPENAI_DEPLOYMENT,\n    SQAI_VQA_MODEL_NAME,\n    SQAI_VQA_OPENAI_SOCKS_PROXY,\n    SQAI_VQA_OPENAI_HTTP_PROXY,\n    SQAI_VQA_OPENAI_BASE_URL,\n    SQAI_VQA_OPENAI_API_KEY,\n    SQAI_VQA_OPENAI_INIT_CONFIG_JSON,\n    SQAI_VQA_OPENAI_USE_AZURE,\n    SQAI_VQA_USE_AZURE_OPENAI,\n    SQAI_VQA_AZURE_OPENAI_SCOPE,\n    SQAI_VQA_AZURE_OPENAI_KEY,\n    SQAI_VQA_AZURE_OPENAI_ENDPOINT,\n    SQAI_VQA_AZURE_OPENAI_API_VERSION,\n    SQAI_VQA_AZURE_OPENAI_DEPLOYMENT,\n    SQAI_VQA_AZURE_OPENAI_INIT_CONFIG_JSON,\n    SQAI_VQA_USE_ANTHROPIC_SDK,\n    SQAI_VQA_ANTHROPIC_API_KEY,\n    SQAI_VQA_VL_MODE,\n    SQAI_PLANNING_MODEL_NAME,\n    SQAI_PLANNING_OPENAI_SOCKS_PROXY,\n    SQAI_PLANNING_OPENAI_HTTP_PROXY,\n    SQAI_PLANNING_OPENAI_BASE_URL,\n    SQAI_PLANNING_OPENAI_API_KEY,\n    SQAI_PLANNING_OPENAI_INIT_CONFIG_JSON,\n    SQAI_PLANNING_OPENAI_USE_AZURE,\n    SQAI_PLANNING_USE_AZURE_OPENAI,\n    SQAI_PLANNING_AZURE_OPENAI_SCOPE,\n    SQAI_PLANNING_AZURE_OPENAI_KEY,\n    SQAI_PLANNING_AZURE_OPENAI_ENDPOINT,\n    SQAI_PLANNING_AZURE_OPENAI_API_VERSION,\n    SQAI_PLANNING_AZURE_OPENAI_DEPLOYMENT,\n    SQAI_PLANNING_AZURE_OPENAI_INIT_CONFIG_JSON,\n    SQAI_PLANNING_USE_ANTHROPIC_SDK,\n    SQAI_PLANNING_ANTHROPIC_API_KEY,\n    SQAI_PLANNING_VL_MODE,\n    SQAI_GROUNDING_MODEL_NAME,\n    SQAI_GROUNDING_OPENAI_SOCKS_PROXY,\n    SQAI_GROUNDING_OPENAI_HTTP_PROXY,\n    SQAI_GROUNDING_OPENAI_BASE_URL,\n    SQAI_GROUNDING_OPENAI_API_KEY,\n    SQAI_GROUNDING_OPENAI_INIT_CONFIG_JSON,\n    SQAI_GROUNDING_OPENAI_USE_AZURE,\n    SQAI_GROUNDING_USE_AZURE_OPENAI,\n    SQAI_GROUNDING_AZURE_OPENAI_SCOPE,\n    SQAI_GROUNDING_AZURE_OPENAI_KEY,\n    SQAI_GROUNDING_AZURE_OPENAI_ENDPOINT,\n    SQAI_GROUNDING_AZURE_OPENAI_API_VERSION,\n    SQAI_GROUNDING_AZURE_OPENAI_DEPLOYMENT,\n    SQAI_GROUNDING_AZURE_OPENAI_INIT_CONFIG_JSON,\n    SQAI_GROUNDING_USE_ANTHROPIC_SDK,\n    SQAI_GROUNDING_ANTHROPIC_API_KEY,\n    SQAI_GROUNDING_VL_MODE\n];\nconst ALL_ENV_KEYS = [\n    ...UNUSED_ENV_KEYS,\n    ...BASIC_ENV_KEYS,\n    ...GLOBAL_ENV_KEYS,\n    ...MODEL_ENV_KEYS\n];\nvar types_UITarsModelVersion = /*#__PURE__*/ function(UITarsModelVersion) {\n    UITarsModelVersion[\"V1_0\"] = \"1.0\";\n    UITarsModelVersion[\"V1_5\"] = \"1.5\";\n    UITarsModelVersion[\"DOUBAO_1_5_15B\"] = \"doubao-1.5-15B\";\n    UITarsModelVersion[\"DOUBAO_1_5_20B\"] = \"doubao-1.5-20B\";\n    return UITarsModelVersion;\n}({});\nconst VL_MODE_RAW_VALID_VALUES = [\n    'doubao-vision',\n    'gemini',\n    'qwen-vl',\n    'qwen3-vl',\n    'vlm-ui-tars',\n    'vlm-ui-tars-doubao',\n    'vlm-ui-tars-doubao-1.5'\n];\nexport { ALL_ENV_KEYS, ANTHROPIC_API_KEY, AZURE_OPENAI_API_VERSION, AZURE_OPENAI_DEPLOYMENT, AZURE_OPENAI_ENDPOINT, AZURE_OPENAI_KEY, BASIC_ENV_KEYS, BOOLEAN_ENV_KEYS, DOCKER_CONTAINER, GLOBAL_ENV_KEYS, MATCH_BY_POSITION, MODEL_ENV_KEYS, NUMBER_ENV_KEYS, OPENAI_API_KEY, OPENAI_BASE_URL, OPENAI_MAX_TOKENS, OPENAI_USE_AZURE, SQAI_ADB_PATH, SQAI_ADB_REMOTE_HOST, SQAI_ADB_REMOTE_PORT, SQAI_ANDROID_IME_STRATEGY, SQAI_ANTHROPIC_API_KEY, SQAI_API_TYPE, SQAI_AZURE_OPENAI_API_VERSION, SQAI_AZURE_OPENAI_DEPLOYMENT, SQAI_AZURE_OPENAI_ENDPOINT, SQAI_AZURE_OPENAI_INIT_CONFIG_JSON, SQAI_AZURE_OPENAI_KEY, SQAI_AZURE_OPENAI_SCOPE, SQAI_CACHE, SQAI_CACHE_MAX_FILENAME_LENGTH, SQAI_DANGEROUSLY_PRINT_ALL_CONFIG, SQAI_DEBUG_AI_PROFILE, SQAI_DEBUG_AI_RESPONSE, SQAI_DEBUG_MODE, SQAI_FORCE_DEEP_THINK, SQAI_GROUNDING_ANTHROPIC_API_KEY, SQAI_GROUNDING_AZURE_OPENAI_API_VERSION, SQAI_GROUNDING_AZURE_OPENAI_DEPLOYMENT, SQAI_GROUNDING_AZURE_OPENAI_ENDPOINT, SQAI_GROUNDING_AZURE_OPENAI_INIT_CONFIG_JSON, SQAI_GROUNDING_AZURE_OPENAI_KEY, SQAI_GROUNDING_AZURE_OPENAI_SCOPE, SQAI_GROUNDING_MODEL_NAME, SQAI_GROUNDING_OPENAI_API_KEY, SQAI_GROUNDING_OPENAI_BASE_URL, SQAI_GROUNDING_OPENAI_HTTP_PROXY, SQAI_GROUNDING_OPENAI_INIT_CONFIG_JSON, SQAI_GROUNDING_OPENAI_SOCKS_PROXY, SQAI_GROUNDING_OPENAI_USE_AZURE, SQAI_GROUNDING_USE_ANTHROPIC_SDK, SQAI_GROUNDING_USE_AZURE_OPENAI, SQAI_GROUNDING_VL_MODE, SQAI_IOS_DEVICE_UDID, SQAI_IOS_SIMULATOR_UDID, SQAI_LANGSMITH_DEBUG, SQAI_MCP_ANDROID_MODE, SQAI_MCP_CHROME_PATH, SQAI_MCP_USE_PUPPETEER_MODE, SQAI_MODEL_NAME, SQAI_OPENAI_API_KEY, SQAI_OPENAI_BASE_URL, SQAI_OPENAI_HTTP_PROXY, SQAI_OPENAI_INIT_CONFIG_JSON, SQAI_OPENAI_SOCKS_PROXY, SQAI_OPENAI_USE_AZURE, SQAI_PLANNING_ANTHROPIC_API_KEY, SQAI_PLANNING_AZURE_OPENAI_API_VERSION, SQAI_PLANNING_AZURE_OPENAI_DEPLOYMENT, SQAI_PLANNING_AZURE_OPENAI_ENDPOINT, SQAI_PLANNING_AZURE_OPENAI_INIT_CONFIG_JSON, SQAI_PLANNING_AZURE_OPENAI_KEY, SQAI_PLANNING_AZURE_OPENAI_SCOPE, SQAI_PLANNING_MODEL_NAME, SQAI_PLANNING_OPENAI_API_KEY, SQAI_PLANNING_OPENAI_BASE_URL, SQAI_PLANNING_OPENAI_HTTP_PROXY, SQAI_PLANNING_OPENAI_INIT_CONFIG_JSON, SQAI_PLANNING_OPENAI_SOCKS_PROXY, SQAI_PLANNING_OPENAI_USE_AZURE, SQAI_PLANNING_USE_ANTHROPIC_SDK, SQAI_PLANNING_USE_AZURE_OPENAI, SQAI_PLANNING_VL_MODE, SQAI_PREFERRED_LANGUAGE, SQAI_REPLANNING_CYCLE_LIMIT, SQAI_REPORT_TAG_NAME, SQAI_RUN_DIR, SQAI_USE_ANTHROPIC_SDK, SQAI_USE_AZURE_OPENAI, SQAI_USE_DOUBAO_VISION, SQAI_USE_GEMINI, SQAI_USE_QWEN3_VL, SQAI_USE_QWEN_VL, SQAI_USE_VLM_UI_TARS, SQAI_USE_VL_MODEL, SQAI_VL_MODE, SQAI_VQA_ANTHROPIC_API_KEY, SQAI_VQA_AZURE_OPENAI_API_VERSION, SQAI_VQA_AZURE_OPENAI_DEPLOYMENT, SQAI_VQA_AZURE_OPENAI_ENDPOINT, SQAI_VQA_AZURE_OPENAI_INIT_CONFIG_JSON, SQAI_VQA_AZURE_OPENAI_KEY, SQAI_VQA_AZURE_OPENAI_SCOPE, SQAI_VQA_MODEL_NAME, SQAI_VQA_OPENAI_API_KEY, SQAI_VQA_OPENAI_BASE_URL, SQAI_VQA_OPENAI_HTTP_PROXY, SQAI_VQA_OPENAI_INIT_CONFIG_JSON, SQAI_VQA_OPENAI_SOCKS_PROXY, SQAI_VQA_OPENAI_USE_AZURE, SQAI_VQA_USE_ANTHROPIC_SDK, SQAI_VQA_USE_AZURE_OPENAI, SQAI_VQA_VL_MODE, STRING_ENV_KEYS, types_UITarsModelVersion as UITarsModelVersion, UNUSED_ENV_KEYS, VL_MODE_RAW_VALID_VALUES };\n","import { sha256 } from \"js-sha256\";\nimport { v4 } from \"uuid\";\nvar _process_versions;\nconst ifInBrowser = 'undefined' != typeof window;\nconst ifInWorker = 'undefined' != typeof WorkerGlobalScope;\nconst ifInNode = 'undefined' != typeof process && (null == (_process_versions = process.versions) ? void 0 : _process_versions.node);\nfunction uuid() {\n    return v4();\n}\nconst hashMap = {};\nfunction generateHashId(rect, content = '') {\n    const combined = JSON.stringify({\n        content,\n        rect\n    });\n    let sliceLength = 5;\n    let slicedHash = '';\n    const hashHex = sha256.create().update(combined).hex();\n    const toLetters = (hex)=>hex.split('').map((char)=>{\n            const code = Number.parseInt(char, 16);\n            return String.fromCharCode(97 + code % 26);\n        }).join('');\n    const hashLetters = toLetters(hashHex);\n    while(sliceLength < hashLetters.length - 1){\n        slicedHash = hashLetters.slice(0, sliceLength);\n        if (hashMap[slicedHash] && hashMap[slicedHash] !== combined) {\n            sliceLength++;\n            continue;\n        }\n        hashMap[slicedHash] = combined;\n        break;\n    }\n    return slicedHash;\n}\nfunction assert(condition, message) {\n    if (!condition) throw new Error(message || 'Assertion failed');\n}\nfunction getGlobalScope() {\n    if ('undefined' != typeof window) return window;\n    if ('undefined' != typeof globalThis) return globalThis;\n    if ('undefined' != typeof self) return self;\n}\nlet isMcp = false;\nfunction setIsMcp(value) {\n    isMcp = value;\n}\nfunction logMsg(...message) {\n    if (!isMcp) console.log(...message);\n}\nasync function repeat(times, fn) {\n    for(let i = 0; i < times; i++)await fn(i);\n}\nconst utils_REGEXP_LT = /</g;\nconst utils_REGEXP_GT = />/g;\nconst REGEXP_LT_ESCAPE = '__sqai_lt__';\nconst REGEXP_GT_ESCAPE = '__sqai_gt__';\nconst escapeScriptTag = (html)=>html.replace(utils_REGEXP_LT, REGEXP_LT_ESCAPE).replace(utils_REGEXP_GT, REGEXP_GT_ESCAPE);\nconst antiEscapeScriptTag = (html)=>{\n    const REGEXP_LT = new RegExp(REGEXP_LT_ESCAPE, 'g');\n    const REGEXP_GT = new RegExp(REGEXP_GT_ESCAPE, 'g');\n    return html.replace(REGEXP_LT, '<').replace(REGEXP_GT, '>');\n};\nfunction replaceIllegalPathCharsAndSpace(str) {\n    return str.replace(/[:*?\"<>| ]/g, '-');\n}\nexport { antiEscapeScriptTag, assert, escapeScriptTag, generateHashId, getGlobalScope, ifInBrowser, ifInNode, ifInWorker, logMsg, repeat, replaceIllegalPathCharsAndSpace, setIsMcp, uuid };\n","import { BASIC_ENV_KEYS } from \"./types.mjs\";\nconst getBasicEnvValue = (key)=>{\n    if (!BASIC_ENV_KEYS.includes(key)) throw new Error(`getBasicEnvValue with key ${key} is not supported.`);\n    return process.env[key];\n};\nexport { getBasicEnvValue };\n","import { existsSync, mkdirSync } from \"node:fs\";\nimport { tmpdir } from \"node:os\";\nimport node_path from \"node:path\";\nimport { getBasicEnvValue } from \"./env/basic.mjs\";\nimport { SQAI_RUN_DIR } from \"./env/types.mjs\";\nimport { ifInNode } from \"./utils.mjs\";\nconst defaultRunDirName = 'sqai_run';\nconst getMidsceneRunDir = ()=>{\n    if (!ifInNode) return '';\n    return getBasicEnvValue(SQAI_RUN_DIR) || defaultRunDirName;\n};\nconst getMidsceneRunBaseDir = ()=>{\n    if (!ifInNode) return '';\n    let basePath = node_path.resolve(process.cwd(), getMidsceneRunDir());\n    if (!existsSync(basePath)) try {\n        mkdirSync(basePath, {\n            recursive: true\n        });\n    } catch (error) {\n        basePath = node_path.join(tmpdir(), defaultRunDirName);\n        mkdirSync(basePath, {\n            recursive: true\n        });\n    }\n    return basePath;\n};\nconst getMidsceneRunSubDir = (subdir)=>{\n    if (!ifInNode) return '';\n    const basePath = getMidsceneRunBaseDir();\n    const logPath = node_path.join(basePath, subdir);\n    if (!existsSync(logPath)) mkdirSync(logPath, {\n        recursive: true\n    });\n    return logPath;\n};\nconst ERROR_CODE_NOT_IMPLEMENTED_AS_DESIGNED = 'NOT_IMPLEMENTED_AS_DESIGNED';\nexport { ERROR_CODE_NOT_IMPLEMENTED_AS_DESIGNED, defaultRunDirName, getMidsceneRunBaseDir, getMidsceneRunDir, getMidsceneRunSubDir };\n","import node_fs from \"node:fs\";\nimport node_path from \"node:path\";\nimport node_util from \"node:util\";\nimport debug from \"debug\";\nimport { getMidsceneRunSubDir } from \"./common.mjs\";\nimport { ifInNode } from \"./utils.mjs\";\nconst topicPrefix = 'sqai';\nconst logStreams = new Map();\nconst debugInstances = new Map();\nfunction getLogStream(topic) {\n    const topicFileName = topic.replace(/:/g, '-');\n    if (!logStreams.has(topicFileName)) {\n        const logFile = node_path.join(getMidsceneRunSubDir('log'), `${topicFileName}.log`);\n        const stream = node_fs.createWriteStream(logFile, {\n            flags: 'a'\n        });\n        logStreams.set(topicFileName, stream);\n    }\n    return logStreams.get(topicFileName);\n}\nfunction writeLogToFile(topic, message) {\n    if (!ifInNode) return;\n    const stream = getLogStream(topic);\n    const now = new Date();\n    const isoDate = now.toLocaleDateString('sv-SE');\n    const isoTime = now.toLocaleTimeString('sv-SE');\n    const milliseconds = now.getMilliseconds().toString().padStart(3, '0');\n    const timezoneOffsetMinutes = now.getTimezoneOffset();\n    const sign = timezoneOffsetMinutes <= 0 ? '+' : '-';\n    const hours = Math.floor(Math.abs(timezoneOffsetMinutes) / 60).toString().padStart(2, '0');\n    const minutes = (Math.abs(timezoneOffsetMinutes) % 60).toString().padStart(2, '0');\n    const timezoneString = `${sign}${hours}:${minutes}`;\n    const localISOTime = `${isoDate}T${isoTime}.${milliseconds}${timezoneString}`;\n    stream.write(`[${localISOTime}] ${message}\\n`);\n}\nfunction getDebug(topic) {\n    const fullTopic = `${topicPrefix}:${topic}`;\n    if (!debugInstances.has(fullTopic)) {\n        const debugFn = debug(fullTopic);\n        const wrapper = (...args)=>{\n            if (ifInNode) {\n                const message = node_util.format(...args);\n                writeLogToFile(topic, message);\n            }\n            debugFn(...args);\n        };\n        debugInstances.set(fullTopic, wrapper);\n    }\n    return debugInstances.get(fullTopic);\n}\nfunction enableDebug(topic) {\n    if (ifInNode) return;\n    debug.enable(`${topicPrefix}:${topic}`);\n}\nfunction cleanupLogStreams() {\n    if (!ifInNode) return;\n    for (const stream of logStreams.values())stream.end();\n    logStreams.clear();\n    debugInstances.clear();\n}\nexport { cleanupLogStreams, enableDebug, getDebug };\n","import { enableDebug } from \"../logger.mjs\";\nimport { getBasicEnvValue } from \"./basic.mjs\";\nimport { SQAI_DEBUG_AI_PROFILE, SQAI_DEBUG_AI_RESPONSE } from \"./types.mjs\";\nconst initDebugConfig = ()=>{\n    const shouldPrintTiming = getBasicEnvValue(SQAI_DEBUG_AI_PROFILE);\n    let debugConfig = '';\n    if (shouldPrintTiming) {\n        console.warn('SQAI_DEBUG_AI_PROFILE is deprecated, use DEBUG=sqai:ai:profile instead');\n        debugConfig = 'ai:profile';\n    }\n    const shouldPrintAIResponse = getBasicEnvValue(SQAI_DEBUG_AI_RESPONSE);\n    if (shouldPrintAIResponse) {\n        console.warn('SQAI_DEBUG_AI_RESPONSE is deprecated, use DEBUG=sqai:ai:response instead');\n        debugConfig = debugConfig ? 'ai:*' : 'ai:call';\n    }\n    if (debugConfig) enableDebug(debugConfig);\n};\nexport { initDebugConfig };\n","import { initDebugConfig } from \"./init-debug.mjs\";\nimport { ALL_ENV_KEYS, BOOLEAN_ENV_KEYS, GLOBAL_ENV_KEYS, MATCH_BY_POSITION, MODEL_ENV_KEYS, NUMBER_ENV_KEYS, STRING_ENV_KEYS } from \"./types.mjs\";\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nclass GlobalConfigManager {\n    getAllEnvConfig() {\n        const envConfig = ALL_ENV_KEYS.reduce((p, name)=>{\n            p[name] = process.env[name];\n            return p;\n        }, Object.create(null));\n        if (!this.override) return envConfig;\n        {\n            const { newConfig, extendMode } = this.override;\n            if (extendMode) return {\n                ...envConfig,\n                ...newConfig\n            };\n            return {\n                ...newConfig\n            };\n        }\n    }\n    getEnvConfigValue(key) {\n        const allConfig = this.getAllEnvConfig();\n        if (!STRING_ENV_KEYS.includes(key)) throw new Error(`getEnvConfigValue with key ${key} is not supported.`);\n        if (key === MATCH_BY_POSITION) throw new Error('MATCH_BY_POSITION is deprecated, use SQAI_USE_VL_MODEL instead');\n        const value = allConfig[key];\n        this.keysHaveBeenRead[key] = true;\n        if ('string' == typeof value) return value.trim();\n        return value;\n    }\n    getEnvConfigInNumber(key) {\n        const allConfig = this.getAllEnvConfig();\n        if (!NUMBER_ENV_KEYS.includes(key)) throw new Error(`getEnvConfigInNumber with key ${key} is not supported`);\n        const value = allConfig[key];\n        this.keysHaveBeenRead[key] = true;\n        return Number(value || '');\n    }\n    getEnvConfigInBoolean(key) {\n        const allConfig = this.getAllEnvConfig();\n        if (!BOOLEAN_ENV_KEYS.includes(key)) throw new Error(`getEnvConfigInBoolean with key ${key} is not supported`);\n        const value = allConfig[key];\n        this.keysHaveBeenRead[key] = true;\n        if (!value) return false;\n        if (/^(true|1)$/i.test(value)) return true;\n        if (/^(false|0)$/i.test(value)) return false;\n        return !!value.trim();\n    }\n    registerModelConfigManager(globalModelConfigManager) {\n        this.globalModelConfigManager = globalModelConfigManager;\n    }\n    overrideAIConfig(newConfig, extendMode = false) {\n        var _this_override;\n        for(const key in newConfig){\n            if (![\n                ...GLOBAL_ENV_KEYS,\n                ...MODEL_ENV_KEYS\n            ].includes(key)) throw new Error(`Failed to override AI config, invalid key: ${key}`);\n            const value = newConfig[key];\n            if ('string' != typeof value) throw new Error(`Failed to override AI config, value for key ${key} must be a string, but got with type ${typeof value}`);\n            if (this.keysHaveBeenRead[key]) console.warn(`Warning: try to override AI config with key ${key} ,but it has been read.`);\n        }\n        const savedNewConfig = extendMode ? {\n            ...null == (_this_override = this.override) ? void 0 : _this_override.newConfig,\n            ...newConfig\n        } : newConfig;\n        this.override = {\n            newConfig: {\n                ...savedNewConfig\n            },\n            extendMode\n        };\n        if (!this.globalModelConfigManager) throw new Error('globalModelConfigManager is not registered, which should not happen');\n        this.globalModelConfigManager.clearModelConfigMap();\n    }\n    constructor(){\n        _define_property(this, \"override\", void 0);\n        _define_property(this, \"keysHaveBeenRead\", {});\n        _define_property(this, \"globalModelConfigManager\", void 0);\n        initDebugConfig();\n    }\n}\nexport { GlobalConfigManager };\n","import { ANTHROPIC_API_KEY, AZURE_OPENAI_API_VERSION, AZURE_OPENAI_DEPLOYMENT, AZURE_OPENAI_ENDPOINT, AZURE_OPENAI_KEY, OPENAI_API_KEY, OPENAI_BASE_URL, OPENAI_USE_AZURE, SQAI_ANTHROPIC_API_KEY, SQAI_AZURE_OPENAI_API_VERSION, SQAI_AZURE_OPENAI_DEPLOYMENT, SQAI_AZURE_OPENAI_ENDPOINT, SQAI_AZURE_OPENAI_INIT_CONFIG_JSON, SQAI_AZURE_OPENAI_KEY, SQAI_AZURE_OPENAI_SCOPE, SQAI_GROUNDING_ANTHROPIC_API_KEY, SQAI_GROUNDING_AZURE_OPENAI_API_VERSION, SQAI_GROUNDING_AZURE_OPENAI_DEPLOYMENT, SQAI_GROUNDING_AZURE_OPENAI_ENDPOINT, SQAI_GROUNDING_AZURE_OPENAI_INIT_CONFIG_JSON, SQAI_GROUNDING_AZURE_OPENAI_KEY, SQAI_GROUNDING_AZURE_OPENAI_SCOPE, SQAI_GROUNDING_MODEL_NAME, SQAI_GROUNDING_OPENAI_API_KEY, SQAI_GROUNDING_OPENAI_BASE_URL, SQAI_GROUNDING_OPENAI_HTTP_PROXY, SQAI_GROUNDING_OPENAI_INIT_CONFIG_JSON, SQAI_GROUNDING_OPENAI_SOCKS_PROXY, SQAI_GROUNDING_OPENAI_USE_AZURE, SQAI_GROUNDING_USE_ANTHROPIC_SDK, SQAI_GROUNDING_USE_AZURE_OPENAI, SQAI_GROUNDING_VL_MODE, SQAI_MODEL_NAME, SQAI_OPENAI_API_KEY, SQAI_OPENAI_BASE_URL, SQAI_OPENAI_HTTP_PROXY, SQAI_OPENAI_INIT_CONFIG_JSON, SQAI_OPENAI_SOCKS_PROXY, SQAI_OPENAI_USE_AZURE, SQAI_PLANNING_ANTHROPIC_API_KEY, SQAI_PLANNING_AZURE_OPENAI_API_VERSION, SQAI_PLANNING_AZURE_OPENAI_DEPLOYMENT, SQAI_PLANNING_AZURE_OPENAI_ENDPOINT, SQAI_PLANNING_AZURE_OPENAI_INIT_CONFIG_JSON, SQAI_PLANNING_AZURE_OPENAI_KEY, SQAI_PLANNING_AZURE_OPENAI_SCOPE, SQAI_PLANNING_MODEL_NAME, SQAI_PLANNING_OPENAI_API_KEY, SQAI_PLANNING_OPENAI_BASE_URL, SQAI_PLANNING_OPENAI_HTTP_PROXY, SQAI_PLANNING_OPENAI_INIT_CONFIG_JSON, SQAI_PLANNING_OPENAI_SOCKS_PROXY, SQAI_PLANNING_OPENAI_USE_AZURE, SQAI_PLANNING_USE_ANTHROPIC_SDK, SQAI_PLANNING_USE_AZURE_OPENAI, SQAI_PLANNING_VL_MODE, SQAI_USE_ANTHROPIC_SDK, SQAI_USE_AZURE_OPENAI, SQAI_VL_MODE, SQAI_VQA_ANTHROPIC_API_KEY, SQAI_VQA_AZURE_OPENAI_API_VERSION, SQAI_VQA_AZURE_OPENAI_DEPLOYMENT, SQAI_VQA_AZURE_OPENAI_ENDPOINT, SQAI_VQA_AZURE_OPENAI_INIT_CONFIG_JSON, SQAI_VQA_AZURE_OPENAI_KEY, SQAI_VQA_AZURE_OPENAI_SCOPE, SQAI_VQA_MODEL_NAME, SQAI_VQA_OPENAI_API_KEY, SQAI_VQA_OPENAI_BASE_URL, SQAI_VQA_OPENAI_HTTP_PROXY, SQAI_VQA_OPENAI_INIT_CONFIG_JSON, SQAI_VQA_OPENAI_SOCKS_PROXY, SQAI_VQA_OPENAI_USE_AZURE, SQAI_VQA_USE_ANTHROPIC_SDK, SQAI_VQA_USE_AZURE_OPENAI, SQAI_VQA_VL_MODE } from \"./types.mjs\";\nconst VQA_MODEL_CONFIG_KEYS = {\n    modelName: SQAI_VQA_MODEL_NAME,\n    socksProxy: SQAI_VQA_OPENAI_SOCKS_PROXY,\n    httpProxy: SQAI_VQA_OPENAI_HTTP_PROXY,\n    openaiBaseURL: SQAI_VQA_OPENAI_BASE_URL,\n    openaiApiKey: SQAI_VQA_OPENAI_API_KEY,\n    openaiExtraConfig: SQAI_VQA_OPENAI_INIT_CONFIG_JSON,\n    openaiUseAzureDeprecated: SQAI_VQA_OPENAI_USE_AZURE,\n    useAzureOpenai: SQAI_VQA_USE_AZURE_OPENAI,\n    azureOpenaiScope: SQAI_VQA_AZURE_OPENAI_SCOPE,\n    azureOpenaiKey: SQAI_VQA_AZURE_OPENAI_KEY,\n    azureOpenaiEndpoint: SQAI_VQA_AZURE_OPENAI_ENDPOINT,\n    azureOpenaiApiVersion: SQAI_VQA_AZURE_OPENAI_API_VERSION,\n    azureOpenaiDeployment: SQAI_VQA_AZURE_OPENAI_DEPLOYMENT,\n    azureExtraConfig: SQAI_VQA_AZURE_OPENAI_INIT_CONFIG_JSON,\n    useAnthropicSdk: SQAI_VQA_USE_ANTHROPIC_SDK,\n    anthropicApiKey: SQAI_VQA_ANTHROPIC_API_KEY,\n    vlMode: SQAI_VQA_VL_MODE\n};\nconst GROUNDING_MODEL_CONFIG_KEYS = {\n    modelName: SQAI_GROUNDING_MODEL_NAME,\n    socksProxy: SQAI_GROUNDING_OPENAI_SOCKS_PROXY,\n    httpProxy: SQAI_GROUNDING_OPENAI_HTTP_PROXY,\n    openaiBaseURL: SQAI_GROUNDING_OPENAI_BASE_URL,\n    openaiApiKey: SQAI_GROUNDING_OPENAI_API_KEY,\n    openaiExtraConfig: SQAI_GROUNDING_OPENAI_INIT_CONFIG_JSON,\n    openaiUseAzureDeprecated: SQAI_GROUNDING_OPENAI_USE_AZURE,\n    useAzureOpenai: SQAI_GROUNDING_USE_AZURE_OPENAI,\n    azureOpenaiScope: SQAI_GROUNDING_AZURE_OPENAI_SCOPE,\n    azureOpenaiKey: SQAI_GROUNDING_AZURE_OPENAI_KEY,\n    azureOpenaiEndpoint: SQAI_GROUNDING_AZURE_OPENAI_ENDPOINT,\n    azureOpenaiApiVersion: SQAI_GROUNDING_AZURE_OPENAI_API_VERSION,\n    azureOpenaiDeployment: SQAI_GROUNDING_AZURE_OPENAI_DEPLOYMENT,\n    azureExtraConfig: SQAI_GROUNDING_AZURE_OPENAI_INIT_CONFIG_JSON,\n    useAnthropicSdk: SQAI_GROUNDING_USE_ANTHROPIC_SDK,\n    anthropicApiKey: SQAI_GROUNDING_ANTHROPIC_API_KEY,\n    vlMode: SQAI_GROUNDING_VL_MODE\n};\nconst PLANNING_MODEL_CONFIG_KEYS = {\n    modelName: SQAI_PLANNING_MODEL_NAME,\n    socksProxy: SQAI_PLANNING_OPENAI_SOCKS_PROXY,\n    httpProxy: SQAI_PLANNING_OPENAI_HTTP_PROXY,\n    openaiBaseURL: SQAI_PLANNING_OPENAI_BASE_URL,\n    openaiApiKey: SQAI_PLANNING_OPENAI_API_KEY,\n    openaiExtraConfig: SQAI_PLANNING_OPENAI_INIT_CONFIG_JSON,\n    openaiUseAzureDeprecated: SQAI_PLANNING_OPENAI_USE_AZURE,\n    useAzureOpenai: SQAI_PLANNING_USE_AZURE_OPENAI,\n    azureOpenaiScope: SQAI_PLANNING_AZURE_OPENAI_SCOPE,\n    azureOpenaiKey: SQAI_PLANNING_AZURE_OPENAI_KEY,\n    azureOpenaiEndpoint: SQAI_PLANNING_AZURE_OPENAI_ENDPOINT,\n    azureOpenaiApiVersion: SQAI_PLANNING_AZURE_OPENAI_API_VERSION,\n    azureOpenaiDeployment: SQAI_PLANNING_AZURE_OPENAI_DEPLOYMENT,\n    azureExtraConfig: SQAI_PLANNING_AZURE_OPENAI_INIT_CONFIG_JSON,\n    useAnthropicSdk: SQAI_PLANNING_USE_ANTHROPIC_SDK,\n    anthropicApiKey: SQAI_PLANNING_ANTHROPIC_API_KEY,\n    vlMode: SQAI_PLANNING_VL_MODE\n};\nconst DEFAULT_MODEL_CONFIG_KEYS = {\n    modelName: SQAI_MODEL_NAME,\n    socksProxy: SQAI_OPENAI_SOCKS_PROXY,\n    httpProxy: SQAI_OPENAI_HTTP_PROXY,\n    openaiBaseURL: SQAI_OPENAI_BASE_URL,\n    openaiApiKey: SQAI_OPENAI_API_KEY,\n    openaiExtraConfig: SQAI_OPENAI_INIT_CONFIG_JSON,\n    openaiUseAzureDeprecated: SQAI_OPENAI_USE_AZURE,\n    useAzureOpenai: SQAI_USE_AZURE_OPENAI,\n    azureOpenaiScope: SQAI_AZURE_OPENAI_SCOPE,\n    azureOpenaiKey: SQAI_AZURE_OPENAI_KEY,\n    azureOpenaiEndpoint: SQAI_AZURE_OPENAI_ENDPOINT,\n    azureOpenaiApiVersion: SQAI_AZURE_OPENAI_API_VERSION,\n    azureOpenaiDeployment: SQAI_AZURE_OPENAI_DEPLOYMENT,\n    azureExtraConfig: SQAI_AZURE_OPENAI_INIT_CONFIG_JSON,\n    useAnthropicSdk: SQAI_USE_ANTHROPIC_SDK,\n    anthropicApiKey: SQAI_ANTHROPIC_API_KEY,\n    vlMode: SQAI_VL_MODE\n};\nconst DEFAULT_MODEL_CONFIG_KEYS_LEGACY = {\n    modelName: SQAI_MODEL_NAME,\n    socksProxy: SQAI_OPENAI_SOCKS_PROXY,\n    httpProxy: SQAI_OPENAI_HTTP_PROXY,\n    openaiBaseURL: OPENAI_BASE_URL,\n    openaiApiKey: OPENAI_API_KEY,\n    openaiExtraConfig: SQAI_OPENAI_INIT_CONFIG_JSON,\n    openaiUseAzureDeprecated: OPENAI_USE_AZURE,\n    useAzureOpenai: SQAI_USE_AZURE_OPENAI,\n    azureOpenaiScope: SQAI_AZURE_OPENAI_SCOPE,\n    azureOpenaiKey: AZURE_OPENAI_KEY,\n    azureOpenaiEndpoint: AZURE_OPENAI_ENDPOINT,\n    azureOpenaiApiVersion: AZURE_OPENAI_API_VERSION,\n    azureOpenaiDeployment: AZURE_OPENAI_DEPLOYMENT,\n    azureExtraConfig: SQAI_AZURE_OPENAI_INIT_CONFIG_JSON,\n    useAnthropicSdk: SQAI_USE_ANTHROPIC_SDK,\n    anthropicApiKey: ANTHROPIC_API_KEY,\n    vlMode: 'DEFAULT_MODEL_CONFIG_KEYS has no vlMode key'\n};\nexport { DEFAULT_MODEL_CONFIG_KEYS, DEFAULT_MODEL_CONFIG_KEYS_LEGACY, GROUNDING_MODEL_CONFIG_KEYS, PLANNING_MODEL_CONFIG_KEYS, VQA_MODEL_CONFIG_KEYS };\n","import { assert } from \"../utils.mjs\";\nconst maskKey = (key, maskChar = '*')=>{\n    if ('string' != typeof key || 0 === key.length) return key;\n    const prefixLen = 3;\n    const suffixLen = 3;\n    const keepLength = prefixLen + suffixLen;\n    if (key.length <= keepLength) return key;\n    const prefix = key.substring(0, prefixLen);\n    const suffix = key.substring(key.length - suffixLen);\n    const maskLength = key.length - keepLength;\n    const mask = maskChar.repeat(maskLength);\n    return `${prefix}${mask}${suffix}`;\n};\nconst maskConfig = (config)=>Object.fromEntries(Object.entries(config).map(([key, value])=>{\n        if ([\n            'openaiApiKey',\n            'azureOpenaiKey',\n            'anthropicApiKey'\n        ].includes(key)) return [\n            key,\n            maskKey(value)\n        ];\n        if ([\n            'openaiExtraConfig',\n            'azureExtraConfig'\n        ].includes(key)) return [\n            key,\n            maskKey(JSON.stringify(value))\n        ];\n        return [\n            key,\n            value\n        ];\n    }));\nconst parseJson = (key, value)=>{\n    if (value) try {\n        return JSON.parse(value);\n    } catch (e) {\n        throw new Error(`Failed to parse ${key} as a JSON. ${e.message}`, {\n            cause: e\n        });\n    }\n};\nconst createAssert = (modelNameKey, provider, modelName)=>(value, key, modelVendorFlag)=>{\n        if (modelName) modelVendorFlag ? assert(value, `The ${key} must be a non-empty string because of the ${modelNameKey} is declared as ${modelName} and ${modelVendorFlag} has also been specified in ${provider}, but got: ${value}. Please check your config.`) : assert(value, `The ${key} must be a non-empty string because of the ${modelNameKey} is declared as ${modelName} in ${provider}, but got: ${value}. Please check your config.`);\n        else assert(value, `The ${key} must be a non-empty string, but got: ${value}. Please check your config.`);\n    };\nexport { createAssert, maskConfig, parseJson };\n","import { SQAI_USE_DOUBAO_VISION, SQAI_USE_GEMINI, SQAI_USE_QWEN3_VL, SQAI_USE_QWEN_VL, SQAI_USE_VLM_UI_TARS, UITarsModelVersion, VL_MODE_RAW_VALID_VALUES } from \"./types.mjs\";\nconst parseVlModeAndUiTarsModelVersionFromRawValue = (vlModeRaw)=>{\n    if (!vlModeRaw) return {\n        vlMode: void 0,\n        uiTarsVersion: void 0\n    };\n    if (!VL_MODE_RAW_VALID_VALUES.includes(vlModeRaw)) throw new Error(`the value ${vlModeRaw} is not a valid VL_MODE value, must be one of ${VL_MODE_RAW_VALID_VALUES}`);\n    const raw = vlModeRaw;\n    if ('vlm-ui-tars' === raw) return {\n        vlMode: 'vlm-ui-tars',\n        uiTarsVersion: UITarsModelVersion.V1_0\n    };\n    if ('vlm-ui-tars-doubao' === raw || 'vlm-ui-tars-doubao-1.5' === raw) return {\n        vlMode: 'vlm-ui-tars',\n        uiTarsVersion: UITarsModelVersion.DOUBAO_1_5_20B\n    };\n    return {\n        vlMode: raw,\n        uiTarsVersion: void 0\n    };\n};\nconst parseVlModeAndUiTarsFromGlobalConfig = (provider)=>{\n    const isDoubao = provider[SQAI_USE_DOUBAO_VISION];\n    const isQwen = provider[SQAI_USE_QWEN_VL];\n    const isQwen3 = provider[SQAI_USE_QWEN3_VL];\n    const isUiTars = provider[SQAI_USE_VLM_UI_TARS];\n    const isGemini = provider[SQAI_USE_GEMINI];\n    const enabledModes = [\n        isDoubao && SQAI_USE_DOUBAO_VISION,\n        isQwen && SQAI_USE_QWEN_VL,\n        isQwen3 && SQAI_USE_QWEN3_VL,\n        isUiTars && SQAI_USE_VLM_UI_TARS,\n        isGemini && SQAI_USE_GEMINI\n    ].filter(Boolean);\n    if (enabledModes.length > 1) throw new Error(`Only one vision mode can be enabled at a time. Currently enabled modes: ${enabledModes.join(', ')}. Please disable all but one mode.`);\n    if (isQwen3) return {\n        vlMode: 'qwen3-vl',\n        uiTarsVersion: void 0\n    };\n    if (isQwen) return {\n        vlMode: 'qwen-vl',\n        uiTarsVersion: void 0\n    };\n    if (isDoubao) return {\n        vlMode: 'doubao-vision',\n        uiTarsVersion: void 0\n    };\n    if (isGemini) return {\n        vlMode: 'gemini',\n        uiTarsVersion: void 0\n    };\n    if (isUiTars) if ('1' === isUiTars) return {\n        vlMode: 'vlm-ui-tars',\n        uiTarsVersion: UITarsModelVersion.V1_0\n    };\n    else if ('DOUBAO' === isUiTars || 'DOUBAO-1.5' === isUiTars) return {\n        vlMode: 'vlm-ui-tars',\n        uiTarsVersion: UITarsModelVersion.DOUBAO_1_5_20B\n    };\n    else return {\n        vlMode: 'vlm-ui-tars',\n        uiTarsVersion: `${isUiTars}`\n    };\n    return {\n        vlMode: void 0,\n        uiTarsVersion: void 0\n    };\n};\nexport { parseVlModeAndUiTarsFromGlobalConfig, parseVlModeAndUiTarsModelVersionFromRawValue };\n","import { DEFAULT_MODEL_CONFIG_KEYS, DEFAULT_MODEL_CONFIG_KEYS_LEGACY, GROUNDING_MODEL_CONFIG_KEYS, PLANNING_MODEL_CONFIG_KEYS, VQA_MODEL_CONFIG_KEYS } from \"./constants.mjs\";\nimport { getDebug } from \"../logger.mjs\";\nimport { assert } from \"../utils.mjs\";\nimport { createAssert, maskConfig, parseJson } from \"./helper.mjs\";\nimport { initDebugConfig } from \"./init-debug.mjs\";\nimport { parseVlModeAndUiTarsFromGlobalConfig, parseVlModeAndUiTarsModelVersionFromRawValue } from \"./parse.mjs\";\nconst KEYS_MAP = {\n    VQA: VQA_MODEL_CONFIG_KEYS,\n    grounding: GROUNDING_MODEL_CONFIG_KEYS,\n    planning: PLANNING_MODEL_CONFIG_KEYS,\n    default: DEFAULT_MODEL_CONFIG_KEYS\n};\nconst decideOpenaiSdkConfig = ({ keys, provider, valueAssert })=>{\n    initDebugConfig();\n    const debugLog = getDebug('ai:config');\n    const socksProxy = provider[keys.socksProxy];\n    const httpProxy = provider[keys.httpProxy];\n    const vlMode = provider[keys.vlMode];\n    debugLog('enter decideOpenaiSdkConfig with keys:', keys);\n    if (provider[keys.openaiUseAzureDeprecated]) {\n        debugLog(`provider has ${keys.openaiUseAzureDeprecated} with value${provider[keys.openaiUseAzureDeprecated]}`);\n        const openaiBaseURL = provider[keys.openaiBaseURL];\n        const openaiApiKey = provider[keys.openaiApiKey];\n        const openaiExtraConfig = parseJson(keys.openaiExtraConfig, provider[keys.openaiExtraConfig]);\n        valueAssert(openaiApiKey, keys.openaiApiKey, keys.openaiUseAzureDeprecated);\n        return {\n            socksProxy,\n            httpProxy,\n            vlModeRaw: vlMode,\n            openaiUseAzureDeprecated: true,\n            openaiApiKey,\n            openaiBaseURL,\n            openaiExtraConfig\n        };\n    }\n    if (provider[keys.useAzureOpenai]) {\n        debugLog(`provider has ${keys.useAzureOpenai} with value ${provider[keys.useAzureOpenai]}`);\n        const azureOpenaiScope = provider[keys.azureOpenaiScope];\n        const azureOpenaiKey = provider[keys.azureOpenaiKey];\n        const azureOpenaiEndpoint = provider[keys.azureOpenaiEndpoint];\n        const azureOpenaiDeployment = provider[keys.azureOpenaiDeployment];\n        const azureOpenaiApiVersion = provider[keys.azureOpenaiApiVersion];\n        const azureExtraConfig = parseJson(keys.azureExtraConfig, provider[keys.azureExtraConfig]);\n        const openaiExtraConfig = parseJson(keys.openaiExtraConfig, provider[keys.openaiExtraConfig]);\n        valueAssert(azureOpenaiKey, keys.azureOpenaiKey, keys.useAzureOpenai);\n        return {\n            socksProxy,\n            httpProxy,\n            vlModeRaw: vlMode,\n            useAzureOpenai: true,\n            azureOpenaiScope,\n            azureOpenaiKey,\n            azureOpenaiEndpoint,\n            azureOpenaiDeployment,\n            azureOpenaiApiVersion,\n            azureExtraConfig,\n            openaiExtraConfig\n        };\n    }\n    if (provider[keys.useAnthropicSdk]) {\n        debugLog(`provider has ${keys.useAnthropicSdk} with value ${provider[keys.useAnthropicSdk]}`);\n        const anthropicApiKey = provider[keys.anthropicApiKey];\n        valueAssert(anthropicApiKey, keys.anthropicApiKey, keys.useAnthropicSdk);\n        return {\n            socksProxy,\n            httpProxy,\n            useAnthropicSdk: true,\n            anthropicApiKey\n        };\n    }\n    {\n        debugLog('provider has no specific model SDK declared');\n        const openaiBaseURL = provider[keys.openaiBaseURL];\n        const openaiApiKey = provider[keys.openaiApiKey];\n        const openaiExtraConfig = parseJson(keys.openaiExtraConfig, provider[keys.openaiExtraConfig]);\n        valueAssert(openaiApiKey, keys.openaiApiKey);\n        return {\n            socksProxy,\n            httpProxy,\n            vlModeRaw: vlMode,\n            openaiBaseURL,\n            openaiApiKey,\n            openaiExtraConfig\n        };\n    }\n};\nconst getModelDescription = (vlMode, uiTarsVersion)=>{\n    if (vlMode) if (uiTarsVersion) return `UI-TARS=${uiTarsVersion}`;\n    else return `${vlMode} mode`;\n    return '';\n};\nconst decideModelConfigFromIntentConfig = (intent, intentConfig)=>{\n    const debugLog = getDebug('ai:config');\n    debugLog('decideModelConfig base on agent.modelConfig()');\n    const keysForFn = KEYS_MAP[intent];\n    const candidateModelNameFromConfig = intentConfig[keysForFn.modelName];\n    debugLog('Got modelName from modelConfigFn', candidateModelNameFromConfig);\n    const chosenKeys = (()=>{\n        if (candidateModelNameFromConfig) {\n            debugLog('query modelConfig from fn by intent got corresponding modelName, will get other corresponding keys');\n            return keysForFn;\n        }\n        debugLog('query modelConfig from fn by intent got no corresponding modelName, will get other keys by default');\n        assert(intentConfig[DEFAULT_MODEL_CONFIG_KEYS.modelName], `The return value of agent.modelConfig do not have a valid value with key ${DEFAULT_MODEL_CONFIG_KEYS.modelName}.`);\n        return DEFAULT_MODEL_CONFIG_KEYS;\n    })();\n    const result = decideOpenaiSdkConfig({\n        keys: chosenKeys,\n        provider: intentConfig,\n        valueAssert: createAssert(chosenKeys.modelName, 'modelConfig', candidateModelNameFromConfig)\n    });\n    const { vlMode, uiTarsVersion } = parseVlModeAndUiTarsModelVersionFromRawValue(result.vlModeRaw);\n    const modelDescription = getModelDescription(vlMode, uiTarsVersion);\n    const finalResult = {\n        ...result,\n        modelName: intentConfig[chosenKeys.modelName],\n        vlMode,\n        uiTarsModelVersion: uiTarsVersion,\n        modelDescription,\n        from: 'modelConfig',\n        intent\n    };\n    debugLog(`decideModelConfig result by agent.modelConfig() with intent ${intent}:`, maskConfig(finalResult));\n    return finalResult;\n};\nconst decideModelConfigFromEnv = (intent, allEnvConfig)=>{\n    initDebugConfig();\n    const debugLog = getDebug('ai:config');\n    const keysForEnv = 'default' === intent ? DEFAULT_MODEL_CONFIG_KEYS_LEGACY : KEYS_MAP[intent];\n    if ('default' !== intent && allEnvConfig[keysForEnv.modelName]) {\n        const modelName = allEnvConfig[keysForEnv.modelName];\n        debugLog(`Got intent ${intent} corresponding modelName ${modelName} by key ${keysForEnv.modelName} from globalConfig, will get other config by intent.`);\n        const result = decideOpenaiSdkConfig({\n            keys: keysForEnv,\n            provider: allEnvConfig,\n            valueAssert: createAssert(keysForEnv.modelName, 'process.env', modelName)\n        });\n        const { vlMode, uiTarsVersion } = parseVlModeAndUiTarsModelVersionFromRawValue(result.vlModeRaw);\n        const modelDescription = getModelDescription(vlMode, uiTarsVersion);\n        const finalResult = {\n            ...result,\n            modelName,\n            vlMode,\n            uiTarsModelVersion: uiTarsVersion,\n            modelDescription,\n            from: 'env',\n            intent\n        };\n        debugLog(`decideModelConfig result by process.env with intent ${intent}:`, maskConfig(finalResult));\n        return finalResult;\n    }\n    debugLog(`decideModelConfig as legacy logic with intent ${intent}.`);\n    const result = decideOpenaiSdkConfig({\n        keys: DEFAULT_MODEL_CONFIG_KEYS_LEGACY,\n        provider: allEnvConfig,\n        valueAssert: createAssert(DEFAULT_MODEL_CONFIG_KEYS_LEGACY.modelName, 'process.env')\n    });\n    const { vlMode, uiTarsVersion } = parseVlModeAndUiTarsFromGlobalConfig(allEnvConfig);\n    const modelDescription = getModelDescription(vlMode, uiTarsVersion);\n    const finalResult = {\n        ...result,\n        modelName: allEnvConfig[DEFAULT_MODEL_CONFIG_KEYS_LEGACY.modelName] || 'gpt-4o',\n        vlMode,\n        uiTarsModelVersion: uiTarsVersion,\n        modelDescription,\n        from: 'legacy-env',\n        intent\n    };\n    debugLog(`decideModelConfig result by legacy logic with intent ${intent}:`, maskConfig(finalResult));\n    return finalResult;\n};\nexport { decideModelConfigFromEnv, decideModelConfigFromIntentConfig, decideOpenaiSdkConfig };\n","import { decideModelConfigFromEnv, decideModelConfigFromIntentConfig } from \"./decide-model-config.mjs\";\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nconst ALL_INTENTS = [\n    'VQA',\n    'default',\n    'grounding',\n    'planning'\n];\nclass ModelConfigManager {\n    calcIntentConfigMap(modelConfigFn) {\n        const intentConfigMap = {\n            VQA: void 0,\n            default: void 0,\n            grounding: void 0,\n            planning: void 0\n        };\n        for (const i of ALL_INTENTS){\n            const result = modelConfigFn({\n                intent: i\n            });\n            if (!result) throw new Error(`The agent has an option named modelConfig is a function, but it return ${result} when call with intent ${i}, which should be a object.`);\n            intentConfigMap[i] = result;\n        }\n        return intentConfigMap;\n    }\n    calcModelConfigMapBaseOnIntent(intentConfigMap) {\n        const modelConfigMap = {\n            VQA: void 0,\n            default: void 0,\n            grounding: void 0,\n            planning: void 0\n        };\n        for (const i of ALL_INTENTS){\n            const result = decideModelConfigFromIntentConfig(i, intentConfigMap[i]);\n            modelConfigMap[i] = result;\n        }\n        return modelConfigMap;\n    }\n    calcModelConfigMapBaseOnEnv(allEnvConfig) {\n        const modelConfigMap = {\n            VQA: void 0,\n            default: void 0,\n            grounding: void 0,\n            planning: void 0\n        };\n        for (const i of ALL_INTENTS){\n            const result = decideModelConfigFromEnv(i, allEnvConfig);\n            modelConfigMap[i] = result;\n        }\n        return modelConfigMap;\n    }\n    clearModelConfigMap() {\n        if (this.isolatedMode) throw new Error('ModelConfigManager work in isolated mode, so clearModelConfigMap should not be called');\n        this.modelConfigMap = void 0;\n    }\n    getModelConfig(intent) {\n        if (this.isolatedMode) {\n            if (!this.modelConfigMap) throw new Error('modelConfigMap is not initialized in isolated mode, which should not happen');\n            return this.modelConfigMap[intent];\n        }\n        if (!this.modelConfigMap) {\n            if (!this.globalConfigManager) throw new Error('globalConfigManager is not registered, which should not happen');\n            this.modelConfigMap = this.calcModelConfigMapBaseOnEnv(this.globalConfigManager.getAllEnvConfig());\n        }\n        return this.modelConfigMap[intent];\n    }\n    getUploadTestServerUrl() {\n        const { openaiExtraConfig } = this.getModelConfig('default');\n        const serverUrl = null == openaiExtraConfig ? void 0 : openaiExtraConfig.REPORT_SERVER_URL;\n        return serverUrl;\n    }\n    registerGlobalConfigManager(globalConfigManager) {\n        this.globalConfigManager = globalConfigManager;\n    }\n    throwErrorIfNonVLModel(intent = 'grounding') {\n        const modelConfig = this.getModelConfig(intent);\n        if (!modelConfig.vlMode) throw new Error('No visual language model (VL model) detected for the current scenario. Element localization may be inaccurate. Please verify your model configuration. Learn more: https://sqai.tech/choose-a-model');\n    }\n    constructor(modelConfigFn){\n        _define_property(this, \"modelConfigMap\", void 0);\n        _define_property(this, \"isolatedMode\", false);\n        _define_property(this, \"globalConfigManager\", void 0);\n        if (modelConfigFn) {\n            this.isolatedMode = true;\n            const intentConfigMap = this.calcIntentConfigMap(modelConfigFn);\n            this.modelConfigMap = this.calcModelConfigMapBaseOnIntent(intentConfigMap);\n        }\n    }\n}\nexport { ModelConfigManager };\n","import { GlobalConfigManager } from \"./global-config-manager.mjs\";\nimport { ModelConfigManager } from \"./model-config-manager.mjs\";\nimport { SQAI_PREFERRED_LANGUAGE } from \"./types.mjs\";\nconst globalModelConfigManager = new ModelConfigManager();\nconst globalConfigManager = new GlobalConfigManager();\nglobalConfigManager.registerModelConfigManager(globalModelConfigManager);\nglobalModelConfigManager.registerGlobalConfigManager(globalConfigManager);\nconst getPreferredLanguage = ()=>{\n    const prefer = globalConfigManager.getEnvConfigValue(SQAI_PREFERRED_LANGUAGE);\n    if (prefer) return prefer;\n    const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n    const isChina = 'Asia/Shanghai' === timeZone;\n    return isChina ? 'Chinese' : 'English';\n};\nconst overrideAIConfig = (newConfig, extendMode = false)=>{\n    globalConfigManager.overrideAIConfig(newConfig, extendMode);\n};\nexport { getPreferredLanguage, globalConfigManager, globalModelConfigManager, overrideAIConfig };\n","function truncateText(text, maxLength = 150) {\n    if (void 0 === text) return '';\n    if ('object' == typeof text) text = JSON.stringify(text);\n    if ('number' == typeof text) return text.toString();\n    if ('string' == typeof text && text.length > maxLength) return `${text.slice(0, maxLength)}...`;\n    if ('string' == typeof text) return text.trim();\n    return '';\n}\nfunction trimAttributes(attributes, truncateTextLength) {\n    const tailorAttributes = Object.keys(attributes).reduce((res, currentKey)=>{\n        const attributeVal = attributes[currentKey];\n        if ('style' === currentKey || 'htmlTagName' === currentKey || 'nodeType' === currentKey) return res;\n        res[currentKey] = truncateText(attributeVal, truncateTextLength);\n        return res;\n    }, {});\n    return tailorAttributes;\n}\nconst nodeSizeThreshold = 4;\nfunction descriptionOfTree(tree, truncateTextLength, filterNonTextContent = false, visibleOnly = true) {\n    const attributesString = (kv)=>Object.entries(kv).map(([key, value])=>`${key}=\"${truncateText(value, truncateTextLength)}\"`).join(' ');\n    function buildContentTree(node, indent = 0, visibleOnly = true) {\n        let before = '';\n        let contentWithIndent = '';\n        let after = '';\n        let emptyNode = true;\n        const indentStr = '  '.repeat(indent);\n        let children = '';\n        for(let i = 0; i < (node.children || []).length; i++){\n            const childContent = buildContentTree(node.children[i], indent + 1, visibleOnly);\n            if (childContent) children += `\\n${childContent}`;\n        }\n        if (node.node && node.node.rect.width > nodeSizeThreshold && node.node.rect.height > nodeSizeThreshold && (!filterNonTextContent || filterNonTextContent && node.node.content) && (!visibleOnly || visibleOnly && node.node.isVisible)) {\n            var _node_node_attributes;\n            emptyNode = false;\n            let nodeTypeString;\n            nodeTypeString = (null == (_node_node_attributes = node.node.attributes) ? void 0 : _node_node_attributes.htmlTagName) ? node.node.attributes.htmlTagName.replace(/[<>]/g, '') : node.node.attributes.nodeType.replace(/\\sNode$/, '').toLowerCase();\n            const markerId = node.node.indexId;\n            const markerIdString = markerId ? `markerId=\"${markerId}\"` : '';\n            const rectAttribute = node.node.rect ? {\n                left: node.node.rect.left,\n                top: node.node.rect.top,\n                width: node.node.rect.width,\n                height: node.node.rect.height\n            } : {};\n            before = `<${nodeTypeString} id=\"${node.node.id}\" ${markerIdString} ${attributesString(trimAttributes(node.node.attributes || {}, truncateTextLength))} ${attributesString(rectAttribute)}>`;\n            const content = truncateText(node.node.content, truncateTextLength);\n            contentWithIndent = content ? `\\n${indentStr}  ${content}` : '';\n            after = `</${nodeTypeString}>`;\n        } else if (!filterNonTextContent) {\n            if (!children.trim().startsWith('<>')) {\n                before = '<>';\n                contentWithIndent = '';\n                after = '</>';\n            }\n        }\n        if (emptyNode && !children.trim()) return '';\n        const result = `${indentStr}${before}${contentWithIndent}${children}\\n${indentStr}${after}`;\n        if (result.trim()) return result;\n        return '';\n    }\n    const result = buildContentTree(tree, 0, visibleOnly);\n    return result.replace(/^\\s*\\n/gm, '');\n}\nfunction treeToList(tree) {\n    const result = [];\n    function dfs(node) {\n        if (node.node) result.push(node.node);\n        for (const child of node.children)dfs(child);\n    }\n    dfs(tree);\n    return result;\n}\nfunction traverseTree(tree, onNode) {\n    function dfs(node) {\n        if (node.node) node.node = onNode(node.node);\n        for (const child of node.children)dfs(child);\n    }\n    dfs(tree);\n    return tree;\n}\nexport { descriptionOfTree, traverseTree, treeToList, trimAttributes, truncateText };\n","import node_assert from \"node:assert\";\nimport { Buffer } from \"node:buffer\";\nimport { readFileSync } from \"node:fs\";\nimport node_path from \"node:path\";\nimport { getDebug } from \"../logger.mjs\";\nimport { ifInNode } from \"../utils.mjs\";\nimport get_jimp from \"./get-jimp.mjs\";\nimport get_photon from \"./get-photon.mjs\";\nimport get_sharp from \"./get-sharp.mjs\";\nconst imgDebug = getDebug('img');\nasync function saveBase64Image(options) {\n    const { base64Data, outputPath } = options;\n    const { body } = parseBase64(base64Data);\n    const imageBuffer = Buffer.from(body, 'base64');\n    const Jimp = await get_jimp();\n    const image = await Jimp.read(imageBuffer);\n    await image.writeAsync(outputPath);\n}\nasync function resizeAndConvertImgBuffer(inputFormat, inputData, newSize) {\n    if ('string' == typeof inputData) throw Error('inputData is base64, use resizeImgBase64 instead');\n    node_assert(newSize && newSize.width > 0 && newSize.height > 0, 'newSize must be positive');\n    const resizeStartTime = Date.now();\n    imgDebug(`resizeImg start, target size: ${newSize.width}x${newSize.height}`);\n    if (ifInNode) try {\n        const Sharp = await get_sharp();\n        const metadata = await Sharp(inputData).metadata();\n        const { width: originalWidth, height: originalHeight } = metadata;\n        if (!originalWidth || !originalHeight) throw Error('Undefined width or height from the input image.');\n        if (newSize.width === originalWidth && newSize.height === originalHeight) return {\n            buffer: inputData,\n            format: inputFormat\n        };\n        const resizedBuffer = await Sharp(inputData).resize(newSize.width, newSize.height).jpeg({\n            quality: 90\n        }).toBuffer();\n        const resizeEndTime = Date.now();\n        imgDebug(`resizeImg done (Sharp), target size: ${newSize.width}x${newSize.height}, cost: ${resizeEndTime - resizeStartTime}ms`);\n        return {\n            buffer: resizedBuffer,\n            format: 'jpeg'\n        };\n    } catch (error) {\n        imgDebug('Sharp failed, falling back to Photon:', error);\n    }\n    const { PhotonImage, SamplingFilter, resize } = await get_photon();\n    const inputBytes = new Uint8Array(inputData);\n    const inputImage = PhotonImage.new_from_byteslice(inputBytes);\n    const originalWidth = inputImage.get_width();\n    const originalHeight = inputImage.get_height();\n    if (!originalWidth || !originalHeight) {\n        inputImage.free();\n        throw Error('Undefined width or height from the input image.');\n    }\n    if (newSize.width === originalWidth && newSize.height === originalHeight) {\n        inputImage.free();\n        return {\n            buffer: inputData,\n            format: inputFormat\n        };\n    }\n    const outputImage = resize(inputImage, newSize.width, newSize.height, SamplingFilter.CatmullRom);\n    const outputBytes = outputImage.get_bytes_jpeg(90);\n    const resizedBuffer = Buffer.from(outputBytes);\n    inputImage.free();\n    outputImage.free();\n    const resizeEndTime = Date.now();\n    imgDebug(`resizeImg done (Photon), target size: ${newSize.width}x${newSize.height}, cost: ${resizeEndTime - resizeStartTime}ms`);\n    return {\n        buffer: resizedBuffer,\n        format: 'jpeg'\n    };\n}\nconst createImgBase64ByFormat = (format, body)=>`data:image/${format};base64,${body}`;\nasync function resizeImgBase64(inputBase64, newSize) {\n    const { body, mimeType } = parseBase64(inputBase64);\n    const imageBuffer = Buffer.from(body, 'base64');\n    const { buffer, format } = await resizeAndConvertImgBuffer(mimeType.split('/')[1], imageBuffer, newSize);\n    return createImgBase64ByFormat(format, buffer.toString('base64'));\n}\nfunction zoomForGPT4o(originalWidth, originalHeight) {\n    const maxWidth = 2048;\n    const maxHeight = 768;\n    let newWidth = originalWidth;\n    let newHeight = originalHeight;\n    const aspectRatio = originalWidth / originalHeight;\n    if (originalWidth > maxWidth) {\n        newWidth = maxWidth;\n        newHeight = newWidth / aspectRatio;\n    }\n    if (newHeight > maxHeight) {\n        newHeight = maxHeight;\n        newWidth = newHeight * aspectRatio;\n    }\n    return {\n        width: Math.round(newWidth),\n        height: Math.round(newHeight)\n    };\n}\nasync function jimpFromBase64(base64) {\n    const Jimp = await get_jimp();\n    const { body } = parseBase64(base64);\n    const imageBuffer = Buffer.from(body, 'base64');\n    return Jimp.read(imageBuffer);\n}\nasync function paddingToMatchBlock(image, blockSize = 28) {\n    const { width, height } = image.bitmap;\n    const targetWidth = Math.ceil(width / blockSize) * blockSize;\n    const targetHeight = Math.ceil(height / blockSize) * blockSize;\n    if (targetWidth === width && targetHeight === height) return {\n        width,\n        height,\n        image\n    };\n    const Jimp = await get_jimp();\n    const paddedImage = new Jimp(targetWidth, targetHeight, 0xffffffff);\n    paddedImage.composite(image, 0, 0);\n    return {\n        width: targetWidth,\n        height: targetHeight,\n        image: paddedImage\n    };\n}\nasync function paddingToMatchBlockByBase64(imageBase64, blockSize = 28) {\n    const jimpImage = await jimpFromBase64(imageBase64);\n    const paddedResult = await paddingToMatchBlock(jimpImage, blockSize);\n    return {\n        width: paddedResult.width,\n        height: paddedResult.height,\n        imageBase64: await jimpToBase64(paddedResult.image)\n    };\n}\nasync function cropByRect(imageBase64, rect, paddingImage) {\n    const jimpImage = await jimpFromBase64(imageBase64);\n    const { left, top, width, height } = rect;\n    jimpImage.crop(left, top, width, height);\n    if (paddingImage) {\n        const paddedResult = await paddingToMatchBlock(jimpImage);\n        return {\n            width: paddedResult.width,\n            height: paddedResult.height,\n            imageBase64: await jimpToBase64(paddedResult.image)\n        };\n    }\n    return {\n        width: jimpImage.bitmap.width,\n        height: jimpImage.bitmap.height,\n        imageBase64: await jimpToBase64(jimpImage)\n    };\n}\nasync function jimpToBase64(image) {\n    const Jimp = await get_jimp();\n    return image.getBase64Async(Jimp.MIME_JPEG);\n}\nconst httpImg2Base64 = async (url)=>{\n    const response = await fetch(url);\n    if (!response.ok) throw new Error(`Failed to fetch image: ${url}`);\n    const contentType = response.headers.get('content-type');\n    if (!contentType) throw new Error(`Failed to fetch image: ${url}`);\n    node_assert(contentType.startsWith('image/'), `The url ${url} is not a image, because of content-type in header is ${contentType}.`);\n    const buffer = Buffer.from(await response.arrayBuffer());\n    return `data:${contentType};base64,${buffer.toString('base64')}`;\n};\nconst localImg2Base64 = (imgPath, withoutHeader = false)=>{\n    const body = readFileSync(imgPath).toString('base64');\n    if (withoutHeader) return body;\n    const type = node_path.extname(imgPath).slice(1);\n    const finalType = 'svg' === type ? 'svg+xml' : type || 'jpg';\n    return `data:image/${finalType};base64,${body}`;\n};\nconst preProcessImageUrl = async (url, convertHttpImage2Base64)=>{\n    if ('string' != typeof url) throw new Error(`url must be a string, but got ${url} with type ${typeof url}`);\n    if (url.startsWith('data:')) return url;\n    if (!(url.startsWith('http://') || url.startsWith('https://'))) return await localImg2Base64(url);\n    if (!convertHttpImage2Base64) return url;\n    return await httpImg2Base64(url);\n};\nconst parseBase64 = (fullBase64String)=>{\n    try {\n        const separator = ';base64,';\n        const index = fullBase64String.indexOf(separator);\n        if (-1 === index) throw new Error('Invalid base64 string');\n        return {\n            mimeType: fullBase64String.slice(5, index),\n            body: fullBase64String.slice(index + separator.length)\n        };\n    } catch (e) {\n        throw new Error(`parseBase64 fail because intput is not a valid base64 string: ${fullBase64String}`, {\n            cause: e\n        });\n    }\n};\nexport { createImgBase64ByFormat, cropByRect, httpImg2Base64, jimpFromBase64, jimpToBase64, localImg2Base64, paddingToMatchBlock, paddingToMatchBlockByBase64, parseBase64, preProcessImageUrl, resizeAndConvertImgBuffer, resizeImgBase64, saveBase64Image, zoomForGPT4o };\n","import type {\r\n  AIUsageInfo,\r\n  BaseElement,\r\n  DeviceAction,\r\n  ElementTreeNode,\r\n  MidsceneYamlFlowItem,\r\n  PlanningAction,\r\n  Rect,\r\n  Size,\r\n} from '@/types';\r\nimport { assert } from '@sqaitech/shared/utils';\r\n\r\nimport type { ChatCompletionMessageParam } from 'openai/resources/index';\r\n\r\nimport type { PlanningLocateParam } from '@/types';\r\nimport { NodeType } from '@sqaitech/shared/constants';\r\nimport type { TVlModeTypes } from '@sqaitech/shared/env';\r\nimport { treeToList } from '@sqaitech/shared/extractor';\r\nimport { compositeElementInfoImg } from '@sqaitech/shared/img';\r\nimport { getDebug } from '@sqaitech/shared/logger';\r\nimport { z } from 'zod';\r\n\r\nexport type AIArgs = ChatCompletionMessageParam[];\r\n\r\nexport enum AIActionType {\r\n  ASSERT = 0,\r\n  INSPECT_ELEMENT = 1,\r\n  EXTRACT_DATA = 2,\r\n  PLAN = 3,\r\n  DESCRIBE_ELEMENT = 4,\r\n  TEXT = 5,\r\n}\r\n\r\nconst defaultBboxSize = 20; // must be even number\r\nconst debugInspectUtils = getDebug('ai:common');\r\n\r\n// transform the param of locate from qwen mode\r\nexport function fillBboxParam(\r\n  locate: PlanningLocateParam,\r\n  width: number,\r\n  height: number,\r\n  rightLimit: number,\r\n  bottomLimit: number,\r\n  vlMode: TVlModeTypes | undefined,\r\n) {\r\n  // The Qwen model might have hallucinations of naming bbox as bbox_2d.\r\n  if ((locate as any).bbox_2d && !locate?.bbox) {\r\n    locate.bbox = (locate as any).bbox_2d;\r\n    // biome-ignore lint/performance/noDelete: <explanation>\r\n    delete (locate as any).bbox_2d;\r\n  }\r\n\r\n  if (locate?.bbox) {\r\n    locate.bbox = adaptBbox(\r\n      locate.bbox,\r\n      width,\r\n      height,\r\n      rightLimit,\r\n      bottomLimit,\r\n      vlMode,\r\n    );\r\n  }\r\n\r\n  return locate;\r\n}\r\n\r\nexport function adaptQwenBbox(\r\n  bbox: number[],\r\n): [number, number, number, number] {\r\n  if (bbox.length < 2) {\r\n    const msg = `invalid bbox data for qwen-vl mode: ${JSON.stringify(bbox)} `;\r\n    throw new Error(msg);\r\n  }\r\n\r\n  const result: [number, number, number, number] = [\r\n    Math.round(bbox[0]),\r\n    Math.round(bbox[1]),\r\n    typeof bbox[2] === 'number'\r\n      ? Math.round(bbox[2])\r\n      : Math.round(bbox[0] + defaultBboxSize),\r\n    typeof bbox[3] === 'number'\r\n      ? Math.round(bbox[3])\r\n      : Math.round(bbox[1] + defaultBboxSize),\r\n  ];\r\n  return result;\r\n}\r\n\r\nexport function adaptDoubaoBbox(\r\n  bbox: string[] | number[] | string,\r\n  width: number,\r\n  height: number,\r\n): [number, number, number, number] {\r\n  assert(\r\n    width > 0 && height > 0,\r\n    'width and height must be greater than 0 in doubao mode',\r\n  );\r\n\r\n  if (typeof bbox === 'string') {\r\n    assert(\r\n      /^(\\d+)\\s(\\d+)\\s(\\d+)\\s(\\d+)$/.test(bbox.trim()),\r\n      `invalid bbox data string for doubao-vision mode: ${bbox}`,\r\n    );\r\n    const splitted = bbox.split(' ');\r\n    if (splitted.length === 4) {\r\n      return [\r\n        Math.round((Number(splitted[0]) * width) / 1000),\r\n        Math.round((Number(splitted[1]) * height) / 1000),\r\n        Math.round((Number(splitted[2]) * width) / 1000),\r\n        Math.round((Number(splitted[3]) * height) / 1000),\r\n      ];\r\n    }\r\n    throw new Error(`invalid bbox data string for doubao-vision mode: ${bbox}`);\r\n  }\r\n\r\n  if (Array.isArray(bbox) && Array.isArray(bbox[0])) {\r\n    bbox = bbox[0];\r\n  }\r\n\r\n  let bboxList: number[] = [];\r\n  if (Array.isArray(bbox) && typeof bbox[0] === 'string') {\r\n    bbox.forEach((item) => {\r\n      if (typeof item === 'string' && item.includes(',')) {\r\n        const [x, y] = item.split(',');\r\n        bboxList.push(Number(x.trim()), Number(y.trim()));\r\n      } else if (typeof item === 'string' && item.includes(' ')) {\r\n        const [x, y] = item.split(' ');\r\n        bboxList.push(Number(x.trim()), Number(y.trim()));\r\n      } else {\r\n        bboxList.push(Number(item));\r\n      }\r\n    });\r\n  } else {\r\n    bboxList = bbox as any;\r\n  }\r\n\r\n  if (bboxList.length === 4 || bboxList.length === 5) {\r\n    return [\r\n      Math.round((bboxList[0] * width) / 1000),\r\n      Math.round((bboxList[1] * height) / 1000),\r\n      Math.round((bboxList[2] * width) / 1000),\r\n      Math.round((bboxList[3] * height) / 1000),\r\n    ];\r\n  }\r\n\r\n  // treat the bbox as a center point\r\n  if (\r\n    bboxList.length === 6 ||\r\n    bboxList.length === 2 ||\r\n    bboxList.length === 3 ||\r\n    bboxList.length === 7\r\n  ) {\r\n    return [\r\n      Math.max(\r\n        0,\r\n        Math.round((bboxList[0] * width) / 1000) - defaultBboxSize / 2,\r\n      ),\r\n      Math.max(\r\n        0,\r\n        Math.round((bboxList[1] * height) / 1000) - defaultBboxSize / 2,\r\n      ),\r\n      Math.min(\r\n        width,\r\n        Math.round((bboxList[0] * width) / 1000) + defaultBboxSize / 2,\r\n      ),\r\n      Math.min(\r\n        height,\r\n        Math.round((bboxList[1] * height) / 1000) + defaultBboxSize / 2,\r\n      ),\r\n    ];\r\n  }\r\n\r\n  if (bbox.length === 8) {\r\n    return [\r\n      Math.round((bboxList[0] * width) / 1000),\r\n      Math.round((bboxList[1] * height) / 1000),\r\n      Math.round((bboxList[4] * width) / 1000),\r\n      Math.round((bboxList[5] * height) / 1000),\r\n    ];\r\n  }\r\n\r\n  const msg = `invalid bbox data for doubao-vision mode: ${JSON.stringify(bbox)} `;\r\n  throw new Error(msg);\r\n}\r\n\r\nexport function adaptBbox(\r\n  bbox: number[],\r\n  width: number,\r\n  height: number,\r\n  rightLimit: number,\r\n  bottomLimit: number,\r\n  vlMode: TVlModeTypes | undefined,\r\n): [number, number, number, number] {\r\n  let result: [number, number, number, number] = [0, 0, 0, 0];\r\n  if (vlMode === 'doubao-vision' || vlMode === 'vlm-ui-tars') {\r\n    result = adaptDoubaoBbox(bbox, width, height);\r\n  } else if (vlMode === 'gemini') {\r\n    result = adaptGeminiBbox(bbox, width, height);\r\n  } else if (vlMode === 'qwen3-vl') {\r\n    result = normalized01000(bbox, width, height);\r\n  } else {\r\n    result = adaptQwenBbox(bbox);\r\n  }\r\n\r\n  result[2] = Math.min(result[2], rightLimit);\r\n  result[3] = Math.min(result[3], bottomLimit);\r\n\r\n  return result;\r\n}\r\n\r\n// x1, y1, x2, y2 -> 0-1000\r\nexport function normalized01000(\r\n  bbox: number[],\r\n  width: number,\r\n  height: number,\r\n): [number, number, number, number] {\r\n  return [\r\n    Math.round((bbox[0] * width) / 1000),\r\n    Math.round((bbox[1] * height) / 1000),\r\n    Math.round((bbox[2] * width) / 1000),\r\n    Math.round((bbox[3] * height) / 1000),\r\n  ];\r\n}\r\n\r\n// y1, x1, y2, x2 -> 0-1000\r\nexport function adaptGeminiBbox(\r\n  bbox: number[],\r\n  width: number,\r\n  height: number,\r\n): [number, number, number, number] {\r\n  const left = Math.round((bbox[1] * width) / 1000);\r\n  const top = Math.round((bbox[0] * height) / 1000);\r\n  const right = Math.round((bbox[3] * width) / 1000);\r\n  const bottom = Math.round((bbox[2] * height) / 1000);\r\n  return [left, top, right, bottom];\r\n}\r\n\r\nexport function adaptBboxToRect(\r\n  bbox: number[],\r\n  width: number,\r\n  height: number,\r\n  offsetX = 0,\r\n  offsetY = 0,\r\n  rightLimit = width,\r\n  bottomLimit = height,\r\n  vlMode?: TVlModeTypes | undefined,\r\n): Rect {\r\n  debugInspectUtils(\r\n    'adaptBboxToRect',\r\n    bbox,\r\n    width,\r\n    height,\r\n    'offset',\r\n    offsetX,\r\n    offsetY,\r\n    'limit',\r\n    rightLimit,\r\n    bottomLimit,\r\n    'vlMode',\r\n    vlMode,\r\n  );\r\n  const [left, top, right, bottom] = adaptBbox(\r\n    bbox,\r\n    width,\r\n    height,\r\n    rightLimit,\r\n    bottomLimit,\r\n    vlMode,\r\n  );\r\n\r\n  // Calculate initial rect dimensions\r\n  const rectLeft = left;\r\n  const rectTop = top;\r\n  let rectWidth = right - left;\r\n  let rectHeight = bottom - top;\r\n\r\n  // Ensure the rect doesn't exceed image boundaries\r\n  // If right edge exceeds width, adjust the width\r\n  if (rectLeft + rectWidth > width) {\r\n    rectWidth = width - rectLeft;\r\n  }\r\n\r\n  // If bottom edge exceeds height, adjust the height\r\n  if (rectTop + rectHeight > height) {\r\n    rectHeight = height - rectTop;\r\n  }\r\n\r\n  // Ensure minimum dimensions (width and height should be at least 1)\r\n  rectWidth = Math.max(1, rectWidth);\r\n  rectHeight = Math.max(1, rectHeight);\r\n\r\n  const rect = {\r\n    left: rectLeft + offsetX,\r\n    top: rectTop + offsetY,\r\n    width: rectWidth,\r\n    height: rectHeight,\r\n  };\r\n  debugInspectUtils('adaptBboxToRect, result=', rect);\r\n\r\n  return rect;\r\n}\r\n\r\nlet warned = false;\r\nexport function warnGPT4oSizeLimit(size: Size, modelName: string) {\r\n  if (warned) return;\r\n  if (modelName.toLowerCase().includes('gpt-4o')) {\r\n    const warningMsg = `GPT-4o has a maximum image input size of 2000x768 or 768x2000, but got ${size.width}x${size.height}. Please set your interface to a smaller resolution. Otherwise, the result may be inaccurate.`;\r\n\r\n    if (\r\n      Math.max(size.width, size.height) > 2000 ||\r\n      Math.min(size.width, size.height) > 768\r\n    ) {\r\n      console.warn(warningMsg);\r\n      warned = true;\r\n    }\r\n  } else if (size.width > 1800 || size.height > 1800) {\r\n    console.warn(\r\n      `The image size seems too large (${size.width}x${size.height}). It may lead to more token usage, slower response, and inaccurate result.`,\r\n    );\r\n    warned = true;\r\n  }\r\n}\r\n\r\nexport function mergeRects(rects: Rect[]) {\r\n  const minLeft = Math.min(...rects.map((r) => r.left));\r\n  const minTop = Math.min(...rects.map((r) => r.top));\r\n  const maxRight = Math.max(...rects.map((r) => r.left + r.width));\r\n  const maxBottom = Math.max(...rects.map((r) => r.top + r.height));\r\n  return {\r\n    left: minLeft,\r\n    top: minTop,\r\n    width: maxRight - minLeft,\r\n    height: maxBottom - minTop,\r\n  };\r\n}\r\n\r\n// expand the search area to at least 300 x 300, or add a default padding\r\nexport function expandSearchArea(\r\n  rect: Rect,\r\n  screenSize: Size,\r\n  vlMode: TVlModeTypes | undefined,\r\n) {\r\n  const minEdgeSize = vlMode === 'doubao-vision' ? 500 : 300;\r\n  const defaultPadding = 160;\r\n\r\n  // Calculate padding needed to reach minimum edge size\r\n  const paddingSizeHorizontal =\r\n    rect.width < minEdgeSize\r\n      ? Math.ceil((minEdgeSize - rect.width) / 2)\r\n      : defaultPadding;\r\n  const paddingSizeVertical =\r\n    rect.height < minEdgeSize\r\n      ? Math.ceil((minEdgeSize - rect.height) / 2)\r\n      : defaultPadding;\r\n\r\n  // Calculate new dimensions (ensure minimum edge size)\r\n  let newWidth = Math.max(minEdgeSize, rect.width + paddingSizeHorizontal * 2);\r\n  let newHeight = Math.max(minEdgeSize, rect.height + paddingSizeVertical * 2);\r\n\r\n  // Calculate initial position with padding\r\n  let newLeft = rect.left - paddingSizeHorizontal;\r\n  let newTop = rect.top - paddingSizeVertical;\r\n\r\n  // Ensure the rect doesn't exceed screen boundaries by adjusting position\r\n  // If the rect goes beyond the right edge, shift it left\r\n  if (newLeft + newWidth > screenSize.width) {\r\n    newLeft = screenSize.width - newWidth;\r\n  }\r\n\r\n  // If the rect goes beyond the bottom edge, shift it up\r\n  if (newTop + newHeight > screenSize.height) {\r\n    newTop = screenSize.height - newHeight;\r\n  }\r\n\r\n  // Ensure the rect doesn't go beyond the left/top edges\r\n  newLeft = Math.max(0, newLeft);\r\n  newTop = Math.max(0, newTop);\r\n\r\n  // If after position adjustment, the rect still exceeds screen boundaries,\r\n  // clamp the dimensions to fit within screen\r\n  if (newLeft + newWidth > screenSize.width) {\r\n    newWidth = screenSize.width - newLeft;\r\n  }\r\n  if (newTop + newHeight > screenSize.height) {\r\n    newHeight = screenSize.height - newTop;\r\n  }\r\n\r\n  rect.left = newLeft;\r\n  rect.top = newTop;\r\n  rect.width = newWidth;\r\n  rect.height = newHeight;\r\n\r\n  return rect;\r\n}\r\n\r\nexport async function markupImageForLLM(\r\n  screenshotBase64: string,\r\n  tree: ElementTreeNode<BaseElement>,\r\n  size: Size,\r\n) {\r\n  const elementsInfo = treeToList(tree);\r\n  const elementsPositionInfoWithoutText = elementsInfo!.filter(\r\n    (elementInfo) => {\r\n      if (elementInfo.attributes.nodeType === NodeType.TEXT) {\r\n        return false;\r\n      }\r\n      return true;\r\n    },\r\n  );\r\n\r\n  const imagePayload = await compositeElementInfoImg({\r\n    inputImgBase64: screenshotBase64,\r\n    elementsPositionInfo: elementsPositionInfoWithoutText,\r\n    size,\r\n  });\r\n  return imagePayload;\r\n}\r\n\r\nexport function buildYamlFlowFromPlans(\r\n  plans: PlanningAction[],\r\n  actionSpace: DeviceAction<any>[],\r\n  sleep?: number,\r\n): MidsceneYamlFlowItem[] {\r\n  const flow: MidsceneYamlFlowItem[] = [];\r\n\r\n  for (const plan of plans) {\r\n    const verb = plan.type;\r\n\r\n    const action = actionSpace.find((action) => action.name === verb);\r\n    if (!action) {\r\n      console.warn(\r\n        `Cannot convert action ${verb} to yaml flow. Will ignore it.`,\r\n      );\r\n      continue;\r\n    }\r\n\r\n    const flowKey = action.interfaceAlias || verb;\r\n    const flowParam = action.paramSchema\r\n      ? dumpActionParam(plan.param || {}, action.paramSchema)\r\n      : {};\r\n\r\n    const flowItem: MidsceneYamlFlowItem = {\r\n      [flowKey]: '',\r\n      ...flowParam,\r\n    };\r\n\r\n    flow.push(flowItem);\r\n  }\r\n\r\n  if (sleep) {\r\n    flow.push({\r\n      sleep,\r\n    });\r\n  }\r\n\r\n  return flow;\r\n}\r\n\r\n// Zod schemas for shared types\r\nexport const PointSchema = z.object({\r\n  left: z.number(),\r\n  top: z.number(),\r\n});\r\n\r\nexport const SizeSchema = z.object({\r\n  width: z.number(),\r\n  height: z.number(),\r\n  dpr: z.number().optional(),\r\n});\r\n\r\nexport const RectSchema = PointSchema.and(SizeSchema).and(\r\n  z.object({\r\n    zoom: z.number().optional(),\r\n  }),\r\n);\r\n\r\n// Zod schema for TMultimodalPrompt\r\nexport const TMultimodalPromptSchema = z.object({\r\n  images: z\r\n    .array(\r\n      z.object({\r\n        name: z.string(),\r\n        url: z.string(),\r\n      }),\r\n    )\r\n    .optional(),\r\n  convertHttpImage2Base64: z.boolean().optional(),\r\n});\r\n\r\n// Zod schema for TUserPrompt\r\nexport const TUserPromptSchema = z.union([\r\n  z.string(),\r\n  z\r\n    .object({\r\n      prompt: z.string(),\r\n    })\r\n    .and(TMultimodalPromptSchema.partial()),\r\n]);\r\n\r\n// Generate TypeScript types from Zod schemas\r\nexport type TMultimodalPrompt = z.infer<typeof TMultimodalPromptSchema>;\r\nexport type TUserPrompt = z.infer<typeof TUserPromptSchema>;\r\n\r\nconst locateFieldFlagName = 'SQAI_location_field_flag';\r\n\r\n// Schema for locator field input (when users provide locate parameters)\r\nconst MidsceneLocationInput = z\r\n  .object({\r\n    prompt: TUserPromptSchema,\r\n    deepThink: z.boolean().optional(),\r\n    cacheable: z.boolean().optional(),\r\n    xpath: z.union([z.string(), z.boolean()]).optional(),\r\n  })\r\n  .passthrough();\r\n\r\n// Schema for locator field result (when AI returns locate results)\r\nconst MidsceneLocationResult = z\r\n  .object({\r\n    [locateFieldFlagName]: z.literal(true),\r\n    prompt: TUserPromptSchema,\r\n\r\n    // optional fields\r\n    deepThink: z.boolean().optional(), // only available in vl model\r\n    cacheable: z.boolean().optional(),\r\n    xpath: z.boolean().optional(), // preset result for xpath\r\n\r\n    // these two fields will only appear in the result\r\n    center: z.tuple([z.number(), z.number()]),\r\n    rect: RectSchema,\r\n  })\r\n  .passthrough();\r\n\r\n// Export the result type - this is used for runtime results that include center and rect\r\nexport type MidsceneLocationResultType = z.infer<typeof MidsceneLocationResult>;\r\n\r\n// Export the input type - this is the inferred type from getMidsceneLocationSchema()\r\nexport type MidsceneLocationInputType = z.infer<typeof MidsceneLocationInput>;\r\n\r\n/**\r\n * Returns the schema for locator fields.\r\n * This now returns the input schema which is more permissive and suitable for validation.\r\n */\r\nexport const getMidsceneLocationSchema = () => {\r\n  return MidsceneLocationInput;\r\n};\r\n\r\nexport const ifMidsceneLocatorField = (field: any): boolean => {\r\n  // Handle optional fields by getting the inner type\r\n  let actualField = field;\r\n  if (actualField._def?.typeName === 'ZodOptional') {\r\n    actualField = actualField._def.innerType;\r\n  }\r\n\r\n  // Check if this is a ZodObject\r\n  if (actualField._def?.typeName === 'ZodObject') {\r\n    const shape = actualField._def.shape();\r\n\r\n    // Method 1: Check for the location field flag (for result schema)\r\n    if (locateFieldFlagName in shape) {\r\n      return true;\r\n    }\r\n\r\n    // Method 2: Check if it's the input schema by checking for 'prompt' field\r\n    // Input schema has 'prompt' as a required field\r\n    if ('prompt' in shape && shape.prompt) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nexport const dumpMidsceneLocatorField = (field: any): string => {\r\n  assert(\r\n    ifMidsceneLocatorField(field),\r\n    'field is not a midscene locator field',\r\n  );\r\n\r\n  // If field is a string, return it directly\r\n  if (typeof field === 'string') {\r\n    return field;\r\n  }\r\n\r\n  // If field is an object with prompt property\r\n  if (field && typeof field === 'object' && field.prompt) {\r\n    // If prompt is a string, return it directly\r\n    if (typeof field.prompt === 'string') {\r\n      return field.prompt;\r\n    }\r\n    // If prompt is a TUserPrompt object, extract the prompt string\r\n    if (typeof field.prompt === 'object' && field.prompt.prompt) {\r\n      return field.prompt.prompt; // TODO: dump images if necessary\r\n    }\r\n  }\r\n\r\n  // Fallback: try to convert to string\r\n  return String(field);\r\n};\r\n\r\nexport const findAllMidsceneLocatorField = (\r\n  zodType?: z.ZodType<any>,\r\n  requiredOnly?: boolean,\r\n): string[] => {\r\n  if (!zodType) {\r\n    return [];\r\n  }\r\n\r\n  // Check if this is a ZodObject by checking if it has a shape property\r\n  const zodObject = zodType as any;\r\n  if (zodObject._def?.typeName === 'ZodObject' && zodObject.shape) {\r\n    const keys = Object.keys(zodObject.shape);\r\n    return keys.filter((key) => {\r\n      const field = zodObject.shape[key];\r\n      if (!ifMidsceneLocatorField(field)) {\r\n        return false;\r\n      }\r\n\r\n      // If requiredOnly is true, filter out optional fields\r\n      if (requiredOnly) {\r\n        return field._def?.typeName !== 'ZodOptional';\r\n      }\r\n\r\n      return true;\r\n    });\r\n  }\r\n\r\n  // For other ZodType instances, we can't extract field names\r\n  return [];\r\n};\r\n\r\nexport const dumpActionParam = (\r\n  jsonObject: Record<string, any>,\r\n  zodSchema: z.ZodType<any>,\r\n): Record<string, any> => {\r\n  const locatorFields = findAllMidsceneLocatorField(zodSchema);\r\n  const result = { ...jsonObject };\r\n\r\n  for (const fieldName of locatorFields) {\r\n    const fieldValue = result[fieldName];\r\n    if (fieldValue) {\r\n      // If it's already a string, keep it as is\r\n      if (typeof fieldValue === 'string') {\r\n        result[fieldName] = fieldValue;\r\n      } else if (typeof fieldValue === 'object') {\r\n        // Check if this field is actually a MidsceneLocationType object\r\n        if (fieldValue.prompt) {\r\n          // If prompt is a string, use it directly\r\n          if (typeof fieldValue.prompt === 'string') {\r\n            result[fieldName] = fieldValue.prompt;\r\n          } else if (\r\n            typeof fieldValue.prompt === 'object' &&\r\n            fieldValue.prompt.prompt\r\n          ) {\r\n            // If prompt is a TUserPrompt object, extract the prompt string\r\n            result[fieldName] = fieldValue.prompt.prompt;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\nexport const loadActionParam = (\r\n  jsonObject: Record<string, any>,\r\n  zodSchema: z.ZodType<any>,\r\n): Record<string, any> => {\r\n  const locatorFields = findAllMidsceneLocatorField(zodSchema);\r\n  const result = { ...jsonObject };\r\n\r\n  for (const fieldName of locatorFields) {\r\n    const fieldValue = result[fieldName];\r\n    if (fieldValue && typeof fieldValue === 'string') {\r\n      result[fieldName] = {\r\n        [locateFieldFlagName]: true,\r\n        prompt: fieldValue,\r\n      };\r\n    }\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\n/**\r\n * Parse and validate action parameters using Zod schema.\r\n * All fields are validated through Zod, EXCEPT locator fields which are skipped.\r\n * Default values defined in the schema are automatically applied.\r\n *\r\n * Locator fields are special business logic fields with complex validation requirements,\r\n * so they are intentionally excluded from Zod parsing and use existing validation logic.\r\n */\r\nexport const parseActionParam = (\r\n  rawParam: Record<string, any>,\r\n  zodSchema: z.ZodType<any>,\r\n): Record<string, any> => {\r\n  // Handle undefined or null rawParam by providing an empty object\r\n  const param = rawParam ?? {};\r\n\r\n  // Find all locate fields in the schema\r\n  const locateFields = findAllMidsceneLocatorField(zodSchema);\r\n\r\n  // If there are no locate fields, just do normal validation\r\n  if (locateFields.length === 0) {\r\n    return zodSchema.parse(param);\r\n  }\r\n\r\n  // Extract locate field values to restore later\r\n  const locateFieldValues: Record<string, any> = {};\r\n  for (const fieldName of locateFields) {\r\n    if (fieldName in param) {\r\n      locateFieldValues[fieldName] = param[fieldName];\r\n    }\r\n  }\r\n\r\n  // Build params for validation - skip locate fields and use dummy values\r\n  const paramsForValidation: Record<string, any> = {};\r\n  for (const key in param) {\r\n    if (locateFields.includes(key)) {\r\n      // Use dummy value to satisfy schema validation\r\n      paramsForValidation[key] = { prompt: '_dummy_' };\r\n    } else {\r\n      paramsForValidation[key] = param[key];\r\n    }\r\n  }\r\n\r\n  // Validate with dummy locate values\r\n  const validated = zodSchema.parse(paramsForValidation);\r\n\r\n  // Restore the actual locate field values (unvalidated, as per business requirement)\r\n  for (const fieldName in locateFieldValues) {\r\n    validated[fieldName] = locateFieldValues[fieldName];\r\n  }\r\n\r\n  return validated;\r\n};\r\n","import type {\r\n  AIDataExtractionResponse,\r\n  AIElementLocatorResponse,\r\n  AIElementResponse,\r\n  AISectionLocatorResponse,\r\n  AIUsageInfo,\r\n  BaseElement,\r\n  ElementById,\r\n  InsightExtractOption,\r\n  Rect,\r\n  ReferenceImage,\r\n  UIContext,\r\n} from '@/types';\r\nimport type { IModelConfig } from '@sqaitech/shared/env';\r\nimport {\r\n  cropByRect,\r\n  paddingToMatchBlockByBase64,\r\n  preProcessImageUrl,\r\n} from '@sqaitech/shared/img';\r\nimport { getDebug } from '@sqaitech/shared/logger';\r\nimport { assert } from '@sqaitech/shared/utils';\r\nimport type {\r\n  ChatCompletionSystemMessageParam,\r\n  ChatCompletionUserMessageParam,\r\n} from 'openai/resources/index';\r\nimport type { TMultimodalPrompt, TUserPrompt } from './common';\r\nimport {\r\n  AIActionType,\r\n  adaptBboxToRect,\r\n  expandSearchArea,\r\n  markupImageForLLM,\r\n  mergeRects,\r\n} from './common';\r\nimport {\r\n  extractDataQueryPrompt,\r\n  systemPromptToExtract,\r\n} from './prompt/extraction';\r\nimport {\r\n  findElementPrompt,\r\n  systemPromptToLocateElement,\r\n} from './prompt/llm-locator';\r\nimport {\r\n  sectionLocatorInstruction,\r\n  systemPromptToLocateSection,\r\n} from './prompt/llm-section-locator';\r\nimport {\r\n  describeUserPage,\r\n  distance,\r\n  distanceThreshold,\r\n  elementByPositionWithElementInfo,\r\n} from './prompt/util';\r\nimport { callAIWithObjectResponse } from './service-caller/index';\r\n\r\nexport type AIArgs = [\r\n  ChatCompletionSystemMessageParam,\r\n  ...ChatCompletionUserMessageParam[],\r\n];\r\n\r\nconst debugInspect = getDebug('ai:inspect');\r\nconst debugSection = getDebug('ai:section');\r\n\r\nconst extraTextFromUserPrompt = (prompt: TUserPrompt): string => {\r\n  if (typeof prompt === 'string') {\r\n    return prompt;\r\n  } else {\r\n    return prompt.prompt;\r\n  }\r\n};\r\n\r\nconst promptsToChatParam = async (\r\n  multimodalPrompt: TMultimodalPrompt,\r\n): Promise<ChatCompletionUserMessageParam[]> => {\r\n  const msgs: ChatCompletionUserMessageParam[] = [];\r\n  if (multimodalPrompt?.images?.length) {\r\n    msgs.push({\r\n      role: 'user',\r\n      content: [\r\n        {\r\n          type: 'text',\r\n          text: 'Next, I will provide all the reference images.',\r\n        },\r\n      ],\r\n    });\r\n\r\n    for (const item of multimodalPrompt.images) {\r\n      const base64 = await preProcessImageUrl(\r\n        item.url,\r\n        !!multimodalPrompt.convertHttpImage2Base64,\r\n      );\r\n\r\n      msgs.push({\r\n        role: 'user',\r\n        content: [\r\n          {\r\n            type: 'text',\r\n            text: `reference image ${item.name}:`,\r\n          },\r\n        ],\r\n      });\r\n\r\n      msgs.push({\r\n        role: 'user',\r\n        content: [\r\n          {\r\n            type: 'image_url',\r\n            image_url: {\r\n              url: base64,\r\n              detail: 'high',\r\n            },\r\n          },\r\n        ],\r\n      });\r\n    }\r\n  }\r\n  return msgs;\r\n};\r\n\r\nexport async function AiLocateElement<\r\n  ElementType extends BaseElement = BaseElement,\r\n>(options: {\r\n  context: UIContext<ElementType>;\r\n  targetElementDescription: TUserPrompt;\r\n  referenceImage?: ReferenceImage;\r\n  callAIFn: typeof callAIWithObjectResponse<\r\n    AIElementResponse | [number, number]\r\n  >;\r\n  searchConfig?: Awaited<ReturnType<typeof AiLocateSection>>;\r\n  modelConfig: IModelConfig;\r\n}): Promise<{\r\n  parseResult: AIElementLocatorResponse;\r\n  rect?: Rect;\r\n  rawResponse: string;\r\n  elementById: ElementById;\r\n  usage?: AIUsageInfo;\r\n  isOrderSensitive?: boolean;\r\n}> {\r\n  const { context, targetElementDescription, callAIFn, modelConfig } = options;\r\n  const { vlMode } = modelConfig;\r\n  const { screenshotBase64 } = context;\r\n\r\n  const { description, elementById, insertElementByPosition } =\r\n    await describeUserPage(context, { vlMode });\r\n\r\n  assert(\r\n    targetElementDescription,\r\n    'cannot find the target element description',\r\n  );\r\n  const userInstructionPrompt = findElementPrompt({\r\n    pageDescription: description,\r\n    targetElementDescription: extraTextFromUserPrompt(targetElementDescription),\r\n  });\r\n  const systemPrompt = systemPromptToLocateElement(vlMode);\r\n\r\n  let imagePayload = screenshotBase64;\r\n  let imageWidth = context.size.width;\r\n  let imageHeight = context.size.height;\r\n  let originalImageWidth = imageWidth;\r\n  let originalImageHeight = imageHeight;\r\n\r\n  if (options.searchConfig) {\r\n    assert(\r\n      options.searchConfig.rect,\r\n      'searchArea is provided but its rect cannot be found. Failed to locate element',\r\n    );\r\n    assert(\r\n      options.searchConfig.imageBase64,\r\n      'searchArea is provided but its imageBase64 cannot be found. Failed to locate element',\r\n    );\r\n\r\n    imagePayload = options.searchConfig.imageBase64;\r\n    imageWidth = options.searchConfig.rect?.width;\r\n    imageHeight = options.searchConfig.rect?.height;\r\n    originalImageWidth = imageWidth;\r\n    originalImageHeight = imageHeight;\r\n  } else if (vlMode === 'qwen-vl') {\r\n    const paddedResult = await paddingToMatchBlockByBase64(imagePayload);\r\n    imageWidth = paddedResult.width;\r\n    imageHeight = paddedResult.height;\r\n    imagePayload = paddedResult.imageBase64;\r\n  } else if (vlMode === 'qwen3-vl') {\r\n    // const paddedResult = await paddingToMatchBlockByBase64(imagePayload, 32);\r\n    // imageWidth = paddedResult.width;\r\n    // imageHeight = paddedResult.height;\r\n    // imagePayload = paddedResult.imageBase64;\r\n  } else if (!vlMode) {\r\n    imagePayload = await markupImageForLLM(\r\n      screenshotBase64,\r\n      context.tree,\r\n      context.size,\r\n    );\r\n  }\r\n\r\n  const msgs: AIArgs = [\r\n    { role: 'system', content: systemPrompt },\r\n    {\r\n      role: 'user',\r\n      content: [\r\n        {\r\n          type: 'image_url',\r\n          image_url: {\r\n            url: imagePayload,\r\n            detail: 'high',\r\n          },\r\n        },\r\n        {\r\n          type: 'text',\r\n          text: userInstructionPrompt,\r\n        },\r\n      ],\r\n    },\r\n  ];\r\n\r\n  if (typeof targetElementDescription !== 'string') {\r\n    const addOns = await promptsToChatParam({\r\n      images: targetElementDescription.images,\r\n      convertHttpImage2Base64: targetElementDescription.convertHttpImage2Base64,\r\n    });\r\n    msgs.push(...addOns);\r\n  }\r\n\r\n  const res = await callAIFn(msgs, AIActionType.INSPECT_ELEMENT, modelConfig);\r\n\r\n  const rawResponse = JSON.stringify(res.content);\r\n\r\n  let resRect: Rect | undefined;\r\n  let matchedElements: AIElementLocatorResponse['elements'] =\r\n    'elements' in res.content ? res.content.elements : [];\r\n  let errors: AIElementLocatorResponse['errors'] | undefined =\r\n    'errors' in res.content ? res.content.errors : [];\r\n  try {\r\n    if ('bbox' in res.content && Array.isArray(res.content.bbox)) {\r\n      resRect = adaptBboxToRect(\r\n        res.content.bbox,\r\n        imageWidth,\r\n        imageHeight,\r\n        options.searchConfig?.rect?.left,\r\n        options.searchConfig?.rect?.top,\r\n        originalImageWidth,\r\n        originalImageHeight,\r\n        vlMode,\r\n      );\r\n\r\n      debugInspect('resRect', resRect);\r\n\r\n      const rectCenter = {\r\n        x: resRect.left + resRect.width / 2,\r\n        y: resRect.top + resRect.height / 2,\r\n      };\r\n      let element = elementByPositionWithElementInfo(context.tree, rectCenter);\r\n\r\n      const distanceToCenter = element\r\n        ? distance({ x: element.center[0], y: element.center[1] }, rectCenter)\r\n        : 0;\r\n\r\n      if (!element || distanceToCenter > distanceThreshold) {\r\n        element = insertElementByPosition(rectCenter);\r\n      }\r\n\r\n      if (element) {\r\n        matchedElements = [element];\r\n        errors = [];\r\n      }\r\n    }\r\n  } catch (e) {\r\n    const msg =\r\n      e instanceof Error\r\n        ? `Failed to parse bbox: ${e.message}`\r\n        : 'unknown error in locate';\r\n    if (!errors || errors?.length === 0) {\r\n      errors = [msg];\r\n    } else {\r\n      errors.push(`(${msg})`);\r\n    }\r\n  }\r\n\r\n  return {\r\n    rect: resRect,\r\n    parseResult: {\r\n      elements: matchedElements,\r\n      errors,\r\n    },\r\n    rawResponse,\r\n    elementById,\r\n    usage: res.usage,\r\n    isOrderSensitive:\r\n      typeof res.content === 'object' &&\r\n      res.content !== null &&\r\n      'isOrderSensitive' in res.content\r\n        ? (res.content as any).isOrderSensitive\r\n        : undefined,\r\n  };\r\n}\r\n\r\nexport async function AiLocateSection(options: {\r\n  context: UIContext<BaseElement>;\r\n  sectionDescription: TUserPrompt;\r\n  modelConfig: IModelConfig;\r\n}): Promise<{\r\n  rect?: Rect;\r\n  imageBase64?: string;\r\n  error?: string;\r\n  rawResponse: string;\r\n  usage?: AIUsageInfo;\r\n}> {\r\n  const { context, sectionDescription, modelConfig } = options;\r\n  const { vlMode } = modelConfig;\r\n  const { screenshotBase64 } = context;\r\n\r\n  const systemPrompt = systemPromptToLocateSection(vlMode);\r\n  const sectionLocatorInstructionText = sectionLocatorInstruction({\r\n    sectionDescription: extraTextFromUserPrompt(sectionDescription),\r\n  });\r\n  const msgs: AIArgs = [\r\n    { role: 'system', content: systemPrompt },\r\n    {\r\n      role: 'user',\r\n      content: [\r\n        {\r\n          type: 'image_url',\r\n          image_url: {\r\n            url: screenshotBase64,\r\n            detail: 'high',\r\n          },\r\n        },\r\n        {\r\n          type: 'text',\r\n          text: sectionLocatorInstructionText,\r\n        },\r\n      ],\r\n    },\r\n  ];\r\n\r\n  if (typeof sectionDescription !== 'string') {\r\n    const addOns = await promptsToChatParam({\r\n      images: sectionDescription.images,\r\n      convertHttpImage2Base64: sectionDescription.convertHttpImage2Base64,\r\n    });\r\n    msgs.push(...addOns);\r\n  }\r\n\r\n  const result = await callAIWithObjectResponse<AISectionLocatorResponse>(\r\n    msgs,\r\n    AIActionType.EXTRACT_DATA,\r\n    modelConfig,\r\n  );\r\n\r\n  let sectionRect: Rect | undefined;\r\n  const sectionBbox = result.content.bbox;\r\n  if (sectionBbox) {\r\n    const targetRect = adaptBboxToRect(\r\n      sectionBbox,\r\n      context.size.width,\r\n      context.size.height,\r\n      0,\r\n      0,\r\n      context.size.width,\r\n      context.size.height,\r\n      vlMode,\r\n    );\r\n    debugSection('original targetRect %j', targetRect);\r\n\r\n    const referenceBboxList = result.content.references_bbox || [];\r\n    debugSection('referenceBboxList %j', referenceBboxList);\r\n\r\n    const referenceRects = referenceBboxList\r\n      .filter((bbox) => Array.isArray(bbox))\r\n      .map((bbox) => {\r\n        return adaptBboxToRect(\r\n          bbox,\r\n          context.size.width,\r\n          context.size.height,\r\n          0,\r\n          0,\r\n          context.size.width,\r\n          context.size.height,\r\n          vlMode,\r\n        );\r\n      });\r\n    debugSection('referenceRects %j', referenceRects);\r\n\r\n    // merge the sectionRect and referenceRects\r\n    const mergedRect = mergeRects([targetRect, ...referenceRects]);\r\n    debugSection('mergedRect %j', mergedRect);\r\n\r\n    // expand search area to at least 200 x 200\r\n    sectionRect = expandSearchArea(mergedRect, context.size, vlMode);\r\n    debugSection('expanded sectionRect %j', sectionRect);\r\n  }\r\n\r\n  let imageBase64 = screenshotBase64;\r\n  if (sectionRect) {\r\n    const croppedResult = await cropByRect(\r\n      screenshotBase64,\r\n      sectionRect,\r\n      vlMode === 'qwen-vl',\r\n    );\r\n    imageBase64 = croppedResult.imageBase64;\r\n    sectionRect.width = croppedResult.width;\r\n    sectionRect.height = croppedResult.height;\r\n  }\r\n\r\n  return {\r\n    rect: sectionRect,\r\n    imageBase64,\r\n    error: result.content.error,\r\n    rawResponse: JSON.stringify(result.content),\r\n    usage: result.usage,\r\n  };\r\n}\r\n\r\nexport async function AiExtractElementInfo<\r\n  T,\r\n  ElementType extends BaseElement = BaseElement,\r\n>(options: {\r\n  dataQuery: string | Record<string, string>;\r\n  multimodalPrompt?: TMultimodalPrompt;\r\n  context: UIContext<ElementType>;\r\n  extractOption?: InsightExtractOption;\r\n  modelConfig: IModelConfig;\r\n}) {\r\n  const { dataQuery, context, extractOption, multimodalPrompt, modelConfig } =\r\n    options;\r\n  const { vlMode } = modelConfig;\r\n  const systemPrompt = systemPromptToExtract();\r\n\r\n  const { screenshotBase64 } = context;\r\n\r\n  const { description, elementById } = await describeUserPage(context, {\r\n    truncateTextLength: 200,\r\n    filterNonTextContent: false,\r\n    visibleOnly: false,\r\n    domIncluded: extractOption?.domIncluded,\r\n    vlMode,\r\n  });\r\n\r\n  const extractDataPromptText = extractDataQueryPrompt(description, dataQuery);\r\n\r\n  const userContent: ChatCompletionUserMessageParam['content'] = [];\r\n\r\n  if (extractOption?.screenshotIncluded !== false) {\r\n    userContent.push({\r\n      type: 'image_url',\r\n      image_url: {\r\n        url: screenshotBase64,\r\n        detail: 'high',\r\n      },\r\n    });\r\n  }\r\n\r\n  userContent.push({\r\n    type: 'text',\r\n    text: extractDataPromptText,\r\n  });\r\n\r\n  const msgs: AIArgs = [\r\n    { role: 'system', content: systemPrompt },\r\n    {\r\n      role: 'user',\r\n      content: userContent,\r\n    },\r\n  ];\r\n\r\n  if (multimodalPrompt) {\r\n    const addOns = await promptsToChatParam({\r\n      images: multimodalPrompt.images,\r\n      convertHttpImage2Base64: multimodalPrompt.convertHttpImage2Base64,\r\n    });\r\n    msgs.push(...addOns);\r\n  }\r\n\r\n  const result = await callAIWithObjectResponse<AIDataExtractionResponse<T>>(\r\n    msgs,\r\n    AIActionType.EXTRACT_DATA,\r\n    modelConfig,\r\n  );\r\n  return {\r\n    parseResult: result.content,\r\n    elementById,\r\n    usage: result.usage,\r\n  };\r\n}\r\n","import type {\r\n  DeviceAction,\r\n  InterfaceType,\r\n  PlanningAIResponse,\r\n  UIContext,\r\n} from '@/types';\r\nimport type { IModelConfig } from '@sqaitech/shared/env';\r\nimport { paddingToMatchBlockByBase64 } from '@sqaitech/shared/img';\r\nimport { getDebug } from '@sqaitech/shared/logger';\r\nimport { assert } from '@sqaitech/shared/utils';\r\nimport type {\r\n  ChatCompletionContentPart,\r\n  ChatCompletionMessageParam,\r\n} from 'openai/resources/index';\r\nimport {\r\n  AIActionType,\r\n  buildYamlFlowFromPlans,\r\n  fillBboxParam,\r\n  findAllMidsceneLocatorField,\r\n  markupImageForLLM,\r\n  warnGPT4oSizeLimit,\r\n} from './common';\r\nimport type { ConversationHistory } from './conversation-history';\r\nimport { systemPromptToTaskPlanning } from './prompt/llm-planning';\r\nimport { describeUserPage } from './prompt/util';\r\nimport { callAIWithObjectResponse } from './service-caller/index';\r\n\r\nconst debug = getDebug('planning');\r\n\r\nexport async function plan(\r\n  userInstruction: string,\r\n  opts: {\r\n    context: UIContext;\r\n    interfaceType: InterfaceType;\r\n    actionSpace: DeviceAction<any>[];\r\n    actionContext?: string;\r\n    modelConfig: IModelConfig;\r\n    conversationHistory?: ConversationHistory;\r\n  },\r\n): Promise<PlanningAIResponse> {\r\n  const { context, modelConfig, conversationHistory } = opts;\r\n  const { screenshotBase64, size } = context;\r\n\r\n  const { modelName, vlMode } = modelConfig;\r\n\r\n  const { description: pageDescription, elementById } = await describeUserPage(\r\n    context,\r\n    { vlMode },\r\n  );\r\n  const systemPrompt = await systemPromptToTaskPlanning({\r\n    actionSpace: opts.actionSpace,\r\n    vlMode: vlMode,\r\n  });\r\n\r\n  let imagePayload = screenshotBase64;\r\n  let imageWidth = size.width;\r\n  let imageHeight = size.height;\r\n  const rightLimit = imageWidth;\r\n  const bottomLimit = imageHeight;\r\n  if (vlMode === 'qwen-vl') {\r\n    const paddedResult = await paddingToMatchBlockByBase64(imagePayload);\r\n    imageWidth = paddedResult.width;\r\n    imageHeight = paddedResult.height;\r\n    imagePayload = paddedResult.imageBase64;\r\n  } else if (vlMode === 'qwen3-vl') {\r\n    // const paddedResult = await paddingToMatchBlockByBase64(imagePayload, 32);\r\n    // imageWidth = paddedResult.width;\r\n    // imageHeight = paddedResult.height;\r\n    // imagePayload = paddedResult.imageBase64;\r\n  } else if (!vlMode) {\r\n    imagePayload = await markupImageForLLM(screenshotBase64, context.tree, {\r\n      width: imageWidth,\r\n      height: imageHeight,\r\n    });\r\n  }\r\n\r\n  warnGPT4oSizeLimit(size, modelName);\r\n\r\n  const historyLog = opts.conversationHistory?.snapshot() || [];\r\n  // .filter((item) => item.role === 'assistant') || [];\r\n\r\n  const knowledgeContext: ChatCompletionMessageParam[] = opts.actionContext\r\n    ? [\r\n        {\r\n          role: 'user',\r\n          content: [\r\n            {\r\n              type: 'text',\r\n              text: `<high_priority_knowledge>${opts.actionContext}</high_priority_knowledge>`,\r\n            },\r\n          ],\r\n        },\r\n      ]\r\n    : [];\r\n\r\n  const instruction: ChatCompletionMessageParam[] = [\r\n    {\r\n      role: 'user',\r\n      content: [\r\n        {\r\n          type: 'text',\r\n          text: `<user_instruction>${userInstruction}</user_instruction>`,\r\n        },\r\n      ],\r\n    },\r\n  ];\r\n\r\n  const msgs: ChatCompletionMessageParam[] = [\r\n    { role: 'system', content: systemPrompt },\r\n    ...knowledgeContext,\r\n    ...instruction,\r\n    ...historyLog,\r\n    {\r\n      role: 'user',\r\n      content: [\r\n        {\r\n          type: 'image_url',\r\n          image_url: {\r\n            url: imagePayload,\r\n            detail: 'high',\r\n          },\r\n        },\r\n        ...(vlMode\r\n          ? []\r\n          : ([\r\n              {\r\n                type: 'text',\r\n                text: pageDescription,\r\n              },\r\n            ] as ChatCompletionContentPart[])),\r\n      ],\r\n    },\r\n  ];\r\n\r\n  const { content, usage } = await callAIWithObjectResponse<PlanningAIResponse>(\r\n    msgs,\r\n    AIActionType.PLAN,\r\n    modelConfig,\r\n  );\r\n  const rawResponse = JSON.stringify(content, undefined, 2);\r\n  const planFromAI = content;\r\n\r\n  const actions =\r\n    (planFromAI.action?.type ? [planFromAI.action] : planFromAI.actions) || [];\r\n  const returnValue: PlanningAIResponse = {\r\n    ...planFromAI,\r\n    actions,\r\n    rawResponse,\r\n    usage,\r\n    yamlFlow: buildYamlFlowFromPlans(\r\n      actions,\r\n      opts.actionSpace,\r\n      planFromAI.sleep,\r\n    ),\r\n  };\r\n\r\n  assert(planFromAI, \"can't get plans from AI\");\r\n\r\n  // TODO: use zod.parse to parse the action.param, and then fill the bbox param.\r\n  actions.forEach((action) => {\r\n    const type = action.type;\r\n    const actionInActionSpace = opts.actionSpace.find(\r\n      (action) => action.name === type,\r\n    );\r\n\r\n    debug('actionInActionSpace matched', actionInActionSpace);\r\n    const locateFields = actionInActionSpace\r\n      ? findAllMidsceneLocatorField(actionInActionSpace.paramSchema)\r\n      : [];\r\n\r\n    debug('locateFields', locateFields);\r\n\r\n    locateFields.forEach((field) => {\r\n      const locateResult = action.param[field];\r\n      if (locateResult) {\r\n        if (vlMode) {\r\n          action.param[field] = fillBboxParam(\r\n            locateResult,\r\n            imageWidth,\r\n            imageHeight,\r\n            rightLimit,\r\n            bottomLimit,\r\n            vlMode,\r\n          );\r\n        } else {\r\n          const element = elementById(locateResult);\r\n          if (element) {\r\n            action.param[field].id = element.id;\r\n          }\r\n        }\r\n      }\r\n    });\r\n  });\r\n  // in Qwen-VL, error means error. In GPT-4o, error may mean more actions are needed.\r\n  assert(!planFromAI.error, `Failed to plan actions: ${planFromAI.error}`);\r\n\r\n  if (\r\n    actions.length === 0 &&\r\n    returnValue.more_actions_needed_by_instruction &&\r\n    !returnValue.sleep\r\n  ) {\r\n    console.warn(\r\n      'No actions planned for the prompt, but model said more actions are needed:',\r\n      userInstruction,\r\n    );\r\n  }\r\n\r\n  conversationHistory?.append({\r\n    role: 'assistant',\r\n    content: [\r\n      {\r\n        type: 'text',\r\n        text: rawResponse,\r\n      },\r\n    ],\r\n  });\r\n  conversationHistory?.append({\r\n    role: 'user',\r\n    content: [\r\n      {\r\n        type: 'text',\r\n        text: 'I have finished the action previously planned',\r\n      },\r\n    ],\r\n  });\r\n\r\n  return returnValue;\r\n}\r\n","/*! For license information please see us-keyboard-layout.mjs.LICENSE.txt */\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n * SPDX-License-Identifier: Apache-2.0\r\n */ const _keyDefinitions = {\n    0: {\n        keyCode: 48,\n        key: '0',\n        code: 'Digit0'\n    },\n    1: {\n        keyCode: 49,\n        key: '1',\n        code: 'Digit1'\n    },\n    2: {\n        keyCode: 50,\n        key: '2',\n        code: 'Digit2'\n    },\n    3: {\n        keyCode: 51,\n        key: '3',\n        code: 'Digit3'\n    },\n    4: {\n        keyCode: 52,\n        key: '4',\n        code: 'Digit4'\n    },\n    5: {\n        keyCode: 53,\n        key: '5',\n        code: 'Digit5'\n    },\n    6: {\n        keyCode: 54,\n        key: '6',\n        code: 'Digit6'\n    },\n    7: {\n        keyCode: 55,\n        key: '7',\n        code: 'Digit7'\n    },\n    8: {\n        keyCode: 56,\n        key: '8',\n        code: 'Digit8'\n    },\n    9: {\n        keyCode: 57,\n        key: '9',\n        code: 'Digit9'\n    },\n    Power: {\n        key: 'Power',\n        code: 'Power'\n    },\n    Eject: {\n        key: 'Eject',\n        code: 'Eject'\n    },\n    Abort: {\n        keyCode: 3,\n        code: 'Abort',\n        key: 'Cancel'\n    },\n    Help: {\n        keyCode: 6,\n        code: 'Help',\n        key: 'Help'\n    },\n    Backspace: {\n        keyCode: 8,\n        code: 'Backspace',\n        key: 'Backspace'\n    },\n    Tab: {\n        keyCode: 9,\n        code: 'Tab',\n        key: 'Tab'\n    },\n    Numpad5: {\n        keyCode: 12,\n        shiftKeyCode: 101,\n        key: 'Clear',\n        code: 'Numpad5',\n        shiftKey: '5',\n        location: 3\n    },\n    NumpadEnter: {\n        keyCode: 13,\n        code: 'NumpadEnter',\n        key: 'Enter',\n        text: '\\r',\n        location: 3\n    },\n    Enter: {\n        keyCode: 13,\n        code: 'Enter',\n        key: 'Enter',\n        text: '\\r'\n    },\n    '\\r': {\n        keyCode: 13,\n        code: 'Enter',\n        key: 'Enter',\n        text: '\\r'\n    },\n    '\\n': {\n        keyCode: 13,\n        code: 'Enter',\n        key: 'Enter',\n        text: '\\r'\n    },\n    ShiftLeft: {\n        keyCode: 16,\n        code: 'ShiftLeft',\n        key: 'Shift',\n        location: 1\n    },\n    ShiftRight: {\n        keyCode: 16,\n        code: 'ShiftRight',\n        key: 'Shift',\n        location: 2\n    },\n    ControlLeft: {\n        keyCode: 17,\n        code: 'ControlLeft',\n        key: 'Control',\n        location: 1\n    },\n    ControlRight: {\n        keyCode: 17,\n        code: 'ControlRight',\n        key: 'Control',\n        location: 2\n    },\n    AltLeft: {\n        keyCode: 18,\n        code: 'AltLeft',\n        key: 'Alt',\n        location: 1\n    },\n    AltRight: {\n        keyCode: 18,\n        code: 'AltRight',\n        key: 'Alt',\n        location: 2\n    },\n    Pause: {\n        keyCode: 19,\n        code: 'Pause',\n        key: 'Pause'\n    },\n    CapsLock: {\n        keyCode: 20,\n        code: 'CapsLock',\n        key: 'CapsLock'\n    },\n    Escape: {\n        keyCode: 27,\n        code: 'Escape',\n        key: 'Escape'\n    },\n    Convert: {\n        keyCode: 28,\n        code: 'Convert',\n        key: 'Convert'\n    },\n    NonConvert: {\n        keyCode: 29,\n        code: 'NonConvert',\n        key: 'NonConvert'\n    },\n    Space: {\n        keyCode: 32,\n        code: 'Space',\n        key: ' '\n    },\n    Numpad9: {\n        keyCode: 33,\n        shiftKeyCode: 105,\n        key: 'PageUp',\n        code: 'Numpad9',\n        shiftKey: '9',\n        location: 3\n    },\n    PageUp: {\n        keyCode: 33,\n        code: 'PageUp',\n        key: 'PageUp'\n    },\n    Numpad3: {\n        keyCode: 34,\n        shiftKeyCode: 99,\n        key: 'PageDown',\n        code: 'Numpad3',\n        shiftKey: '3',\n        location: 3\n    },\n    PageDown: {\n        keyCode: 34,\n        code: 'PageDown',\n        key: 'PageDown'\n    },\n    End: {\n        keyCode: 35,\n        code: 'End',\n        key: 'End'\n    },\n    Numpad1: {\n        keyCode: 35,\n        shiftKeyCode: 97,\n        key: 'End',\n        code: 'Numpad1',\n        shiftKey: '1',\n        location: 3\n    },\n    Home: {\n        keyCode: 36,\n        code: 'Home',\n        key: 'Home'\n    },\n    Numpad7: {\n        keyCode: 36,\n        shiftKeyCode: 103,\n        key: 'Home',\n        code: 'Numpad7',\n        shiftKey: '7',\n        location: 3\n    },\n    ArrowLeft: {\n        keyCode: 37,\n        code: 'ArrowLeft',\n        key: 'ArrowLeft'\n    },\n    Numpad4: {\n        keyCode: 37,\n        shiftKeyCode: 100,\n        key: 'ArrowLeft',\n        code: 'Numpad4',\n        shiftKey: '4',\n        location: 3\n    },\n    Numpad8: {\n        keyCode: 38,\n        shiftKeyCode: 104,\n        key: 'ArrowUp',\n        code: 'Numpad8',\n        shiftKey: '8',\n        location: 3\n    },\n    ArrowUp: {\n        keyCode: 38,\n        code: 'ArrowUp',\n        key: 'ArrowUp'\n    },\n    ArrowRight: {\n        keyCode: 39,\n        code: 'ArrowRight',\n        key: 'ArrowRight'\n    },\n    Numpad6: {\n        keyCode: 39,\n        shiftKeyCode: 102,\n        key: 'ArrowRight',\n        code: 'Numpad6',\n        shiftKey: '6',\n        location: 3\n    },\n    Numpad2: {\n        keyCode: 40,\n        shiftKeyCode: 98,\n        key: 'ArrowDown',\n        code: 'Numpad2',\n        shiftKey: '2',\n        location: 3\n    },\n    ArrowDown: {\n        keyCode: 40,\n        code: 'ArrowDown',\n        key: 'ArrowDown'\n    },\n    Select: {\n        keyCode: 41,\n        code: 'Select',\n        key: 'Select'\n    },\n    Open: {\n        keyCode: 43,\n        code: 'Open',\n        key: 'Execute'\n    },\n    PrintScreen: {\n        keyCode: 44,\n        code: 'PrintScreen',\n        key: 'PrintScreen'\n    },\n    Insert: {\n        keyCode: 45,\n        code: 'Insert',\n        key: 'Insert'\n    },\n    Numpad0: {\n        keyCode: 45,\n        shiftKeyCode: 96,\n        key: 'Insert',\n        code: 'Numpad0',\n        shiftKey: '0',\n        location: 3\n    },\n    Delete: {\n        keyCode: 46,\n        code: 'Delete',\n        key: 'Delete'\n    },\n    NumpadDecimal: {\n        keyCode: 46,\n        shiftKeyCode: 110,\n        code: 'NumpadDecimal',\n        key: '\\u0000',\n        shiftKey: '.',\n        location: 3\n    },\n    Digit0: {\n        keyCode: 48,\n        code: 'Digit0',\n        shiftKey: ')',\n        key: '0'\n    },\n    Digit1: {\n        keyCode: 49,\n        code: 'Digit1',\n        shiftKey: '!',\n        key: '1'\n    },\n    Digit2: {\n        keyCode: 50,\n        code: 'Digit2',\n        shiftKey: '@',\n        key: '2'\n    },\n    Digit3: {\n        keyCode: 51,\n        code: 'Digit3',\n        shiftKey: '#',\n        key: '3'\n    },\n    Digit4: {\n        keyCode: 52,\n        code: 'Digit4',\n        shiftKey: '$',\n        key: '4'\n    },\n    Digit5: {\n        keyCode: 53,\n        code: 'Digit5',\n        shiftKey: '%',\n        key: '5'\n    },\n    Digit6: {\n        keyCode: 54,\n        code: 'Digit6',\n        shiftKey: '^',\n        key: '6'\n    },\n    Digit7: {\n        keyCode: 55,\n        code: 'Digit7',\n        shiftKey: '&',\n        key: '7'\n    },\n    Digit8: {\n        keyCode: 56,\n        code: 'Digit8',\n        shiftKey: '*',\n        key: '8'\n    },\n    Digit9: {\n        keyCode: 57,\n        code: 'Digit9',\n        shiftKey: '(',\n        key: '9'\n    },\n    KeyA: {\n        keyCode: 65,\n        code: 'KeyA',\n        shiftKey: 'A',\n        key: 'a'\n    },\n    KeyB: {\n        keyCode: 66,\n        code: 'KeyB',\n        shiftKey: 'B',\n        key: 'b'\n    },\n    KeyC: {\n        keyCode: 67,\n        code: 'KeyC',\n        shiftKey: 'C',\n        key: 'c'\n    },\n    KeyD: {\n        keyCode: 68,\n        code: 'KeyD',\n        shiftKey: 'D',\n        key: 'd'\n    },\n    KeyE: {\n        keyCode: 69,\n        code: 'KeyE',\n        shiftKey: 'E',\n        key: 'e'\n    },\n    KeyF: {\n        keyCode: 70,\n        code: 'KeyF',\n        shiftKey: 'F',\n        key: 'f'\n    },\n    KeyG: {\n        keyCode: 71,\n        code: 'KeyG',\n        shiftKey: 'G',\n        key: 'g'\n    },\n    KeyH: {\n        keyCode: 72,\n        code: 'KeyH',\n        shiftKey: 'H',\n        key: 'h'\n    },\n    KeyI: {\n        keyCode: 73,\n        code: 'KeyI',\n        shiftKey: 'I',\n        key: 'i'\n    },\n    KeyJ: {\n        keyCode: 74,\n        code: 'KeyJ',\n        shiftKey: 'J',\n        key: 'j'\n    },\n    KeyK: {\n        keyCode: 75,\n        code: 'KeyK',\n        shiftKey: 'K',\n        key: 'k'\n    },\n    KeyL: {\n        keyCode: 76,\n        code: 'KeyL',\n        shiftKey: 'L',\n        key: 'l'\n    },\n    KeyM: {\n        keyCode: 77,\n        code: 'KeyM',\n        shiftKey: 'M',\n        key: 'm'\n    },\n    KeyN: {\n        keyCode: 78,\n        code: 'KeyN',\n        shiftKey: 'N',\n        key: 'n'\n    },\n    KeyO: {\n        keyCode: 79,\n        code: 'KeyO',\n        shiftKey: 'O',\n        key: 'o'\n    },\n    KeyP: {\n        keyCode: 80,\n        code: 'KeyP',\n        shiftKey: 'P',\n        key: 'p'\n    },\n    KeyQ: {\n        keyCode: 81,\n        code: 'KeyQ',\n        shiftKey: 'Q',\n        key: 'q'\n    },\n    KeyR: {\n        keyCode: 82,\n        code: 'KeyR',\n        shiftKey: 'R',\n        key: 'r'\n    },\n    KeyS: {\n        keyCode: 83,\n        code: 'KeyS',\n        shiftKey: 'S',\n        key: 's'\n    },\n    KeyT: {\n        keyCode: 84,\n        code: 'KeyT',\n        shiftKey: 'T',\n        key: 't'\n    },\n    KeyU: {\n        keyCode: 85,\n        code: 'KeyU',\n        shiftKey: 'U',\n        key: 'u'\n    },\n    KeyV: {\n        keyCode: 86,\n        code: 'KeyV',\n        shiftKey: 'V',\n        key: 'v'\n    },\n    KeyW: {\n        keyCode: 87,\n        code: 'KeyW',\n        shiftKey: 'W',\n        key: 'w'\n    },\n    KeyX: {\n        keyCode: 88,\n        code: 'KeyX',\n        shiftKey: 'X',\n        key: 'x'\n    },\n    KeyY: {\n        keyCode: 89,\n        code: 'KeyY',\n        shiftKey: 'Y',\n        key: 'y'\n    },\n    KeyZ: {\n        keyCode: 90,\n        code: 'KeyZ',\n        shiftKey: 'Z',\n        key: 'z'\n    },\n    MetaLeft: {\n        keyCode: 91,\n        code: 'MetaLeft',\n        key: 'Meta',\n        location: 1\n    },\n    MetaRight: {\n        keyCode: 92,\n        code: 'MetaRight',\n        key: 'Meta',\n        location: 2\n    },\n    ContextMenu: {\n        keyCode: 93,\n        code: 'ContextMenu',\n        key: 'ContextMenu'\n    },\n    NumpadMultiply: {\n        keyCode: 106,\n        code: 'NumpadMultiply',\n        key: '*',\n        location: 3\n    },\n    NumpadAdd: {\n        keyCode: 107,\n        code: 'NumpadAdd',\n        key: '+',\n        location: 3\n    },\n    NumpadSubtract: {\n        keyCode: 109,\n        code: 'NumpadSubtract',\n        key: '-',\n        location: 3\n    },\n    NumpadDivide: {\n        keyCode: 111,\n        code: 'NumpadDivide',\n        key: '/',\n        location: 3\n    },\n    F1: {\n        keyCode: 112,\n        code: 'F1',\n        key: 'F1'\n    },\n    F2: {\n        keyCode: 113,\n        code: 'F2',\n        key: 'F2'\n    },\n    F3: {\n        keyCode: 114,\n        code: 'F3',\n        key: 'F3'\n    },\n    F4: {\n        keyCode: 115,\n        code: 'F4',\n        key: 'F4'\n    },\n    F5: {\n        keyCode: 116,\n        code: 'F5',\n        key: 'F5'\n    },\n    F6: {\n        keyCode: 117,\n        code: 'F6',\n        key: 'F6'\n    },\n    F7: {\n        keyCode: 118,\n        code: 'F7',\n        key: 'F7'\n    },\n    F8: {\n        keyCode: 119,\n        code: 'F8',\n        key: 'F8'\n    },\n    F9: {\n        keyCode: 120,\n        code: 'F9',\n        key: 'F9'\n    },\n    F10: {\n        keyCode: 121,\n        code: 'F10',\n        key: 'F10'\n    },\n    F11: {\n        keyCode: 122,\n        code: 'F11',\n        key: 'F11'\n    },\n    F12: {\n        keyCode: 123,\n        code: 'F12',\n        key: 'F12'\n    },\n    F13: {\n        keyCode: 124,\n        code: 'F13',\n        key: 'F13'\n    },\n    F14: {\n        keyCode: 125,\n        code: 'F14',\n        key: 'F14'\n    },\n    F15: {\n        keyCode: 126,\n        code: 'F15',\n        key: 'F15'\n    },\n    F16: {\n        keyCode: 127,\n        code: 'F16',\n        key: 'F16'\n    },\n    F17: {\n        keyCode: 128,\n        code: 'F17',\n        key: 'F17'\n    },\n    F18: {\n        keyCode: 129,\n        code: 'F18',\n        key: 'F18'\n    },\n    F19: {\n        keyCode: 130,\n        code: 'F19',\n        key: 'F19'\n    },\n    F20: {\n        keyCode: 131,\n        code: 'F20',\n        key: 'F20'\n    },\n    F21: {\n        keyCode: 132,\n        code: 'F21',\n        key: 'F21'\n    },\n    F22: {\n        keyCode: 133,\n        code: 'F22',\n        key: 'F22'\n    },\n    F23: {\n        keyCode: 134,\n        code: 'F23',\n        key: 'F23'\n    },\n    F24: {\n        keyCode: 135,\n        code: 'F24',\n        key: 'F24'\n    },\n    NumLock: {\n        keyCode: 144,\n        code: 'NumLock',\n        key: 'NumLock'\n    },\n    ScrollLock: {\n        keyCode: 145,\n        code: 'ScrollLock',\n        key: 'ScrollLock'\n    },\n    AudioVolumeMute: {\n        keyCode: 173,\n        code: 'AudioVolumeMute',\n        key: 'AudioVolumeMute'\n    },\n    AudioVolumeDown: {\n        keyCode: 174,\n        code: 'AudioVolumeDown',\n        key: 'AudioVolumeDown'\n    },\n    AudioVolumeUp: {\n        keyCode: 175,\n        code: 'AudioVolumeUp',\n        key: 'AudioVolumeUp'\n    },\n    MediaTrackNext: {\n        keyCode: 176,\n        code: 'MediaTrackNext',\n        key: 'MediaTrackNext'\n    },\n    MediaTrackPrevious: {\n        keyCode: 177,\n        code: 'MediaTrackPrevious',\n        key: 'MediaTrackPrevious'\n    },\n    MediaStop: {\n        keyCode: 178,\n        code: 'MediaStop',\n        key: 'MediaStop'\n    },\n    MediaPlayPause: {\n        keyCode: 179,\n        code: 'MediaPlayPause',\n        key: 'MediaPlayPause'\n    },\n    Semicolon: {\n        keyCode: 186,\n        code: 'Semicolon',\n        shiftKey: ':',\n        key: ';'\n    },\n    Equal: {\n        keyCode: 187,\n        code: 'Equal',\n        shiftKey: '+',\n        key: '='\n    },\n    NumpadEqual: {\n        keyCode: 187,\n        code: 'NumpadEqual',\n        key: '=',\n        location: 3\n    },\n    Comma: {\n        keyCode: 188,\n        code: 'Comma',\n        shiftKey: '<',\n        key: ','\n    },\n    Minus: {\n        keyCode: 189,\n        code: 'Minus',\n        shiftKey: '_',\n        key: '-'\n    },\n    Period: {\n        keyCode: 190,\n        code: 'Period',\n        shiftKey: '>',\n        key: '.'\n    },\n    Slash: {\n        keyCode: 191,\n        code: 'Slash',\n        shiftKey: '?',\n        key: '/'\n    },\n    Backquote: {\n        keyCode: 192,\n        code: 'Backquote',\n        shiftKey: '~',\n        key: '`'\n    },\n    BracketLeft: {\n        keyCode: 219,\n        code: 'BracketLeft',\n        shiftKey: '{',\n        key: '['\n    },\n    Backslash: {\n        keyCode: 220,\n        code: 'Backslash',\n        shiftKey: '|',\n        key: '\\\\'\n    },\n    BracketRight: {\n        keyCode: 221,\n        code: 'BracketRight',\n        shiftKey: '}',\n        key: ']'\n    },\n    Quote: {\n        keyCode: 222,\n        code: 'Quote',\n        shiftKey: '\"',\n        key: \"'\"\n    },\n    AltGraph: {\n        keyCode: 225,\n        code: 'AltGraph',\n        key: 'AltGraph'\n    },\n    Props: {\n        keyCode: 247,\n        code: 'Props',\n        key: 'CrSel'\n    },\n    Cancel: {\n        keyCode: 3,\n        key: 'Cancel',\n        code: 'Abort'\n    },\n    Clear: {\n        keyCode: 12,\n        key: 'Clear',\n        code: 'Numpad5',\n        location: 3\n    },\n    Shift: {\n        keyCode: 16,\n        key: 'Shift',\n        code: 'ShiftLeft',\n        location: 1\n    },\n    Control: {\n        keyCode: 17,\n        key: 'Control',\n        code: 'ControlLeft',\n        location: 1\n    },\n    Alt: {\n        keyCode: 18,\n        key: 'Alt',\n        code: 'AltLeft',\n        location: 1\n    },\n    Accept: {\n        keyCode: 30,\n        key: 'Accept'\n    },\n    ModeChange: {\n        keyCode: 31,\n        key: 'ModeChange'\n    },\n    ' ': {\n        keyCode: 32,\n        key: ' ',\n        code: 'Space'\n    },\n    Print: {\n        keyCode: 42,\n        key: 'Print'\n    },\n    Execute: {\n        keyCode: 43,\n        key: 'Execute',\n        code: 'Open'\n    },\n    '\\u0000': {\n        keyCode: 46,\n        key: '\\u0000',\n        code: 'NumpadDecimal',\n        location: 3\n    },\n    a: {\n        keyCode: 65,\n        key: 'a',\n        code: 'KeyA'\n    },\n    b: {\n        keyCode: 66,\n        key: 'b',\n        code: 'KeyB'\n    },\n    c: {\n        keyCode: 67,\n        key: 'c',\n        code: 'KeyC'\n    },\n    d: {\n        keyCode: 68,\n        key: 'd',\n        code: 'KeyD'\n    },\n    e: {\n        keyCode: 69,\n        key: 'e',\n        code: 'KeyE'\n    },\n    f: {\n        keyCode: 70,\n        key: 'f',\n        code: 'KeyF'\n    },\n    g: {\n        keyCode: 71,\n        key: 'g',\n        code: 'KeyG'\n    },\n    h: {\n        keyCode: 72,\n        key: 'h',\n        code: 'KeyH'\n    },\n    i: {\n        keyCode: 73,\n        key: 'i',\n        code: 'KeyI'\n    },\n    j: {\n        keyCode: 74,\n        key: 'j',\n        code: 'KeyJ'\n    },\n    k: {\n        keyCode: 75,\n        key: 'k',\n        code: 'KeyK'\n    },\n    l: {\n        keyCode: 76,\n        key: 'l',\n        code: 'KeyL'\n    },\n    m: {\n        keyCode: 77,\n        key: 'm',\n        code: 'KeyM'\n    },\n    n: {\n        keyCode: 78,\n        key: 'n',\n        code: 'KeyN'\n    },\n    o: {\n        keyCode: 79,\n        key: 'o',\n        code: 'KeyO'\n    },\n    p: {\n        keyCode: 80,\n        key: 'p',\n        code: 'KeyP'\n    },\n    q: {\n        keyCode: 81,\n        key: 'q',\n        code: 'KeyQ'\n    },\n    r: {\n        keyCode: 82,\n        key: 'r',\n        code: 'KeyR'\n    },\n    s: {\n        keyCode: 83,\n        key: 's',\n        code: 'KeyS'\n    },\n    t: {\n        keyCode: 84,\n        key: 't',\n        code: 'KeyT'\n    },\n    u: {\n        keyCode: 85,\n        key: 'u',\n        code: 'KeyU'\n    },\n    v: {\n        keyCode: 86,\n        key: 'v',\n        code: 'KeyV'\n    },\n    w: {\n        keyCode: 87,\n        key: 'w',\n        code: 'KeyW'\n    },\n    x: {\n        keyCode: 88,\n        key: 'x',\n        code: 'KeyX'\n    },\n    y: {\n        keyCode: 89,\n        key: 'y',\n        code: 'KeyY'\n    },\n    z: {\n        keyCode: 90,\n        key: 'z',\n        code: 'KeyZ'\n    },\n    Meta: {\n        keyCode: 91,\n        key: 'Meta',\n        code: 'MetaLeft',\n        location: 1\n    },\n    '*': {\n        keyCode: 106,\n        key: '*',\n        code: 'NumpadMultiply',\n        location: 3\n    },\n    '+': {\n        keyCode: 107,\n        key: '+',\n        code: 'NumpadAdd',\n        location: 3\n    },\n    '-': {\n        keyCode: 109,\n        key: '-',\n        code: 'NumpadSubtract',\n        location: 3\n    },\n    '/': {\n        keyCode: 111,\n        key: '/',\n        code: 'NumpadDivide',\n        location: 3\n    },\n    ';': {\n        keyCode: 186,\n        key: ';',\n        code: 'Semicolon'\n    },\n    '=': {\n        keyCode: 187,\n        key: '=',\n        code: 'Equal'\n    },\n    ',': {\n        keyCode: 188,\n        key: ',',\n        code: 'Comma'\n    },\n    '.': {\n        keyCode: 190,\n        key: '.',\n        code: 'Period'\n    },\n    '`': {\n        keyCode: 192,\n        key: '`',\n        code: 'Backquote'\n    },\n    '[': {\n        keyCode: 219,\n        key: '[',\n        code: 'BracketLeft'\n    },\n    '\\\\': {\n        keyCode: 220,\n        key: '\\\\',\n        code: 'Backslash'\n    },\n    ']': {\n        keyCode: 221,\n        key: ']',\n        code: 'BracketRight'\n    },\n    \"'\": {\n        keyCode: 222,\n        key: \"'\",\n        code: 'Quote'\n    },\n    Attn: {\n        keyCode: 246,\n        key: 'Attn'\n    },\n    CrSel: {\n        keyCode: 247,\n        key: 'CrSel',\n        code: 'Props'\n    },\n    ExSel: {\n        keyCode: 248,\n        key: 'ExSel'\n    },\n    EraseEof: {\n        keyCode: 249,\n        key: 'EraseEof'\n    },\n    Play: {\n        keyCode: 250,\n        key: 'Play'\n    },\n    ZoomOut: {\n        keyCode: 251,\n        key: 'ZoomOut'\n    },\n    ')': {\n        keyCode: 48,\n        key: ')',\n        code: 'Digit0'\n    },\n    '!': {\n        keyCode: 49,\n        key: '!',\n        code: 'Digit1'\n    },\n    '@': {\n        keyCode: 50,\n        key: '@',\n        code: 'Digit2'\n    },\n    '#': {\n        keyCode: 51,\n        key: '#',\n        code: 'Digit3'\n    },\n    $: {\n        keyCode: 52,\n        key: '$',\n        code: 'Digit4'\n    },\n    '%': {\n        keyCode: 53,\n        key: '%',\n        code: 'Digit5'\n    },\n    '^': {\n        keyCode: 54,\n        key: '^',\n        code: 'Digit6'\n    },\n    '&': {\n        keyCode: 55,\n        key: '&',\n        code: 'Digit7'\n    },\n    '(': {\n        keyCode: 57,\n        key: '(',\n        code: 'Digit9'\n    },\n    A: {\n        keyCode: 65,\n        key: 'A',\n        code: 'KeyA'\n    },\n    B: {\n        keyCode: 66,\n        key: 'B',\n        code: 'KeyB'\n    },\n    C: {\n        keyCode: 67,\n        key: 'C',\n        code: 'KeyC'\n    },\n    D: {\n        keyCode: 68,\n        key: 'D',\n        code: 'KeyD'\n    },\n    E: {\n        keyCode: 69,\n        key: 'E',\n        code: 'KeyE'\n    },\n    F: {\n        keyCode: 70,\n        key: 'F',\n        code: 'KeyF'\n    },\n    G: {\n        keyCode: 71,\n        key: 'G',\n        code: 'KeyG'\n    },\n    H: {\n        keyCode: 72,\n        key: 'H',\n        code: 'KeyH'\n    },\n    I: {\n        keyCode: 73,\n        key: 'I',\n        code: 'KeyI'\n    },\n    J: {\n        keyCode: 74,\n        key: 'J',\n        code: 'KeyJ'\n    },\n    K: {\n        keyCode: 75,\n        key: 'K',\n        code: 'KeyK'\n    },\n    L: {\n        keyCode: 76,\n        key: 'L',\n        code: 'KeyL'\n    },\n    M: {\n        keyCode: 77,\n        key: 'M',\n        code: 'KeyM'\n    },\n    N: {\n        keyCode: 78,\n        key: 'N',\n        code: 'KeyN'\n    },\n    O: {\n        keyCode: 79,\n        key: 'O',\n        code: 'KeyO'\n    },\n    P: {\n        keyCode: 80,\n        key: 'P',\n        code: 'KeyP'\n    },\n    Q: {\n        keyCode: 81,\n        key: 'Q',\n        code: 'KeyQ'\n    },\n    R: {\n        keyCode: 82,\n        key: 'R',\n        code: 'KeyR'\n    },\n    S: {\n        keyCode: 83,\n        key: 'S',\n        code: 'KeyS'\n    },\n    T: {\n        keyCode: 84,\n        key: 'T',\n        code: 'KeyT'\n    },\n    U: {\n        keyCode: 85,\n        key: 'U',\n        code: 'KeyU'\n    },\n    V: {\n        keyCode: 86,\n        key: 'V',\n        code: 'KeyV'\n    },\n    W: {\n        keyCode: 87,\n        key: 'W',\n        code: 'KeyW'\n    },\n    X: {\n        keyCode: 88,\n        key: 'X',\n        code: 'KeyX'\n    },\n    Y: {\n        keyCode: 89,\n        key: 'Y',\n        code: 'KeyY'\n    },\n    Z: {\n        keyCode: 90,\n        key: 'Z',\n        code: 'KeyZ'\n    },\n    ':': {\n        keyCode: 186,\n        key: ':',\n        code: 'Semicolon'\n    },\n    '<': {\n        keyCode: 188,\n        key: '<',\n        code: 'Comma'\n    },\n    _: {\n        keyCode: 189,\n        key: '_',\n        code: 'Minus'\n    },\n    '>': {\n        keyCode: 190,\n        key: '>',\n        code: 'Period'\n    },\n    '?': {\n        keyCode: 191,\n        key: '?',\n        code: 'Slash'\n    },\n    '~': {\n        keyCode: 192,\n        key: '~',\n        code: 'Backquote'\n    },\n    '{': {\n        keyCode: 219,\n        key: '{',\n        code: 'BracketLeft'\n    },\n    '|': {\n        keyCode: 220,\n        key: '|',\n        code: 'Backslash'\n    },\n    '}': {\n        keyCode: 221,\n        key: '}',\n        code: 'BracketRight'\n    },\n    '\"': {\n        keyCode: 222,\n        key: '\"',\n        code: 'Quote'\n    },\n    SoftLeft: {\n        key: 'SoftLeft',\n        code: 'SoftLeft',\n        location: 4\n    },\n    SoftRight: {\n        key: 'SoftRight',\n        code: 'SoftRight',\n        location: 4\n    },\n    Camera: {\n        keyCode: 44,\n        key: 'Camera',\n        code: 'Camera',\n        location: 4\n    },\n    Call: {\n        key: 'Call',\n        code: 'Call',\n        location: 4\n    },\n    EndCall: {\n        keyCode: 95,\n        key: 'EndCall',\n        code: 'EndCall',\n        location: 4\n    },\n    VolumeDown: {\n        keyCode: 182,\n        key: 'VolumeDown',\n        code: 'VolumeDown',\n        location: 4\n    },\n    VolumeUp: {\n        keyCode: 183,\n        key: 'VolumeUp',\n        code: 'VolumeUp',\n        location: 4\n    }\n};\nconst lowerCaseKeyDefinitions = Object.entries(_keyDefinitions).reduce((acc, [key, definition])=>{\n    const lowerKey = key.toLowerCase();\n    if (lowerKey !== key) acc[lowerKey] = definition;\n    return acc;\n}, {});\nconst getKeyDefinition = (key)=>{\n    const lowerKey = key.toLowerCase();\n    if (lowerCaseKeyDefinitions[lowerKey]) return lowerCaseKeyDefinitions[lowerKey].key;\n    return key;\n};\nconst isMac = 'undefined' != typeof window ? /Mac|iPod|iPhone|iPad/.test(window.navigator.platform) : 'darwin' === process.platform;\nconst keyMap = {\n    return: _keyDefinitions.Enter.key,\n    enter: _keyDefinitions.Enter.key,\n    ctrl: isMac ? _keyDefinitions.Meta.key : _keyDefinitions.Control.key,\n    shift: _keyDefinitions.Shift.key,\n    alt: _keyDefinitions.Alt.key,\n    space: _keyDefinitions.Space.key,\n    'page down': _keyDefinitions.PageDown.key,\n    pagedown: _keyDefinitions.PageDown.key,\n    'page up': _keyDefinitions.PageUp.key,\n    pageup: _keyDefinitions.PageUp.key\n};\nfunction transformHotkeyInput(keyInput) {\n    if (keyMap[keyInput.toLowerCase()]) return [\n        getKeyDefinition(keyMap[keyInput.toLowerCase()])\n    ];\n    return keyInput.split(' ').map((key)=>getKeyDefinition(keyMap[key.toLowerCase()] || key));\n}\nexport { _keyDefinitions, getKeyDefinition, isMac, transformHotkeyInput };\n","import type {\r\n  PlanningAIResponse,\r\n  PlanningAction,\r\n  Size,\r\n  UIContext,\r\n} from '@/types';\r\nimport { type IModelConfig, UITarsModelVersion } from '@sqaitech/shared/env';\r\nimport { resizeImgBase64 } from '@sqaitech/shared/img';\r\nimport { getDebug } from '@sqaitech/shared/logger';\r\nimport { transformHotkeyInput } from '@sqaitech/shared/us-keyboard-layout';\r\nimport { assert } from '@sqaitech/shared/utils';\r\nimport { actionParser } from '@ui-tars/action-parser';\r\nimport { AIActionType } from './common';\r\nimport type { ConversationHistory } from './conversation-history';\r\nimport { getSummary, getUiTarsPlanningPrompt } from './prompt/ui-tars-planning';\r\nimport { callAIWithStringResponse } from './service-caller/index';\r\ntype ActionType =\r\n  | 'click'\r\n  | 'drag'\r\n  | 'type'\r\n  | 'hotkey'\r\n  | 'finished'\r\n  | 'scroll'\r\n  | 'wait';\r\n\r\nconst debug = getDebug('ui-tars-planning');\r\nconst bboxSize = 10;\r\nconst pointToBbox = (\r\n  point: { x: number; y: number },\r\n  width: number,\r\n  height: number,\r\n): [number, number, number, number] => {\r\n  return [\r\n    Math.round(Math.max(point.x - bboxSize / 2, 0)),\r\n    Math.round(Math.max(point.y - bboxSize / 2, 0)),\r\n    Math.round(Math.min(point.x + bboxSize / 2, width)),\r\n    Math.round(Math.min(point.y + bboxSize / 2, height)),\r\n  ];\r\n};\r\n\r\nexport async function uiTarsPlanning(\r\n  userInstruction: string,\r\n  options: {\r\n    conversationHistory: ConversationHistory;\r\n    context: UIContext;\r\n    modelConfig: IModelConfig;\r\n  },\r\n): Promise<PlanningAIResponse> {\r\n  const { conversationHistory, context, modelConfig } = options;\r\n  const { uiTarsModelVersion } = modelConfig;\r\n  const systemPrompt = getUiTarsPlanningPrompt() + userInstruction;\r\n\r\n  const imagePayload = await resizeImageForUiTars(\r\n    context.screenshotBase64,\r\n    context.size,\r\n    uiTarsModelVersion,\r\n  );\r\n\r\n  conversationHistory.append({\r\n    role: 'user',\r\n    content: [\r\n      {\r\n        type: 'image_url',\r\n        image_url: {\r\n          url: imagePayload,\r\n        },\r\n      },\r\n    ],\r\n  });\r\n\r\n  const res = await callAIWithStringResponse(\r\n    [\r\n      {\r\n        role: 'user',\r\n        content: systemPrompt,\r\n      },\r\n      ...conversationHistory.snapshot(),\r\n    ],\r\n    AIActionType.INSPECT_ELEMENT,\r\n    modelConfig,\r\n  );\r\n  const convertedText = convertBboxToCoordinates(res.content);\r\n\r\n  const { size } = context;\r\n  const { parsed } = actionParser({\r\n    prediction: convertedText,\r\n    factor: [1000, 1000],\r\n    screenContext: {\r\n      width: size.width,\r\n      height: size.height,\r\n    },\r\n    modelVer: uiTarsModelVersion,\r\n  });\r\n\r\n  debug(\r\n    'ui-tars modelVer',\r\n    uiTarsModelVersion,\r\n    ', parsed',\r\n    JSON.stringify(parsed),\r\n  );\r\n\r\n  const transformActions: PlanningAction[] = [];\r\n  let shouldContinue = true;\r\n  parsed.forEach((action) => {\r\n    const actionType = (action.action_type || '').toLowerCase();\r\n    if (actionType === 'click') {\r\n      assert(action.action_inputs.start_box, 'start_box is required');\r\n      const point = getPoint(action.action_inputs.start_box, size);\r\n      transformActions.push({\r\n        type: 'Tap',\r\n        param: {\r\n          locate: {\r\n            prompt: action.thought || '',\r\n            bbox: pointToBbox(\r\n              { x: point[0], y: point[1] },\r\n              size.width,\r\n              size.height,\r\n            ),\r\n          },\r\n        },\r\n      });\r\n    } else if (actionType === 'drag') {\r\n      assert(action.action_inputs.start_box, 'start_box is required');\r\n      assert(action.action_inputs.end_box, 'end_box is required');\r\n      const startPoint = getPoint(action.action_inputs.start_box, size);\r\n      const endPoint = getPoint(action.action_inputs.end_box, size);\r\n      transformActions.push({\r\n        type: 'DragAndDrop',\r\n        param: {\r\n          from: {\r\n            prompt: action.thought || '',\r\n            bbox: pointToBbox(\r\n              { x: startPoint[0], y: startPoint[1] },\r\n              size.width,\r\n              size.height,\r\n            ),\r\n          },\r\n          to: {\r\n            prompt: action.thought || '',\r\n            bbox: pointToBbox(\r\n              { x: endPoint[0], y: endPoint[1] },\r\n              size.width,\r\n              size.height,\r\n            ),\r\n          },\r\n        },\r\n        thought: action.thought || '',\r\n      });\r\n    } else if (actionType === 'type') {\r\n      transformActions.push({\r\n        type: 'Input',\r\n        param: {\r\n          value: action.action_inputs.content,\r\n        },\r\n        thought: action.thought || '',\r\n      });\r\n    } else if (actionType === 'scroll') {\r\n      transformActions.push({\r\n        type: 'Scroll',\r\n        param: {\r\n          direction: action.action_inputs.direction,\r\n        },\r\n        thought: action.thought || '',\r\n      });\r\n    } else if (actionType === 'finished') {\r\n      shouldContinue = false;\r\n      transformActions.push({\r\n        type: 'Finished',\r\n        param: {},\r\n        thought: action.thought || '',\r\n      });\r\n    } else if (actionType === 'hotkey') {\r\n      if (!action.action_inputs.key) {\r\n        console.warn(\r\n          'No key found in action: hotkey. Will not perform action.',\r\n        );\r\n      } else {\r\n        const keys = transformHotkeyInput(action.action_inputs.key);\r\n\r\n        transformActions.push({\r\n          type: 'KeyboardPress',\r\n          param: {\r\n            keyName: keys,\r\n          },\r\n          thought: action.thought || '',\r\n        });\r\n      }\r\n    } else if (actionType === 'wait') {\r\n      transformActions.push({\r\n        type: 'Sleep',\r\n        param: {\r\n          timeMs: 1000,\r\n        },\r\n        thought: action.thought || '',\r\n      });\r\n    }\r\n  });\r\n\r\n  if (transformActions.length === 0) {\r\n    throw new Error(`No actions found, response: ${res.content}`, {\r\n      cause: {\r\n        prediction: res.content,\r\n        parsed,\r\n      },\r\n    });\r\n  }\r\n\r\n  debug('transformActions', JSON.stringify(transformActions, null, 2));\r\n  const log = getSummary(res.content);\r\n\r\n  conversationHistory.append({\r\n    role: 'assistant',\r\n    content: log,\r\n  });\r\n\r\n  return {\r\n    actions: transformActions,\r\n    log,\r\n    usage: res.usage,\r\n    rawResponse: JSON.stringify(res.content, undefined, 2),\r\n    more_actions_needed_by_instruction: shouldContinue,\r\n  };\r\n}\r\n\r\n/**\r\n * Converts bounding box notation to coordinate points\r\n * @param text - The text containing bbox tags to be converted\r\n * @returns The text with bbox tags replaced by coordinate points\r\n */\r\nfunction convertBboxToCoordinates(text: string): string {\r\n  // Match the four numbers after <bbox>\r\n  const pattern = /<bbox>(\\d+)\\s+(\\d+)\\s+(\\d+)\\s+(\\d+)<\\/bbox>/g;\r\n\r\n  function replaceMatch(\r\n    match: string,\r\n    x1: string,\r\n    y1: string,\r\n    x2: string,\r\n    y2: string,\r\n  ): string {\r\n    // Convert strings to numbers and calculate center point\r\n    const x1Num = Number.parseInt(x1, 10);\r\n    const y1Num = Number.parseInt(y1, 10);\r\n    const x2Num = Number.parseInt(x2, 10);\r\n    const y2Num = Number.parseInt(y2, 10);\r\n\r\n    // Use Math.floor to truncate and calculate center point\r\n    const x = Math.floor((x1Num + x2Num) / 2);\r\n    const y = Math.floor((y1Num + y2Num) / 2);\r\n\r\n    // Return formatted coordinate string\r\n    return `(${x},${y})`;\r\n  }\r\n\r\n  // Remove [EOS] and replace <bbox> coordinates\r\n  const cleanedText = text.replace(/\\[EOS\\]/g, '');\r\n  return cleanedText.replace(pattern, replaceMatch).trim();\r\n}\r\n\r\nfunction getPoint(startBox: string, size: { width: number; height: number }) {\r\n  const [x, y] = JSON.parse(startBox);\r\n  return [x * size.width, y * size.height];\r\n}\r\n\r\ninterface BaseAction {\r\n  action_type: ActionType;\r\n  action_inputs: Record<string, any>;\r\n  reflection: string | null;\r\n  thought: string | null;\r\n}\r\n\r\ninterface ClickAction extends BaseAction {\r\n  action_type: 'click';\r\n  action_inputs: {\r\n    start_box: string; // JSON string of [x, y] coordinates\r\n  };\r\n}\r\n\r\ninterface DragAction extends BaseAction {\r\n  action_type: 'drag';\r\n  action_inputs: {\r\n    start_box: string; // JSON string of [x, y] coordinates\r\n    end_box: string; // JSON string of [x, y] coordinates\r\n  };\r\n}\r\n\r\ninterface WaitAction extends BaseAction {\r\n  action_type: 'wait';\r\n  action_inputs: {\r\n    time: string; // JSON string of [x, y] coordinates\r\n  };\r\n}\r\n\r\ninterface TypeAction extends BaseAction {\r\n  action_type: 'type';\r\n  action_inputs: {\r\n    content: string;\r\n  };\r\n}\r\n\r\ninterface HotkeyAction extends BaseAction {\r\n  action_type: 'hotkey';\r\n  action_inputs: {\r\n    key: string;\r\n  };\r\n}\r\n\r\ninterface ScrollAction extends BaseAction {\r\n  action_type: 'scroll';\r\n  action_inputs: {\r\n    direction: 'up' | 'down';\r\n  };\r\n}\r\n\r\ninterface FinishedAction extends BaseAction {\r\n  action_type: 'finished';\r\n  action_inputs: Record<string, never>;\r\n}\r\n\r\nexport type Action =\r\n  | ClickAction\r\n  | DragAction\r\n  | TypeAction\r\n  | HotkeyAction\r\n  | ScrollAction\r\n  | FinishedAction\r\n  | WaitAction;\r\n\r\nexport async function resizeImageForUiTars(\r\n  imageBase64: string,\r\n  size: Size,\r\n  uiTarsVersion: UITarsModelVersion | undefined,\r\n) {\r\n  if (uiTarsVersion === UITarsModelVersion.V1_5) {\r\n    debug('ui-tars-v1.5, will check image size', size);\r\n    const currentPixels = size.width * size.height;\r\n    const maxPixels = 16384 * 28 * 28; //\r\n    if (currentPixels > maxPixels) {\r\n      const resizeFactor = Math.sqrt(maxPixels / currentPixels);\r\n      const newWidth = Math.floor(size.width * resizeFactor);\r\n      const newHeight = Math.floor(size.height * resizeFactor);\r\n      debug(\r\n        'resize image for ui-tars, new width: %s, new height: %s',\r\n        newWidth,\r\n        newHeight,\r\n      );\r\n      const resizedImage = await resizeImgBase64(imageBase64, {\r\n        width: newWidth,\r\n        height: newHeight,\r\n      });\r\n      return resizedImage;\r\n    }\r\n  }\r\n  return imageBase64;\r\n}\r\n","import type { TUserPrompt } from '@/ai-model/common';\r\nimport type {\r\n  DetailedLocateParam,\r\n  LocateOption,\r\n  MidsceneYamlScript,\r\n} from '@/types';\r\nimport { getDebug } from '@sqaitech/shared/logger';\r\nimport { assert } from '@sqaitech/shared/utils';\r\nimport yaml from 'js-yaml';\r\n\r\nconst debugUtils = getDebug('yaml:utils');\r\n\r\nexport function interpolateEnvVars(content: string): string {\r\n  // Process line by line to skip commented lines\r\n  const lines = content.split('\\n');\r\n  const processedLines = lines.map((line) => {\r\n    // Check if the line is a YAML comment (starts with # after optional whitespace)\r\n    const trimmedLine = line.trimStart();\r\n    if (trimmedLine.startsWith('#')) {\r\n      // Skip interpolation for comment lines\r\n      return line;\r\n    }\r\n\r\n    // Process environment variables for non-comment lines\r\n    return line.replace(/\\$\\{([^}]+)\\}/g, (_, envVar) => {\r\n      const value = process.env[envVar.trim()];\r\n      if (value === undefined) {\r\n        throw new Error(\r\n          `Environment variable \"${envVar.trim()}\" is not defined`,\r\n        );\r\n      }\r\n      return value;\r\n    });\r\n  });\r\n\r\n  return processedLines.join('\\n');\r\n}\r\n\r\nexport function parseYamlScript(\r\n  content: string,\r\n  filePath?: string,\r\n): MidsceneYamlScript {\r\n  let processedContent = content;\r\n  if (content.indexOf('android') !== -1 && content.match(/deviceId:\\s*(\\d+)/)) {\r\n    let matchedDeviceId;\r\n    processedContent = content.replace(\r\n      /deviceId:\\s*(\\d+)/g,\r\n      (match, deviceId) => {\r\n        matchedDeviceId = deviceId;\r\n        return `deviceId: '${deviceId}'`;\r\n      },\r\n    );\r\n    console.warn(\r\n      `please use string-style deviceId in yaml script, for example: deviceId: \"${matchedDeviceId}\"`,\r\n    );\r\n  }\r\n  const interpolatedContent = interpolateEnvVars(processedContent);\r\n  const obj = yaml.load(interpolatedContent, {\r\n    schema: yaml.JSON_SCHEMA,\r\n  }) as MidsceneYamlScript;\r\n\r\n  const pathTip = filePath ? `, failed to load ${filePath}` : '';\r\n  assert(obj.tasks, `property \"tasks\" is required in yaml script ${pathTip}`);\r\n  assert(\r\n    Array.isArray(obj.tasks),\r\n    `property \"tasks\" must be an array in yaml script, but got ${obj.tasks}`,\r\n  );\r\n  return obj;\r\n}\r\n\r\nexport function buildDetailedLocateParam(\r\n  locatePrompt: TUserPrompt,\r\n  opt?: LocateOption,\r\n): DetailedLocateParam | undefined {\r\n  debugUtils('will call buildDetailedLocateParam', locatePrompt, opt);\r\n  let prompt = locatePrompt || opt?.prompt || (opt as any)?.locate; // as a shortcut\r\n  let deepThink = false;\r\n  let cacheable = true;\r\n  let xpath = undefined;\r\n\r\n  if (typeof opt === 'object' && opt !== null) {\r\n    deepThink = opt.deepThink ?? false;\r\n    cacheable = opt.cacheable ?? true;\r\n    xpath = opt.xpath;\r\n    if (locatePrompt && opt.prompt && locatePrompt !== opt.prompt) {\r\n      console.warn(\r\n        'conflict prompt for item',\r\n        locatePrompt,\r\n        opt,\r\n        'maybe you put the prompt in the wrong place',\r\n      );\r\n    }\r\n    prompt = prompt || opt.prompt;\r\n  }\r\n\r\n  if (!prompt) {\r\n    debugUtils(\r\n      'no prompt, will return undefined in buildDetailedLocateParam',\r\n      opt,\r\n    );\r\n    return undefined;\r\n  }\r\n\r\n  return {\r\n    prompt,\r\n    deepThink,\r\n    cacheable,\r\n    xpath,\r\n  };\r\n}\r\n\r\nexport function buildDetailedLocateParamAndRestParams(\r\n  locatePrompt: TUserPrompt,\r\n  opt: LocateOption | undefined,\r\n  excludeKeys: string[] = [],\r\n): {\r\n  locateParam: DetailedLocateParam | undefined;\r\n  restParams: Record<string, any>;\r\n} {\r\n  const locateParam = buildDetailedLocateParam(locatePrompt, opt);\r\n\r\n  // Extract all keys from opt except the ones already included in locateParam\r\n  const restParams: Record<string, any> = {};\r\n\r\n  if (typeof opt === 'object' && opt !== null) {\r\n    // Get all keys from opt\r\n    const allKeys = Object.keys(opt);\r\n\r\n    // Keys already included in locateParam: prompt, deepThink, cacheable, xpath\r\n    const locateParamKeys = Object.keys(locateParam || {});\r\n\r\n    // Extract all other keys\r\n    for (const key of allKeys) {\r\n      if (\r\n        !locateParamKeys.includes(key) &&\r\n        !excludeKeys.includes(key) &&\r\n        key !== 'locate'\r\n      ) {\r\n        restParams[key] = opt[key as keyof LocateOption];\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    locateParam,\r\n    restParams,\r\n  };\r\n}\r\n","import { existsSync, mkdirSync, writeFileSync } from 'node:fs';\r\nimport { basename, dirname, join, resolve } from 'node:path';\r\nimport { assert, ifInBrowser, ifInWorker } from '@sqaitech/shared/utils';\r\n\r\n// previous defined yaml flow, as a helper\r\ninterface MidsceneYamlFlowItemAIInput extends LocateOption {\r\n  // previous version\r\n  // aiInput: string; // value to input\r\n  // locate: TUserPrompt; // where to input\r\n  aiInput: TUserPrompt | undefined; // where to input\r\n  value: string | number; // value to input\r\n}\r\n\r\ninterface MidsceneYamlFlowItemAIKeyboardPress extends LocateOption {\r\n  // previous version\r\n  // aiKeyboardPress: string;\r\n  // locate?: TUserPrompt; // where to press, optional\r\n  aiKeyboardPress: TUserPrompt | undefined; // where to press\r\n  keyName: string; // key to press\r\n}\r\n\r\ninterface MidsceneYamlFlowItemAIScroll extends LocateOption, ScrollParam {\r\n  // previous version\r\n  // aiScroll: null;\r\n  // locate?: TUserPrompt; // which area to scroll, optional\r\n  aiScroll: TUserPrompt | undefined; // which area to scroll\r\n}\r\n\r\nimport type { Agent } from '@/agent/agent';\r\nimport type { TUserPrompt } from '@/ai-model/common';\r\nimport type {\r\n  DeviceAction,\r\n  FreeFn,\r\n  LocateOption,\r\n  MidsceneYamlFlowItemAIAction,\r\n  MidsceneYamlFlowItemAIAsk,\r\n  MidsceneYamlFlowItemAIAssert,\r\n  MidsceneYamlFlowItemAIBoolean,\r\n  MidsceneYamlFlowItemAILocate,\r\n  MidsceneYamlFlowItemAINumber,\r\n  MidsceneYamlFlowItemAIQuery,\r\n  MidsceneYamlFlowItemAIString,\r\n  MidsceneYamlFlowItemAIWaitFor,\r\n  MidsceneYamlFlowItemEvaluateJavaScript,\r\n  MidsceneYamlFlowItemLogScreenshot,\r\n  MidsceneYamlFlowItemSleep,\r\n  MidsceneYamlScript,\r\n  MidsceneYamlScriptEnv,\r\n  ScriptPlayerStatusValue,\r\n  ScriptPlayerTaskStatus,\r\n  ScrollParam,\r\n} from '@/types';\r\nimport { getMidsceneRunSubDir } from '@sqaitech/shared/common';\r\nimport { getDebug } from '@sqaitech/shared/logger';\r\nimport {\r\n  buildDetailedLocateParam,\r\n  buildDetailedLocateParamAndRestParams,\r\n} from './utils';\r\n\r\nconst debug = getDebug('yaml-player');\r\nexport class ScriptPlayer<T extends MidsceneYamlScriptEnv> {\r\n  public currentTaskIndex?: number;\r\n  public taskStatusList: ScriptPlayerTaskStatus[] = [];\r\n  public status: ScriptPlayerStatusValue = 'init';\r\n  public reportFile?: string | null;\r\n  public result: Record<string, any>;\r\n  private unnamedResultIndex = 0;\r\n  public output?: string | null;\r\n  public unstableLogContent?: string | null;\r\n  public errorInSetup?: Error;\r\n  private interfaceAgent: Agent | null = null;\r\n  public agentStatusTip?: string;\r\n  public target?: MidsceneYamlScriptEnv;\r\n  private actionSpace: DeviceAction[] = [];\r\n  private scriptPath?: string;\r\n  constructor(\r\n    private script: MidsceneYamlScript,\r\n    private setupAgent: (platform: T) => Promise<{\r\n      agent: Agent;\r\n      freeFn: FreeFn[];\r\n    }>,\r\n    public onTaskStatusChange?: (taskStatus: ScriptPlayerTaskStatus) => void,\r\n    scriptPath?: string,\r\n  ) {\r\n    this.scriptPath = scriptPath;\r\n    this.result = {};\r\n    this.target =\r\n      script.target ||\r\n      script.web ||\r\n      script.android ||\r\n      script.ios ||\r\n      script.config;\r\n\r\n    if (ifInBrowser || ifInWorker) {\r\n      this.output = undefined;\r\n      debug('output is undefined in browser or worker');\r\n    } else if (this.target?.output) {\r\n      this.output = resolve(process.cwd(), this.target.output);\r\n      debug('setting output by config.output', this.output);\r\n    } else {\r\n      const scriptName = this.scriptPath\r\n        ? basename(this.scriptPath, '.yaml').replace(/\\.(ya?ml)$/i, '')\r\n        : 'script';\r\n      this.output = join(\r\n        getMidsceneRunSubDir('output'),\r\n        `${scriptName}-${Date.now()}.json`,\r\n      );\r\n      debug('setting output by script path', this.output);\r\n    }\r\n\r\n    if (ifInBrowser || ifInWorker) {\r\n      this.unstableLogContent = undefined;\r\n    } else if (typeof this.target?.unstableLogContent === 'string') {\r\n      this.unstableLogContent = resolve(\r\n        process.cwd(),\r\n        this.target.unstableLogContent,\r\n      );\r\n    } else if (this.target?.unstableLogContent === true) {\r\n      this.unstableLogContent = join(\r\n        getMidsceneRunSubDir('output'),\r\n        'unstableLogContent.json',\r\n      );\r\n    }\r\n\r\n    this.taskStatusList = (script.tasks || []).map((task, taskIndex) => ({\r\n      ...task,\r\n      index: taskIndex,\r\n      status: 'init',\r\n      totalSteps: task.flow?.length || 0,\r\n    }));\r\n  }\r\n\r\n  private setResult(key: string | undefined, value: any) {\r\n    const keyToUse = key || this.unnamedResultIndex++;\r\n    if (this.result[keyToUse]) {\r\n      console.warn(`result key ${keyToUse} already exists, will overwrite`);\r\n    }\r\n    this.result[keyToUse] = value;\r\n\r\n    return this.flushResult();\r\n  }\r\n\r\n  private setPlayerStatus(status: ScriptPlayerStatusValue, error?: Error) {\r\n    this.status = status;\r\n    this.errorInSetup = error;\r\n  }\r\n\r\n  private notifyCurrentTaskStatusChange(taskIndex?: number) {\r\n    const taskIndexToNotify =\r\n      typeof taskIndex === 'number' ? taskIndex : this.currentTaskIndex;\r\n\r\n    if (typeof taskIndexToNotify !== 'number') {\r\n      return;\r\n    }\r\n\r\n    const taskStatus = this.taskStatusList[taskIndexToNotify];\r\n    if (this.onTaskStatusChange) {\r\n      this.onTaskStatusChange(taskStatus);\r\n    }\r\n  }\r\n\r\n  private async setTaskStatus(\r\n    index: number,\r\n    statusValue: ScriptPlayerStatusValue,\r\n    error?: Error,\r\n  ) {\r\n    this.taskStatusList[index].status = statusValue;\r\n    if (error) {\r\n      this.taskStatusList[index].error = error;\r\n    }\r\n\r\n    this.notifyCurrentTaskStatusChange(index);\r\n  }\r\n\r\n  private setTaskIndex(taskIndex: number) {\r\n    this.currentTaskIndex = taskIndex;\r\n  }\r\n\r\n  private flushResult() {\r\n    if (this.output) {\r\n      const output = resolve(process.cwd(), this.output);\r\n      const outputDir = dirname(output);\r\n      if (!existsSync(outputDir)) {\r\n        mkdirSync(outputDir, { recursive: true });\r\n      }\r\n      writeFileSync(output, JSON.stringify(this.result || {}, undefined, 2));\r\n    }\r\n  }\r\n\r\n  private flushUnstableLogContent() {\r\n    if (this.unstableLogContent) {\r\n      const content = this.interfaceAgent?._unstableLogContent();\r\n      const filePath = resolve(process.cwd(), this.unstableLogContent);\r\n      const outputDir = dirname(filePath);\r\n      if (!existsSync(outputDir)) {\r\n        mkdirSync(outputDir, { recursive: true });\r\n      }\r\n      writeFileSync(filePath, JSON.stringify(content, null, 2));\r\n    }\r\n  }\r\n\r\n  async playTask(taskStatus: ScriptPlayerTaskStatus, agent: Agent) {\r\n    const { flow } = taskStatus;\r\n    assert(flow, 'missing flow in task');\r\n\r\n    for (const flowItemIndex in flow) {\r\n      const currentStep = Number.parseInt(flowItemIndex, 10);\r\n      taskStatus.currentStep = currentStep;\r\n      const flowItem = flow[flowItemIndex];\r\n      debug(\r\n        `playing step ${flowItemIndex}, flowItem=${JSON.stringify(flowItem)}`,\r\n      );\r\n      if (\r\n        'aiAction' in (flowItem as MidsceneYamlFlowItemAIAction) ||\r\n        'ai' in (flowItem as MidsceneYamlFlowItemAIAction)\r\n      ) {\r\n        const actionTask = flowItem as MidsceneYamlFlowItemAIAction;\r\n        const prompt = actionTask.aiAction || actionTask.ai;\r\n        assert(prompt, 'missing prompt for ai (aiAction)');\r\n        await agent.aiAction(prompt, {\r\n          cacheable: actionTask.cacheable,\r\n        });\r\n      } else if ('aiAssert' in (flowItem as MidsceneYamlFlowItemAIAssert)) {\r\n        const assertTask = flowItem as MidsceneYamlFlowItemAIAssert;\r\n        const prompt = assertTask.aiAssert;\r\n        const msg = assertTask.errorMessage;\r\n        assert(prompt, 'missing prompt for aiAssert');\r\n        const { pass, thought, message } =\r\n          (await agent.aiAssert(prompt, msg, {\r\n            keepRawResponse: true,\r\n          })) || {};\r\n\r\n        this.setResult(assertTask.name, {\r\n          pass,\r\n          thought,\r\n          message,\r\n        });\r\n\r\n        if (!pass) {\r\n          throw new Error(message);\r\n        }\r\n      } else if ('aiQuery' in (flowItem as MidsceneYamlFlowItemAIQuery)) {\r\n        const queryTask = flowItem as MidsceneYamlFlowItemAIQuery;\r\n        const prompt = queryTask.aiQuery;\r\n        const options = {\r\n          domIncluded: queryTask.domIncluded,\r\n          screenshotIncluded: queryTask.screenshotIncluded,\r\n        };\r\n        assert(prompt, 'missing prompt for aiQuery');\r\n        const queryResult = await agent.aiQuery(prompt, options);\r\n        this.setResult(queryTask.name, queryResult);\r\n      } else if ('aiNumber' in (flowItem as MidsceneYamlFlowItemAINumber)) {\r\n        const numberTask = flowItem as MidsceneYamlFlowItemAINumber;\r\n        const prompt = numberTask.aiNumber;\r\n        const options = {\r\n          domIncluded: numberTask.domIncluded,\r\n          screenshotIncluded: numberTask.screenshotIncluded,\r\n        };\r\n        assert(prompt, 'missing prompt for aiNumber');\r\n        const numberResult = await agent.aiNumber(prompt, options);\r\n        this.setResult(numberTask.name, numberResult);\r\n      } else if ('aiString' in (flowItem as MidsceneYamlFlowItemAIString)) {\r\n        const stringTask = flowItem as MidsceneYamlFlowItemAIString;\r\n        const prompt = stringTask.aiString;\r\n        const options = {\r\n          domIncluded: stringTask.domIncluded,\r\n          screenshotIncluded: stringTask.screenshotIncluded,\r\n        };\r\n        assert(prompt, 'missing prompt for aiString');\r\n        const stringResult = await agent.aiString(prompt, options);\r\n        this.setResult(stringTask.name, stringResult);\r\n      } else if ('aiBoolean' in (flowItem as MidsceneYamlFlowItemAIBoolean)) {\r\n        const booleanTask = flowItem as MidsceneYamlFlowItemAIBoolean;\r\n        const prompt = booleanTask.aiBoolean;\r\n        const options = {\r\n          domIncluded: booleanTask.domIncluded,\r\n          screenshotIncluded: booleanTask.screenshotIncluded,\r\n        };\r\n        assert(prompt, 'missing prompt for aiBoolean');\r\n        const booleanResult = await agent.aiBoolean(prompt, options);\r\n        this.setResult(booleanTask.name, booleanResult);\r\n      } else if ('aiAsk' in (flowItem as MidsceneYamlFlowItemAIAsk)) {\r\n        const askTask = flowItem as MidsceneYamlFlowItemAIAsk;\r\n        const prompt = askTask.aiAsk;\r\n        assert(prompt, 'missing prompt for aiAsk');\r\n        const askResult = await agent.aiAsk(prompt);\r\n        this.setResult(askTask.name, askResult);\r\n      } else if ('aiLocate' in (flowItem as MidsceneYamlFlowItemAILocate)) {\r\n        const locateTask = flowItem as MidsceneYamlFlowItemAILocate;\r\n        const prompt = locateTask.aiLocate;\r\n        assert(prompt, 'missing prompt for aiLocate');\r\n        const locateResult = await agent.aiLocate(prompt, locateTask);\r\n        this.setResult(locateTask.name, locateResult);\r\n      } else if ('aiWaitFor' in (flowItem as MidsceneYamlFlowItemAIWaitFor)) {\r\n        const waitForTask = flowItem as MidsceneYamlFlowItemAIWaitFor;\r\n        const prompt = waitForTask.aiWaitFor;\r\n        assert(prompt, 'missing prompt for aiWaitFor');\r\n        const timeout = waitForTask.timeout;\r\n        await agent.aiWaitFor(prompt, { timeoutMs: timeout });\r\n      } else if ('sleep' in (flowItem as MidsceneYamlFlowItemSleep)) {\r\n        const sleepTask = flowItem as MidsceneYamlFlowItemSleep;\r\n        const ms = sleepTask.sleep;\r\n        let msNumber = ms;\r\n        if (typeof ms === 'string') {\r\n          msNumber = Number.parseInt(ms, 10);\r\n        }\r\n        assert(\r\n          msNumber && msNumber > 0,\r\n          `ms for sleep must be greater than 0, but got ${ms}`,\r\n        );\r\n        await new Promise((resolve) => setTimeout(resolve, msNumber));\r\n      } else if (\r\n        'javascript' in (flowItem as MidsceneYamlFlowItemEvaluateJavaScript)\r\n      ) {\r\n        const evaluateJavaScriptTask =\r\n          flowItem as MidsceneYamlFlowItemEvaluateJavaScript;\r\n\r\n        const result = await agent.evaluateJavaScript(\r\n          evaluateJavaScriptTask.javascript,\r\n        );\r\n        this.setResult(evaluateJavaScriptTask.name, result);\r\n      } else if (\r\n        'logScreenshot' in (flowItem as MidsceneYamlFlowItemLogScreenshot)\r\n      ) {\r\n        const logScreenshotTask = flowItem as MidsceneYamlFlowItemLogScreenshot;\r\n        await agent.logScreenshot(logScreenshotTask.logScreenshot, {\r\n          content: logScreenshotTask.content || '',\r\n        });\r\n      } else if ('aiInput' in (flowItem as MidsceneYamlFlowItemAIInput)) {\r\n        // may be input empty string ''\r\n        const { aiInput, ...inputTask } =\r\n          flowItem as MidsceneYamlFlowItemAIInput;\r\n\r\n        // Compatibility with previous version:\r\n        // Old format: { aiInput: string (value), locate: TUserPrompt }\r\n        // New format - 1: { aiInput: TUserPrompt, value: string | number }\r\n        // New format - 2: { aiInput: undefined, locate: TUserPrompt, value: string | number }\r\n        let locatePrompt: TUserPrompt | undefined;\r\n        let value: string | number | undefined;\r\n        if ((inputTask as any).locate) {\r\n          // Old format - aiInput is the value, locate is the prompt\r\n          value = (aiInput as string) || inputTask.value;\r\n          locatePrompt = (inputTask as any).locate;\r\n        } else {\r\n          // New format - aiInput is the prompt, value is the value\r\n          locatePrompt = aiInput || '';\r\n          value = inputTask.value;\r\n        }\r\n\r\n        await agent.callActionInActionSpace('Input', {\r\n          ...inputTask,\r\n          ...(value !== undefined ? { value: String(value) } : {}),\r\n          ...(locatePrompt\r\n            ? { locate: buildDetailedLocateParam(locatePrompt, inputTask) }\r\n            : {}),\r\n        });\r\n      } else if (\r\n        'aiKeyboardPress' in (flowItem as MidsceneYamlFlowItemAIKeyboardPress)\r\n      ) {\r\n        const { aiKeyboardPress, ...keyboardPressTask } =\r\n          flowItem as MidsceneYamlFlowItemAIKeyboardPress;\r\n\r\n        // Compatibility with previous version:\r\n        // Old format: { aiKeyboardPress: string (key), locate?: TUserPrompt }\r\n        // New format - 1: { aiKeyboardPress: TUserPrompt, keyName: string }\r\n        // New format - 2: { aiKeyboardPress: , locate?: TUserPrompt, keyName: string }\r\n        let locatePrompt: TUserPrompt | undefined;\r\n        let keyName: string | undefined;\r\n        if ((keyboardPressTask as any).locate) {\r\n          // Old format - aiKeyboardPress is the key, locate is the prompt\r\n          keyName = aiKeyboardPress as string;\r\n          locatePrompt = (keyboardPressTask as any).locate;\r\n        } else if (keyboardPressTask.keyName) {\r\n          // New format - aiKeyboardPress is the prompt, key is the key\r\n          keyName = keyboardPressTask.keyName;\r\n          locatePrompt = aiKeyboardPress;\r\n        } else {\r\n          keyName = aiKeyboardPress as string;\r\n        }\r\n\r\n        await agent.callActionInActionSpace('KeyboardPress', {\r\n          ...keyboardPressTask,\r\n          ...(keyName ? { keyName } : {}),\r\n          ...(locatePrompt\r\n            ? {\r\n                locate: buildDetailedLocateParam(\r\n                  locatePrompt,\r\n                  keyboardPressTask,\r\n                ),\r\n              }\r\n            : {}),\r\n        });\r\n      } else if ('aiScroll' in (flowItem as MidsceneYamlFlowItemAIScroll)) {\r\n        const { aiScroll, ...scrollTask } =\r\n          flowItem as MidsceneYamlFlowItemAIScroll;\r\n\r\n        // Compatibility with previous version:\r\n        // Old format: { aiScroll: null, locate?: TUserPrompt, direction, scrollType, distance? }\r\n        // New format - 1: { aiScroll: TUserPrompt, direction, scrollType, distance? }\r\n        // New format - 2: { aiScroll: undefined, locate: TUserPrompt, direction, scrollType, distance? }\r\n        let locatePrompt: TUserPrompt | undefined;\r\n        if ((scrollTask as any).locate) {\r\n          // Old format - locate is the prompt, aiScroll is null/ignored\r\n          locatePrompt = (scrollTask as any).locate;\r\n        } else {\r\n          // New format - aiScroll is the prompt, or no prompt for global scroll\r\n          locatePrompt = aiScroll;\r\n        }\r\n\r\n        await agent.callActionInActionSpace('Scroll', {\r\n          ...scrollTask,\r\n          ...(locatePrompt\r\n            ? { locate: buildDetailedLocateParam(locatePrompt, scrollTask) }\r\n            : {}),\r\n        });\r\n      } else {\r\n        // generic action, find the action in actionSpace\r\n\r\n        /* for aiTap, aiRightClick, the parameters are a flattened data for the 'locate', these are all valid data\r\n\r\n        - aiTap: 'search input box'\r\n        - aiTap: 'search input box'\r\n          deepThink: true\r\n          cacheable: false\r\n        - aiTap:\r\n          prompt: 'search input box'\r\n        - aiTap:\r\n          prompt: 'search input box'\r\n          deepThink: true\r\n          cacheable: false\r\n        */\r\n\r\n        const actionSpace = this.actionSpace;\r\n        let locatePromptShortcut: string | undefined;\r\n        const matchedAction = actionSpace.find((action) => {\r\n          const actionInterfaceAlias = action.interfaceAlias;\r\n          if (\r\n            actionInterfaceAlias &&\r\n            Object.prototype.hasOwnProperty.call(flowItem, actionInterfaceAlias)\r\n          ) {\r\n            locatePromptShortcut = flowItem[\r\n              actionInterfaceAlias as keyof typeof flowItem\r\n            ] as string;\r\n            return true;\r\n          }\r\n\r\n          const keyOfActionInActionSpace = action.name;\r\n          if (\r\n            Object.prototype.hasOwnProperty.call(\r\n              flowItem,\r\n              keyOfActionInActionSpace,\r\n            )\r\n          ) {\r\n            locatePromptShortcut = flowItem[\r\n              keyOfActionInActionSpace as keyof typeof flowItem\r\n            ] as string;\r\n            return true;\r\n          }\r\n\r\n          return false;\r\n        });\r\n\r\n        assert(\r\n          matchedAction,\r\n          `unknown flowItem in yaml: ${JSON.stringify(flowItem)}`,\r\n        );\r\n\r\n        assert(\r\n          !((flowItem as any).prompt && locatePromptShortcut),\r\n          `conflict locate prompt for item: ${JSON.stringify(flowItem)}`,\r\n        );\r\n\r\n        if (locatePromptShortcut) {\r\n          (flowItem as any).prompt = locatePromptShortcut;\r\n        }\r\n\r\n        const { locateParam, restParams } =\r\n          buildDetailedLocateParamAndRestParams(\r\n            locatePromptShortcut || '',\r\n            flowItem as LocateOption,\r\n            [\r\n              matchedAction.name,\r\n              matchedAction.interfaceAlias || '_never_mind_',\r\n            ],\r\n          );\r\n\r\n        const flowParams = {\r\n          ...restParams,\r\n          locate: locateParam,\r\n        };\r\n\r\n        debug(\r\n          `matchedAction: ${matchedAction.name}`,\r\n          `flowParams: ${JSON.stringify(flowParams, null, 2)}`,\r\n        );\r\n        await agent.callActionInActionSpace(matchedAction.name, flowParams);\r\n      }\r\n    }\r\n    this.reportFile = agent.reportFile;\r\n    await this.flushUnstableLogContent();\r\n  }\r\n\r\n  async run() {\r\n    const { target, web, android, ios, tasks } = this.script;\r\n    const webEnv = web || target;\r\n    const androidEnv = android;\r\n    const iosEnv = ios;\r\n    const platform = webEnv || androidEnv || iosEnv;\r\n\r\n    this.setPlayerStatus('running');\r\n\r\n    let agent: Agent | null = null;\r\n    let freeFn: FreeFn[] = [];\r\n    try {\r\n      const { agent: newAgent, freeFn: newFreeFn } = await this.setupAgent(\r\n        platform as T,\r\n      );\r\n      this.actionSpace = await newAgent.getActionSpace();\r\n      agent = newAgent;\r\n      const originalOnTaskStartTip = agent.onTaskStartTip;\r\n      agent.onTaskStartTip = (tip) => {\r\n        if (this.status === 'running') {\r\n          this.agentStatusTip = tip;\r\n        }\r\n        originalOnTaskStartTip?.(tip);\r\n      };\r\n      freeFn = [\r\n        ...(newFreeFn || []),\r\n        {\r\n          name: 'restore-agent-onTaskStartTip',\r\n          fn: () => {\r\n            if (agent) {\r\n              agent.onTaskStartTip = originalOnTaskStartTip;\r\n            }\r\n          },\r\n        },\r\n      ];\r\n    } catch (e) {\r\n      this.setPlayerStatus('error', e as Error);\r\n      return;\r\n    }\r\n    this.interfaceAgent = agent;\r\n\r\n    let taskIndex = 0;\r\n    this.setPlayerStatus('running');\r\n    let errorFlag = false;\r\n    while (taskIndex < tasks.length) {\r\n      const taskStatus = this.taskStatusList[taskIndex];\r\n      this.setTaskStatus(taskIndex, 'running' as any);\r\n      this.setTaskIndex(taskIndex);\r\n\r\n      try {\r\n        await this.playTask(taskStatus, this.interfaceAgent);\r\n        this.setTaskStatus(taskIndex, 'done' as any);\r\n      } catch (e) {\r\n        this.setTaskStatus(taskIndex, 'error' as any, e as Error);\r\n\r\n        if (taskStatus.continueOnError) {\r\n          // nothing more to do\r\n        } else {\r\n          this.reportFile = agent.reportFile;\r\n          errorFlag = true;\r\n          break;\r\n        }\r\n      }\r\n      this.reportFile = agent?.reportFile;\r\n      taskIndex++;\r\n    }\r\n\r\n    if (errorFlag) {\r\n      this.setPlayerStatus('error');\r\n    } else {\r\n      this.setPlayerStatus('done');\r\n    }\r\n    this.agentStatusTip = '';\r\n\r\n    // free the resources\r\n    for (const fn of freeFn) {\r\n      try {\r\n        // console.log('freeing', fn.name);\r\n        await fn.fn();\r\n        // console.log('freed', fn.name);\r\n      } catch (e) {\r\n        // console.error('error freeing', fn.name, e);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import type { DeviceAction } from '@sqaitech/core';\r\nimport { findAllMidsceneLocatorField } from '@sqaitech/core/ai-model';\r\nimport { buildDetailedLocateParam } from '@sqaitech/core/yaml';\r\nimport type {\r\n  ExecutionOptions,\r\n  FormValue,\r\n  PlaygroundAgent,\r\n  ValidationResult,\r\n} from './types';\r\n\r\n// APIs that should not generate replay scripts\r\nexport const dataExtractionAPIs = [\r\n  'aiQuery',\r\n  'aiBoolean',\r\n  'aiNumber',\r\n  'aiString',\r\n  'aiAsk',\r\n];\r\n\r\nexport const validationAPIs = ['aiAssert', 'aiWaitFor'];\r\n\r\nexport const noReplayAPIs = [...dataExtractionAPIs, ...validationAPIs];\r\n\r\nexport const formatErrorMessage = (e: any): string => {\r\n  const errorMessage = e?.message || '';\r\n\r\n  if (errorMessage.includes('of different extension')) {\r\n    return 'Conflicting extension detected. Please disable the suspicious plugins and refresh the page. Guide: https://sqai.tech/quick-experience.html#faq';\r\n  }\r\n\r\n  if (errorMessage.includes('NOT_IMPLEMENTED_AS_DESIGNED')) {\r\n    return 'Further actions cannot be performed in the current environment';\r\n  }\r\n\r\n  return errorMessage || 'Unknown error';\r\n};\r\n\r\n// Parse structured parameters for callActionInActionSpace\r\nexport async function parseStructuredParams(\r\n  action: DeviceAction<unknown>,\r\n  params: Record<string, unknown>,\r\n  options: ExecutionOptions = {},\r\n): Promise<unknown[]> {\r\n  if (!action?.paramSchema || !('shape' in action.paramSchema)) {\r\n    return [params.prompt || '', options];\r\n  }\r\n\r\n  const schema = action.paramSchema;\r\n  const keys =\r\n    schema && 'shape' in schema\r\n      ? Object.keys((schema as { shape: Record<string, unknown> }).shape)\r\n      : [];\r\n\r\n  const paramObj: Record<string, unknown> = { ...options };\r\n\r\n  keys.forEach((key) => {\r\n    if (\r\n      params[key] !== undefined &&\r\n      params[key] !== null &&\r\n      params[key] !== ''\r\n    ) {\r\n      paramObj[key] = params[key];\r\n    }\r\n  });\r\n\r\n  // Check if there's a locate field that needs detailed locate param processing\r\n  if (schema) {\r\n    const locatorFieldKeys = findAllMidsceneLocatorField(schema);\r\n    locatorFieldKeys.forEach((locateKey: string) => {\r\n      const locatePrompt = params[locateKey];\r\n      if (locatePrompt && typeof locatePrompt === 'string') {\r\n        // Build detailed locate param using the locate prompt and options\r\n        const detailedLocateParam = buildDetailedLocateParam(locatePrompt, {\r\n          deepThink: options.deepThink,\r\n          cacheable: true, // Default to true for playground\r\n        });\r\n        if (detailedLocateParam) {\r\n          paramObj[locateKey] = detailedLocateParam;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  return [paramObj];\r\n}\r\n\r\nexport function validateStructuredParams(\r\n  value: FormValue,\r\n  action: DeviceAction<unknown> | undefined,\r\n): ValidationResult {\r\n  if (!value.params) {\r\n    return { valid: false, errorMessage: 'Parameters are required' };\r\n  }\r\n\r\n  if (!action?.paramSchema) {\r\n    return { valid: true };\r\n  }\r\n\r\n  try {\r\n    const paramsForValidation = { ...value.params };\r\n\r\n    const schema = action.paramSchema;\r\n    if (schema) {\r\n      const locatorFieldKeys = findAllMidsceneLocatorField(schema);\r\n      locatorFieldKeys.forEach((key: string) => {\r\n        if (typeof paramsForValidation[key] === 'string') {\r\n          paramsForValidation[key] = {\r\n            midscene_location_field_flag: true,\r\n            prompt: paramsForValidation[key],\r\n            center: [0, 0],\r\n            rect: { left: 0, top: 0, width: 0, height: 0 },\r\n          };\r\n        }\r\n      });\r\n    }\r\n\r\n    action.paramSchema?.parse(paramsForValidation);\r\n    return { valid: true };\r\n  } catch (error: unknown) {\r\n    const zodError = error as {\r\n      errors?: Array<{ path: string[]; message: string }>;\r\n    };\r\n    if (zodError.errors && zodError.errors.length > 0) {\r\n      const errorMessages = zodError.errors\r\n        .filter((err) => {\r\n          const path = err.path.join('.');\r\n          return (\r\n            !path.includes('center') &&\r\n            !path.includes('rect') &&\r\n            !path.includes('midscene_location_field_flag')\r\n          );\r\n        })\r\n        .map((err) => {\r\n          const field = err.path.join('.');\r\n          return `${field}: ${err.message}`;\r\n        });\r\n\r\n      if (errorMessages.length > 0) {\r\n        return {\r\n          valid: false,\r\n          errorMessage: `Validation error: ${errorMessages.join(', ')}`,\r\n        };\r\n      }\r\n    } else {\r\n      const errorMsg =\r\n        error instanceof Error ? error.message : 'Unknown validation error';\r\n      return {\r\n        valid: false,\r\n        errorMessage: `Parameter validation failed: ${errorMsg}`,\r\n      };\r\n    }\r\n  }\r\n\r\n  return { valid: true };\r\n}\r\n\r\nexport async function executeAction(\r\n  activeAgent: PlaygroundAgent,\r\n  actionType: string,\r\n  actionSpace: DeviceAction<unknown>[],\r\n  value: FormValue,\r\n  options: ExecutionOptions,\r\n): Promise<unknown> {\r\n  const action = actionSpace?.find(\r\n    (a: DeviceAction<unknown>) =>\r\n      a.interfaceAlias === actionType || a.name === actionType,\r\n  );\r\n\r\n  if (action && typeof activeAgent.callActionInActionSpace === 'function') {\r\n    if (value.params) {\r\n      const parsedParams = await parseStructuredParams(\r\n        action,\r\n        value.params,\r\n        options,\r\n      );\r\n      return await activeAgent.callActionInActionSpace(\r\n        action.name,\r\n        parsedParams[0],\r\n      );\r\n    } else {\r\n      // For prompt-based actions, we need to build the detailed locate param\r\n      const detailedLocateParam = value.prompt\r\n        ? buildDetailedLocateParam(value.prompt, {\r\n            deepThink: options.deepThink,\r\n            cacheable: true,\r\n          })\r\n        : undefined;\r\n\r\n      return await activeAgent.callActionInActionSpace(action.name, {\r\n        locate: detailedLocateParam,\r\n        ...options,\r\n      });\r\n    }\r\n  } else {\r\n    const prompt = value.prompt;\r\n\r\n    if (actionType === 'aiAssert') {\r\n      const { pass, thought } =\r\n        (await activeAgent?.aiAssert?.(prompt || '', undefined, {\r\n          keepRawResponse: true,\r\n          ...options,\r\n        })) || {};\r\n      return { pass: pass || false, thought: thought || '' };\r\n    }\r\n\r\n    // Fallback for methods not found in actionSpace\r\n    if (activeAgent && typeof activeAgent[actionType] === 'function') {\r\n      return await activeAgent[actionType](prompt, options);\r\n    }\r\n\r\n    throw new Error(`Unknown action type: ${actionType}`);\r\n  }\r\n}\r\n","import type { DeviceAction } from '@sqaitech/core';\r\nimport { findAllMidsceneLocatorField } from '@sqaitech/core/ai-model';\r\nimport type { ExecutionOptions, FormValue, ValidationResult } from '../types';\r\n\r\nexport abstract class BasePlaygroundAdapter {\r\n  abstract parseStructuredParams(\r\n    action: DeviceAction<unknown>,\r\n    params: Record<string, unknown>,\r\n    options: ExecutionOptions,\r\n  ): Promise<unknown[]>;\r\n\r\n  abstract formatErrorMessage(error: any): string;\r\n\r\n  // Abstract method for execution - must be implemented by concrete adapters\r\n  abstract executeAction(\r\n    actionType: string,\r\n    value: FormValue,\r\n    options: ExecutionOptions,\r\n  ): Promise<unknown>;\r\n\r\n  // Optional method for getting action space - default implementation returns empty array\r\n  async getActionSpace(_context: any): Promise<DeviceAction<unknown>[]> {\r\n    return [];\r\n  }\r\n\r\n  // Common validation logic - can be overridden if needed\r\n  validateParams(\r\n    value: FormValue,\r\n    action: DeviceAction<unknown> | undefined,\r\n  ): ValidationResult {\r\n    if (!action?.paramSchema) {\r\n      return { valid: true };\r\n    }\r\n\r\n    const needsStructuredParams = this.actionNeedsStructuredParams(action);\r\n\r\n    if (!needsStructuredParams) {\r\n      return { valid: true };\r\n    }\r\n\r\n    if (!value.params) {\r\n      return { valid: false, errorMessage: 'Parameters are required' };\r\n    }\r\n\r\n    try {\r\n      const paramsForValidation = this.prepareParamsForValidation(\r\n        value.params,\r\n        action,\r\n      );\r\n      action.paramSchema.parse(paramsForValidation);\r\n      return { valid: true };\r\n    } catch (error: unknown) {\r\n      return this.handleValidationError(error);\r\n    }\r\n  }\r\n\r\n  // Common display content creation logic - can be overridden if needed\r\n  createDisplayContent(\r\n    value: FormValue,\r\n    needsStructuredParams: boolean,\r\n    action: DeviceAction<unknown> | undefined,\r\n  ): string {\r\n    if (!needsStructuredParams || !value.params || !action?.paramSchema) {\r\n      return value.prompt || '';\r\n    }\r\n\r\n    const paramsList = this.buildParamsDisplayList(value.params, action);\r\n    return paramsList.join('\\n') || value.prompt || '';\r\n  }\r\n\r\n  // Helper method for basic error message formatting\r\n  protected formatBasicErrorMessage(error: any): string {\r\n    return error?.message || 'Unknown error';\r\n  }\r\n\r\n  // Helper method for parsing structured params base logic\r\n  protected getSchemaKeys(action: DeviceAction<unknown>): string[] {\r\n    if (!action?.paramSchema || !('shape' in action.paramSchema)) {\r\n      return [];\r\n    }\r\n\r\n    const schema = action.paramSchema;\r\n    return schema && 'shape' in schema\r\n      ? Object.keys((schema as { shape: Record<string, unknown> }).shape)\r\n      : [];\r\n  }\r\n\r\n  // Helper method for filtering valid params\r\n  protected filterValidParams(\r\n    params: Record<string, unknown>,\r\n    excludeKeys: string[] = [],\r\n  ): Record<string, unknown> {\r\n    const filtered: Record<string, unknown> = {};\r\n\r\n    Object.keys(params).forEach((key) => {\r\n      if (\r\n        !excludeKeys.includes(key) &&\r\n        params[key] !== undefined &&\r\n        params[key] !== null &&\r\n        params[key] !== ''\r\n      ) {\r\n        filtered[key] = params[key];\r\n      }\r\n    });\r\n\r\n    return filtered;\r\n  }\r\n\r\n  // Check if action needs structured parameters\r\n  protected actionNeedsStructuredParams(\r\n    action: DeviceAction<unknown>,\r\n  ): boolean {\r\n    if (\r\n      typeof action.paramSchema === 'object' &&\r\n      'shape' in action.paramSchema\r\n    ) {\r\n      const shape =\r\n        (action.paramSchema as { shape: Record<string, unknown> }).shape || {};\r\n      return Object.keys(shape).length > 0;\r\n    }\r\n    return true; // If paramSchema exists but not in expected format, assume it needs params\r\n  }\r\n\r\n  // Prepare parameters for validation by converting string locate fields\r\n  protected prepareParamsForValidation(\r\n    params: Record<string, unknown>,\r\n    action: DeviceAction<unknown>,\r\n  ): Record<string, unknown> {\r\n    const paramsForValidation = { ...params };\r\n\r\n    if (action.paramSchema) {\r\n      const locatorFieldKeys = findAllMidsceneLocatorField(action.paramSchema);\r\n      locatorFieldKeys.forEach((key: string) => {\r\n        if (typeof paramsForValidation[key] === 'string') {\r\n          paramsForValidation[key] = {\r\n            midscene_location_field_flag: true,\r\n            prompt: paramsForValidation[key],\r\n            center: [0, 0], // dummy values for validation\r\n            rect: { left: 0, top: 0, width: 0, height: 0 },\r\n          };\r\n        }\r\n      });\r\n    }\r\n\r\n    return paramsForValidation;\r\n  }\r\n\r\n  // Handle validation errors with proper error message extraction\r\n  protected handleValidationError(error: unknown): ValidationResult {\r\n    const zodError = error as {\r\n      errors?: Array<{ path: string[]; message: string }>;\r\n    };\r\n\r\n    if (zodError.errors && zodError.errors.length > 0) {\r\n      const errorMessages = zodError.errors\r\n        .filter((err) => {\r\n          const path = err.path.join('.');\r\n          return (\r\n            !path.includes('center') &&\r\n            !path.includes('rect') &&\r\n            !path.includes('midscene_location_field_flag')\r\n          );\r\n        })\r\n        .map((err) => {\r\n          const field = err.path.join('.');\r\n          return `${field}: ${err.message}`;\r\n        });\r\n\r\n      if (errorMessages.length > 0) {\r\n        return {\r\n          valid: false,\r\n          errorMessage: `Validation error: ${errorMessages.join(', ')}`,\r\n        };\r\n      }\r\n    }\r\n\r\n    const errorMsg =\r\n      error instanceof Error ? error.message : 'Unknown validation error';\r\n\r\n    return {\r\n      valid: false,\r\n      errorMessage: `Parameter validation failed: ${errorMsg}`,\r\n    };\r\n  }\r\n\r\n  // Build display list for parameters\r\n  protected buildParamsDisplayList(\r\n    params: Record<string, unknown>,\r\n    action: DeviceAction<unknown>,\r\n  ): string[] {\r\n    const paramsList: string[] = [];\r\n    const schema = action.paramSchema;\r\n\r\n    if (!(schema && 'shape' in schema)) {\r\n      return paramsList;\r\n    }\r\n\r\n    const locatorFieldKeys = findAllMidsceneLocatorField(schema);\r\n    const shapeKeys = Object.keys(\r\n      (schema as { shape: Record<string, unknown> }).shape,\r\n    );\r\n\r\n    shapeKeys.forEach((key) => {\r\n      const paramValue = params[key];\r\n      if (this.isValidParamValue(paramValue)) {\r\n        const displayKey = this.capitalizeFirstLetter(key);\r\n        const formattedValue = this.formatParamValue(\r\n          key,\r\n          paramValue,\r\n          locatorFieldKeys.includes(key),\r\n        );\r\n        paramsList.push(`${displayKey}: ${formattedValue}`);\r\n      }\r\n    });\r\n\r\n    return paramsList;\r\n  }\r\n\r\n  // Check if parameter value is valid for display\r\n  protected isValidParamValue(value: unknown): boolean {\r\n    return value !== undefined && value !== null && value !== '';\r\n  }\r\n\r\n  // Capitalize first letter of a string\r\n  protected capitalizeFirstLetter(str: string): string {\r\n    return str.charAt(0).toUpperCase() + str.slice(1);\r\n  }\r\n\r\n  // Format parameter value for display\r\n  protected formatParamValue(\r\n    key: string,\r\n    value: unknown,\r\n    isLocateField: boolean,\r\n  ): string {\r\n    if (isLocateField || typeof value === 'string') {\r\n      return `\"${value}\"`;\r\n    }\r\n\r\n    if (typeof value === 'number') {\r\n      // Special handling for distance in scroll\r\n      return key === 'distance' ? `${value}px` : `${value}`;\r\n    }\r\n\r\n    return `${value}`;\r\n  }\r\n}\r\n","import type { DeviceAction } from '@sqaitech/core';\r\nimport { overrideAIConfig } from '@sqaitech/shared/env';\r\nimport { uuid } from '@sqaitech/shared/utils';\r\nimport { executeAction, parseStructuredParams } from '../common';\r\nimport type { ExecutionOptions, FormValue, PlaygroundAgent } from '../types';\r\nimport { BasePlaygroundAdapter } from './base';\r\n\r\nexport class LocalExecutionAdapter extends BasePlaygroundAdapter {\r\n  private agent: PlaygroundAgent;\r\n  private taskProgressTips: Record<string, string> = {};\r\n  private progressCallback?: (tip: string) => void;\r\n  private readonly _id: string; // Unique identifier for this local adapter instance\r\n  private currentRequestId?: string; // Track current request to prevent stale callbacks\r\n\r\n  constructor(agent: PlaygroundAgent) {\r\n    super();\r\n    this.agent = agent;\r\n    this._id = uuid(); // Generate unique ID for local adapter\r\n  }\r\n\r\n  // Get adapter ID\r\n  get id(): string {\r\n    return this._id;\r\n  }\r\n\r\n  setProgressCallback(callback: (tip: string) => void): void {\r\n    // Clear any existing callback before setting new one\r\n    this.progressCallback = undefined;\r\n    // Set the new callback\r\n    this.progressCallback = callback;\r\n  }\r\n\r\n  private cleanup(requestId: string): void {\r\n    delete this.taskProgressTips[requestId];\r\n  }\r\n\r\n  async parseStructuredParams(\r\n    action: DeviceAction<unknown>,\r\n    params: Record<string, unknown>,\r\n    options: ExecutionOptions,\r\n  ): Promise<unknown[]> {\r\n    // Use shared implementation from common.ts\r\n    return await parseStructuredParams(action, params, options);\r\n  }\r\n\r\n  formatErrorMessage(error: any): string {\r\n    const errorMessage = error?.message || '';\r\n    if (errorMessage.includes('of different extension')) {\r\n      return 'Conflicting extension detected. Please disable the suspicious plugins and refresh the page. Guide: https://sqai.tech/quick-experience.html#faq';\r\n    }\r\n    return this.formatBasicErrorMessage(error);\r\n  }\r\n\r\n  // Local execution - use base implementation\r\n  // (inherits default executeAction from BasePlaygroundAdapter)\r\n\r\n  // Local execution gets actionSpace from internal agent (parameter is for backward compatibility)\r\n  async getActionSpace(context?: unknown): Promise<DeviceAction<unknown>[]> {\r\n    // Priority 1: Use agent's getActionSpace method\r\n    if (this.agent?.getActionSpace) {\r\n      return await this.agent.getActionSpace();\r\n    }\r\n\r\n    // Priority 2: Use agent's interface.actionSpace method\r\n    if (\r\n      this.agent &&\r\n      'interface' in this.agent &&\r\n      typeof this.agent.interface === 'object'\r\n    ) {\r\n      const page = this.agent.interface as {\r\n        actionSpace?: () => Promise<DeviceAction<unknown>[]>;\r\n      };\r\n      if (page?.actionSpace) {\r\n        return await page.actionSpace();\r\n      }\r\n    }\r\n\r\n    // Priority 3: Fallback to context parameter (for backward compatibility with tests)\r\n    if (context && typeof context === 'object' && 'actionSpace' in context) {\r\n      const contextPage = context as {\r\n        actionSpace: () => Promise<DeviceAction<unknown>[]>;\r\n      };\r\n      return await contextPage.actionSpace();\r\n    }\r\n\r\n    return [];\r\n  }\r\n\r\n  // Local execution doesn't use a server, so always return true\r\n  async checkStatus(): Promise<boolean> {\r\n    return true;\r\n  }\r\n\r\n  async overrideConfig(aiConfig: Record<string, unknown>): Promise<void> {\r\n    // For local execution, use the shared env override function\r\n    overrideAIConfig(aiConfig);\r\n  }\r\n\r\n  async executeAction(\r\n    actionType: string,\r\n    value: FormValue,\r\n    options: ExecutionOptions,\r\n  ): Promise<unknown> {\r\n    // Get actionSpace using our simplified getActionSpace method\r\n    const actionSpace = await this.getActionSpace();\r\n    let originalOnTaskStartTip: ((tip: string) => void) | undefined;\r\n\r\n    // Setup progress tracking if requestId is provided\r\n    if (options.requestId && this.agent) {\r\n      // Track current request ID to prevent stale callbacks\r\n      this.currentRequestId = options.requestId;\r\n      originalOnTaskStartTip = this.agent.onTaskStartTip;\r\n\r\n      // Set up a fresh callback\r\n      this.agent.onTaskStartTip = (tip: string) => {\r\n        // Only process if this is still the current request\r\n        if (this.currentRequestId !== options.requestId) {\r\n          return;\r\n        }\r\n\r\n        // Store tip for our progress tracking\r\n        this.taskProgressTips[options.requestId!] = tip;\r\n\r\n        // Call the direct progress callback set via setProgressCallback\r\n        if (this.progressCallback) {\r\n          this.progressCallback(tip);\r\n        }\r\n\r\n        if (typeof originalOnTaskStartTip === 'function') {\r\n          originalOnTaskStartTip(tip);\r\n        }\r\n      };\r\n    }\r\n\r\n    try {\r\n      // Call the base implementation with the original signature\r\n      const result = await executeAction(\r\n        this.agent,\r\n        actionType,\r\n        actionSpace,\r\n        value,\r\n        options,\r\n      );\r\n\r\n      // For local execution, we need to package the result with dump and reportHTML\r\n      // similar to how the server does it\r\n      const response = {\r\n        result,\r\n        dump: null as unknown,\r\n        reportHTML: null as string | null,\r\n        error: null as string | null,\r\n      };\r\n\r\n      try {\r\n        // Get dump and reportHTML from agent like the server does\r\n        if (this.agent.dumpDataString) {\r\n          const dumpString = this.agent.dumpDataString();\r\n          if (dumpString) {\r\n            response.dump = JSON.parse(dumpString);\r\n          }\r\n        }\r\n\r\n        if (this.agent.reportHTMLString) {\r\n          response.reportHTML = this.agent.reportHTMLString() || null;\r\n        }\r\n\r\n        // Write out action dumps\r\n        if (this.agent.writeOutActionDumps) {\r\n          this.agent.writeOutActionDumps();\r\n        }\r\n      } catch (error: unknown) {\r\n        console.error('Failed to get dump/reportHTML from agent:', error);\r\n      }\r\n\r\n      this.agent.resetDump();\r\n\r\n      return response;\r\n    } finally {\r\n      // Always clean up progress tracking to prevent memory leaks\r\n      if (options.requestId) {\r\n        this.cleanup(options.requestId);\r\n        // Clear the agent callback to prevent accumulation\r\n        if (this.agent) {\r\n          this.agent.onTaskStartTip = originalOnTaskStartTip;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  async getTaskProgress(requestId: string): Promise<{ tip?: string }> {\r\n    // Return the stored tip for this requestId\r\n    return { tip: this.taskProgressTips[requestId] || undefined };\r\n  }\r\n\r\n  // Local execution task cancellation - minimal implementation\r\n  async cancelTask(\r\n    _requestId: string,\r\n  ): Promise<{ error?: string; success?: boolean }> {\r\n    if (!this.agent) {\r\n      return { error: 'No active agent found for this requestId' };\r\n    }\r\n\r\n    try {\r\n      await this.agent.destroy?.();\r\n      return { success: true };\r\n    } catch (error: unknown) {\r\n      const errorMessage =\r\n        error instanceof Error ? error.message : 'Unknown error';\r\n      console.error(`Failed to cancel agent: ${errorMessage}`);\r\n      return { error: `Failed to cancel: ${errorMessage}` };\r\n    }\r\n  }\r\n\r\n  // Get interface information from the agent\r\n  async getInterfaceInfo(): Promise<{\r\n    type: string;\r\n    description?: string;\r\n  } | null> {\r\n    if (!this.agent?.interface) {\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      const type = this.agent.interface.interfaceType || 'Unknown';\r\n      const description = this.agent.interface.describe?.() || undefined;\r\n\r\n      return {\r\n        type,\r\n        description,\r\n      };\r\n    } catch (error: unknown) {\r\n      console.error('Failed to get interface info:', error);\r\n      return null;\r\n    }\r\n  }\r\n}\r\n","import type { DeviceAction } from '@sqaitech/core';\r\nimport { parseStructuredParams } from '../common';\r\nimport type { ExecutionOptions, FormValue, ValidationResult } from '../types';\r\nimport { BasePlaygroundAdapter } from './base';\r\n\r\nexport class RemoteExecutionAdapter extends BasePlaygroundAdapter {\r\n  private serverUrl?: string;\r\n  private progressPolling = new Map<string, NodeJS.Timeout>();\r\n  private progressCallback?: (tip: string) => void;\r\n  private _id?: string;\r\n\r\n  constructor(serverUrl: string) {\r\n    super();\r\n    this.serverUrl = serverUrl;\r\n  }\r\n\r\n  // Get adapter ID (cached after first status check for remote)\r\n  get id(): string | undefined {\r\n    return this._id;\r\n  }\r\n\r\n  // Override validateParams for remote execution\r\n  // Since schemas from server are JSON-serialized and lack .parse() method\r\n  validateParams(\r\n    value: FormValue,\r\n    action: DeviceAction<unknown> | undefined,\r\n  ): ValidationResult {\r\n    if (!action?.paramSchema) {\r\n      return { valid: true };\r\n    }\r\n\r\n    const needsStructuredParams = this.actionNeedsStructuredParams(action);\r\n\r\n    if (!needsStructuredParams) {\r\n      return { valid: true };\r\n    }\r\n\r\n    if (!value.params) {\r\n      return { valid: false, errorMessage: 'Parameters are required' };\r\n    }\r\n\r\n    // For remote execution, perform basic validation without .parse()\r\n    // Check if required fields are present\r\n    if (action.paramSchema && typeof action.paramSchema === 'object') {\r\n      const schema = action.paramSchema as any;\r\n      if (schema.shape || schema.type === 'ZodObject') {\r\n        const shape = schema.shape || {};\r\n        const missingFields = Object.keys(shape).filter((key) => {\r\n          const fieldDef = shape[key];\r\n          // Check if field is required (not optional)\r\n          const isOptional =\r\n            fieldDef?.isOptional ||\r\n            fieldDef?._def?.innerType || // ZodOptional\r\n            fieldDef?._def?.typeName === 'ZodOptional';\r\n          return (\r\n            !isOptional &&\r\n            (value.params![key] === undefined || value.params![key] === '')\r\n          );\r\n        });\r\n\r\n        if (missingFields.length > 0) {\r\n          return {\r\n            valid: false,\r\n            errorMessage: `Missing required parameters: ${missingFields.join(', ')}`,\r\n          };\r\n        }\r\n      }\r\n    }\r\n\r\n    return { valid: true };\r\n  }\r\n\r\n  async parseStructuredParams(\r\n    action: DeviceAction<unknown>,\r\n    params: Record<string, unknown>,\r\n    options: ExecutionOptions,\r\n  ): Promise<unknown[]> {\r\n    // Use shared implementation from common.ts\r\n    return await parseStructuredParams(action, params, options);\r\n  }\r\n\r\n  formatErrorMessage(error: any): string {\r\n    const message = error?.message || '';\r\n\r\n    // Handle Android-specific errors\r\n    const androidErrors = [\r\n      {\r\n        keyword: 'adb',\r\n        message:\r\n          'ADB connection error. Please ensure device is connected and USB debugging is enabled.',\r\n      },\r\n      {\r\n        keyword: 'UIAutomator',\r\n        message:\r\n          'UIAutomator error. Please ensure the UIAutomator server is running on the device.',\r\n      },\r\n    ];\r\n\r\n    const androidError = androidErrors.find(({ keyword }) =>\r\n      message.includes(keyword),\r\n    );\r\n    if (androidError) {\r\n      return androidError.message;\r\n    }\r\n\r\n    return this.formatBasicErrorMessage(error);\r\n  }\r\n\r\n  // Remote execution adapter - simplified interface\r\n  async executeAction(\r\n    actionType: string,\r\n    value: FormValue,\r\n    options: ExecutionOptions,\r\n  ): Promise<unknown> {\r\n    // If serverUrl is provided, use server-side execution\r\n    if (this.serverUrl && typeof window !== 'undefined') {\r\n      return this.executeViaServer(actionType, value, options);\r\n    }\r\n\r\n    throw new Error(\r\n      'Remote execution adapter requires server URL for execution',\r\n    );\r\n  }\r\n\r\n  // Remote execution via server - uses same endpoint as requestPlaygroundServer\r\n  private async executeViaServer(\r\n    actionType: string,\r\n    value: FormValue,\r\n    options: ExecutionOptions,\r\n  ): Promise<unknown> {\r\n    const payload: Record<string, unknown> = {\r\n      type: actionType,\r\n      prompt: value.prompt,\r\n      ...this.buildOptionalPayloadParams(options, value),\r\n    };\r\n\r\n    // Add context only if it exists (server can handle single agent case without context)\r\n    if (options.context) {\r\n      payload.context = options.context;\r\n    }\r\n\r\n    // Start progress polling if callback is set and requestId exists\r\n    if (options.requestId && this.progressCallback) {\r\n      this.startProgressPolling(options.requestId, this.progressCallback);\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`${this.serverUrl}/execute`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify(payload),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorText = await response.text().catch(() => 'Unknown error');\r\n        throw new Error(\r\n          `Server request failed (${response.status}): ${errorText}`,\r\n        );\r\n      }\r\n\r\n      const result = await response.json();\r\n\r\n      // Stop progress polling when execution completes\r\n      if (options.requestId) {\r\n        this.stopProgressPolling(options.requestId);\r\n      }\r\n\r\n      return result;\r\n    } catch (error) {\r\n      // Stop progress polling on error\r\n      if (options.requestId) {\r\n        this.stopProgressPolling(options.requestId);\r\n      }\r\n      console.error('Execute via server failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Helper method to build optional payload parameters\r\n  private buildOptionalPayloadParams(\r\n    options: ExecutionOptions,\r\n    value: FormValue,\r\n  ): Record<string, unknown> {\r\n    const optionalParams: Record<string, unknown> = {};\r\n\r\n    // Add optional parameters only if they have meaningful values\r\n    const optionalFields = [\r\n      { key: 'requestId', value: options.requestId },\r\n      { key: 'deepThink', value: options.deepThink },\r\n      { key: 'screenshotIncluded', value: options.screenshotIncluded },\r\n      { key: 'domIncluded', value: options.domIncluded },\r\n      { key: 'params', value: value.params },\r\n    ] as const;\r\n\r\n    optionalFields.forEach(({ key, value }) => {\r\n      if (value !== undefined && value !== null && value !== '') {\r\n        optionalParams[key] = value;\r\n      }\r\n    });\r\n\r\n    return optionalParams;\r\n  }\r\n\r\n  // Get action space from server with fallback\r\n  async getActionSpace(context?: unknown): Promise<DeviceAction<unknown>[]> {\r\n    // Try server first if available\r\n    if (this.serverUrl && typeof window !== 'undefined') {\r\n      try {\r\n        const response = await fetch(`${this.serverUrl}/action-space`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify({ context }),\r\n        });\r\n\r\n        if (!response.ok) {\r\n          throw new Error(`Failed to get action space: ${response.statusText}`);\r\n        }\r\n\r\n        const result = await response.json();\r\n        return Array.isArray(result) ? result : [];\r\n      } catch (error) {\r\n        console.error('Failed to get action space from server:', error);\r\n        // Fall through to context fallback\r\n      }\r\n    }\r\n\r\n    // Fallback: try context.actionSpace if available\r\n    if (context && typeof context === 'object' && 'actionSpace' in context) {\r\n      try {\r\n        const actionSpaceMethod = (\r\n          context as { actionSpace: () => Promise<DeviceAction<unknown>[]> }\r\n        ).actionSpace;\r\n        const result = await actionSpaceMethod();\r\n        return Array.isArray(result) ? result : [];\r\n      } catch (error) {\r\n        console.error('Failed to get action space from context:', error);\r\n      }\r\n    }\r\n\r\n    return [];\r\n  }\r\n\r\n  // Uses base implementation for validateParams and createDisplayContent\r\n\r\n  // Server communication methods\r\n  async checkStatus(): Promise<boolean> {\r\n    if (!this.serverUrl) {\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const res = await fetch(`${this.serverUrl}/status`);\r\n      if (res.status === 200) {\r\n        // Try to extract id from response\r\n        try {\r\n          const data = await res.json();\r\n          if (data.id && typeof data.id === 'string') {\r\n            this._id = data.id;\r\n          }\r\n        } catch (jsonError) {\r\n          // If JSON parsing fails, id remains undefined but status is still OK\r\n          console.debug('Failed to parse status response:', jsonError);\r\n        }\r\n        return true;\r\n      }\r\n      return false;\r\n    } catch (error) {\r\n      console.warn('Server status check failed:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async overrideConfig(aiConfig: Record<string, unknown>): Promise<void> {\r\n    if (!this.serverUrl) {\r\n      throw new Error('Server URL not configured');\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`${this.serverUrl}/config`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ aiConfig }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(\r\n          `Failed to override server config: ${response.statusText}`,\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to override server config:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async getTaskProgress(requestId: string): Promise<{ tip?: string }> {\r\n    if (!this.serverUrl) {\r\n      return { tip: undefined };\r\n    }\r\n\r\n    if (!requestId?.trim()) {\r\n      console.warn('Invalid requestId provided for task progress');\r\n      return { tip: undefined };\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(\r\n        `${this.serverUrl}/task-progress/${encodeURIComponent(requestId)}`,\r\n      );\r\n\r\n      if (!response.ok) {\r\n        console.warn(`Task progress request failed: ${response.statusText}`);\r\n        return { tip: undefined };\r\n      }\r\n\r\n      return await response.json();\r\n    } catch (error) {\r\n      console.error('Failed to poll task progress:', error);\r\n      return { tip: undefined };\r\n    }\r\n  }\r\n\r\n  // Cancel task\r\n  async cancelTask(\r\n    requestId: string,\r\n  ): Promise<{ error?: string; success?: boolean }> {\r\n    // Stop progress polling\r\n    this.stopProgressPolling(requestId);\r\n\r\n    if (!this.serverUrl) {\r\n      return { error: 'No server URL configured' };\r\n    }\r\n\r\n    if (!requestId?.trim()) {\r\n      return { error: 'Invalid request ID' };\r\n    }\r\n\r\n    try {\r\n      const res = await fetch(\r\n        `${this.serverUrl}/cancel/${encodeURIComponent(requestId)}`,\r\n        {\r\n          method: 'POST',\r\n        },\r\n      );\r\n\r\n      if (!res.ok) {\r\n        return { error: `Cancel request failed: ${res.statusText}` };\r\n      }\r\n\r\n      const result = await res.json();\r\n      return { success: true, ...result };\r\n    } catch (error) {\r\n      console.error('Failed to cancel task:', error);\r\n      return { error: 'Failed to cancel task' };\r\n    }\r\n  }\r\n\r\n  // Progress callback management\r\n  setProgressCallback(callback: (tip: string) => void): void {\r\n    this.progressCallback = callback;\r\n  }\r\n\r\n  // Start progress polling\r\n  private startProgressPolling(\r\n    requestId: string,\r\n    callback: (tip: string) => void,\r\n  ): void {\r\n    // Don't start multiple polling for the same request\r\n    if (this.progressPolling.has(requestId)) {\r\n      return;\r\n    }\r\n\r\n    let lastTip = '';\r\n    const interval = setInterval(async () => {\r\n      try {\r\n        const progress = await this.getTaskProgress(requestId);\r\n        if (progress?.tip?.trim?.() && progress.tip !== lastTip) {\r\n          lastTip = progress.tip;\r\n          callback(progress.tip);\r\n        }\r\n      } catch (error) {\r\n        // Silently ignore progress polling errors to avoid spam\r\n        console.debug('Progress polling error:', error);\r\n      }\r\n    }, 500); // Poll every 500ms\r\n\r\n    this.progressPolling.set(requestId, interval);\r\n  }\r\n\r\n  // Stop progress polling\r\n  private stopProgressPolling(requestId: string): void {\r\n    const interval = this.progressPolling.get(requestId);\r\n    if (interval) {\r\n      clearInterval(interval);\r\n      this.progressPolling.delete(requestId);\r\n    }\r\n  }\r\n\r\n  // Get screenshot from server\r\n  async getScreenshot(): Promise<{\r\n    screenshot: string;\r\n    timestamp: number;\r\n  } | null> {\r\n    if (!this.serverUrl) {\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`${this.serverUrl}/screenshot`);\r\n\r\n      if (!response.ok) {\r\n        console.warn(`Screenshot request failed: ${response.statusText}`);\r\n        return null;\r\n      }\r\n\r\n      return await response.json();\r\n    } catch (error) {\r\n      console.error('Failed to get screenshot:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Get interface information from server\r\n  async getInterfaceInfo(): Promise<{\r\n    type: string;\r\n    description?: string;\r\n  } | null> {\r\n    if (!this.serverUrl) {\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`${this.serverUrl}/interface-info`);\r\n\r\n      if (!response.ok) {\r\n        console.warn(`Interface info request failed: ${response.statusText}`);\r\n        return null;\r\n      }\r\n\r\n      return await response.json();\r\n    } catch (error) {\r\n      console.error('Failed to get interface info:', error);\r\n      return null;\r\n    }\r\n  }\r\n}\r\n","import type { DeviceAction } from '@sqaitech/core';\r\nimport { PLAYGROUND_SERVER_PORT } from '@sqaitech/shared/constants';\r\nimport type { BasePlaygroundAdapter } from '../adapters/base';\r\nimport { LocalExecutionAdapter } from '../adapters/local-execution';\r\nimport { RemoteExecutionAdapter } from '../adapters/remote-execution';\r\nimport type {\r\n  ExecutionOptions,\r\n  FormValue,\r\n  PlaygroundAgent,\r\n  PlaygroundConfig,\r\n  ValidationResult,\r\n} from '../types';\r\n\r\nexport class PlaygroundSDK {\r\n  private adapter: BasePlaygroundAdapter;\r\n\r\n  constructor(config: PlaygroundConfig) {\r\n    this.adapter = this.createAdapter(\r\n      config.type,\r\n      config.serverUrl,\r\n      config.agent,\r\n    );\r\n  }\r\n\r\n  private createAdapter(\r\n    type: string,\r\n    serverUrl?: string,\r\n    agent?: PlaygroundAgent,\r\n  ): BasePlaygroundAdapter {\r\n    switch (type) {\r\n      case 'local-execution':\r\n        if (!agent) {\r\n          throw new Error('Agent is required for local execution');\r\n        }\r\n        return new LocalExecutionAdapter(agent);\r\n      case 'remote-execution': {\r\n        // Use provided serverUrl first, then fallback to localhost if current page origin is file:// or default\r\n        const finalServerUrl =\r\n          serverUrl ||\r\n          (typeof window !== 'undefined' &&\r\n          window.location.protocol.includes('http')\r\n            ? window.location.origin\r\n            : `http://localhost:${PLAYGROUND_SERVER_PORT}`);\r\n\r\n        return new RemoteExecutionAdapter(finalServerUrl);\r\n      }\r\n      default:\r\n        throw new Error(`Unsupported execution type: ${type}`);\r\n    }\r\n  }\r\n\r\n  async executeAction(\r\n    actionType: string,\r\n    value: FormValue,\r\n    options: ExecutionOptions,\r\n  ): Promise<unknown> {\r\n    const result = await this.adapter.executeAction(actionType, value, options);\r\n\r\n    // Stop any active polling for this request after execution completes\r\n    if (options.requestId) {\r\n      this.stopProgressPolling(options.requestId);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  async getActionSpace(context?: unknown): Promise<DeviceAction<unknown>[]> {\r\n    // Both adapters now accept context parameter\r\n    // Local will prioritize internal agent, Remote will use server + fallback\r\n    return this.adapter.getActionSpace(context);\r\n  }\r\n\r\n  validateStructuredParams(\r\n    value: FormValue,\r\n    action: DeviceAction<unknown> | undefined,\r\n  ): ValidationResult {\r\n    return this.adapter.validateParams(value, action);\r\n  }\r\n\r\n  formatErrorMessage(error: any): string {\r\n    return this.adapter.formatErrorMessage(error);\r\n  }\r\n\r\n  createDisplayContent(\r\n    value: FormValue,\r\n    needsStructuredParams: boolean,\r\n    action: DeviceAction<unknown> | undefined,\r\n  ): string {\r\n    return this.adapter.createDisplayContent(\r\n      value,\r\n      needsStructuredParams,\r\n      action,\r\n    );\r\n  }\r\n\r\n  // Get adapter ID (works for both remote and local execution)\r\n  get id(): string | undefined {\r\n    if (this.adapter instanceof RemoteExecutionAdapter) {\r\n      return this.adapter.id;\r\n    }\r\n    if (this.adapter instanceof LocalExecutionAdapter) {\r\n      return this.adapter.id;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  // Server communication methods (for remote execution)\r\n  async checkStatus(): Promise<boolean> {\r\n    if (this.adapter instanceof RemoteExecutionAdapter) {\r\n      return this.adapter.checkStatus();\r\n    }\r\n    return true; // For local execution, always return true\r\n  }\r\n\r\n  async overrideConfig(aiConfig: any): Promise<void> {\r\n    if (this.adapter instanceof RemoteExecutionAdapter) {\r\n      return this.adapter.overrideConfig(aiConfig);\r\n    }\r\n    // For local execution, this is a no-op\r\n  }\r\n\r\n  async getTaskProgress(requestId: string): Promise<{ tip?: string }> {\r\n    if (this.adapter instanceof RemoteExecutionAdapter) {\r\n      return this.adapter.getTaskProgress(requestId);\r\n    }\r\n    if (this.adapter instanceof LocalExecutionAdapter) {\r\n      return this.adapter.getTaskProgress(requestId);\r\n    }\r\n    return { tip: undefined }; // Fallback\r\n  }\r\n\r\n  // Cancel task (for remote execution)\r\n  async cancelTask(requestId: string): Promise<any> {\r\n    // Stop progress polling for this request\r\n    this.stopProgressPolling(requestId);\r\n\r\n    if (this.adapter instanceof RemoteExecutionAdapter) {\r\n      return this.adapter.cancelTask(requestId);\r\n    }\r\n    return { error: 'Cancel task not supported in local execution mode' };\r\n  }\r\n\r\n  // Progress callback management\r\n  onProgressUpdate(callback: (tip: string) => void): void {\r\n    // Pass the callback to the adapter if it supports it\r\n    if (this.adapter instanceof RemoteExecutionAdapter) {\r\n      this.adapter.setProgressCallback(callback);\r\n    } else if (this.adapter instanceof LocalExecutionAdapter) {\r\n      this.adapter.setProgressCallback(callback);\r\n    }\r\n  }\r\n\r\n  // Start progress polling for remote execution (deprecated - now handled by adapter)\r\n  startProgressPolling(requestId: string): void {\r\n    // This method is now handled by the RemoteExecutionAdapter automatically\r\n    // when executeAction is called with a requestId\r\n    console.warn(\r\n      'startProgressPolling is deprecated - polling is now automatic',\r\n    );\r\n  }\r\n\r\n  // Stop progress polling for a specific request (deprecated - now handled by adapter)\r\n  stopProgressPolling(requestId: string): void {\r\n    // This method is now handled by the RemoteExecutionAdapter automatically\r\n    console.warn(\r\n      'stopProgressPolling is deprecated - polling cleanup is now automatic',\r\n    );\r\n  }\r\n\r\n  // Cancel execution - supports both remote and local\r\n  async cancelExecution(requestId: string): Promise<void> {\r\n    this.stopProgressPolling(requestId);\r\n\r\n    if (this.adapter instanceof RemoteExecutionAdapter) {\r\n      await this.adapter.cancelTask(requestId);\r\n    } else if (this.adapter instanceof LocalExecutionAdapter) {\r\n      // For local execution, we might need to implement agent cancellation\r\n      console.warn('Local execution cancellation not fully implemented');\r\n    }\r\n  }\r\n\r\n  // Screenshot method for remote execution\r\n  async getScreenshot(): Promise<{\r\n    screenshot: string;\r\n    timestamp: number;\r\n  } | null> {\r\n    if (this.adapter instanceof RemoteExecutionAdapter) {\r\n      return this.adapter.getScreenshot();\r\n    }\r\n    return null; // For local execution, not supported yet\r\n  }\r\n\r\n  // Get interface information (type and description)\r\n  async getInterfaceInfo(): Promise<{\r\n    type: string;\r\n    description?: string;\r\n  } | null> {\r\n    if (this.adapter instanceof LocalExecutionAdapter) {\r\n      return this.adapter.getInterfaceInfo();\r\n    }\r\n    if (this.adapter instanceof RemoteExecutionAdapter) {\r\n      return this.adapter.getInterfaceInfo();\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","const elementColor = [\n    '#01204E'\n];\nconst highlightColorForSearchArea = '#028391';\nconst highlightColorForElement = '#fd5907';\nfunction djb2Hash(str) {\n    if (!str) str = 'unnamed';\n    let hash = 5381;\n    for(let i = 0; i < str.length; i++)hash = (hash << 5) + hash + str.charCodeAt(i);\n    return hash >>> 0;\n}\nfunction colorForName(name) {\n    const hashNumber = djb2Hash(name);\n    return elementColor[hashNumber % elementColor.length];\n}\nfunction highlightColorForType(type) {\n    if ('searchArea' === type) return highlightColorForSearchArea;\n    return highlightColorForElement;\n}\nfunction globalThemeConfig() {\n    return {\n        token: {\n            colorPrimary: '#2B83FF'\n        },\n        components: {\n            Layout: {\n                headerHeight: 60,\n                headerPadding: '0 30px',\n                headerBg: '#FFF',\n                bodyBg: '#FFF'\n            }\n        }\n    };\n}\nexport { colorForName, globalThemeConfig, highlightColorForType };\n","import { jsx } from \"react/jsx-runtime\";\nimport \"./index.css\";\nimport sqai_logo from \"../../assets/sqai-logo.mjs\";\nconst LogoUrl = sqai_logo;\nconst Logo = (param)=>{\n    let { hideLogo = false } = param;\n    if (hideLogo) return null;\n    return /*#__PURE__*/ jsx(\"div\", {\n        className: \"logo\",\n        children: /*#__PURE__*/ jsx(\"a\", {\n            href: \"https://sqai.tech\",\n            target: \"_blank\",\n            rel: \"noreferrer\",\n            children: /*#__PURE__*/ jsx(\"img\", {\n                alt: \"SQAI Logo\",\n                src: sqai_logo\n            })\n        })\n    });\n};\nexport { Logo, LogoUrl };\n","import { create } from \"zustand\";\nvar __webpack_require__ = {};\n(()=>{\n    __webpack_require__.d = (exports, definition)=>{\n        for(var key in definition)if (__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) Object.defineProperty(exports, key, {\n            enumerable: true,\n            get: definition[key]\n        });\n    };\n})();\n(()=>{\n    __webpack_require__.o = (obj, prop)=>Object.prototype.hasOwnProperty.call(obj, prop);\n})();\n(()=>{\n    __webpack_require__.r = (exports)=>{\n        if ('undefined' != typeof Symbol && Symbol.toStringTag) Object.defineProperty(exports, Symbol.toStringTag, {\n            value: 'Module'\n        });\n        Object.defineProperty(exports, '__esModule', {\n            value: true\n        });\n    };\n})();\nvar external_zustand_namespaceObject = {};\n__webpack_require__.r(external_zustand_namespaceObject);\n__webpack_require__.d(external_zustand_namespaceObject, {\n    create: ()=>create\n});\nconst { create: store_create } = external_zustand_namespaceObject;\nconst AUTO_ZOOM_KEY = 'sqai-auto-zoom';\nconst BACKGROUND_VISIBLE_KEY = 'sqai-background-visible';\nconst ELEMENTS_VISIBLE_KEY = 'sqai-elements-visible';\nconst parseBooleanParam = (value)=>{\n    if (null === value) return;\n    const normalized = value.trim().toLowerCase();\n    if ([\n        '1',\n        'true',\n        'yes',\n        'on'\n    ].includes(normalized)) return true;\n    if ([\n        '0',\n        'false',\n        'no',\n        'off'\n    ].includes(normalized)) return false;\n};\nconst getQueryPreference = (paramName)=>{\n    if ('undefined' == typeof window) return;\n    const searchParams = new URLSearchParams(window.location.search);\n    return parseBooleanParam(searchParams.get(paramName));\n};\nconst useBlackboardPreference = store_create((set)=>{\n    const savedAutoZoom = 'false' !== localStorage.getItem(AUTO_ZOOM_KEY);\n    const savedBackgroundVisible = 'false' !== localStorage.getItem(BACKGROUND_VISIBLE_KEY);\n    const savedElementsVisible = 'false' !== localStorage.getItem(ELEMENTS_VISIBLE_KEY);\n    const autoZoomFromQuery = getQueryPreference('focusOnCursor');\n    const elementsVisibleFromQuery = getQueryPreference('showElementMarkers');\n    return {\n        backgroundVisible: savedBackgroundVisible,\n        elementsVisible: void 0 === elementsVisibleFromQuery ? savedElementsVisible : elementsVisibleFromQuery,\n        autoZoom: void 0 === autoZoomFromQuery ? savedAutoZoom : autoZoomFromQuery,\n        setBackgroundVisible: (visible)=>{\n            set({\n                backgroundVisible: visible\n            });\n            localStorage.setItem(BACKGROUND_VISIBLE_KEY, visible.toString());\n        },\n        setElementsVisible: (visible)=>{\n            set({\n                elementsVisible: visible\n            });\n            localStorage.setItem(ELEMENTS_VISIBLE_KEY, visible.toString());\n        },\n        setAutoZoom: (enabled)=>{\n            set({\n                autoZoom: enabled\n            });\n            localStorage.setItem(AUTO_ZOOM_KEY, enabled.toString());\n        }\n    };\n});\nconst CONFIG_KEY = 'sqai-env-config';\nconst SERVICE_MODE_KEY = 'sqai-service-mode';\nconst TRACKING_ACTIVE_TAB_KEY = 'sqai-tracking-active-tab';\nconst DEEP_THINK_KEY = 'sqai-deep-think';\nconst SCREENSHOT_INCLUDED_KEY = 'sqai-screenshot-included';\nconst DOM_INCLUDED_KEY = 'sqai-dom-included';\nconst getConfigStringFromLocalStorage = ()=>{\n    const configString = localStorage.getItem(CONFIG_KEY);\n    return configString || '';\n};\nconst parseConfig = (configString)=>{\n    const lines = configString.split('\\n');\n    const config = {};\n    lines.forEach((line)=>{\n        const trimmed = line.trim();\n        if (trimmed.startsWith('#')) return;\n        const cleanLine = trimmed.replace(/^export\\s+/i, '').replace(/;$/, '').trim();\n        const match = cleanLine.match(/^(\\w+)=(.*)$/);\n        if (match) {\n            const [, key, value] = match;\n            let parsedValue = value.trim();\n            if (parsedValue.startsWith(\"'\") && parsedValue.endsWith(\"'\") || parsedValue.startsWith('\"') && parsedValue.endsWith('\"')) parsedValue = parsedValue.slice(1, -1);\n            config[key] = parsedValue;\n        }\n    });\n    return config;\n};\nconst useEnvConfig = store_create((set, get)=>{\n    const configString = getConfigStringFromLocalStorage();\n    const config = parseConfig(configString);\n    const ifInExtension = window.location.href.startsWith('chrome-extension');\n    const savedServiceMode = localStorage.getItem(SERVICE_MODE_KEY);\n    const savedForceSameTabNavigation = 'false' !== localStorage.getItem(TRACKING_ACTIVE_TAB_KEY);\n    const savedDeepThink = 'true' === localStorage.getItem(DEEP_THINK_KEY);\n    const savedScreenshotIncluded = 'false' !== localStorage.getItem(SCREENSHOT_INCLUDED_KEY);\n    const savedDomIncluded = localStorage.getItem(DOM_INCLUDED_KEY) || 'false';\n    return {\n        serviceMode: ifInExtension ? 'In-Browser-Extension' : savedServiceMode || 'Server',\n        setServiceMode: (serviceMode)=>{\n            if (ifInExtension) throw new Error('serviceMode cannot be set in extension');\n            set({\n                serviceMode\n            });\n            localStorage.setItem(SERVICE_MODE_KEY, serviceMode);\n        },\n        config,\n        configString,\n        setConfig: (config)=>set({\n                config\n            }),\n        loadConfig: (configString)=>{\n            const config = parseConfig(configString);\n            set({\n                config,\n                configString\n            });\n            localStorage.setItem(CONFIG_KEY, configString);\n        },\n        syncFromStorage: ()=>{\n            const latestConfigString = getConfigStringFromLocalStorage();\n            const latestConfig = parseConfig(latestConfigString);\n            set({\n                config: latestConfig,\n                configString: latestConfigString\n            });\n        },\n        forceSameTabNavigation: savedForceSameTabNavigation,\n        setForceSameTabNavigation: (forceSameTabNavigation)=>{\n            set({\n                forceSameTabNavigation\n            });\n            localStorage.setItem(TRACKING_ACTIVE_TAB_KEY, forceSameTabNavigation.toString());\n        },\n        deepThink: savedDeepThink,\n        setDeepThink: (deepThink)=>{\n            set({\n                deepThink\n            });\n            localStorage.setItem(DEEP_THINK_KEY, deepThink.toString());\n        },\n        screenshotIncluded: savedScreenshotIncluded,\n        setScreenshotIncluded: (screenshotIncluded)=>{\n            set({\n                screenshotIncluded\n            });\n            localStorage.setItem(SCREENSHOT_INCLUDED_KEY, screenshotIncluded.toString());\n        },\n        domIncluded: 'visible-only' === savedDomIncluded ? 'visible-only' : 'true' === savedDomIncluded,\n        setDomIncluded: (domIncluded)=>{\n            set({\n                domIncluded\n            });\n            localStorage.setItem(DOM_INCLUDED_KEY, domIncluded.toString());\n        },\n        popupTab: 'playground',\n        setPopupTab: (tab)=>{\n            set({\n                popupTab: tab\n            });\n        }\n    };\n});\nexport { useBlackboardPreference, useEnvConfig };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport { SettingOutlined } from \"@ant-design/icons\";\nimport { Input, Modal, Tooltip } from \"antd\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { useEnvConfig } from \"../../store/store.mjs\";\nfunction EnvConfig(param) {\n    let { showTooltipWhenEmpty = true, showModelName = true, tooltipPlacement = 'bottom', mode = 'icon' } = param;\n    const { config, configString, loadConfig, syncFromStorage } = useEnvConfig();\n    const [isModalOpen, setIsModalOpen] = useState(false);\n    const [tempConfigString, setTempConfigString] = useState(configString);\n    const midsceneModelName = config.MIDSCENE_MODEL_NAME;\n    const componentRef = useRef(null);\n    const showModal = (e)=>{\n        syncFromStorage();\n        setIsModalOpen(true);\n        e.preventDefault();\n        e.stopPropagation();\n    };\n    const handleOk = ()=>{\n        setIsModalOpen(false);\n        loadConfig(tempConfigString);\n    };\n    const handleCancel = ()=>{\n        setIsModalOpen(false);\n    };\n    useEffect(()=>{\n        if (isModalOpen) setTempConfigString(configString);\n    }, [\n        isModalOpen,\n        configString\n    ]);\n    return /*#__PURE__*/ jsxs(\"div\", {\n        style: {\n            display: 'flex',\n            justifyContent: 'flex-end',\n            gap: '10px',\n            alignItems: 'center',\n            height: '100%',\n            minHeight: '32px'\n        },\n        ref: componentRef,\n        children: [\n            showModelName ? midsceneModelName : null,\n            /*#__PURE__*/ jsx(Tooltip, {\n                title: \"Please set up your environment variables before using.\",\n                placement: tooltipPlacement,\n                align: {\n                    offset: [\n                        -10,\n                        5\n                    ]\n                },\n                getPopupContainer: ()=>componentRef.current,\n                open: isModalOpen ? false : showTooltipWhenEmpty ? 0 === Object.keys(config).length : void 0,\n                children: 'icon' === mode ? /*#__PURE__*/ jsx(SettingOutlined, {\n                    onClick: showModal\n                }) : /*#__PURE__*/ jsx(\"span\", {\n                    onClick: showModal,\n                    style: {\n                        color: '#006AFF',\n                        cursor: 'pointer'\n                    },\n                    children: \"set up\"\n                })\n            }),\n            /*#__PURE__*/ jsxs(Modal, {\n                title: \"Model Env Config\",\n                open: isModalOpen,\n                onOk: handleOk,\n                onCancel: handleCancel,\n                okText: \"Save\",\n                style: {\n                    width: '800px',\n                    height: '100%',\n                    marginTop: '10%'\n                },\n                destroyOnClose: true,\n                maskClosable: true,\n                centered: true,\n                children: [\n                    /*#__PURE__*/ jsx(Input.TextArea, {\n                        rows: 7,\n                        placeholder: 'OPENAI_API_KEY=sk-...\\nMIDSCENE_MODEL_NAME=gpt-4o-2024-08-06\\n...',\n                        value: tempConfigString,\n                        onChange: (e)=>setTempConfigString(e.target.value),\n                        style: {\n                            whiteSpace: 'nowrap',\n                            wordWrap: 'break-word'\n                        }\n                    }),\n                    /*#__PURE__*/ jsxs(\"div\", {\n                        children: [\n                            /*#__PURE__*/ jsx(\"p\", {\n                                children: \"The format is KEY=VALUE and separated by new lines.\"\n                            }),\n                            /*#__PURE__*/ jsxs(\"p\", {\n                                children: [\n                                    \"These data will be saved \",\n                                    /*#__PURE__*/ jsx(\"strong\", {\n                                        children: \"locally in your browser\"\n                                    }),\n                                    \".\"\n                                ]\n                            })\n                        ]\n                    })\n                ]\n            })\n        ]\n    });\n}\nexport { EnvConfig };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport { GithubOutlined, QuestionCircleOutlined } from \"@ant-design/icons\";\nimport { Typography } from \"antd\";\nimport { EnvConfig } from \"../env-config/index.mjs\";\nimport \"./style.css\";\nfunction NavActions(param) {\n    let { showEnvConfig = true, showTooltipWhenEmpty = false, showModelName = false, githubUrl = 'https://github.com/web-infra-dev/midscene', helpUrl = 'https://sqai.tech/quick-experience.html', className = '' } = param;\n    return /*#__PURE__*/ jsxs(\"div\", {\n        className: `nav-actions ${className}`,\n        children: [\n            /*#__PURE__*/ jsx(Typography.Link, {\n                href: githubUrl,\n                target: \"_blank\",\n                children: /*#__PURE__*/ jsx(GithubOutlined, {\n                    className: \"nav-icon\"\n                })\n            }),\n            /*#__PURE__*/ jsx(Typography.Link, {\n                href: helpUrl,\n                target: \"_blank\",\n                children: /*#__PURE__*/ jsx(QuestionCircleOutlined, {\n                    className: \"nav-icon\"\n                })\n            }),\n            showEnvConfig && /*#__PURE__*/ jsx(EnvConfig, {\n                showTooltipWhenEmpty: showTooltipWhenEmpty,\n                showModelName: showModelName\n            })\n        ]\n    });\n}\nexport { NavActions };\n","const trackingTip = 'limit popup to current tab';\nconst deepThinkTip = 'deep think';\nconst screenshotIncludedTip = 'include screenshot in request';\nconst domIncludedTip = 'include DOM info in request';\nconst apiMetadata = {\n    aiAction: {\n        group: 'interaction',\n        title: 'Auto Planning: plan the steps and execute'\n    },\n    aiTap: {\n        group: 'interaction',\n        title: 'Click an element'\n    },\n    aiDoubleClick: {\n        group: 'interaction',\n        title: 'Double-click an element'\n    },\n    aiHover: {\n        group: 'interaction',\n        title: 'Hover over an element'\n    },\n    aiInput: {\n        group: 'interaction',\n        title: 'Input text into an element'\n    },\n    aiRightClick: {\n        group: 'interaction',\n        title: 'Right-click an element'\n    },\n    aiKeyboardPress: {\n        group: 'interaction',\n        title: 'Press keyboard keys'\n    },\n    aiScroll: {\n        group: 'interaction',\n        title: 'Scroll the page or element'\n    },\n    aiLocate: {\n        group: 'interaction',\n        title: 'Locate an element on the page'\n    },\n    aiQuery: {\n        group: 'extraction',\n        title: 'Extract data directly from the UI'\n    },\n    aiBoolean: {\n        group: 'extraction',\n        title: 'Get true/false answer'\n    },\n    aiNumber: {\n        group: 'extraction',\n        title: 'Extract numeric value'\n    },\n    aiString: {\n        group: 'extraction',\n        title: 'Extract text value'\n    },\n    aiAsk: {\n        group: 'extraction',\n        title: 'Ask a question about the UI'\n    },\n    aiAssert: {\n        group: 'validation',\n        title: 'Assert a condition is true'\n    },\n    aiWaitFor: {\n        group: 'validation',\n        title: 'Wait for a condition to be met'\n    }\n};\nconst defaultMainButtons = [\n    'aiAction',\n    'aiTap',\n    'aiQuery',\n    'aiAssert'\n];\nconst WELCOME_MESSAGE_TEMPLATE = {\n    type: 'system',\n    content: `\n      Welcome to Midscene.js Playground!\n      \n      This is a panel for experimenting and testing Midscene.js features. You can use natural language instructions to operate the web page, such as clicking buttons, filling in forms, querying information, etc.\n      \n      Please enter your instructions in the input box below to start experiencing.\n    `,\n    loading: false,\n    result: void 0,\n    replayScriptsInfo: null,\n    replayCounter: 0,\n    loadingProgressText: '',\n    verticalMode: false\n};\nconst BLANK_RESULT = {\n    result: void 0,\n    dump: null,\n    reportHTML: null,\n    error: null\n};\nexport { BLANK_RESULT, WELCOME_MESSAGE_TEMPLATE, apiMetadata, deepThinkTip, defaultMainButtons, domIncludedTip, screenshotIncludedTip, trackingTip };\n","import dayjs from \"dayjs\";\nfunction timeStr(timestamp) {\n    return timestamp ? dayjs(timestamp).format('YYYY-MM-DD HH:mm:ss') : '-';\n}\nfunction filterBase64Value(input) {\n    return input.replace(/data:image\\/[^\"]+\"/g, 'data:image...\"');\n}\nconst mousePointer = 'data:image/png;base64,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';\nconst mouseLoading = 'data:image/png;base64,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';\nexport { filterBase64Value, mouseLoading, mousePointer, timeStr };\n","import type {\r\n  AndroidPullParam,\r\n  DetailedLocateParam,\r\n  ExecutionTask,\r\n  ExecutionTaskAction,\r\n  ExecutionTaskInsightAssertion,\r\n  ExecutionTaskInsightLocate,\r\n  ExecutionTaskInsightQuery,\r\n  ExecutionTaskPlanning,\r\n  ScrollParam,\r\n} from '@/types';\r\n\r\nexport function typeStr(task: ExecutionTask) {\r\n  return task.subType && task.subType !== 'Plan'\r\n    ? `${task.type} / ${task.subType || ''}`\r\n    : task.type;\r\n}\r\n\r\nexport function locateParamStr(locate?: DetailedLocateParam | string): string {\r\n  if (!locate) {\r\n    return '';\r\n  }\r\n\r\n  if (typeof locate === 'string') {\r\n    return locate;\r\n  }\r\n\r\n  if (typeof locate === 'object') {\r\n    if (typeof locate.prompt === 'string') {\r\n      return locate.prompt;\r\n    }\r\n\r\n    if (typeof locate.prompt === 'object' && locate.prompt.prompt) {\r\n      const prompt = locate.prompt.prompt;\r\n      const images = locate.prompt.images || [];\r\n\r\n      if (images.length === 0) return prompt;\r\n\r\n      const imagesStr = images\r\n        .map((image) => {\r\n          let url = image.url;\r\n          if (\r\n            url.startsWith('data:image/') ||\r\n            (url.startsWith('data:') && url.includes('base64'))\r\n          ) {\r\n            url = `${url.substring(0, 15)}...`;\r\n          }\r\n          return `[${image.name}](${url})`;\r\n        })\r\n        .join(', ');\r\n\r\n      return `${prompt}, ${imagesStr}`;\r\n    }\r\n  }\r\n\r\n  return '';\r\n}\r\n\r\nexport function scrollParamStr(scrollParam?: ScrollParam) {\r\n  if (!scrollParam) {\r\n    return '';\r\n  }\r\n  return `${scrollParam.direction || 'down'}, ${scrollParam.scrollType || 'once'}, ${scrollParam.distance || 'distance-not-set'}`;\r\n}\r\n\r\nexport function pullParamStr(pullParam?: AndroidPullParam) {\r\n  if (!pullParam) {\r\n    return '';\r\n  }\r\n  const parts: string[] = [];\r\n  parts.push(`direction: ${pullParam.direction || 'down'}`);\r\n  if (pullParam.distance) {\r\n    parts.push(`distance: ${pullParam.distance}`);\r\n  }\r\n  if (pullParam.duration) {\r\n    parts.push(`duration: ${pullParam.duration}ms`);\r\n  }\r\n  return parts.join(', ');\r\n}\r\n\r\nexport function taskTitleStr(\r\n  type:\r\n    | 'Tap'\r\n    | 'Hover'\r\n    | 'Input'\r\n    | 'RightClick'\r\n    | 'KeyboardPress'\r\n    | 'Scroll'\r\n    | 'Action'\r\n    | 'Query'\r\n    | 'Assert'\r\n    | 'WaitFor'\r\n    | 'Locate'\r\n    | 'Boolean'\r\n    | 'Number'\r\n    | 'String',\r\n  prompt: string,\r\n) {\r\n  if (prompt) {\r\n    return `${type} - ${prompt}`;\r\n  }\r\n  return type;\r\n}\r\n\r\nexport function paramStr(task: ExecutionTask) {\r\n  let value: string | undefined | object;\r\n  if (task.type === 'Planning') {\r\n    value = (task as ExecutionTaskPlanning)?.param?.userInstruction;\r\n  }\r\n\r\n  if (task.type === 'Insight') {\r\n    value =\r\n      locateParamStr((task as ExecutionTaskInsightLocate)?.param) ||\r\n      (task as ExecutionTaskInsightLocate)?.param?.id ||\r\n      (task as ExecutionTaskInsightQuery)?.param?.dataDemand ||\r\n      (task as ExecutionTaskInsightAssertion)?.param?.assertion;\r\n  }\r\n\r\n  if (task.type === 'Action') {\r\n    const locate = (task as ExecutionTaskAction)?.locate;\r\n    const locateStr = locate ? locateParamStr(locate) : '';\r\n\r\n    value = task.thought || '';\r\n    if (typeof (task as ExecutionTaskAction)?.param?.timeMs === 'number') {\r\n      value = `${(task as ExecutionTaskAction)?.param?.timeMs}ms`;\r\n    } else if (\r\n      typeof (task as ExecutionTaskAction)?.param?.scrollType === 'string'\r\n    ) {\r\n      value = scrollParamStr((task as ExecutionTaskAction)?.param);\r\n    } else if (\r\n      typeof (task as ExecutionTaskAction)?.param?.direction === 'string' &&\r\n      (task as ExecutionTaskAction)?.subType === 'AndroidPull'\r\n    ) {\r\n      value = pullParamStr((task as ExecutionTaskAction)?.param);\r\n    } else if (\r\n      typeof (task as ExecutionTaskAction)?.param?.value !== 'undefined'\r\n    ) {\r\n      value = (task as ExecutionTaskAction)?.param?.value;\r\n    }\r\n\r\n    if (locateStr) {\r\n      if (value) {\r\n        value = `${locateStr} - ${value}`;\r\n      } else {\r\n        value = locateStr;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (typeof value === 'undefined') return '';\r\n\r\n  if (typeof value === 'string') return value;\r\n\r\n  if (typeof value === 'object' && locateParamStr(value as any)) {\r\n    return locateParamStr(value as any);\r\n  }\r\n\r\n  return JSON.stringify(value, undefined, 2);\r\n}\r\n","import { AIActionType, type AIArgs, expandSearchArea } from '@/ai-model/common';\r\nimport {\r\n  AiExtractElementInfo,\r\n  AiLocateElement,\r\n  callAIWithObjectResponse,\r\n} from '@/ai-model/index';\r\nimport { AiLocateSection } from '@/ai-model/inspect';\r\nimport { elementDescriberInstruction } from '@/ai-model/prompt/describe';\r\nimport type {\r\n  AIDescribeElementResponse,\r\n  AIUsageInfo,\r\n  BaseElement,\r\n  DetailedLocateParam,\r\n  DumpSubscriber,\r\n  InsightAction,\r\n  InsightExtractOption,\r\n  InsightExtractParam,\r\n  InsightTaskInfo,\r\n  LocateResult,\r\n  PartialInsightDumpFromSDK,\r\n  Rect,\r\n  UIContext,\r\n} from '@/types';\r\nimport {\r\n  type IModelConfig,\r\n  SQAI_FORCE_DEEP_THINK,\r\n  globalConfigManager,\r\n} from '@sqaitech/shared/env';\r\nimport { compositeElementInfoImg, cropByRect } from '@sqaitech/shared/img';\r\nimport { getDebug } from '@sqaitech/shared/logger';\r\nimport { assert } from '@sqaitech/shared/utils';\r\nimport type { TMultimodalPrompt } from '../ai-model/common';\r\nimport { emitInsightDump } from './utils';\r\n\r\nexport interface LocateOpts {\r\n  context?: UIContext<BaseElement>;\r\n}\r\n\r\nexport type AnyValue<T> = {\r\n  [K in keyof T]: unknown extends T[K] ? any : T[K];\r\n};\r\n\r\ninterface InsightOptions {\r\n  taskInfo?: Omit<InsightTaskInfo, 'durationMs'>;\r\n  aiVendorFn?: typeof callAIWithObjectResponse;\r\n}\r\n\r\nconst debug = getDebug('ai:insight');\r\nexport default class Insight<\r\n  ElementType extends BaseElement = BaseElement,\r\n  ContextType extends UIContext<ElementType> = UIContext<ElementType>,\r\n> {\r\n  contextRetrieverFn: (\r\n    action: InsightAction,\r\n  ) => Promise<ContextType> | ContextType;\r\n\r\n  aiVendorFn: Exclude<InsightOptions['aiVendorFn'], undefined> =\r\n    callAIWithObjectResponse;\r\n\r\n  onceDumpUpdatedFn?: DumpSubscriber;\r\n\r\n  taskInfo?: Omit<InsightTaskInfo, 'durationMs'>;\r\n\r\n  constructor(\r\n    context:\r\n      | ContextType\r\n      | ((action: InsightAction) => Promise<ContextType> | ContextType),\r\n    opt?: InsightOptions,\r\n  ) {\r\n    assert(context, 'context is required for Insight');\r\n    if (typeof context === 'function') {\r\n      this.contextRetrieverFn = context;\r\n    } else {\r\n      this.contextRetrieverFn = () => Promise.resolve(context);\r\n    }\r\n\r\n    // just for unit test, aiVendorFn is callAIWithObjectResponse by default\r\n    if (typeof opt?.aiVendorFn !== 'undefined') {\r\n      this.aiVendorFn = opt.aiVendorFn;\r\n    }\r\n    if (typeof opt?.taskInfo !== 'undefined') {\r\n      this.taskInfo = opt.taskInfo;\r\n    }\r\n  }\r\n\r\n  async locate(\r\n    query: DetailedLocateParam,\r\n    opt: LocateOpts,\r\n    modelConfig: IModelConfig,\r\n  ): Promise<LocateResult> {\r\n    const queryPrompt = typeof query === 'string' ? query : query.prompt;\r\n    assert(queryPrompt, 'query is required for locate');\r\n    const dumpSubscriber = this.onceDumpUpdatedFn;\r\n    this.onceDumpUpdatedFn = undefined;\r\n\r\n    assert(typeof query === 'object', 'query should be an object for locate');\r\n\r\n    const globalDeepThinkSwitch = globalConfigManager.getEnvConfigInBoolean(\r\n      SQAI_FORCE_DEEP_THINK,\r\n    );\r\n    if (globalDeepThinkSwitch) {\r\n      debug('globalDeepThinkSwitch', globalDeepThinkSwitch);\r\n    }\r\n    let searchAreaPrompt;\r\n    if (query.deepThink || globalDeepThinkSwitch) {\r\n      searchAreaPrompt = query.prompt;\r\n    }\r\n\r\n    const { vlMode } = modelConfig;\r\n\r\n    if (searchAreaPrompt && !vlMode) {\r\n      console.warn(\r\n        'The \"deepThink\" feature is not supported with multimodal LLM. Please config VL model for SQAI. https://sqai.tech/choose-a-model',\r\n      );\r\n      searchAreaPrompt = undefined;\r\n    }\r\n\r\n    const context = opt?.context || (await this.contextRetrieverFn('locate'));\r\n\r\n    let searchArea: Rect | undefined = undefined;\r\n    let searchAreaRawResponse: string | undefined = undefined;\r\n    let searchAreaUsage: AIUsageInfo | undefined = undefined;\r\n    let searchAreaResponse:\r\n      | Awaited<ReturnType<typeof AiLocateSection>>\r\n      | undefined = undefined;\r\n    if (searchAreaPrompt) {\r\n      searchAreaResponse = await AiLocateSection({\r\n        context,\r\n        sectionDescription: searchAreaPrompt,\r\n        modelConfig,\r\n      });\r\n      assert(\r\n        searchAreaResponse.rect,\r\n        `cannot find search area for \"${searchAreaPrompt}\"${\r\n          searchAreaResponse.error ? `: ${searchAreaResponse.error}` : ''\r\n        }`,\r\n      );\r\n      searchAreaRawResponse = searchAreaResponse.rawResponse;\r\n      searchAreaUsage = searchAreaResponse.usage;\r\n      searchArea = searchAreaResponse.rect;\r\n    }\r\n\r\n    const startTime = Date.now();\r\n    const {\r\n      parseResult,\r\n      rect,\r\n      elementById,\r\n      rawResponse,\r\n      usage,\r\n      isOrderSensitive,\r\n    } = await AiLocateElement({\r\n      callAIFn: this.aiVendorFn,\r\n      context,\r\n      targetElementDescription: queryPrompt,\r\n      searchConfig: searchAreaResponse,\r\n      modelConfig,\r\n    });\r\n\r\n    const timeCost = Date.now() - startTime;\r\n    const taskInfo: InsightTaskInfo = {\r\n      ...(this.taskInfo ? this.taskInfo : {}),\r\n      durationMs: timeCost,\r\n      rawResponse: JSON.stringify(rawResponse),\r\n      formatResponse: JSON.stringify(parseResult),\r\n      usage,\r\n      searchArea,\r\n      searchAreaRawResponse,\r\n      searchAreaUsage,\r\n    };\r\n\r\n    let errorLog: string | undefined;\r\n    if (parseResult.errors?.length) {\r\n      errorLog = `AI model failed to locate: \\n${parseResult.errors.join('\\n')}`;\r\n    }\r\n\r\n    const dumpData: PartialInsightDumpFromSDK = {\r\n      type: 'locate',\r\n      userQuery: {\r\n        element: queryPrompt,\r\n      },\r\n      matchedElement: [],\r\n      matchedRect: rect,\r\n      data: null,\r\n      taskInfo,\r\n      deepThink: !!searchArea,\r\n      error: errorLog,\r\n    };\r\n\r\n    const elements: BaseElement[] = [];\r\n    (parseResult.elements || []).forEach((item) => {\r\n      if ('id' in item) {\r\n        const element = elementById(item?.id);\r\n\r\n        if (!element) {\r\n          console.warn(\r\n            `locate: cannot find element id=${item.id}. Maybe an unstable response from AI model`,\r\n          );\r\n          return;\r\n        }\r\n        elements.push(element);\r\n      }\r\n    });\r\n\r\n    emitInsightDump(\r\n      {\r\n        ...dumpData,\r\n        matchedElement: elements,\r\n      },\r\n      dumpSubscriber,\r\n    );\r\n\r\n    if (errorLog) {\r\n      throw new Error(errorLog);\r\n    }\r\n\r\n    assert(\r\n      elements.length <= 1,\r\n      `locate: multiple elements found, length = ${elements.length}`,\r\n    );\r\n\r\n    if (elements.length === 1) {\r\n      return {\r\n        element: {\r\n          id: elements[0]!.id,\r\n          indexId: elements[0]!.indexId,\r\n          center: elements[0]!.center,\r\n          rect: elements[0]!.rect,\r\n          xpaths: elements[0]!.xpaths || [],\r\n          attributes: elements[0]!.attributes,\r\n          isOrderSensitive,\r\n        },\r\n        rect,\r\n      };\r\n    }\r\n    return {\r\n      element: null,\r\n      rect,\r\n    };\r\n  }\r\n\r\n  async extract<T>(\r\n    dataDemand: InsightExtractParam,\r\n    modelConfig: IModelConfig,\r\n    opt?: InsightExtractOption,\r\n    multimodalPrompt?: TMultimodalPrompt,\r\n  ): Promise<{\r\n    data: T;\r\n    thought?: string;\r\n    usage?: AIUsageInfo;\r\n  }> {\r\n    assert(\r\n      typeof dataDemand === 'object' || typeof dataDemand === 'string',\r\n      `dataDemand should be object or string, but get ${typeof dataDemand}`,\r\n    );\r\n    const dumpSubscriber = this.onceDumpUpdatedFn;\r\n    this.onceDumpUpdatedFn = undefined;\r\n\r\n    const context = await this.contextRetrieverFn('extract');\r\n\r\n    const startTime = Date.now();\r\n\r\n    const { parseResult, usage } = await AiExtractElementInfo<T>({\r\n      context,\r\n      dataQuery: dataDemand,\r\n      multimodalPrompt,\r\n      extractOption: opt,\r\n      modelConfig,\r\n    });\r\n\r\n    const timeCost = Date.now() - startTime;\r\n    const taskInfo: InsightTaskInfo = {\r\n      ...(this.taskInfo ? this.taskInfo : {}),\r\n      durationMs: timeCost,\r\n      rawResponse: JSON.stringify(parseResult),\r\n    };\r\n\r\n    let errorLog: string | undefined;\r\n    if (parseResult.errors?.length) {\r\n      errorLog = `AI response error: \\n${parseResult.errors.join('\\n')}`;\r\n    }\r\n\r\n    const dumpData: PartialInsightDumpFromSDK = {\r\n      type: 'extract',\r\n      userQuery: {\r\n        dataDemand,\r\n      },\r\n      matchedElement: [],\r\n      data: null,\r\n      taskInfo,\r\n      error: errorLog,\r\n    };\r\n\r\n    const { data, thought } = parseResult || {};\r\n\r\n    // 4\r\n    emitInsightDump(\r\n      {\r\n        ...dumpData,\r\n        data,\r\n      },\r\n      dumpSubscriber,\r\n    );\r\n\r\n    if (errorLog && !data && !opt?.doNotThrowError) {\r\n      throw new Error(errorLog);\r\n    }\r\n\r\n    return {\r\n      data,\r\n      thought,\r\n      usage,\r\n    };\r\n  }\r\n\r\n  async describe(\r\n    target: Rect | [number, number],\r\n    modelConfig: IModelConfig,\r\n    opt?: {\r\n      deepThink?: boolean;\r\n    },\r\n  ): Promise<Pick<AIDescribeElementResponse, 'description'>> {\r\n    assert(target, 'target is required for insight.describe');\r\n    const context = await this.contextRetrieverFn('describe');\r\n    const { screenshotBase64, size } = context;\r\n    assert(screenshotBase64, 'screenshot is required for insight.describe');\r\n    // The result of the \"describe\" function will be used for positioning, so essentially it is a form of grounding.\r\n    const { vlMode } = modelConfig;\r\n    const systemPrompt = elementDescriberInstruction();\r\n\r\n    // Convert [x,y] center point to Rect if needed\r\n    const defaultRectSize = 30;\r\n    const targetRect: Rect = Array.isArray(target)\r\n      ? {\r\n          left: Math.floor(target[0] - defaultRectSize / 2),\r\n          top: Math.floor(target[1] - defaultRectSize / 2),\r\n          width: defaultRectSize,\r\n          height: defaultRectSize,\r\n        }\r\n      : target;\r\n\r\n    let imagePayload = await compositeElementInfoImg({\r\n      inputImgBase64: screenshotBase64,\r\n      size,\r\n      elementsPositionInfo: [\r\n        {\r\n          rect: targetRect,\r\n        },\r\n      ],\r\n      borderThickness: 3,\r\n    });\r\n\r\n    if (opt?.deepThink) {\r\n      const searchArea = expandSearchArea(targetRect, context.size, vlMode);\r\n      debug('describe: set searchArea', searchArea);\r\n      const croppedResult = await cropByRect(\r\n        imagePayload,\r\n        searchArea,\r\n        vlMode === 'qwen-vl',\r\n      );\r\n      imagePayload = croppedResult.imageBase64;\r\n    }\r\n\r\n    const msgs: AIArgs = [\r\n      { role: 'system', content: systemPrompt },\r\n      {\r\n        role: 'user',\r\n        content: [\r\n          {\r\n            type: 'image_url',\r\n            image_url: {\r\n              url: imagePayload,\r\n              detail: 'high',\r\n            },\r\n          },\r\n        ],\r\n      },\r\n    ];\r\n\r\n    const callAIFn = this\r\n      .aiVendorFn as typeof callAIWithObjectResponse<AIDescribeElementResponse>;\r\n\r\n    const res = await callAIFn(\r\n      msgs,\r\n      AIActionType.DESCRIBE_ELEMENT,\r\n      modelConfig,\r\n    );\r\n\r\n    const { content } = res;\r\n    assert(!content.error, `describe failed: ${content.error}`);\r\n    assert(content.description, 'failed to describe the element');\r\n    return content;\r\n  }\r\n}\r\n","import { elementByPositionWithElementInfo } from '@/ai-model';\r\nimport type { TMultimodalPrompt, TUserPrompt } from '@/ai-model/common';\r\nimport type { AbstractInterface } from '@/device';\r\nimport type {\r\n  BaseElement,\r\n  ElementCacheFeature,\r\n  ElementTreeNode,\r\n  ExecutionDump,\r\n  ExecutionTask,\r\n  ExecutorContext,\r\n  LocateResultElement,\r\n  PlanningLocateParam,\r\n  UIContext,\r\n} from '@/types';\r\nimport { uploadTestInfoToServer } from '@/utils';\r\nimport { NodeType } from '@sqaitech/shared/constants';\r\nimport {\r\n  SQAI_REPORT_TAG_NAME,\r\n  globalConfigManager,\r\n} from '@sqaitech/shared/env';\r\nimport {\r\n  generateElementByPosition,\r\n  getNodeFromCacheList,\r\n} from '@sqaitech/shared/extractor';\r\nimport { resizeImgBase64 } from '@sqaitech/shared/img';\r\nimport { getDebug } from '@sqaitech/shared/logger';\r\nimport { _keyDefinitions } from '@sqaitech/shared/us-keyboard-layout';\r\nimport { assert, logMsg, uuid } from '@sqaitech/shared/utils';\r\nimport dayjs from 'dayjs';\r\nimport { debug as cacheDebug } from './task-cache';\r\nimport type { TaskExecutor } from './tasks';\r\n\r\nconst debugProfile = getDebug('web:tool:profile');\r\n\r\nexport async function commonContextParser(\r\n  interfaceInstance: AbstractInterface,\r\n  _opt: { uploadServerUrl?: string },\r\n): Promise<UIContext> {\r\n  assert(interfaceInstance, 'interfaceInstance is required');\r\n\r\n  debugProfile('Getting interface description');\r\n  const description = interfaceInstance.describe?.() || '';\r\n  debugProfile('Interface description end');\r\n\r\n  debugProfile('Uploading test info to server');\r\n  uploadTestInfoToServer({\r\n    testUrl: description,\r\n    serverUrl: _opt.uploadServerUrl,\r\n  });\r\n  debugProfile('UploadTestInfoToServer end');\r\n\r\n  const screenshotBase64 = await interfaceInstance.screenshotBase64();\r\n  assert(screenshotBase64!, 'screenshotBase64 is required');\r\n\r\n  const size = await interfaceInstance.size();\r\n  debugProfile(`size: ${size.width}x${size.height} dpr: ${size.dpr}`);\r\n\r\n  return {\r\n    tree: {\r\n      node: null,\r\n      children: [],\r\n    },\r\n    size,\r\n    screenshotBase64: screenshotBase64!,\r\n  };\r\n}\r\n\r\nexport function getReportFileName(tag = 'web') {\r\n  const reportTagName = globalConfigManager.getEnvConfigValue(\r\n    SQAI_REPORT_TAG_NAME,\r\n  );\r\n  const dateTimeInFileName = dayjs().format('YYYY-MM-DD_HH-mm-ss');\r\n  // ensure uniqueness at the same time\r\n  const uniqueId = uuid().substring(0, 8);\r\n  return `${reportTagName || tag}-${dateTimeInFileName}-${uniqueId}`;\r\n}\r\n\r\nexport function printReportMsg(filepath: string) {\r\n  logMsg(`Midscene - report file updated: ${filepath}`);\r\n}\r\n\r\n/**\r\n * Get the current execution file name\r\n * @returns The name of the current execution file\r\n */\r\nexport function getCurrentExecutionFile(trace?: string): string | false {\r\n  const error = new Error();\r\n  const stackTrace = trace || error.stack;\r\n  const pkgDir = process.cwd() || '';\r\n  if (stackTrace) {\r\n    const stackLines = stackTrace.split('\\n');\r\n    for (const line of stackLines) {\r\n      if (\r\n        line.includes('.spec.') ||\r\n        line.includes('.test.') ||\r\n        line.includes('.ts') ||\r\n        line.includes('.js')\r\n      ) {\r\n        const match = line.match(/(?:at\\s+)?(.*?\\.(?:spec|test)\\.[jt]s)/);\r\n        if (match?.[1]) {\r\n          const targetFileName = match[1]\r\n            .replace(pkgDir, '')\r\n            .trim()\r\n            .replace('at ', '');\r\n          return targetFileName;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nconst testFileIndex = new Map<string, number>();\r\n\r\nexport function generateCacheId(fileName?: string): string {\r\n  let taskFile = fileName || getCurrentExecutionFile();\r\n  if (!taskFile) {\r\n    taskFile = uuid();\r\n    console.warn(\r\n      'Midscene - using random UUID for cache id. Cache may be invalid.',\r\n    );\r\n  }\r\n\r\n  if (testFileIndex.has(taskFile)) {\r\n    const currentIndex = testFileIndex.get(taskFile);\r\n    if (currentIndex !== undefined) {\r\n      testFileIndex.set(taskFile, currentIndex + 1);\r\n    }\r\n  } else {\r\n    testFileIndex.set(taskFile, 1);\r\n  }\r\n  return `${taskFile}-${testFileIndex.get(taskFile)}`;\r\n}\r\n\r\nexport function matchElementFromPlan(\r\n  planLocateParam: PlanningLocateParam,\r\n  tree: ElementTreeNode<BaseElement>,\r\n) {\r\n  if (!planLocateParam) {\r\n    return undefined;\r\n  }\r\n  if (planLocateParam.id) {\r\n    return getNodeFromCacheList(planLocateParam.id);\r\n  }\r\n\r\n  if (planLocateParam.bbox) {\r\n    const centerPosition = {\r\n      x: Math.floor((planLocateParam.bbox[0] + planLocateParam.bbox[2]) / 2),\r\n      y: Math.floor((planLocateParam.bbox[1] + planLocateParam.bbox[3]) / 2),\r\n    };\r\n    let element = elementByPositionWithElementInfo(tree, centerPosition);\r\n\r\n    if (!element) {\r\n      element = generateElementByPosition(centerPosition) as BaseElement;\r\n    }\r\n\r\n    return element;\r\n  }\r\n\r\n  return undefined;\r\n}\r\n\r\nexport async function matchElementFromCache(\r\n  taskExecutor: TaskExecutor,\r\n  cacheEntry: ElementCacheFeature | undefined,\r\n  cachePrompt: TUserPrompt,\r\n  cacheable: boolean | undefined,\r\n): Promise<LocateResultElement | undefined> {\r\n  if (!cacheEntry) {\r\n    return undefined;\r\n  }\r\n\r\n  if (cacheable === false) {\r\n    cacheDebug('cache disabled for prompt: %s', cachePrompt);\r\n    return undefined;\r\n  }\r\n\r\n  if (!taskExecutor.taskCache?.isCacheResultUsed) {\r\n    return undefined;\r\n  }\r\n\r\n  if (!taskExecutor.interface.rectMatchesCacheFeature) {\r\n    cacheDebug(\r\n      'interface does not implement rectMatchesCacheFeature, skip cache',\r\n    );\r\n    return undefined;\r\n  }\r\n\r\n  try {\r\n    const rect =\r\n      await taskExecutor.interface.rectMatchesCacheFeature(cacheEntry);\r\n    const element: LocateResultElement = {\r\n      id: uuid(),\r\n      center: [\r\n        Math.round(rect.left + rect.width / 2),\r\n        Math.round(rect.top + rect.height / 2),\r\n      ],\r\n      rect,\r\n      xpaths: [],\r\n      attributes: {\r\n        nodeType: NodeType.POSITION,\r\n      },\r\n    };\r\n\r\n    cacheDebug('cache hit, prompt: %s', cachePrompt);\r\n    return element;\r\n  } catch (error) {\r\n    cacheDebug('rectMatchesCacheFeature error: %s', error);\r\n    return undefined;\r\n  }\r\n}\r\n\r\nexport function trimContextByViewport(execution: ExecutionDump) {\r\n  function filterVisibleTree(\r\n    node: ElementTreeNode<BaseElement>,\r\n  ): ElementTreeNode<BaseElement> | null {\r\n    if (!node) return null;\r\n\r\n    // recursively process all children\r\n    const filteredChildren = Array.isArray(node.children)\r\n      ? (node.children\r\n          .map(filterVisibleTree)\r\n          .filter((child) => child !== null) as ElementTreeNode<BaseElement>[])\r\n      : [];\r\n\r\n    // if the current node is visible, keep it and the filtered children\r\n    if (node.node && node.node.isVisible === true) {\r\n      return {\r\n        ...node,\r\n        children: filteredChildren,\r\n      };\r\n    }\r\n\r\n    // if the current node is invisible, but has visible children, create an empty node to include these children\r\n    if (filteredChildren.length > 0) {\r\n      return {\r\n        node: null,\r\n        children: filteredChildren,\r\n      };\r\n    }\r\n\r\n    // if the current node is invisible and has no visible children, return null\r\n    return null;\r\n  }\r\n\r\n  return {\r\n    ...execution,\r\n    tasks: Array.isArray(execution.tasks)\r\n      ? execution.tasks.map((task: ExecutionTask) => {\r\n          const newTask = { ...task };\r\n          if (task.uiContext?.tree) {\r\n            newTask.uiContext = {\r\n              ...task.uiContext,\r\n              tree: filterVisibleTree(task.uiContext.tree) || {\r\n                node: null,\r\n                children: [],\r\n              },\r\n            };\r\n          }\r\n          return newTask;\r\n        })\r\n      : execution.tasks,\r\n  };\r\n}\r\n\r\ndeclare const __VERSION__: string | undefined;\r\n\r\nexport const getMidsceneVersion = (): string => {\r\n  if (typeof __VERSION__ !== 'undefined') {\r\n    return __VERSION__;\r\n  } else if (\r\n    process.env.__VERSION__ &&\r\n    process.env.__VERSION__ !== 'undefined'\r\n  ) {\r\n    return process.env.__VERSION__;\r\n  }\r\n  throw new Error('__VERSION__ inject failed during build');\r\n};\r\n\r\nexport const getSqaiVersion = getMidsceneVersion;\r\n\r\nexport const parsePrompt = (\r\n  prompt: TUserPrompt,\r\n): {\r\n  textPrompt: string;\r\n  multimodalPrompt?: TMultimodalPrompt;\r\n} => {\r\n  if (typeof prompt === 'string') {\r\n    return {\r\n      textPrompt: prompt,\r\n      multimodalPrompt: undefined,\r\n    };\r\n  }\r\n  return {\r\n    textPrompt: prompt.prompt,\r\n    multimodalPrompt: prompt.images\r\n      ? {\r\n          images: prompt.images,\r\n          convertHttpImage2Base64: !!prompt.convertHttpImage2Base64,\r\n        }\r\n      : undefined,\r\n  };\r\n};\r\n","import assert from 'node:assert';\r\nimport { existsSync, mkdirSync, readFileSync, writeFileSync } from 'node:fs';\r\nimport { dirname, join } from 'node:path';\r\nimport { isDeepStrictEqual } from 'node:util';\r\nimport type { TUserPrompt } from '@/ai-model';\r\nimport type { ElementCacheFeature } from '@/types';\r\nimport { getMidsceneRunSubDir } from '@sqaitech/shared/common';\r\nimport {\r\n  SQAI_CACHE_MAX_FILENAME_LENGTH,\r\n  globalConfigManager,\r\n} from '@sqaitech/shared/env';\r\nimport { getDebug } from '@sqaitech/shared/logger';\r\nimport { ifInBrowser, ifInWorker } from '@sqaitech/shared/utils';\r\nimport { generateHashId } from '@sqaitech/shared/utils';\r\nimport { replaceIllegalPathCharsAndSpace } from '@sqaitech/shared/utils';\r\nimport yaml from 'js-yaml';\r\nimport semver from 'semver';\r\nimport { getSqaiVersion } from './utils';\r\n\r\nconst DEFAULT_CACHE_MAX_FILENAME_LENGTH = 200;\r\n\r\nexport const debug = getDebug('cache');\r\n\r\nexport interface PlanningCache {\r\n  type: 'plan';\r\n  prompt: string;\r\n  yamlWorkflow: string;\r\n}\r\n\r\nexport interface LocateCache {\r\n  type: 'locate';\r\n  prompt: TUserPrompt;\r\n  cache?: ElementCacheFeature;\r\n  /** @deprecated kept for backward compatibility */\r\n  xpaths?: string[];\r\n}\r\n\r\nexport interface MatchCacheResult<T extends PlanningCache | LocateCache> {\r\n  cacheContent: T;\r\n  updateFn: (cb: (cache: T) => void) => void;\r\n}\r\n\r\nexport type CacheFileContent = {\r\n  sqaiVersion: string;\r\n  cacheId: string;\r\n  caches: Array<PlanningCache | LocateCache>;\r\n};\r\n\r\nconst lowestSupportedSqaiVersion = '0.5.0'; // SQAI rebrand - invalidates pre-0.5.0 cache\r\nexport const cacheFileExt = '.cache.yaml';\r\n\r\nexport class TaskCache {\r\n  cacheId: string;\r\n\r\n  cacheFilePath?: string;\r\n\r\n  cache: CacheFileContent;\r\n\r\n  isCacheResultUsed: boolean; // a flag to indicate if the cache result should be used\r\n  cacheOriginalLength: number;\r\n\r\n  readOnlyMode: boolean; // a flag to indicate if the cache is in read-only mode\r\n\r\n  writeOnlyMode: boolean; // a flag to indicate if the cache is in write-only mode\r\n\r\n  private matchedCacheIndices: Set<string> = new Set(); // Track matched records\r\n\r\n  constructor(\r\n    cacheId: string,\r\n    isCacheResultUsed: boolean,\r\n    cacheFilePath?: string,\r\n    options: { readOnly?: boolean; writeOnly?: boolean } = {},\r\n  ) {\r\n    assert(cacheId, 'cacheId is required');\r\n    let safeCacheId = replaceIllegalPathCharsAndSpace(cacheId);\r\n    const cacheMaxFilenameLength =\r\n      globalConfigManager.getEnvConfigInNumber(\r\n        SQAI_CACHE_MAX_FILENAME_LENGTH,\r\n      ) || DEFAULT_CACHE_MAX_FILENAME_LENGTH;\r\n    if (Buffer.byteLength(safeCacheId, 'utf8') > cacheMaxFilenameLength) {\r\n      const prefix = safeCacheId.slice(0, 32);\r\n      const hash = generateHashId(undefined, safeCacheId);\r\n      safeCacheId = `${prefix}-${hash}`;\r\n    }\r\n    this.cacheId = safeCacheId;\r\n\r\n    this.cacheFilePath =\r\n      ifInBrowser || ifInWorker\r\n        ? undefined\r\n        : cacheFilePath ||\r\n          join(getMidsceneRunSubDir('cache'), `${this.cacheId}${cacheFileExt}`);\r\n    const readOnlyMode = Boolean(options?.readOnly);\r\n    const writeOnlyMode = Boolean(options?.writeOnly);\r\n\r\n    if (readOnlyMode && writeOnlyMode) {\r\n      throw new Error('TaskCache cannot be both read-only and write-only');\r\n    }\r\n\r\n    this.isCacheResultUsed = writeOnlyMode ? false : isCacheResultUsed;\r\n    this.readOnlyMode = readOnlyMode;\r\n    this.writeOnlyMode = writeOnlyMode;\r\n\r\n    let cacheContent;\r\n    if (this.cacheFilePath && !this.writeOnlyMode) {\r\n      cacheContent = this.loadCacheFromFile();\r\n    }\r\n    if (!cacheContent) {\r\n      cacheContent = {\r\n        sqaiVersion: getSqaiVersion(),\r\n        cacheId: this.cacheId,\r\n        caches: [],\r\n      };\r\n    }\r\n    this.cache = cacheContent;\r\n    this.cacheOriginalLength = this.isCacheResultUsed\r\n      ? this.cache.caches.length\r\n      : 0;\r\n  }\r\n\r\n  matchCache(\r\n    prompt: TUserPrompt,\r\n    type: 'plan' | 'locate',\r\n  ): MatchCacheResult<PlanningCache | LocateCache> | undefined {\r\n    if (!this.isCacheResultUsed) {\r\n      return undefined;\r\n    }\r\n    // Find the first unused matching cache\r\n    for (let i = 0; i < this.cacheOriginalLength; i++) {\r\n      const item = this.cache.caches[i];\r\n      const promptStr =\r\n        typeof prompt === 'string' ? prompt : JSON.stringify(prompt);\r\n      const key = `${type}:${promptStr}:${i}`;\r\n      if (\r\n        item.type === type &&\r\n        isDeepStrictEqual(item.prompt, prompt) &&\r\n        !this.matchedCacheIndices.has(key)\r\n      ) {\r\n        if (item.type === 'locate') {\r\n          const locateItem = item as LocateCache;\r\n          if (!locateItem.cache && Array.isArray(locateItem.xpaths)) {\r\n            locateItem.cache = { xpaths: locateItem.xpaths };\r\n          }\r\n          if ('xpaths' in locateItem) {\r\n            locateItem.xpaths = undefined;\r\n          }\r\n        }\r\n        this.matchedCacheIndices.add(key);\r\n        debug(\r\n          'cache found and marked as used, type: %s, prompt: %s, index: %d',\r\n          type,\r\n          prompt,\r\n          i,\r\n        );\r\n        return {\r\n          cacheContent: item,\r\n          updateFn: (cb: (cache: PlanningCache | LocateCache) => void) => {\r\n            debug(\r\n              'will call updateFn to update cache, type: %s, prompt: %s, index: %d',\r\n              type,\r\n              prompt,\r\n              i,\r\n            );\r\n            cb(item);\r\n\r\n            if (this.readOnlyMode) {\r\n              debug(\r\n                'read-only mode, cache updated in memory but not flushed to file',\r\n              );\r\n              return;\r\n            }\r\n\r\n            debug(\r\n              'cache updated, will flush to file, type: %s, prompt: %s, index: %d',\r\n              type,\r\n              prompt,\r\n              i,\r\n            );\r\n            this.flushCacheToFile();\r\n          },\r\n        };\r\n      }\r\n    }\r\n    debug('no unused cache found, type: %s, prompt: %s', type, prompt);\r\n    return undefined;\r\n  }\r\n\r\n  matchPlanCache(prompt: string): MatchCacheResult<PlanningCache> | undefined {\r\n    return this.matchCache(prompt, 'plan') as\r\n      | MatchCacheResult<PlanningCache>\r\n      | undefined;\r\n  }\r\n\r\n  matchLocateCache(\r\n    prompt: TUserPrompt,\r\n  ): MatchCacheResult<LocateCache> | undefined {\r\n    return this.matchCache(prompt, 'locate') as\r\n      | MatchCacheResult<LocateCache>\r\n      | undefined;\r\n  }\r\n\r\n  appendCache(cache: PlanningCache | LocateCache) {\r\n    debug('will append cache', cache);\r\n    this.cache.caches.push(cache);\r\n\r\n    if (this.readOnlyMode) {\r\n      debug('read-only mode, cache appended to memory but not flushed to file');\r\n      return;\r\n    }\r\n\r\n    this.flushCacheToFile();\r\n  }\r\n\r\n  loadCacheFromFile() {\r\n    const cacheFile = this.cacheFilePath;\r\n    assert(cacheFile, 'cache file path is required');\r\n\r\n    if (!existsSync(cacheFile)) {\r\n      debug('no cache file found, path: %s', cacheFile);\r\n      return undefined;\r\n    }\r\n\r\n    // detect old cache file\r\n    const jsonTypeCacheFile = cacheFile.replace(cacheFileExt, '.json');\r\n    if (existsSync(jsonTypeCacheFile) && this.isCacheResultUsed) {\r\n      console.warn(\r\n        `An outdated cache file from an earlier version of Midscene has been detected. Since version 0.17, we have implemented an improved caching strategy. Please delete the old file located at: ${jsonTypeCacheFile}.`,\r\n      );\r\n      return undefined;\r\n    }\r\n\r\n    try {\r\n      const data = readFileSync(cacheFile, 'utf8');\r\n      const jsonData = yaml.load(data) as CacheFileContent;\r\n\r\n      const version = getSqaiVersion();\r\n      if (!version) {\r\n        debug('no SQAI version info, will not read cache from file');\r\n        return undefined;\r\n      }\r\n\r\n      if (\r\n        semver.lt(jsonData.sqaiVersion, lowestSupportedSqaiVersion) &&\r\n        !jsonData.sqaiVersion.includes('beta') // for internal test\r\n      ) {\r\n        console.warn(\r\n          `You are using an old version of SQAI cache file from before v0.5.0 rebrand. Cache format has changed.\\nPlease delete the existing cache and rebuild it. Sorry for the inconvenience.\\ncache file: ${cacheFile}`,\r\n        );\r\n        return undefined;\r\n      }\r\n\r\n      debug(\r\n        'cache loaded from file, path: %s, cache version: %s, record length: %s',\r\n        cacheFile,\r\n        jsonData.sqaiVersion,\r\n        jsonData.caches.length,\r\n      );\r\n      jsonData.sqaiVersion = getSqaiVersion(); // update the version\r\n      return jsonData;\r\n    } catch (err) {\r\n      debug(\r\n        'cache file exists but load failed, path: %s, error: %s',\r\n        cacheFile,\r\n        err,\r\n      );\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  flushCacheToFile(options?: { cleanUnused?: boolean }) {\r\n    const version = getSqaiVersion();\r\n    if (!version) {\r\n      debug('no SQAI version info, will not write cache to file');\r\n      return;\r\n    }\r\n\r\n    if (!this.cacheFilePath) {\r\n      debug('no cache file path, will not write cache to file');\r\n      return;\r\n    }\r\n\r\n    // Clean unused caches if requested\r\n    if (options?.cleanUnused) {\r\n      // Skip cleaning in write-only mode or when cache is not used\r\n      if (this.isCacheResultUsed) {\r\n        const originalLength = this.cache.caches.length;\r\n\r\n        // Collect indices of used caches\r\n        const usedIndices = new Set<number>();\r\n        for (const key of this.matchedCacheIndices) {\r\n          // key format: \"type:prompt:index\"\r\n          const parts = key.split(':');\r\n          const index = Number.parseInt(parts[parts.length - 1], 10);\r\n          if (!Number.isNaN(index)) {\r\n            usedIndices.add(index);\r\n          }\r\n        }\r\n\r\n        // Filter: keep used caches and newly added caches\r\n        this.cache.caches = this.cache.caches.filter((_, index) => {\r\n          const isUsed = usedIndices.has(index);\r\n          const isNew = index >= this.cacheOriginalLength;\r\n          return isUsed || isNew;\r\n        });\r\n\r\n        const removedCount = originalLength - this.cache.caches.length;\r\n        if (removedCount > 0) {\r\n          debug('cleaned %d unused cache record(s)', removedCount);\r\n        } else {\r\n          debug('no unused cache to clean');\r\n        }\r\n      } else {\r\n        debug('skip cleaning: cache is not used for reading');\r\n      }\r\n    }\r\n\r\n    try {\r\n      const dir = dirname(this.cacheFilePath);\r\n      if (!existsSync(dir)) {\r\n        mkdirSync(dir, { recursive: true });\r\n        debug('created cache directory: %s', dir);\r\n      }\r\n\r\n      // Sort caches to ensure plan entries come before locate entries for better readability\r\n      // Create a sorted copy for writing to disk while keeping in-memory order unchanged\r\n      const sortedCaches = [...this.cache.caches].sort((a, b) => {\r\n        if (a.type === 'plan' && b.type === 'locate') return -1;\r\n        if (a.type === 'locate' && b.type === 'plan') return 1;\r\n        return 0;\r\n      });\r\n\r\n      const cacheToWrite = {\r\n        ...this.cache,\r\n        caches: sortedCaches,\r\n      };\r\n\r\n      const yamlData = yaml.dump(cacheToWrite);\r\n      writeFileSync(this.cacheFilePath, yamlData);\r\n      debug('cache flushed to file: %s', this.cacheFilePath);\r\n    } catch (err) {\r\n      debug(\r\n        'write cache to file failed, path: %s, error: %s',\r\n        this.cacheFilePath,\r\n        err,\r\n      );\r\n    }\r\n  }\r\n\r\n  updateOrAppendCacheRecord(\r\n    newRecord: PlanningCache | LocateCache,\r\n    cachedRecord?: MatchCacheResult<PlanningCache | LocateCache>,\r\n  ) {\r\n    if (cachedRecord) {\r\n      // update existing record\r\n      if (newRecord.type === 'plan') {\r\n        cachedRecord.updateFn((cache) => {\r\n          (cache as PlanningCache).yamlWorkflow = newRecord.yamlWorkflow;\r\n        });\r\n      } else {\r\n        cachedRecord.updateFn((cache) => {\r\n          const locateCache = cache as LocateCache;\r\n          locateCache.cache = newRecord.cache;\r\n          if ('xpaths' in locateCache) {\r\n            locateCache.xpaths = undefined;\r\n          }\r\n        });\r\n      }\r\n    } else {\r\n      this.appendCache(newRecord);\r\n    }\r\n  }\r\n}\r\n","import {\r\n  ConversationHistory,\r\n  findAllMidsceneLocatorField,\r\n  parseActionParam,\r\n  plan,\r\n  uiTarsPlanning,\r\n} from '@/ai-model';\r\nimport { Executor } from '@/ai-model/action-executor';\r\nimport type { TMultimodalPrompt, TUserPrompt } from '@/ai-model/common';\r\nimport type { AbstractInterface } from '@/device';\r\nimport type Insight from '@/insight';\r\nimport type {\r\n  AIUsageInfo,\r\n  DetailedLocateParam,\r\n  DumpSubscriber,\r\n  ElementCacheFeature,\r\n  ExecutionRecorderItem,\r\n  ExecutionTaskActionApply,\r\n  ExecutionTaskApply,\r\n  ExecutionTaskHitBy,\r\n  ExecutionTaskInsightLocateApply,\r\n  ExecutionTaskInsightQueryApply,\r\n  ExecutionTaskPlanning,\r\n  ExecutionTaskPlanningApply,\r\n  ExecutionTaskProgressOptions,\r\n  ExecutorContext,\r\n  InsightDump,\r\n  InsightExtractOption,\r\n  InsightExtractParam,\r\n  InterfaceType,\r\n  LocateResultElement,\r\n  MidsceneYamlFlowItem,\r\n  PlanningAIResponse,\r\n  PlanningAction,\r\n  PlanningActionParamError,\r\n  PlanningActionParamSleep,\r\n  PlanningActionParamWaitFor,\r\n  PlanningLocateParam,\r\n} from '@/types';\r\nimport { sleep } from '@/utils';\r\nimport {\r\n  type IModelConfig,\r\n  SQAI_REPLANNING_CYCLE_LIMIT,\r\n  globalConfigManager,\r\n} from '@sqaitech/shared/env';\r\nimport { getDebug } from '@sqaitech/shared/logger';\r\nimport { assert } from '@sqaitech/shared/utils';\r\nimport type { TaskCache } from './task-cache';\r\nimport { taskTitleStr } from './ui-utils';\r\nimport {\r\n  matchElementFromCache,\r\n  matchElementFromPlan,\r\n  parsePrompt,\r\n} from './utils';\r\n\r\ninterface ExecutionResult<OutputType = any> {\r\n  output: OutputType;\r\n  thought?: string;\r\n  executor: Executor;\r\n}\r\n\r\nconst debug = getDebug('device-task-executor');\r\nconst defaultReplanningCycleLimit = 10;\r\nconst defaultVlmUiTarsReplanningCycleLimit = 40;\r\n\r\nexport function locatePlanForLocate(param: string | DetailedLocateParam) {\r\n  const locate = typeof param === 'string' ? { prompt: param } : param;\r\n  const locatePlan: PlanningAction<PlanningLocateParam> = {\r\n    type: 'Locate',\r\n    locate,\r\n    param: locate,\r\n    thought: '',\r\n  };\r\n  return locatePlan;\r\n}\r\n\r\nexport class TaskExecutor {\r\n  interface: AbstractInterface;\r\n\r\n  insight: Insight;\r\n\r\n  taskCache?: TaskCache;\r\n\r\n  private conversationHistory: ConversationHistory;\r\n\r\n  onTaskStartCallback?: ExecutionTaskProgressOptions['onTaskStart'];\r\n\r\n  replanningCycleLimit?: number;\r\n\r\n  // @deprecated use .interface instead\r\n  get page() {\r\n    return this.interface;\r\n  }\r\n\r\n  constructor(\r\n    interfaceInstance: AbstractInterface,\r\n    insight: Insight,\r\n    opts: {\r\n      taskCache?: TaskCache;\r\n      onTaskStart?: ExecutionTaskProgressOptions['onTaskStart'];\r\n      replanningCycleLimit?: number;\r\n    },\r\n  ) {\r\n    this.interface = interfaceInstance;\r\n    this.insight = insight;\r\n    this.taskCache = opts.taskCache;\r\n    this.onTaskStartCallback = opts?.onTaskStart;\r\n    this.replanningCycleLimit = opts.replanningCycleLimit;\r\n    this.conversationHistory = new ConversationHistory();\r\n  }\r\n\r\n  private async recordScreenshot(timing: ExecutionRecorderItem['timing']) {\r\n    const base64 = await this.interface.screenshotBase64();\r\n    const item: ExecutionRecorderItem = {\r\n      type: 'screenshot',\r\n      ts: Date.now(),\r\n      screenshot: base64,\r\n      timing,\r\n    };\r\n    return item;\r\n  }\r\n\r\n  private prependExecutorWithScreenshot(\r\n    taskApply: ExecutionTaskApply,\r\n    appendAfterExecution = false,\r\n  ): ExecutionTaskApply {\r\n    const taskWithScreenshot: ExecutionTaskApply = {\r\n      ...taskApply,\r\n      executor: async (param, context, ...args) => {\r\n        const recorder: ExecutionRecorderItem[] = [];\r\n        const { task } = context;\r\n        // set the recorder before executor in case of error\r\n        task.recorder = recorder;\r\n        const shot = await this.recordScreenshot(`before ${task.type}`);\r\n        recorder.push(shot);\r\n\r\n        const result = await taskApply.executor(param, context, ...args);\r\n\r\n        if (appendAfterExecution) {\r\n          const shot2 = await this.recordScreenshot('after Action');\r\n          recorder.push(shot2);\r\n        }\r\n        return result;\r\n      },\r\n    };\r\n    return taskWithScreenshot;\r\n  }\r\n\r\n  public async convertPlanToExecutable(\r\n    plans: PlanningAction[],\r\n    modelConfig: IModelConfig,\r\n    cacheable?: boolean,\r\n  ) {\r\n    const tasks: ExecutionTaskApply[] = [];\r\n\r\n    const taskForLocatePlan = (\r\n      plan: PlanningAction<PlanningLocateParam>,\r\n      detailedLocateParam: DetailedLocateParam | string,\r\n      onResult?: (result: LocateResultElement) => void,\r\n    ): ExecutionTaskInsightLocateApply => {\r\n      if (typeof detailedLocateParam === 'string') {\r\n        detailedLocateParam = {\r\n          prompt: detailedLocateParam,\r\n        };\r\n      }\r\n      // Apply cacheable option from convertPlanToExecutable if it was explicitly set\r\n      if (cacheable !== undefined) {\r\n        detailedLocateParam = {\r\n          ...detailedLocateParam,\r\n          cacheable,\r\n        };\r\n      }\r\n      const taskFind: ExecutionTaskInsightLocateApply = {\r\n        type: 'Insight',\r\n        subType: 'Locate',\r\n        param: detailedLocateParam,\r\n        thought: plan.thought,\r\n        executor: async (param, taskContext) => {\r\n          const { task } = taskContext;\r\n          assert(\r\n            param?.prompt || param?.id || param?.bbox,\r\n            `No prompt or id or position or bbox to locate, param=${JSON.stringify(\r\n              param,\r\n            )}`,\r\n          );\r\n          let insightDump: InsightDump | undefined;\r\n          let usage: AIUsageInfo | undefined;\r\n          const dumpCollector: DumpSubscriber = (dump) => {\r\n            insightDump = dump;\r\n            usage = dump?.taskInfo?.usage;\r\n\r\n            task.log = {\r\n              dump: insightDump,\r\n            };\r\n\r\n            task.usage = usage;\r\n\r\n            // Store searchAreaUsage in task metadata\r\n            if (dump?.taskInfo?.searchAreaUsage) {\r\n              task.searchAreaUsage = dump.taskInfo.searchAreaUsage;\r\n            }\r\n          };\r\n          this.insight.onceDumpUpdatedFn = dumpCollector;\r\n          const shotTime = Date.now();\r\n\r\n          // Get context through contextRetrieverFn which handles frozen context\r\n          const uiContext = await this.insight.contextRetrieverFn('locate');\r\n          task.uiContext = uiContext;\r\n\r\n          const recordItem: ExecutionRecorderItem = {\r\n            type: 'screenshot',\r\n            ts: shotTime,\r\n            screenshot: uiContext.screenshotBase64,\r\n            timing: 'before Insight',\r\n          };\r\n          task.recorder = [recordItem];\r\n\r\n          // try matching xpath\r\n          const elementFromXpath =\r\n            param.xpath && (this.interface as any).getElementInfoByXpath\r\n              ? await (this.interface as any).getElementInfoByXpath(param.xpath)\r\n              : undefined;\r\n          const userExpectedPathHitFlag = !!elementFromXpath;\r\n\r\n          // try matching cache\r\n          const cachePrompt = param.prompt;\r\n          const locateCacheRecord =\r\n            this.taskCache?.matchLocateCache(cachePrompt);\r\n          const cacheEntry = locateCacheRecord?.cacheContent?.cache;\r\n          const elementFromCache = userExpectedPathHitFlag\r\n            ? null\r\n            : await matchElementFromCache(\r\n                this,\r\n                cacheEntry,\r\n                cachePrompt,\r\n                param.cacheable,\r\n              );\r\n          const cacheHitFlag = !!elementFromCache;\r\n\r\n          // try matching plan\r\n          const elementFromPlan =\r\n            !userExpectedPathHitFlag && !cacheHitFlag\r\n              ? matchElementFromPlan(param, uiContext.tree)\r\n              : undefined;\r\n          const planHitFlag = !!elementFromPlan;\r\n\r\n          // try ai locate\r\n          const elementFromAiLocate =\r\n            !userExpectedPathHitFlag && !cacheHitFlag && !planHitFlag\r\n              ? (\r\n                  await this.insight.locate(\r\n                    param,\r\n                    {\r\n                      // fallback to ai locate\r\n                      context: uiContext,\r\n                    },\r\n                    modelConfig,\r\n                  )\r\n                ).element\r\n              : undefined;\r\n          const aiLocateHitFlag = !!elementFromAiLocate;\r\n\r\n          const element =\r\n            elementFromXpath || // highest priority\r\n            elementFromCache || // second priority\r\n            elementFromPlan || // third priority\r\n            elementFromAiLocate;\r\n\r\n          // update cache\r\n          let currentCacheEntry: ElementCacheFeature | undefined;\r\n          if (\r\n            element &&\r\n            this.taskCache &&\r\n            !cacheHitFlag &&\r\n            param?.cacheable !== false\r\n          ) {\r\n            if (this.interface.cacheFeatureForRect) {\r\n              try {\r\n                const feature = await this.interface.cacheFeatureForRect(\r\n                  element.rect,\r\n                  element.isOrderSensitive !== undefined\r\n                    ? { _orderSensitive: element.isOrderSensitive }\r\n                    : undefined,\r\n                );\r\n                if (feature && Object.keys(feature).length > 0) {\r\n                  debug(\r\n                    'update cache, prompt: %s, cache: %o',\r\n                    cachePrompt,\r\n                    feature,\r\n                  );\r\n                  currentCacheEntry = feature;\r\n                  this.taskCache.updateOrAppendCacheRecord(\r\n                    {\r\n                      type: 'locate',\r\n                      prompt: cachePrompt,\r\n                      cache: feature,\r\n                    },\r\n                    locateCacheRecord,\r\n                  );\r\n                } else {\r\n                  debug(\r\n                    'no cache data returned, skip cache update, prompt: %s',\r\n                    cachePrompt,\r\n                  );\r\n                }\r\n              } catch (error) {\r\n                debug('cacheFeatureForRect failed: %s', error);\r\n              }\r\n            } else {\r\n              debug('cacheFeatureForRect is not supported, skip cache update');\r\n            }\r\n          }\r\n          if (!element) {\r\n            throw new Error(`Element not found: ${param.prompt}`);\r\n          }\r\n\r\n          let hitBy: ExecutionTaskHitBy | undefined;\r\n\r\n          if (userExpectedPathHitFlag) {\r\n            hitBy = {\r\n              from: 'User expected path',\r\n              context: {\r\n                xpath: param.xpath,\r\n              },\r\n            };\r\n          } else if (cacheHitFlag) {\r\n            hitBy = {\r\n              from: 'Cache',\r\n              context: {\r\n                cacheEntry,\r\n                cacheToSave: currentCacheEntry,\r\n              },\r\n            };\r\n          } else if (planHitFlag) {\r\n            hitBy = {\r\n              from: 'Planning',\r\n              context: {\r\n                id: elementFromPlan?.id,\r\n                bbox: elementFromPlan?.bbox,\r\n              },\r\n            };\r\n          } else if (aiLocateHitFlag) {\r\n            hitBy = {\r\n              from: 'AI model',\r\n              context: {\r\n                prompt: param.prompt,\r\n              },\r\n            };\r\n          }\r\n\r\n          onResult?.(element);\r\n\r\n          return {\r\n            output: {\r\n              element,\r\n            },\r\n            uiContext,\r\n            hitBy,\r\n          };\r\n        },\r\n      };\r\n      return taskFind;\r\n    };\r\n\r\n    for (const plan of plans) {\r\n      if (plan.type === 'Locate') {\r\n        if (\r\n          !plan.locate ||\r\n          plan.locate === null ||\r\n          plan.locate?.id === null ||\r\n          plan.locate?.id === 'null'\r\n        ) {\r\n          debug('Locate action with id is null, will be ignored', plan);\r\n          continue;\r\n        }\r\n        const taskLocate = taskForLocatePlan(plan, plan.locate);\r\n\r\n        tasks.push(taskLocate);\r\n      } else if (plan.type === 'Error') {\r\n        const taskActionError: ExecutionTaskActionApply<PlanningActionParamError> =\r\n          {\r\n            type: 'Action',\r\n            subType: 'Error',\r\n            param: plan.param,\r\n            thought: plan.thought || plan.param?.thought,\r\n            locate: plan.locate,\r\n            executor: async () => {\r\n              throw new Error(\r\n                plan?.thought || plan.param?.thought || 'error without thought',\r\n              );\r\n            },\r\n          };\r\n        tasks.push(taskActionError);\r\n      } else if (plan.type === 'Finished') {\r\n        const taskActionFinished: ExecutionTaskActionApply<null> = {\r\n          type: 'Action',\r\n          subType: 'Finished',\r\n          param: null,\r\n          thought: plan.thought,\r\n          locate: plan.locate,\r\n          executor: async (param) => {},\r\n        };\r\n        tasks.push(taskActionFinished);\r\n      } else if (plan.type === 'Sleep') {\r\n        const taskActionSleep: ExecutionTaskActionApply<PlanningActionParamSleep> =\r\n          {\r\n            type: 'Action',\r\n            subType: 'Sleep',\r\n            param: plan.param,\r\n            thought: plan.thought,\r\n            locate: plan.locate,\r\n            executor: async (taskParam) => {\r\n              await sleep(taskParam?.timeMs || 3000);\r\n            },\r\n          };\r\n        tasks.push(taskActionSleep);\r\n      } else {\r\n        // action in action space\r\n        const planType = plan.type;\r\n        const actionSpace = await this.interface.actionSpace();\r\n        const action = actionSpace.find((action) => action.name === planType);\r\n        const param = plan.param;\r\n\r\n        if (!action) {\r\n          throw new Error(`Action type '${planType}' not found`);\r\n        }\r\n\r\n        // find all params that needs location\r\n        const locateFields = action\r\n          ? findAllMidsceneLocatorField(action.paramSchema)\r\n          : [];\r\n\r\n        const requiredLocateFields = action\r\n          ? findAllMidsceneLocatorField(action.paramSchema, true)\r\n          : [];\r\n\r\n        locateFields.forEach((field) => {\r\n          if (param[field]) {\r\n            const locatePlan = locatePlanForLocate(param[field]);\r\n            debug(\r\n              'will prepend locate param for field',\r\n              `action.type=${planType}`,\r\n              `param=${JSON.stringify(param[field])}`,\r\n              `locatePlan=${JSON.stringify(locatePlan)}`,\r\n            );\r\n            const locateTask = taskForLocatePlan(\r\n              locatePlan,\r\n              param[field],\r\n              (result) => {\r\n                param[field] = result;\r\n              },\r\n            );\r\n            tasks.push(locateTask);\r\n          } else {\r\n            assert(\r\n              !requiredLocateFields.includes(field),\r\n              `Required locate field '${field}' is not provided for action ${planType}`,\r\n            );\r\n            debug(`field '${field}' is not provided for action ${planType}`);\r\n          }\r\n        });\r\n\r\n        const task: ExecutionTaskApply<\r\n          'Action',\r\n          any,\r\n          { success: boolean; action: string; param: any },\r\n          void\r\n        > = {\r\n          type: 'Action',\r\n          subType: planType,\r\n          thought: plan.thought,\r\n          param: plan.param,\r\n          executor: async (param, context) => {\r\n            debug(\r\n              'executing action',\r\n              planType,\r\n              param,\r\n              `context.element.center: ${context.element?.center}`,\r\n            );\r\n\r\n            // Get context for actionSpace operations to ensure size info is available\r\n            const uiContext = await this.insight.contextRetrieverFn('locate');\r\n            context.task.uiContext = uiContext;\r\n\r\n            requiredLocateFields.forEach((field) => {\r\n              assert(\r\n                param[field],\r\n                `field '${field}' is required for action ${planType} but not provided. Cannot execute action ${planType}.`,\r\n              );\r\n            });\r\n\r\n            try {\r\n              await Promise.all([\r\n                (async () => {\r\n                  if (this.interface.beforeInvokeAction) {\r\n                    debug('will call \"beforeInvokeAction\" for interface');\r\n                    await this.interface.beforeInvokeAction(action.name, param);\r\n                    debug('called \"beforeInvokeAction\" for interface');\r\n                  }\r\n                })(),\r\n                sleep(200),\r\n              ]);\r\n            } catch (originalError: any) {\r\n              const originalMessage =\r\n                originalError?.message || String(originalError);\r\n              throw new Error(\r\n                `error in running beforeInvokeAction for ${action.name}: ${originalMessage}`,\r\n                { cause: originalError },\r\n              );\r\n            }\r\n\r\n            // Validate and parse parameters with defaults\r\n            if (action.paramSchema) {\r\n              try {\r\n                param = parseActionParam(param, action.paramSchema);\r\n              } catch (error: any) {\r\n                throw new Error(\r\n                  `Invalid parameters for action ${action.name}: ${error.message}\\nParameters: ${JSON.stringify(param)}`,\r\n                  { cause: error },\r\n                );\r\n              }\r\n            }\r\n\r\n            debug('calling action', action.name);\r\n            const actionFn = action.call.bind(this.interface);\r\n            await actionFn(param, context);\r\n            debug('called action', action.name);\r\n\r\n            await sleep(300); // wait for the action to complete\r\n\r\n            try {\r\n              if (this.interface.afterInvokeAction) {\r\n                debug('will call \"afterInvokeAction\" for interface');\r\n                await this.interface.afterInvokeAction(action.name, param);\r\n                debug('called \"afterInvokeAction\" for interface');\r\n              }\r\n            } catch (originalError: any) {\r\n              const originalMessage =\r\n                originalError?.message || String(originalError);\r\n              throw new Error(\r\n                `error in running afterInvokeAction for ${action.name}: ${originalMessage}`,\r\n                { cause: originalError },\r\n              );\r\n            }\r\n            // Return a proper result for report generation\r\n            return {\r\n              output: {\r\n                success: true,\r\n                action: planType,\r\n                param: param,\r\n              },\r\n            };\r\n          },\r\n        };\r\n        tasks.push(task);\r\n      }\r\n    }\r\n\r\n    const wrappedTasks = tasks.map(\r\n      (task: ExecutionTaskApply, index: number) => {\r\n        if (task.type === 'Action') {\r\n          return this.prependExecutorWithScreenshot(\r\n            task,\r\n            index === tasks.length - 1,\r\n          );\r\n        }\r\n        return task;\r\n      },\r\n    );\r\n\r\n    return {\r\n      tasks: wrappedTasks,\r\n    };\r\n  }\r\n\r\n  private async setupPlanningContext(executorContext: ExecutorContext) {\r\n    const shotTime = Date.now();\r\n    const uiContext = await this.insight.contextRetrieverFn('locate');\r\n    const recordItem: ExecutionRecorderItem = {\r\n      type: 'screenshot',\r\n      ts: shotTime,\r\n      screenshot: uiContext.screenshotBase64,\r\n      timing: 'before Planning',\r\n    };\r\n\r\n    executorContext.task.recorder = [recordItem];\r\n    (executorContext.task as ExecutionTaskPlanning).uiContext = uiContext;\r\n\r\n    return {\r\n      uiContext,\r\n    };\r\n  }\r\n\r\n  async loadYamlFlowAsPlanning(userInstruction: string, yamlString: string) {\r\n    const taskExecutor = new Executor(taskTitleStr('Action', userInstruction), {\r\n      onTaskStart: this.onTaskStartCallback,\r\n    });\r\n\r\n    const task: ExecutionTaskPlanningApply = {\r\n      type: 'Planning',\r\n      subType: 'LoadYaml',\r\n      locate: null,\r\n      param: {\r\n        userInstruction,\r\n      },\r\n      executor: async (param, executorContext) => {\r\n        await this.setupPlanningContext(executorContext);\r\n        return {\r\n          output: {\r\n            actions: [],\r\n            more_actions_needed_by_instruction: false,\r\n            log: '',\r\n            yamlString,\r\n          },\r\n          cache: {\r\n            hit: true,\r\n          },\r\n          hitBy: {\r\n            from: 'Cache',\r\n            context: {\r\n              yamlString,\r\n            },\r\n          },\r\n        };\r\n      },\r\n    };\r\n\r\n    await taskExecutor.append(task);\r\n    await taskExecutor.flush();\r\n\r\n    return {\r\n      executor: taskExecutor,\r\n    };\r\n  }\r\n\r\n  private createPlanningTask(\r\n    userInstruction: string,\r\n    actionContext: string | undefined,\r\n    modelConfig: IModelConfig,\r\n  ): ExecutionTaskPlanningApply {\r\n    const task: ExecutionTaskPlanningApply = {\r\n      type: 'Planning',\r\n      subType: 'Plan',\r\n      locate: null,\r\n      param: {\r\n        userInstruction,\r\n      },\r\n      executor: async (param, executorContext) => {\r\n        const startTime = Date.now();\r\n        const { uiContext } = await this.setupPlanningContext(executorContext);\r\n        const { vlMode } = modelConfig;\r\n        const uiTarsModelVersion =\r\n          vlMode === 'vlm-ui-tars' ? modelConfig.uiTarsModelVersion : undefined;\r\n\r\n        assert(\r\n          this.interface.actionSpace,\r\n          'actionSpace for device is not implemented',\r\n        );\r\n        const actionSpace = await this.interface.actionSpace();\r\n        debug(\r\n          'actionSpace for this interface is:',\r\n          actionSpace.map((action) => action.name).join(', '),\r\n        );\r\n        assert(Array.isArray(actionSpace), 'actionSpace must be an array');\r\n        if (actionSpace.length === 0) {\r\n          console.warn(\r\n            `ActionSpace for ${this.interface.interfaceType} is empty. This may lead to unexpected behavior.`,\r\n          );\r\n        }\r\n\r\n        const planResult = await (uiTarsModelVersion ? uiTarsPlanning : plan)(\r\n          param.userInstruction,\r\n          {\r\n            context: uiContext,\r\n            actionContext,\r\n            interfaceType: this.interface.interfaceType as InterfaceType,\r\n            actionSpace,\r\n            modelConfig,\r\n            conversationHistory: this.conversationHistory,\r\n          },\r\n        );\r\n        debug('planResult', JSON.stringify(planResult, null, 2));\r\n\r\n        const {\r\n          actions,\r\n          log,\r\n          more_actions_needed_by_instruction,\r\n          error,\r\n          usage,\r\n          rawResponse,\r\n          sleep,\r\n        } = planResult;\r\n\r\n        executorContext.task.log = {\r\n          ...(executorContext.task.log || {}),\r\n          rawResponse,\r\n        };\r\n        executorContext.task.usage = usage;\r\n\r\n        const finalActions = actions || [];\r\n\r\n        if (sleep) {\r\n          const timeNow = Date.now();\r\n          const timeRemaining = sleep - (timeNow - startTime);\r\n          if (timeRemaining > 0) {\r\n            finalActions.push({\r\n              type: 'Sleep',\r\n              param: {\r\n                timeMs: timeRemaining,\r\n              },\r\n              locate: null,\r\n            } as PlanningAction<PlanningActionParamSleep>);\r\n          }\r\n        }\r\n\r\n        if (finalActions.length === 0) {\r\n          assert(\r\n            !more_actions_needed_by_instruction || sleep,\r\n            error ? `Failed to plan: ${error}` : 'No plan found',\r\n          );\r\n        }\r\n\r\n        return {\r\n          output: {\r\n            actions: finalActions,\r\n            more_actions_needed_by_instruction,\r\n            log,\r\n            yamlFlow: planResult.yamlFlow,\r\n          },\r\n          cache: {\r\n            hit: false,\r\n          },\r\n          uiContext,\r\n        };\r\n      },\r\n    };\r\n\r\n    return task;\r\n  }\r\n\r\n  async runPlans(\r\n    title: string,\r\n    plans: PlanningAction[],\r\n    modelConfig: IModelConfig,\r\n  ): Promise<ExecutionResult> {\r\n    const taskExecutor = new Executor(title, {\r\n      onTaskStart: this.onTaskStartCallback,\r\n    });\r\n    const { tasks } = await this.convertPlanToExecutable(plans, modelConfig);\r\n    await taskExecutor.append(tasks);\r\n    const result = await taskExecutor.flush();\r\n    const { output } = result!;\r\n    return {\r\n      output,\r\n      executor: taskExecutor,\r\n    };\r\n  }\r\n\r\n  private getReplanningCycleLimit(isVlmUiTars: boolean) {\r\n    return (\r\n      this.replanningCycleLimit ||\r\n      globalConfigManager.getEnvConfigInNumber(\r\n        SQAI_REPLANNING_CYCLE_LIMIT,\r\n      ) ||\r\n      (isVlmUiTars\r\n        ? defaultVlmUiTarsReplanningCycleLimit\r\n        : defaultReplanningCycleLimit)\r\n    );\r\n  }\r\n\r\n  async action(\r\n    userPrompt: string,\r\n    modelConfig: IModelConfig,\r\n    actionContext?: string,\r\n    cacheable?: boolean,\r\n  ): Promise<\r\n    ExecutionResult<\r\n      | {\r\n          yamlFlow?: MidsceneYamlFlowItem[]; // for cache use\r\n        }\r\n      | undefined\r\n    >\r\n  > {\r\n    this.conversationHistory.reset();\r\n\r\n    const taskExecutor = new Executor(taskTitleStr('Action', userPrompt), {\r\n      onTaskStart: this.onTaskStartCallback,\r\n    });\r\n\r\n    let replanCount = 0;\r\n    const yamlFlow: MidsceneYamlFlowItem[] = [];\r\n    const replanningCycleLimit = this.getReplanningCycleLimit(\r\n      modelConfig.vlMode === 'vlm-ui-tars',\r\n    );\r\n\r\n    // Main planning loop - unified plan/replan logic\r\n    while (true) {\r\n      if (replanCount > replanningCycleLimit) {\r\n        const errorMsg = `Replanning ${replanningCycleLimit} times, which is more than the limit, please split the task into multiple steps`;\r\n\r\n        return this.appendErrorPlan(taskExecutor, errorMsg, modelConfig);\r\n      }\r\n\r\n      // Create planning task (automatically includes execution history if available)\r\n      const planningTask = this.createPlanningTask(\r\n        userPrompt,\r\n        actionContext,\r\n        modelConfig,\r\n      );\r\n\r\n      await taskExecutor.append(planningTask);\r\n      const result = await taskExecutor.flush();\r\n      const planResult: PlanningAIResponse = result?.output;\r\n      if (taskExecutor.isInErrorState()) {\r\n        return {\r\n          output: planResult,\r\n          executor: taskExecutor,\r\n        };\r\n      }\r\n\r\n      // Execute planned actions\r\n      const plans = planResult.actions || [];\r\n      yamlFlow.push(...(planResult.yamlFlow || []));\r\n\r\n      let executables: Awaited<ReturnType<typeof this.convertPlanToExecutable>>;\r\n      try {\r\n        executables = await this.convertPlanToExecutable(\r\n          plans,\r\n          modelConfig,\r\n          cacheable,\r\n        );\r\n        taskExecutor.append(executables.tasks);\r\n      } catch (error) {\r\n        return this.appendErrorPlan(\r\n          taskExecutor,\r\n          `Error converting plans to executable tasks: ${error}, plans: ${JSON.stringify(\r\n            plans,\r\n          )}`,\r\n          modelConfig,\r\n        );\r\n      }\r\n\r\n      await taskExecutor.flush();\r\n      if (taskExecutor.isInErrorState()) {\r\n        return {\r\n          output: undefined,\r\n          executor: taskExecutor,\r\n        };\r\n      }\r\n\r\n      // Check if task is complete\r\n      if (!planResult.more_actions_needed_by_instruction) {\r\n        break;\r\n      }\r\n\r\n      // Increment replan count for next iteration\r\n      replanCount++;\r\n    }\r\n\r\n    return {\r\n      output: {\r\n        yamlFlow,\r\n      },\r\n      executor: taskExecutor,\r\n    };\r\n  }\r\n\r\n  private createTypeQueryTask(\r\n    type: 'Query' | 'Boolean' | 'Number' | 'String' | 'Assert' | 'WaitFor',\r\n    demand: InsightExtractParam,\r\n    modelConfig: IModelConfig,\r\n    opt?: InsightExtractOption,\r\n    multimodalPrompt?: TMultimodalPrompt,\r\n  ) {\r\n    const queryTask: ExecutionTaskInsightQueryApply = {\r\n      type: 'Insight',\r\n      subType: type,\r\n      locate: null,\r\n      param: {\r\n        dataDemand: multimodalPrompt\r\n          ? ({\r\n              demand,\r\n              multimodalPrompt,\r\n            } as never)\r\n          : demand, // for user param presentation in report right sidebar\r\n      },\r\n      executor: async (param, taskContext) => {\r\n        const { task } = taskContext;\r\n        let insightDump: InsightDump | undefined;\r\n        const dumpCollector: DumpSubscriber = (dump) => {\r\n          insightDump = dump;\r\n        };\r\n        this.insight.onceDumpUpdatedFn = dumpCollector;\r\n\r\n        // Get context for query operations\r\n        const shotTime = Date.now();\r\n        const uiContext = await this.insight.contextRetrieverFn('extract');\r\n        task.uiContext = uiContext;\r\n\r\n        const recordItem: ExecutionRecorderItem = {\r\n          type: 'screenshot',\r\n          ts: shotTime,\r\n          screenshot: uiContext.screenshotBase64,\r\n          timing: 'before Extract',\r\n        };\r\n        task.recorder = [recordItem];\r\n\r\n        const ifTypeRestricted = type !== 'Query';\r\n        let demandInput = demand;\r\n        let keyOfResult = 'result';\r\n        if (ifTypeRestricted && (type === 'Assert' || type === 'WaitFor')) {\r\n          keyOfResult = 'StatementIsTruthy';\r\n          const booleanPrompt =\r\n            type === 'Assert'\r\n              ? `Boolean, whether the following statement is true: ${demand}`\r\n              : `Boolean, the user wants to do some 'wait for' operation, please check whether the following statement is true: ${demand}`;\r\n          demandInput = {\r\n            [keyOfResult]: booleanPrompt,\r\n          };\r\n        } else if (ifTypeRestricted) {\r\n          demandInput = {\r\n            [keyOfResult]: `${type}, ${demand}`,\r\n          };\r\n        }\r\n\r\n        const { data, usage, thought } = await this.insight.extract<any>(\r\n          demandInput,\r\n          modelConfig,\r\n          opt,\r\n          multimodalPrompt,\r\n        );\r\n\r\n        let outputResult = data;\r\n        if (ifTypeRestricted) {\r\n          // If AI returned a plain string instead of structured format, use it directly\r\n          if (typeof data === 'string') {\r\n            outputResult = data;\r\n          } else if (type === 'WaitFor') {\r\n            if (data === null || data === undefined) {\r\n              outputResult = false;\r\n            } else {\r\n              outputResult = (data as any)[keyOfResult];\r\n            }\r\n          } else if (data === null || data === undefined) {\r\n            outputResult = null;\r\n          } else {\r\n            assert(\r\n              data?.[keyOfResult] !== undefined,\r\n              'No result in query data',\r\n            );\r\n            outputResult = (data as any)[keyOfResult];\r\n          }\r\n        }\r\n\r\n        if (type === 'Assert' && !outputResult) {\r\n          task.usage = usage;\r\n          task.thought = thought;\r\n          throw new Error(`Assertion failed: ${thought}`);\r\n        }\r\n\r\n        return {\r\n          output: outputResult,\r\n          log: insightDump,\r\n          usage,\r\n          thought,\r\n        };\r\n      },\r\n    };\r\n\r\n    return queryTask;\r\n  }\r\n  async createTypeQueryExecution<T>(\r\n    type: 'Query' | 'Boolean' | 'Number' | 'String' | 'Assert',\r\n    demand: InsightExtractParam,\r\n    modelConfig: IModelConfig,\r\n    opt?: InsightExtractOption,\r\n    multimodalPrompt?: TMultimodalPrompt,\r\n  ): Promise<ExecutionResult<T>> {\r\n    const taskExecutor = new Executor(\r\n      taskTitleStr(\r\n        type,\r\n        typeof demand === 'string' ? demand : JSON.stringify(demand),\r\n      ),\r\n      {\r\n        onTaskStart: this.onTaskStartCallback,\r\n      },\r\n    );\r\n\r\n    const queryTask = await this.createTypeQueryTask(\r\n      type,\r\n      demand,\r\n      modelConfig,\r\n      opt,\r\n      multimodalPrompt,\r\n    );\r\n\r\n    await taskExecutor.append(this.prependExecutorWithScreenshot(queryTask));\r\n    const result = await taskExecutor.flush();\r\n\r\n    if (!result) {\r\n      throw new Error(\r\n        'result of taskExecutor.flush() is undefined in function createTypeQueryTask',\r\n      );\r\n    }\r\n\r\n    const { output, thought } = result;\r\n\r\n    return {\r\n      output,\r\n      thought,\r\n      executor: taskExecutor,\r\n    };\r\n  }\r\n\r\n  private async appendErrorPlan(\r\n    taskExecutor: Executor,\r\n    errorMsg: string,\r\n    modelConfig: IModelConfig,\r\n  ) {\r\n    const errorPlan: PlanningAction<PlanningActionParamError> = {\r\n      type: 'Error',\r\n      param: {\r\n        thought: errorMsg,\r\n      },\r\n      locate: null,\r\n    };\r\n    const { tasks } = await this.convertPlanToExecutable(\r\n      [errorPlan],\r\n      modelConfig,\r\n    );\r\n    await taskExecutor.append(this.prependExecutorWithScreenshot(tasks[0]));\r\n    await taskExecutor.flush();\r\n\r\n    return {\r\n      output: undefined,\r\n      executor: taskExecutor,\r\n    };\r\n  }\r\n\r\n  async taskForSleep(timeMs: number, modelConfig: IModelConfig) {\r\n    const sleepPlan: PlanningAction<PlanningActionParamSleep> = {\r\n      type: 'Sleep',\r\n      param: {\r\n        timeMs,\r\n      },\r\n      locate: null,\r\n    };\r\n    // The convertPlanToExecutable requires modelConfig as a parameter but will not consume it when type is Sleep\r\n    const { tasks: sleepTasks } = await this.convertPlanToExecutable(\r\n      [sleepPlan],\r\n      modelConfig,\r\n    );\r\n\r\n    return this.prependExecutorWithScreenshot(sleepTasks[0]);\r\n  }\r\n\r\n  async waitFor(\r\n    assertion: TUserPrompt,\r\n    opt: PlanningActionParamWaitFor,\r\n    modelConfig: IModelConfig,\r\n  ): Promise<ExecutionResult<void>> {\r\n    const { textPrompt, multimodalPrompt } = parsePrompt(assertion);\r\n\r\n    const description = `waitFor: ${textPrompt}`;\r\n    const taskExecutor = new Executor(taskTitleStr('WaitFor', description), {\r\n      onTaskStart: this.onTaskStartCallback,\r\n    });\r\n    const { timeoutMs, checkIntervalMs } = opt;\r\n\r\n    assert(assertion, 'No assertion for waitFor');\r\n    assert(timeoutMs, 'No timeoutMs for waitFor');\r\n    assert(checkIntervalMs, 'No checkIntervalMs for waitFor');\r\n\r\n    assert(\r\n      checkIntervalMs <= timeoutMs,\r\n      `wrong config for waitFor: checkIntervalMs must be less than timeoutMs, config: {checkIntervalMs: ${checkIntervalMs}, timeoutMs: ${timeoutMs}}`,\r\n    );\r\n\r\n    const overallStartTime = Date.now();\r\n    let startTime = Date.now();\r\n    let errorThought = '';\r\n    while (Date.now() - overallStartTime < timeoutMs) {\r\n      startTime = Date.now();\r\n      const queryTask = await this.createTypeQueryTask(\r\n        'WaitFor',\r\n        textPrompt,\r\n        modelConfig,\r\n        {\r\n          doNotThrowError: true,\r\n        },\r\n        multimodalPrompt,\r\n      );\r\n\r\n      await taskExecutor.append(this.prependExecutorWithScreenshot(queryTask));\r\n      const result = (await taskExecutor.flush()) as\r\n        | {\r\n            output: boolean;\r\n            thought?: string;\r\n          }\r\n        | undefined;\r\n\r\n      if (result?.output) {\r\n        return {\r\n          output: undefined,\r\n          executor: taskExecutor,\r\n        };\r\n      }\r\n\r\n      errorThought =\r\n        result?.thought ||\r\n        (!result && `No result from assertion: ${textPrompt}`) ||\r\n        `unknown error when waiting for assertion: ${textPrompt}`;\r\n      const now = Date.now();\r\n      if (now - startTime < checkIntervalMs) {\r\n        const timeRemaining = checkIntervalMs - (now - startTime);\r\n        const sleepTask = await this.taskForSleep(timeRemaining, modelConfig);\r\n        await taskExecutor.append(sleepTask);\r\n      }\r\n    }\r\n\r\n    return this.appendErrorPlan(\r\n      taskExecutor,\r\n      `waitFor timeout: ${errorThought}`,\r\n      modelConfig,\r\n    );\r\n  }\r\n}\r\n","import {\r\n  type AgentAssertOpt,\r\n  type AgentDescribeElementAtPointResult,\r\n  type AgentOpt,\r\n  type AgentWaitForOpt,\r\n  type CacheConfig,\r\n  type DeviceAction,\r\n  type ExecutionDump,\r\n  type ExecutionRecorderItem,\r\n  type ExecutionTask,\r\n  type ExecutionTaskLog,\r\n  type Executor,\r\n  type GroupedActionDump,\r\n  Insight,\r\n  type InsightAction,\r\n  type InsightExtractOption,\r\n  type InsightExtractParam,\r\n  type LocateOption,\r\n  type LocateResultElement,\r\n  type LocateValidatorResult,\r\n  type LocatorValidatorOption,\r\n  type MidsceneYamlScript,\r\n  type OnTaskStartTip,\r\n  type PlanningAction,\r\n  type Rect,\r\n  type ScrollParam,\r\n  type TUserPrompt,\r\n  type UIContext,\r\n} from '../index';\r\nexport type TestStatus =\r\n  | 'passed'\r\n  | 'failed'\r\n  | 'timedOut'\r\n  | 'skipped'\r\n  | 'interrupted';\r\nimport yaml from 'js-yaml';\r\n\r\nimport {\r\n  getVersion,\r\n  groupedActionDumpFileExt,\r\n  processCacheConfig,\r\n  reportHTMLContent,\r\n  stringifyDumpData,\r\n  writeLogFile,\r\n} from '@/utils';\r\nimport {\r\n  ScriptPlayer,\r\n  buildDetailedLocateParam,\r\n  parseYamlScript,\r\n} from '../yaml/index';\r\n\r\nimport type { AbstractInterface } from '@/device';\r\nimport {\r\n  ModelConfigManager,\r\n  globalModelConfigManager,\r\n} from '@sqaitech/shared/env';\r\nimport { imageInfoOfBase64, resizeImgBase64 } from '@sqaitech/shared/img';\r\nimport { getDebug } from '@sqaitech/shared/logger';\r\nimport { assert } from '@sqaitech/shared/utils';\r\n// import type { AndroidDeviceInputOpt } from '../device';\r\nimport { TaskCache } from './task-cache';\r\nimport { TaskExecutor, locatePlanForLocate } from './tasks';\r\nimport { locateParamStr, paramStr, taskTitleStr, typeStr } from './ui-utils';\r\nimport {\r\n  commonContextParser,\r\n  getReportFileName,\r\n  parsePrompt,\r\n  printReportMsg,\r\n} from './utils';\r\nimport { trimContextByViewport } from './utils';\r\n\r\nconst debug = getDebug('agent');\r\n\r\nconst distanceOfTwoPoints = (p1: [number, number], p2: [number, number]) => {\r\n  const [x1, y1] = p1;\r\n  const [x2, y2] = p2;\r\n  return Math.round(Math.sqrt((x1 - x2) ** 2 + (y1 - y2) ** 2));\r\n};\r\n\r\nconst includedInRect = (point: [number, number], rect: Rect) => {\r\n  const [x, y] = point;\r\n  const { left, top, width, height } = rect;\r\n  return x >= left && x <= left + width && y >= top && y <= top + height;\r\n};\r\n\r\nconst defaultInsightExtractOption: InsightExtractOption = {\r\n  domIncluded: false,\r\n  screenshotIncluded: true,\r\n};\r\n\r\ntype CacheStrategy = NonNullable<CacheConfig['strategy']>;\r\n\r\nconst CACHE_STRATEGIES: readonly CacheStrategy[] = [\r\n  'read-only',\r\n  'read-write',\r\n  'write-only',\r\n];\r\n\r\nconst isValidCacheStrategy = (strategy: string): strategy is CacheStrategy =>\r\n  CACHE_STRATEGIES.some((value) => value === strategy);\r\n\r\nconst CACHE_STRATEGY_VALUES = CACHE_STRATEGIES.map(\r\n  (value) => `\"${value}\"`,\r\n).join(', ');\r\n\r\nexport class Agent<\r\n  InterfaceType extends AbstractInterface = AbstractInterface,\r\n> {\r\n  interface: InterfaceType;\r\n\r\n  insight: Insight;\r\n\r\n  dump: GroupedActionDump;\r\n\r\n  reportFile?: string | null;\r\n\r\n  reportFileName?: string;\r\n\r\n  taskExecutor: TaskExecutor;\r\n\r\n  opts: AgentOpt;\r\n\r\n  /**\r\n   * If true, the agent will not perform any actions\r\n   */\r\n  dryMode = false;\r\n\r\n  onTaskStartTip?: OnTaskStartTip;\r\n\r\n  taskCache?: TaskCache;\r\n\r\n  onDumpUpdate?: (dump: string) => void;\r\n\r\n  destroyed = false;\r\n\r\n  modelConfigManager: ModelConfigManager;\r\n\r\n  /**\r\n   * Frozen page context for consistent AI operations\r\n   */\r\n  private frozenUIContext?: UIContext;\r\n\r\n  /**\r\n   * Flag to track if VL model warning has been shown\r\n   */\r\n  private hasWarnedNonVLModel = false;\r\n\r\n  /**\r\n   * Screenshot scale factor derived from actual screenshot dimensions\r\n   */\r\n  private screenshotScale?: number;\r\n\r\n  /**\r\n   * Internal promise to deduplicate screenshot scale computation\r\n   */\r\n  private screenshotScalePromise?: Promise<number>;\r\n\r\n  // @deprecated use .interface instead\r\n  get page() {\r\n    return this.interface;\r\n  }\r\n\r\n  /**\r\n   * Ensures VL model warning is shown once when needed\r\n   */\r\n  private ensureVLModelWarning() {\r\n    if (\r\n      !this.hasWarnedNonVLModel &&\r\n      this.interface.interfaceType !== 'puppeteer' &&\r\n      this.interface.interfaceType !== 'playwright' &&\r\n      this.interface.interfaceType !== 'static' &&\r\n      this.interface.interfaceType !== 'chrome-extension-proxy' &&\r\n      this.interface.interfaceType !== 'page-over-chrome-extension-bridge'\r\n    ) {\r\n      this.modelConfigManager.throwErrorIfNonVLModel();\r\n      this.hasWarnedNonVLModel = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Lazily compute the ratio between the physical screenshot width and the logical page width\r\n   */\r\n  private async getScreenshotScale(context: UIContext): Promise<number> {\r\n    if (this.screenshotScale !== undefined) {\r\n      return this.screenshotScale;\r\n    }\r\n\r\n    if (!this.screenshotScalePromise) {\r\n      this.screenshotScalePromise = (async () => {\r\n        const pageWidth = context.size?.width;\r\n        assert(\r\n          pageWidth && pageWidth > 0,\r\n          `Invalid page width when computing screenshot scale: ${pageWidth}`,\r\n        );\r\n\r\n        const { width: screenshotWidth } = await imageInfoOfBase64(\r\n          context.screenshotBase64,\r\n        );\r\n\r\n        assert(\r\n          Number.isFinite(screenshotWidth) && screenshotWidth > 0,\r\n          `Invalid screenshot width when computing screenshot scale: ${screenshotWidth}`,\r\n        );\r\n\r\n        const computedScale = screenshotWidth / pageWidth;\r\n        assert(\r\n          Number.isFinite(computedScale) && computedScale > 0,\r\n          `Invalid computed screenshot scale: ${computedScale}`,\r\n        );\r\n\r\n        debug(\r\n          `Computed screenshot scale ${computedScale} from screenshot width ${screenshotWidth} and page width ${pageWidth}`,\r\n        );\r\n        return computedScale;\r\n      })();\r\n    }\r\n\r\n    try {\r\n      this.screenshotScale = await this.screenshotScalePromise;\r\n      return this.screenshotScale;\r\n    } finally {\r\n      this.screenshotScalePromise = undefined;\r\n    }\r\n  }\r\n\r\n  constructor(interfaceInstance: InterfaceType, opts?: AgentOpt) {\r\n    this.interface = interfaceInstance;\r\n    this.opts = Object.assign(\r\n      {\r\n        generateReport: true,\r\n        autoPrintReportMsg: true,\r\n        groupName: 'SQAI Report',\r\n        groupDescription: '',\r\n      },\r\n      opts || {},\r\n    );\r\n\r\n    if (opts?.modelConfig && typeof opts?.modelConfig !== 'function') {\r\n      throw new Error(\r\n        `opts.modelConfig must be one of function or undefined, but got ${typeof opts?.modelConfig}`,\r\n      );\r\n    }\r\n    this.modelConfigManager = opts?.modelConfig\r\n      ? new ModelConfigManager(opts.modelConfig)\r\n      : globalModelConfigManager;\r\n\r\n    this.onTaskStartTip = this.opts.onTaskStartTip;\r\n\r\n    this.insight = new Insight(async (action: InsightAction) => {\r\n      return this.getUIContext(action);\r\n    });\r\n\r\n    // Process cache configuration\r\n    const cacheConfigObj = this.processCacheConfig(opts || {});\r\n    if (cacheConfigObj) {\r\n      this.taskCache = new TaskCache(\r\n        cacheConfigObj.id,\r\n        cacheConfigObj.enabled,\r\n        undefined, // cacheFilePath\r\n        {\r\n          readOnly: cacheConfigObj.readOnly,\r\n          writeOnly: cacheConfigObj.writeOnly,\r\n        },\r\n      );\r\n    }\r\n\r\n    this.taskExecutor = new TaskExecutor(this.interface, this.insight, {\r\n      taskCache: this.taskCache,\r\n      onTaskStart: this.callbackOnTaskStartTip.bind(this),\r\n      replanningCycleLimit: this.opts.replanningCycleLimit,\r\n    });\r\n    this.dump = this.resetDump();\r\n    this.reportFileName =\r\n      opts?.reportFileName ||\r\n      getReportFileName(opts?.testId || this.interface.interfaceType || 'web');\r\n  }\r\n\r\n  async getActionSpace(): Promise<DeviceAction[]> {\r\n    return this.interface.actionSpace();\r\n  }\r\n\r\n  async getUIContext(action?: InsightAction): Promise<UIContext> {\r\n    // Check VL model configuration when UI context is first needed\r\n    this.ensureVLModelWarning();\r\n\r\n    // If page context is frozen, return the frozen context for all actions\r\n    if (this.frozenUIContext) {\r\n      debug('Using frozen page context for action:', action);\r\n      return this.frozenUIContext;\r\n    }\r\n\r\n    // Get original context\r\n    let context: UIContext;\r\n    if (this.interface.getContext) {\r\n      debug('Using page.getContext for action:', action);\r\n      context = await this.interface.getContext();\r\n    } else {\r\n      debug('Using commonContextParser for action:', action);\r\n      context = await commonContextParser(this.interface, {\r\n        uploadServerUrl: this.modelConfigManager.getUploadTestServerUrl(),\r\n      });\r\n    }\r\n\r\n    const computedScreenshotScale = await this.getScreenshotScale(context);\r\n\r\n    if (computedScreenshotScale !== 1) {\r\n      const scaleForLog = Number.parseFloat(computedScreenshotScale.toFixed(4));\r\n      debug(\r\n        `Applying computed screenshot scale: ${scaleForLog} (resize to logical size)`,\r\n      );\r\n      const targetWidth = Math.round(context.size.width);\r\n      const targetHeight = Math.round(context.size.height);\r\n      debug(`Resizing screenshot to ${targetWidth}x${targetHeight}`);\r\n      context.screenshotBase64 = await resizeImgBase64(\r\n        context.screenshotBase64,\r\n        { width: targetWidth, height: targetHeight },\r\n      );\r\n    } else {\r\n      debug(`screenshot scale=${computedScreenshotScale}`);\r\n    }\r\n\r\n    return context;\r\n  }\r\n\r\n  async _snapshotContext(): Promise<UIContext> {\r\n    return await this.getUIContext('locate');\r\n  }\r\n\r\n  async setAIActionContext(prompt: string) {\r\n    if (this.opts.aiActionContext) {\r\n      console.warn(\r\n        'aiActionContext is already set, and it is called again, will override the previous setting',\r\n      );\r\n    }\r\n    this.opts.aiActionContext = prompt;\r\n  }\r\n\r\n  resetDump() {\r\n    this.dump = {\r\n      sdkVersion: getVersion(),\r\n      groupName: this.opts.groupName!,\r\n      groupDescription: this.opts.groupDescription,\r\n      executions: [],\r\n      modelBriefs: [],\r\n    };\r\n\r\n    return this.dump;\r\n  }\r\n\r\n  appendExecutionDump(execution: ExecutionDump) {\r\n    // use trimContextByViewport to process execution\r\n    const trimmedExecution = trimContextByViewport(execution);\r\n    const currentDump = this.dump;\r\n    currentDump.executions.push(trimmedExecution);\r\n  }\r\n\r\n  dumpDataString() {\r\n    // update dump info\r\n    this.dump.groupName = this.opts.groupName!;\r\n    this.dump.groupDescription = this.opts.groupDescription;\r\n    return stringifyDumpData(this.dump);\r\n  }\r\n\r\n  reportHTMLString() {\r\n    return reportHTMLContent(this.dumpDataString());\r\n  }\r\n\r\n  writeOutActionDumps() {\r\n    if (this.destroyed) {\r\n      throw new Error(\r\n        'PageAgent has been destroyed. Cannot update report file.',\r\n      );\r\n    }\r\n    const { generateReport, autoPrintReportMsg } = this.opts;\r\n    this.reportFile = writeLogFile({\r\n      fileName: this.reportFileName!,\r\n      fileExt: groupedActionDumpFileExt,\r\n      fileContent: this.dumpDataString(),\r\n      type: 'dump',\r\n      generateReport,\r\n    });\r\n    debug('writeOutActionDumps', this.reportFile);\r\n    if (generateReport && autoPrintReportMsg && this.reportFile) {\r\n      printReportMsg(this.reportFile);\r\n    }\r\n  }\r\n\r\n  private async callbackOnTaskStartTip(task: ExecutionTask) {\r\n    const param = paramStr(task);\r\n    const tip = param ? `${typeStr(task)} - ${param}` : typeStr(task);\r\n\r\n    if (this.onTaskStartTip) {\r\n      await this.onTaskStartTip(tip);\r\n    }\r\n  }\r\n\r\n  private async afterTaskRunning(executor: Executor, doNotThrowError = false) {\r\n    const executionDump = executor.dump();\r\n    if (this.opts.aiActionContext) {\r\n      executionDump.aiActionContext = this.opts.aiActionContext;\r\n    }\r\n    this.appendExecutionDump(executionDump);\r\n\r\n    try {\r\n      if (this.onDumpUpdate) {\r\n        this.onDumpUpdate(this.dumpDataString());\r\n      }\r\n    } catch (error) {\r\n      console.error('Error in onDumpUpdate', error);\r\n    }\r\n\r\n    this.writeOutActionDumps();\r\n\r\n    if (executor.isInErrorState() && !doNotThrowError) {\r\n      const errorTask = executor.latestErrorTask();\r\n      throw new Error(`${errorTask?.errorMessage}\\n${errorTask?.errorStack}`, {\r\n        cause: errorTask?.error,\r\n      });\r\n    }\r\n  }\r\n\r\n  async callActionInActionSpace<T = any>(\r\n    type: string,\r\n    opt?: T, // and all other action params\r\n  ) {\r\n    debug('callActionInActionSpace', type, ',', opt);\r\n\r\n    const actionPlan: PlanningAction<T> = {\r\n      type: type as any,\r\n      param: (opt as any) || {},\r\n      thought: '',\r\n    };\r\n    debug('actionPlan', actionPlan); // , ', in which the locateParam is', locateParam);\r\n\r\n    const plans: PlanningAction[] = [actionPlan].filter(\r\n      Boolean,\r\n    ) as PlanningAction[];\r\n\r\n    const title = taskTitleStr(\r\n      type as any,\r\n      locateParamStr((opt as any)?.locate || {}),\r\n    );\r\n\r\n    // assume all operation in action space is related to locating\r\n    const modelConfig = this.modelConfigManager.getModelConfig('grounding');\r\n\r\n    const { output, executor } = await this.taskExecutor.runPlans(\r\n      title,\r\n      plans,\r\n      modelConfig,\r\n    );\r\n    await this.afterTaskRunning(executor);\r\n    return output;\r\n  }\r\n\r\n  async aiTap(locatePrompt: TUserPrompt, opt?: LocateOption) {\r\n    assert(locatePrompt, 'missing locate prompt for tap');\r\n\r\n    const detailedLocateParam = buildDetailedLocateParam(locatePrompt, opt);\r\n\r\n    return this.callActionInActionSpace('Tap', {\r\n      locate: detailedLocateParam,\r\n    });\r\n  }\r\n\r\n  async aiRightClick(locatePrompt: TUserPrompt, opt?: LocateOption) {\r\n    assert(locatePrompt, 'missing locate prompt for right click');\r\n\r\n    const detailedLocateParam = buildDetailedLocateParam(locatePrompt, opt);\r\n\r\n    return this.callActionInActionSpace('RightClick', {\r\n      locate: detailedLocateParam,\r\n    });\r\n  }\r\n\r\n  async aiDoubleClick(locatePrompt: TUserPrompt, opt?: LocateOption) {\r\n    assert(locatePrompt, 'missing locate prompt for double click');\r\n\r\n    const detailedLocateParam = buildDetailedLocateParam(locatePrompt, opt);\r\n\r\n    return this.callActionInActionSpace('DoubleClick', {\r\n      locate: detailedLocateParam,\r\n    });\r\n  }\r\n\r\n  async aiHover(locatePrompt: TUserPrompt, opt?: LocateOption) {\r\n    assert(locatePrompt, 'missing locate prompt for hover');\r\n\r\n    const detailedLocateParam = buildDetailedLocateParam(locatePrompt, opt);\r\n\r\n    return this.callActionInActionSpace('Hover', {\r\n      locate: detailedLocateParam,\r\n    });\r\n  }\r\n\r\n  // New signature, always use locatePrompt as the first param\r\n  async aiInput(\r\n    locatePrompt: TUserPrompt,\r\n    opt: LocateOption & { value: string | number } & {\r\n      autoDismissKeyboard?: boolean;\r\n    } & { mode?: 'replace' | 'clear' | 'append' },\r\n  ): Promise<any>;\r\n\r\n  // Legacy signature - deprecated\r\n  /**\r\n   * @deprecated Use aiInput(locatePrompt, opt) instead where opt contains the value\r\n   */\r\n  async aiInput(\r\n    value: string | number,\r\n    locatePrompt: TUserPrompt,\r\n    opt?: LocateOption & { autoDismissKeyboard?: boolean } & {\r\n      mode?: 'replace' | 'clear' | 'append';\r\n    }, // AndroidDeviceInputOpt &\r\n  ): Promise<any>;\r\n\r\n  // Implementation\r\n  async aiInput(\r\n    locatePromptOrValue: TUserPrompt | string | number,\r\n    locatePromptOrOpt:\r\n      | TUserPrompt\r\n      | (LocateOption & { value: string | number } & {\r\n          autoDismissKeyboard?: boolean;\r\n        } & { mode?: 'replace' | 'clear' | 'append' }) // AndroidDeviceInputOpt &\r\n      | undefined,\r\n    optOrUndefined?: LocateOption, // AndroidDeviceInputOpt &\r\n  ) {\r\n    let value: string | number;\r\n    let locatePrompt: TUserPrompt;\r\n    let opt:\r\n      | (LocateOption & { value: string | number } & {\r\n          autoDismissKeyboard?: boolean;\r\n        } & { mode?: 'replace' | 'clear' | 'append' }) // AndroidDeviceInputOpt &\r\n      | undefined;\r\n\r\n    // Check if using new signature (first param is locatePrompt, second has value)\r\n    if (\r\n      typeof locatePromptOrOpt === 'object' &&\r\n      locatePromptOrOpt !== null &&\r\n      'value' in locatePromptOrOpt\r\n    ) {\r\n      // New signature: aiInput(locatePrompt, opt)\r\n      locatePrompt = locatePromptOrValue as TUserPrompt;\r\n      const optWithValue = locatePromptOrOpt as LocateOption & {\r\n        // AndroidDeviceInputOpt &\r\n        value: string | number;\r\n        autoDismissKeyboard?: boolean;\r\n      };\r\n      value = optWithValue.value;\r\n      opt = optWithValue;\r\n    } else {\r\n      // Legacy signature: aiInput(value, locatePrompt, opt)\r\n      value = locatePromptOrValue as string | number;\r\n      locatePrompt = locatePromptOrOpt as TUserPrompt;\r\n      opt = {\r\n        ...optOrUndefined,\r\n        value,\r\n      };\r\n    }\r\n\r\n    assert(\r\n      typeof value === 'string' || typeof value === 'number',\r\n      'input value must be a string or number, use empty string if you want to clear the input',\r\n    );\r\n    assert(locatePrompt, 'missing locate prompt for input');\r\n\r\n    const detailedLocateParam = buildDetailedLocateParam(locatePrompt, opt);\r\n\r\n    return this.callActionInActionSpace('Input', {\r\n      ...(opt || {}),\r\n      locate: detailedLocateParam,\r\n    });\r\n  }\r\n\r\n  // New signature\r\n  async aiKeyboardPress(\r\n    locatePrompt: TUserPrompt,\r\n    opt: LocateOption & { keyName: string },\r\n  ): Promise<any>;\r\n\r\n  // Legacy signature - deprecated\r\n  /**\r\n   * @deprecated Use aiKeyboardPress(locatePrompt, opt) instead where opt contains the keyName\r\n   */\r\n  async aiKeyboardPress(\r\n    keyName: string,\r\n    locatePrompt?: TUserPrompt,\r\n    opt?: LocateOption,\r\n  ): Promise<any>;\r\n\r\n  // Implementation\r\n  async aiKeyboardPress(\r\n    locatePromptOrKeyName: TUserPrompt | string,\r\n    locatePromptOrOpt:\r\n      | TUserPrompt\r\n      | (LocateOption & { keyName: string })\r\n      | undefined,\r\n    optOrUndefined?: LocateOption,\r\n  ) {\r\n    let keyName: string;\r\n    let locatePrompt: TUserPrompt | undefined;\r\n    let opt: (LocateOption & { keyName: string }) | undefined;\r\n\r\n    // Check if using new signature (first param is locatePrompt, second has keyName)\r\n    if (\r\n      typeof locatePromptOrOpt === 'object' &&\r\n      locatePromptOrOpt !== null &&\r\n      'keyName' in locatePromptOrOpt\r\n    ) {\r\n      // New signature: aiKeyboardPress(locatePrompt, opt)\r\n      locatePrompt = locatePromptOrKeyName as TUserPrompt;\r\n      opt = locatePromptOrOpt as LocateOption & {\r\n        keyName: string;\r\n      };\r\n    } else {\r\n      // Legacy signature: aiKeyboardPress(keyName, locatePrompt, opt)\r\n      keyName = locatePromptOrKeyName as string;\r\n      locatePrompt = locatePromptOrOpt as TUserPrompt | undefined;\r\n      opt = {\r\n        ...(optOrUndefined || {}),\r\n        keyName,\r\n      };\r\n    }\r\n\r\n    assert(opt?.keyName, 'missing keyName for keyboard press');\r\n\r\n    const detailedLocateParam = locatePrompt\r\n      ? buildDetailedLocateParam(locatePrompt, opt)\r\n      : undefined;\r\n\r\n    return this.callActionInActionSpace('KeyboardPress', {\r\n      ...(opt || {}),\r\n      locate: detailedLocateParam,\r\n    });\r\n  }\r\n\r\n  // New signature\r\n  async aiScroll(\r\n    locatePrompt: TUserPrompt | undefined,\r\n    opt: LocateOption & ScrollParam,\r\n  ): Promise<any>;\r\n\r\n  // Legacy signature - deprecated\r\n  /**\r\n   * @deprecated Use aiScroll(locatePrompt, opt) instead where opt contains the scroll parameters\r\n   */\r\n  async aiScroll(\r\n    scrollParam: ScrollParam,\r\n    locatePrompt?: TUserPrompt,\r\n    opt?: LocateOption,\r\n  ): Promise<any>;\r\n\r\n  // Implementation\r\n  async aiScroll(\r\n    locatePromptOrScrollParam: TUserPrompt | ScrollParam | undefined,\r\n    locatePromptOrOpt: TUserPrompt | (LocateOption & ScrollParam) | undefined,\r\n    optOrUndefined?: LocateOption,\r\n  ) {\r\n    let scrollParam: ScrollParam;\r\n    let locatePrompt: TUserPrompt | undefined;\r\n    let opt: LocateOption | undefined;\r\n\r\n    // Check if using new signature (first param is locatePrompt, second has scroll params)\r\n    if (\r\n      typeof locatePromptOrOpt === 'object' &&\r\n      ('direction' in locatePromptOrOpt ||\r\n        'scrollType' in locatePromptOrOpt ||\r\n        'distance' in locatePromptOrOpt)\r\n    ) {\r\n      // New signature: aiScroll(locatePrompt, opt)\r\n      locatePrompt = locatePromptOrScrollParam as TUserPrompt;\r\n      opt = locatePromptOrOpt as LocateOption & ScrollParam;\r\n    } else {\r\n      // Legacy signature: aiScroll(scrollParam, locatePrompt, opt)\r\n      scrollParam = locatePromptOrScrollParam as ScrollParam;\r\n      locatePrompt = locatePromptOrOpt as TUserPrompt | undefined;\r\n      opt = {\r\n        ...(optOrUndefined || {}),\r\n        ...(scrollParam || {}),\r\n      };\r\n    }\r\n\r\n    const detailedLocateParam = buildDetailedLocateParam(\r\n      locatePrompt || '',\r\n      opt,\r\n    );\r\n\r\n    return this.callActionInActionSpace('Scroll', {\r\n      ...(opt || {}),\r\n      locate: detailedLocateParam,\r\n    });\r\n  }\r\n\r\n  async aiAction(\r\n    taskPrompt: string,\r\n    opt?: {\r\n      cacheable?: boolean;\r\n    },\r\n  ) {\r\n    const modelConfig = this.modelConfigManager.getModelConfig('planning');\r\n\r\n    const cacheable = opt?.cacheable;\r\n    // if vlm-ui-tars, plan cache is not used\r\n    const isVlmUiTars = modelConfig.vlMode === 'vlm-ui-tars';\r\n    const matchedCache =\r\n      isVlmUiTars || cacheable === false\r\n        ? undefined\r\n        : this.taskCache?.matchPlanCache(taskPrompt);\r\n    if (matchedCache && this.taskCache?.isCacheResultUsed) {\r\n      // log into report file\r\n      const { executor } = await this.taskExecutor.loadYamlFlowAsPlanning(\r\n        taskPrompt,\r\n        matchedCache.cacheContent?.yamlWorkflow,\r\n      );\r\n\r\n      await this.afterTaskRunning(executor);\r\n\r\n      debug('matched cache, will call .runYaml to run the action');\r\n      const yaml = matchedCache.cacheContent?.yamlWorkflow;\r\n      return this.runYaml(yaml);\r\n    }\r\n\r\n    const { output, executor } = await this.taskExecutor.action(\r\n      taskPrompt,\r\n      modelConfig,\r\n      this.opts.aiActionContext,\r\n      cacheable,\r\n    );\r\n\r\n    // update cache\r\n    if (this.taskCache && output?.yamlFlow && cacheable !== false) {\r\n      const yamlContent: MidsceneYamlScript = {\r\n        tasks: [\r\n          {\r\n            name: taskPrompt,\r\n            flow: output.yamlFlow,\r\n          },\r\n        ],\r\n      };\r\n      const yamlFlowStr = yaml.dump(yamlContent);\r\n      this.taskCache.updateOrAppendCacheRecord(\r\n        {\r\n          type: 'plan',\r\n          prompt: taskPrompt,\r\n          yamlWorkflow: yamlFlowStr,\r\n        },\r\n        matchedCache,\r\n      );\r\n    }\r\n\r\n    await this.afterTaskRunning(executor);\r\n    return output;\r\n  }\r\n\r\n  async aiQuery<ReturnType = any>(\r\n    demand: InsightExtractParam,\r\n    opt: InsightExtractOption = defaultInsightExtractOption,\r\n  ): Promise<ReturnType> {\r\n    const modelConfig = this.modelConfigManager.getModelConfig('VQA');\r\n    const { output, executor } =\r\n      await this.taskExecutor.createTypeQueryExecution(\r\n        'Query',\r\n        demand,\r\n        modelConfig,\r\n        opt,\r\n      );\r\n    await this.afterTaskRunning(executor);\r\n    return output as ReturnType;\r\n  }\r\n\r\n  async aiBoolean(\r\n    prompt: TUserPrompt,\r\n    opt: InsightExtractOption = defaultInsightExtractOption,\r\n  ): Promise<boolean> {\r\n    const modelConfig = this.modelConfigManager.getModelConfig('VQA');\r\n\r\n    const { textPrompt, multimodalPrompt } = parsePrompt(prompt);\r\n    const { output, executor } =\r\n      await this.taskExecutor.createTypeQueryExecution(\r\n        'Boolean',\r\n        textPrompt,\r\n        modelConfig,\r\n        opt,\r\n        multimodalPrompt,\r\n      );\r\n    await this.afterTaskRunning(executor);\r\n    return output as boolean;\r\n  }\r\n\r\n  async aiNumber(\r\n    prompt: TUserPrompt,\r\n    opt: InsightExtractOption = defaultInsightExtractOption,\r\n  ): Promise<number> {\r\n    const modelConfig = this.modelConfigManager.getModelConfig('VQA');\r\n\r\n    const { textPrompt, multimodalPrompt } = parsePrompt(prompt);\r\n    const { output, executor } =\r\n      await this.taskExecutor.createTypeQueryExecution(\r\n        'Number',\r\n        textPrompt,\r\n        modelConfig,\r\n        opt,\r\n        multimodalPrompt,\r\n      );\r\n    await this.afterTaskRunning(executor);\r\n    return output as number;\r\n  }\r\n\r\n  async aiString(\r\n    prompt: TUserPrompt,\r\n    opt: InsightExtractOption = defaultInsightExtractOption,\r\n  ): Promise<string> {\r\n    const modelConfig = this.modelConfigManager.getModelConfig('VQA');\r\n\r\n    const { textPrompt, multimodalPrompt } = parsePrompt(prompt);\r\n    const { output, executor } =\r\n      await this.taskExecutor.createTypeQueryExecution(\r\n        'String',\r\n        textPrompt,\r\n        modelConfig,\r\n        opt,\r\n        multimodalPrompt,\r\n      );\r\n    await this.afterTaskRunning(executor);\r\n    return output as string;\r\n  }\r\n\r\n  async aiAsk(\r\n    prompt: TUserPrompt,\r\n    opt: InsightExtractOption = defaultInsightExtractOption,\r\n  ): Promise<string> {\r\n    return this.aiString(prompt, opt);\r\n  }\r\n\r\n  async describeElementAtPoint(\r\n    center: [number, number],\r\n    opt?: {\r\n      verifyPrompt?: boolean;\r\n      retryLimit?: number;\r\n      deepThink?: boolean;\r\n    } & LocatorValidatorOption,\r\n  ): Promise<AgentDescribeElementAtPointResult> {\r\n    const { verifyPrompt = true, retryLimit = 3 } = opt || {};\r\n\r\n    let success = false;\r\n    let retryCount = 0;\r\n    let resultPrompt = '';\r\n    let deepThink = opt?.deepThink || false;\r\n    let verifyResult: LocateValidatorResult | undefined;\r\n\r\n    while (!success && retryCount < retryLimit) {\r\n      if (retryCount >= 2) {\r\n        deepThink = true;\r\n      }\r\n      debug(\r\n        'aiDescribe',\r\n        center,\r\n        'verifyPrompt',\r\n        verifyPrompt,\r\n        'retryCount',\r\n        retryCount,\r\n        'deepThink',\r\n        deepThink,\r\n      );\r\n      // use same intent as aiLocate\r\n      const modelConfig = this.modelConfigManager.getModelConfig('grounding');\r\n\r\n      const text = await this.insight.describe(center, modelConfig, {\r\n        deepThink,\r\n      });\r\n      debug('aiDescribe text', text);\r\n      assert(text.description, `failed to describe element at [${center}]`);\r\n      resultPrompt = text.description;\r\n\r\n      verifyResult = await this.verifyLocator(\r\n        resultPrompt,\r\n        deepThink ? { deepThink: true } : undefined,\r\n        center,\r\n        opt,\r\n      );\r\n      if (verifyResult.pass) {\r\n        success = true;\r\n      } else {\r\n        retryCount++;\r\n      }\r\n    }\r\n\r\n    return {\r\n      prompt: resultPrompt,\r\n      deepThink,\r\n      verifyResult,\r\n    };\r\n  }\r\n\r\n  async verifyLocator(\r\n    prompt: string,\r\n    locateOpt: LocateOption | undefined,\r\n    expectCenter: [number, number],\r\n    verifyLocateOption?: LocatorValidatorOption,\r\n  ): Promise<LocateValidatorResult> {\r\n    debug('verifyLocator', prompt, locateOpt, expectCenter, verifyLocateOption);\r\n\r\n    const { center: verifyCenter, rect: verifyRect } = await this.aiLocate(\r\n      prompt,\r\n      locateOpt,\r\n    );\r\n    const distance = distanceOfTwoPoints(expectCenter, verifyCenter);\r\n    const included = includedInRect(expectCenter, verifyRect);\r\n    const pass =\r\n      distance <= (verifyLocateOption?.centerDistanceThreshold || 20) ||\r\n      included;\r\n    const verifyResult = {\r\n      pass,\r\n      rect: verifyRect,\r\n      center: verifyCenter,\r\n      centerDistance: distance,\r\n    };\r\n    debug('aiDescribe verifyResult', verifyResult);\r\n    return verifyResult;\r\n  }\r\n\r\n  async aiLocate(prompt: TUserPrompt, opt?: LocateOption) {\r\n    const locateParam = buildDetailedLocateParam(prompt, opt);\r\n    assert(locateParam, 'cannot get locate param for aiLocate');\r\n    const locatePlan = locatePlanForLocate(locateParam);\r\n    const plans = [locatePlan];\r\n    const modelConfig = this.modelConfigManager.getModelConfig('grounding');\r\n\r\n    const { executor, output } = await this.taskExecutor.runPlans(\r\n      taskTitleStr('Locate', locateParamStr(locateParam)),\r\n      plans,\r\n      modelConfig,\r\n    );\r\n    await this.afterTaskRunning(executor);\r\n\r\n    const { element } = output;\r\n\r\n    const dprValue = await (this.interface.size() as any).dpr;\r\n    const dprEntry = dprValue\r\n      ? {\r\n          dpr: dprValue,\r\n        }\r\n      : {};\r\n    return {\r\n      rect: element?.rect,\r\n      center: element?.center,\r\n      ...dprEntry,\r\n    } as Pick<LocateResultElement, 'rect' | 'center'> & {\r\n      dpr?: number; // this field is deprecated\r\n    };\r\n  }\r\n\r\n  async aiAssert(\r\n    assertion: TUserPrompt,\r\n    msg?: string,\r\n    opt?: AgentAssertOpt & InsightExtractOption,\r\n  ) {\r\n    const modelConfig = this.modelConfigManager.getModelConfig('VQA');\r\n\r\n    const insightOpt: InsightExtractOption = {\r\n      domIncluded: opt?.domIncluded ?? defaultInsightExtractOption.domIncluded,\r\n      screenshotIncluded:\r\n        opt?.screenshotIncluded ??\r\n        defaultInsightExtractOption.screenshotIncluded,\r\n      doNotThrowError: opt?.doNotThrowError,\r\n    };\r\n\r\n    const { textPrompt, multimodalPrompt } = parsePrompt(assertion);\r\n\r\n    const { output, executor, thought } =\r\n      await this.taskExecutor.createTypeQueryExecution<boolean>(\r\n        'Assert',\r\n        textPrompt,\r\n        modelConfig,\r\n        insightOpt,\r\n        multimodalPrompt,\r\n      );\r\n    await this.afterTaskRunning(executor, true);\r\n\r\n    const message = output\r\n      ? undefined\r\n      : `Assertion failed: ${msg || (typeof assertion === 'string' ? assertion : assertion.prompt)}\\nReason: ${\r\n          thought || executor.latestErrorTask()?.error || '(no_reason)'\r\n        }`;\r\n\r\n    if (opt?.keepRawResponse) {\r\n      return {\r\n        pass: output,\r\n        thought,\r\n        message,\r\n      };\r\n    }\r\n\r\n    if (!output) {\r\n      throw new Error(message);\r\n    }\r\n  }\r\n\r\n  async aiWaitFor(assertion: TUserPrompt, opt?: AgentWaitForOpt) {\r\n    const modelConfig = this.modelConfigManager.getModelConfig('VQA');\r\n    const { executor } = await this.taskExecutor.waitFor(\r\n      assertion,\r\n      {\r\n        timeoutMs: opt?.timeoutMs || 15 * 1000,\r\n        checkIntervalMs: opt?.checkIntervalMs || 3 * 1000,\r\n      },\r\n      modelConfig,\r\n    );\r\n    await this.afterTaskRunning(executor, true);\r\n\r\n    if (executor.isInErrorState()) {\r\n      const errorTask = executor.latestErrorTask();\r\n      throw new Error(`${errorTask?.error}\\n${errorTask?.errorStack}`);\r\n    }\r\n  }\r\n\r\n  async ai(taskPrompt: string, type = 'action') {\r\n    if (type === 'action') {\r\n      return this.aiAction(taskPrompt);\r\n    }\r\n    if (type === 'query') {\r\n      return this.aiQuery(taskPrompt);\r\n    }\r\n\r\n    if (type === 'assert') {\r\n      return this.aiAssert(taskPrompt);\r\n    }\r\n\r\n    if (type === 'tap') {\r\n      return this.aiTap(taskPrompt);\r\n    }\r\n\r\n    if (type === 'rightClick') {\r\n      return this.aiRightClick(taskPrompt);\r\n    }\r\n\r\n    if (type === 'doubleClick') {\r\n      return this.aiDoubleClick(taskPrompt);\r\n    }\r\n\r\n    throw new Error(\r\n      `Unknown type: ${type}, only support 'action', 'query', 'assert', 'tap', 'rightClick', 'doubleClick'`,\r\n    );\r\n  }\r\n\r\n  async runYaml(yamlScriptContent: string): Promise<{\r\n    result: Record<string, any>;\r\n  }> {\r\n    const script = parseYamlScript(yamlScriptContent, 'yaml');\r\n    const player = new ScriptPlayer(script, async () => {\r\n      return { agent: this, freeFn: [] };\r\n    });\r\n    await player.run();\r\n\r\n    if (player.status === 'error') {\r\n      const errors = player.taskStatusList\r\n        .filter((task) => task.status === 'error')\r\n        .map((task) => {\r\n          return `task - ${task.name}: ${task.error?.message}`;\r\n        })\r\n        .join('\\n');\r\n      throw new Error(`Error(s) occurred in running yaml script:\\n${errors}`);\r\n    }\r\n\r\n    return {\r\n      result: player.result,\r\n    };\r\n  }\r\n\r\n  async evaluateJavaScript(script: string) {\r\n    assert(\r\n      this.interface.evaluateJavaScript,\r\n      'evaluateJavaScript is not supported in current agent',\r\n    );\r\n    return this.interface.evaluateJavaScript(script);\r\n  }\r\n\r\n  async destroy() {\r\n    // Early return if already destroyed\r\n    if (this.destroyed) {\r\n      return;\r\n    }\r\n\r\n    await this.interface.destroy?.();\r\n    this.resetDump(); // reset dump to release memory\r\n    this.destroyed = true;\r\n  }\r\n\r\n  async logScreenshot(\r\n    title?: string,\r\n    opt?: {\r\n      content: string;\r\n    },\r\n  ) {\r\n    // 1. screenshot\r\n    const base64 = await this.interface.screenshotBase64();\r\n    const now = Date.now();\r\n    // 2. build recorder\r\n    const recorder: ExecutionRecorderItem[] = [\r\n      {\r\n        type: 'screenshot',\r\n        ts: now,\r\n        screenshot: base64,\r\n      },\r\n    ];\r\n    // 3. build ExecutionTaskLog\r\n    const task: ExecutionTaskLog = {\r\n      type: 'Log',\r\n      subType: 'Screenshot',\r\n      status: 'finished',\r\n      recorder,\r\n      timing: {\r\n        start: now,\r\n        end: now,\r\n        cost: 0,\r\n      },\r\n      param: {\r\n        content: opt?.content || '',\r\n      },\r\n      executor: async () => {},\r\n    };\r\n    // 4. build ExecutionDump\r\n    const executionDump: ExecutionDump = {\r\n      logTime: now,\r\n      name: `Log - ${title || 'untitled'}`,\r\n      description: opt?.content || '',\r\n      tasks: [task],\r\n    };\r\n    if (this.opts.aiActionContext) {\r\n      executionDump.aiActionContext = this.opts.aiActionContext;\r\n    }\r\n    // 5. append to execution dump\r\n    this.appendExecutionDump(executionDump);\r\n\r\n    try {\r\n      this.onDumpUpdate?.(this.dumpDataString());\r\n    } catch (error) {\r\n      console.error('Failed to update dump', error);\r\n    }\r\n\r\n    this.writeOutActionDumps();\r\n  }\r\n\r\n  _unstableLogContent() {\r\n    const { groupName, groupDescription, executions } = this.dump;\r\n    const newExecutions = Array.isArray(executions)\r\n      ? executions.map((execution: any) => {\r\n          const { tasks, ...restExecution } = execution;\r\n          let newTasks = tasks;\r\n          if (Array.isArray(tasks)) {\r\n            newTasks = tasks.map((task: any) => {\r\n              // only remove uiContext and log from task\r\n              const { uiContext, log, ...restTask } = task;\r\n              return restTask;\r\n            });\r\n          }\r\n          return { ...restExecution, ...(newTasks ? { tasks: newTasks } : {}) };\r\n        })\r\n      : [];\r\n    return {\r\n      groupName,\r\n      groupDescription,\r\n      executions: newExecutions,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Freezes the current page context to be reused in subsequent AI operations\r\n   * This avoids recalculating page context for each operation\r\n   */\r\n  async freezePageContext(): Promise<void> {\r\n    debug('Freezing page context');\r\n    const context = await this._snapshotContext();\r\n    // Mark the context as frozen\r\n    context._isFrozen = true;\r\n    this.frozenUIContext = context;\r\n    debug('Page context frozen successfully');\r\n  }\r\n\r\n  /**\r\n   * Unfreezes the page context, allowing AI operations to calculate context dynamically\r\n   */\r\n  async unfreezePageContext(): Promise<void> {\r\n    debug('Unfreezing page context');\r\n    this.frozenUIContext = undefined;\r\n    debug('Page context unfrozen successfully');\r\n  }\r\n\r\n  /**\r\n   * Process cache configuration and return normalized cache settings\r\n   */\r\n  private processCacheConfig(opts: AgentOpt): {\r\n    id: string;\r\n    enabled: boolean;\r\n    readOnly: boolean;\r\n    writeOnly: boolean;\r\n  } | null {\r\n    // Validate original cache config before processing\r\n    // Agent requires explicit IDs - don't allow auto-generation\r\n    if (opts.cache === true) {\r\n      throw new Error(\r\n        'cache: true requires an explicit cache ID. Please provide:\\n' +\r\n          'Example: cache: { id: \"my-cache-id\" }',\r\n      );\r\n    }\r\n\r\n    // Check if cache config object is missing ID\r\n    if (\r\n      opts.cache &&\r\n      typeof opts.cache === 'object' &&\r\n      opts.cache !== null &&\r\n      !opts.cache.id\r\n    ) {\r\n      throw new Error(\r\n        'cache configuration requires an explicit id.\\n' +\r\n          'Example: cache: { id: \"my-cache-id\" }',\r\n      );\r\n    }\r\n\r\n    // Use the unified utils function to process cache configuration\r\n    const cacheConfig = processCacheConfig(\r\n      opts.cache,\r\n      opts.cacheId || opts.testId || 'default',\r\n    );\r\n\r\n    if (!cacheConfig) {\r\n      return null;\r\n    }\r\n\r\n    // Handle cache configuration object\r\n    if (typeof cacheConfig === 'object' && cacheConfig !== null) {\r\n      const id = cacheConfig.id;\r\n      const rawStrategy = cacheConfig.strategy as unknown;\r\n      let strategyValue: string;\r\n\r\n      if (rawStrategy === undefined) {\r\n        strategyValue = 'read-write';\r\n      } else if (typeof rawStrategy === 'string') {\r\n        strategyValue = rawStrategy;\r\n      } else {\r\n        throw new Error(\r\n          `cache.strategy must be a string when provided, but received type ${typeof rawStrategy}`,\r\n        );\r\n      }\r\n\r\n      if (!isValidCacheStrategy(strategyValue)) {\r\n        throw new Error(\r\n          `cache.strategy must be one of ${CACHE_STRATEGY_VALUES}, but received \"${strategyValue}\"`,\r\n        );\r\n      }\r\n\r\n      const isReadOnly = strategyValue === 'read-only';\r\n      const isWriteOnly = strategyValue === 'write-only';\r\n\r\n      return {\r\n        id,\r\n        enabled: !isWriteOnly,\r\n        readOnly: isReadOnly,\r\n        writeOnly: isWriteOnly,\r\n      };\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Manually flush cache to file\r\n   * @param options - Optional configuration\r\n   * @param options.cleanUnused - If true, removes unused cache records before flushing\r\n   */\r\n  async flushCache(options?: { cleanUnused?: boolean }): Promise<void> {\r\n    if (!this.taskCache) {\r\n      throw new Error('Cache is not configured');\r\n    }\r\n\r\n    this.taskCache.flushCacheToFile(options);\r\n  }\r\n}\r\n\r\nexport const createAgent = (\r\n  interfaceInstance: AbstractInterface,\r\n  opts?: AgentOpt,\r\n) => {\r\n  return new Agent(interfaceInstance, opts);\r\n};\r\n","'use client';\nimport { mousePointer } from \"./index.mjs\";\nimport { paramStr, typeStr } from \"@sqaitech/core/agent\";\nimport { treeToList } from \"@sqaitech/shared/extractor\";\nconst stillDuration = 900;\nconst actionSpinningPointerDuration = 300;\nconst stillAfterInsightDuration = 300;\nconst locateDuration = 800;\nconst actionDuration = 1000;\nconst clearInsightDuration = 200;\nconst cameraStateForRect = (rect, imageWidth, imageHeight)=>{\n    const canvasRatio = imageWidth / imageHeight;\n    const rectRatio = rect.width / rect.height;\n    let rectWidthOnPage;\n    rectWidthOnPage = rectRatio >= canvasRatio ? rect.width : rect.height / imageHeight * imageWidth;\n    const cameraPaddingRatio = rectWidthOnPage > 400 ? 0.1 : rectWidthOnPage > 50 ? 0.2 : 0.3;\n    const cameraWidth = Math.min(imageWidth, rectWidthOnPage + imageWidth * cameraPaddingRatio * 2);\n    const cameraHeight = imageHeight / imageWidth * cameraWidth;\n    let left = Math.min(rect.left - imageWidth * cameraPaddingRatio, imageWidth - cameraWidth);\n    left = Math.max(left, 0);\n    let top = Math.min(rect.top - imageHeight * cameraPaddingRatio, imageHeight - cameraHeight);\n    top = Math.max(top, 0);\n    return {\n        left: Math.round(left),\n        top: Math.round(top),\n        width: Math.round(cameraWidth)\n    };\n};\nconst mergeTwoCameraState = (cameraState1, cameraState2)=>{\n    const newLeft = Math.min(cameraState1.left, cameraState2.left);\n    const newTop = Math.min(cameraState1.top, cameraState2.top);\n    const newRight = Math.max(cameraState1.left + cameraState1.width, cameraState2.left + cameraState2.width);\n    const newWidth = newRight - newLeft;\n    return {\n        left: newLeft,\n        top: newTop,\n        width: newWidth\n    };\n};\nconst capitalizeFirstLetter = (str)=>{\n    if ('string' != typeof str || 0 === str.length) return str;\n    return str.charAt(0).toUpperCase() + str.slice(1);\n};\nconst allScriptsFromDump = (dump)=>{\n    const dimensionsSet = new Set();\n    let firstWidth;\n    let firstHeight;\n    const sdkVersion = dump.sdkVersion;\n    const modelBriefsSet = new Set();\n    dump.executions.forEach((execution)=>{\n        execution.tasks.forEach((task)=>{\n            var _task_uiContext_size, _task_uiContext;\n            if (null == (_task_uiContext = task.uiContext) ? void 0 : null == (_task_uiContext_size = _task_uiContext.size) ? void 0 : _task_uiContext_size.width) {\n                const w = task.uiContext.size.width;\n                const h = task.uiContext.size.height;\n                if (!firstWidth) {\n                    firstWidth = w;\n                    firstHeight = h;\n                }\n                dimensionsSet.add(`${w}x${h}`);\n            }\n        });\n    });\n    if (!firstWidth || !firstHeight) {\n        console.warn('width or height is missing in dump file');\n        return {\n            scripts: [],\n            sdkVersion,\n            modelBriefs: []\n        };\n    }\n    const allScripts = [];\n    dump.executions.forEach((execution)=>{\n        const scripts = generateAnimationScripts(execution, -1, firstWidth, firstHeight);\n        if (scripts) allScripts.push(...scripts);\n        execution.tasks.forEach((task)=>{\n            if (task.usage) {\n                const { model_name, model_description, intent } = task.usage;\n                if (intent && model_name) modelBriefsSet.add(model_description ? `${capitalizeFirstLetter(intent)}/${model_name}(${model_description})` : model_name);\n            }\n        });\n    });\n    const allScriptsWithoutIntermediateDoneFrame = allScripts.filter((script, index)=>{\n        if (index !== allScripts.length - 1 && 'Done' === script.title) return false;\n        return true;\n    });\n    const modelBriefs = (()=>{\n        var _list_;\n        const list = [\n            ...modelBriefsSet\n        ];\n        if (!list.length) return list;\n        const firstOneInfo = null == (_list_ = list[0]) ? void 0 : _list_.split('/', 2)[1];\n        if (firstOneInfo && list.slice(1).every((item)=>(null == item ? void 0 : item.split('/', 2)[1]) === firstOneInfo)) return [\n            firstOneInfo\n        ];\n        return list;\n    })();\n    return {\n        scripts: allScriptsWithoutIntermediateDoneFrame,\n        width: firstWidth,\n        height: firstHeight,\n        sdkVersion,\n        modelBriefs\n    };\n};\nconst generateAnimationScripts = (execution, task, imageWidth, imageHeight)=>{\n    if (!execution || !execution.tasks.length) return null;\n    if (0 === imageWidth || 0 === imageHeight) return null;\n    let tasksIncluded = [];\n    if (-1 === task) tasksIncluded = execution.tasks;\n    else {\n        const startIndex = execution.tasks.findIndex((t)=>t === task);\n        if (-1 === startIndex) {\n            console.error(\"task not found, cannot generate animation scripts\");\n            return null;\n        }\n        if (startIndex === execution.tasks.length - 1) return null;\n        for(let i = startIndex; i < execution.tasks.length; i++){\n            if (i > startIndex && 'Planning' === execution.tasks[i].type) break;\n            tasksIncluded.push(execution.tasks[i]);\n        }\n    }\n    if (0 === tasksIncluded.length) return null;\n    const fullPageCameraState = cameraStateForRect({\n        left: 0,\n        top: 0,\n        width: imageWidth,\n        height: imageHeight\n    }, imageWidth, imageHeight);\n    const pointerScript = (img, title, subTitle)=>({\n            type: 'pointer',\n            img,\n            duration: 0,\n            title,\n            subTitle\n        });\n    const scripts = [];\n    let insightCameraState;\n    let currentCameraState = fullPageCameraState;\n    let insightOnTop = false;\n    const taskCount = tasksIncluded.length;\n    let initSubTitle = '';\n    let errorStateFlag = false;\n    tasksIncluded.forEach((task, index)=>{\n        if (errorStateFlag) return;\n        if (0 === index) initSubTitle = paramStr(task);\n        if ('Planning' === task.type) {\n            const planningTask = task;\n            if (planningTask.recorder && planningTask.recorder.length > 0) {\n                var _planningTask_recorder_, _planningTask_recorder, _task_uiContext_size, _task_uiContext, _task_uiContext_size1, _task_uiContext1;\n                scripts.push({\n                    type: 'img',\n                    img: null == (_planningTask_recorder = planningTask.recorder) ? void 0 : null == (_planningTask_recorder_ = _planningTask_recorder[0]) ? void 0 : _planningTask_recorder_.screenshot,\n                    camera: 0 === index ? fullPageCameraState : void 0,\n                    duration: stillDuration,\n                    title: typeStr(task),\n                    subTitle: paramStr(task),\n                    imageWidth: (null == (_task_uiContext = task.uiContext) ? void 0 : null == (_task_uiContext_size = _task_uiContext.size) ? void 0 : _task_uiContext_size.width) || imageWidth,\n                    imageHeight: (null == (_task_uiContext1 = task.uiContext) ? void 0 : null == (_task_uiContext_size1 = _task_uiContext1.size) ? void 0 : _task_uiContext_size1.height) || imageHeight\n                });\n            }\n        } else if ('Insight' === task.type && 'Locate' === task.subType) {\n            var _insightTask_output;\n            const insightTask = task;\n            const resultElement = null == (_insightTask_output = insightTask.output) ? void 0 : _insightTask_output.element;\n            const title = typeStr(task);\n            const subTitle = paramStr(task);\n            if (null == resultElement ? void 0 : resultElement.rect) insightCameraState = {\n                ...cameraStateForRect(resultElement.rect, imageWidth, imageHeight),\n                pointerLeft: resultElement.center[0],\n                pointerTop: resultElement.center[1]\n            };\n            const context = insightTask.uiContext;\n            if (null == context ? void 0 : context.screenshotBase64) {\n                var _insightTask_output1, _insightDump_taskInfo, _context_size, _context_size1;\n                const insightDump = insightTask.log;\n                const insightContentLength = context.tree ? treeToList(context.tree).length : 0;\n                if (context.screenshotBase64) {\n                    var _context_size2, _context_size3;\n                    scripts.push({\n                        type: 'img',\n                        img: context.screenshotBase64,\n                        duration: stillAfterInsightDuration,\n                        title,\n                        subTitle,\n                        imageWidth: (null == (_context_size2 = context.size) ? void 0 : _context_size2.width) || imageWidth,\n                        imageHeight: (null == (_context_size3 = context.size) ? void 0 : _context_size3.height) || imageHeight\n                    });\n                }\n                let cameraState;\n                cameraState = currentCameraState === fullPageCameraState ? void 0 : insightCameraState ? mergeTwoCameraState(currentCameraState, insightCameraState) : void 0;\n                scripts.push({\n                    type: 'insight',\n                    img: context.screenshotBase64,\n                    context: context,\n                    camera: cameraState,\n                    highlightElement: (null == (_insightTask_output1 = insightTask.output) ? void 0 : _insightTask_output1.element) || void 0,\n                    searchArea: null == insightDump ? void 0 : null == (_insightDump_taskInfo = insightDump.taskInfo) ? void 0 : _insightDump_taskInfo.searchArea,\n                    duration: insightContentLength > 20 ? locateDuration : 0.5 * locateDuration,\n                    insightCameraDuration: locateDuration,\n                    title,\n                    subTitle,\n                    imageWidth: (null == (_context_size = context.size) ? void 0 : _context_size.width) || imageWidth,\n                    imageHeight: (null == (_context_size1 = context.size) ? void 0 : _context_size1.height) || imageHeight\n                });\n                scripts.push({\n                    type: 'sleep',\n                    duration: stillAfterInsightDuration,\n                    title,\n                    subTitle\n                });\n                insightOnTop = true;\n            }\n        } else if ('Action' === task.type && 'FalsyConditionStatement' !== task.subType) {\n            var _task_recorder_, _task_recorder, _task_uiContext_size2, _task_uiContext2, _task_uiContext_size3, _task_uiContext3, _task_recorder_1, _task_recorder1;\n            const title = typeStr(task);\n            const subTitle = paramStr(task);\n            scripts.push(pointerScript(mousePointer, title, subTitle));\n            currentCameraState = null != insightCameraState ? insightCameraState : fullPageCameraState;\n            scripts.push({\n                type: 'img',\n                img: null == (_task_recorder = task.recorder) ? void 0 : null == (_task_recorder_ = _task_recorder[0]) ? void 0 : _task_recorder_.screenshot,\n                duration: actionDuration,\n                camera: 'Sleep' === task.subType ? fullPageCameraState : insightCameraState,\n                title,\n                subTitle,\n                imageWidth: (null == (_task_uiContext2 = task.uiContext) ? void 0 : null == (_task_uiContext_size2 = _task_uiContext2.size) ? void 0 : _task_uiContext_size2.width) || imageWidth,\n                imageHeight: (null == (_task_uiContext3 = task.uiContext) ? void 0 : null == (_task_uiContext_size3 = _task_uiContext3.size) ? void 0 : _task_uiContext_size3.height) || imageHeight\n            });\n            if (insightOnTop) {\n                scripts.push({\n                    type: 'clear-insight',\n                    duration: clearInsightDuration,\n                    title,\n                    subTitle\n                });\n                insightOnTop = false;\n            }\n            const imgStillDuration = index < taskCount - 1 ? stillDuration : 0;\n            if (null == (_task_recorder1 = task.recorder) ? void 0 : null == (_task_recorder_1 = _task_recorder1[1]) ? void 0 : _task_recorder_1.screenshot) {\n                var _task_recorder_2, _task_recorder2, _task_uiContext_size4, _task_uiContext4, _task_uiContext_size5, _task_uiContext5;\n                scripts.push({\n                    type: 'spinning-pointer',\n                    duration: actionSpinningPointerDuration,\n                    title,\n                    subTitle\n                });\n                scripts.push(pointerScript(mousePointer, title, subTitle));\n                scripts.push({\n                    type: 'img',\n                    img: null == (_task_recorder2 = task.recorder) ? void 0 : null == (_task_recorder_2 = _task_recorder2[1]) ? void 0 : _task_recorder_2.screenshot,\n                    duration: imgStillDuration,\n                    title,\n                    subTitle,\n                    imageWidth: (null == (_task_uiContext4 = task.uiContext) ? void 0 : null == (_task_uiContext_size4 = _task_uiContext4.size) ? void 0 : _task_uiContext_size4.width) || imageWidth,\n                    imageHeight: (null == (_task_uiContext5 = task.uiContext) ? void 0 : null == (_task_uiContext_size5 = _task_uiContext5.size) ? void 0 : _task_uiContext_size5.height) || imageHeight\n                });\n            } else scripts.push({\n                type: 'sleep',\n                duration: imgStillDuration,\n                title,\n                subTitle\n            });\n        } else {\n            var _task_recorder_3, _task_recorder3;\n            const title = typeStr(task);\n            const subTitle = paramStr(task);\n            const screenshot = null == (_task_recorder3 = task.recorder) ? void 0 : null == (_task_recorder_3 = _task_recorder3[task.recorder.length - 1]) ? void 0 : _task_recorder_3.screenshot;\n            if (screenshot) {\n                var _task_uiContext_size6, _task_uiContext6, _task_uiContext_size7, _task_uiContext7;\n                scripts.push({\n                    type: 'img',\n                    img: screenshot,\n                    duration: stillDuration,\n                    camera: fullPageCameraState,\n                    title,\n                    subTitle,\n                    imageWidth: (null == (_task_uiContext6 = task.uiContext) ? void 0 : null == (_task_uiContext_size6 = _task_uiContext6.size) ? void 0 : _task_uiContext_size6.width) || imageWidth,\n                    imageHeight: (null == (_task_uiContext7 = task.uiContext) ? void 0 : null == (_task_uiContext_size7 = _task_uiContext7.size) ? void 0 : _task_uiContext_size7.height) || imageHeight\n                });\n            }\n        }\n        if ('finished' !== task.status) {\n            var _task_uiContext_size8, _task_uiContext8, _task_uiContext_size9, _task_uiContext9;\n            errorStateFlag = true;\n            const errorTitle = typeStr(task);\n            const errorMsg = task.errorMessage || 'unknown error';\n            const errorSubTitle = errorMsg.indexOf('NOT_IMPLEMENTED_AS_DESIGNED') > 0 ? 'Further actions cannot be performed in the current environment' : errorMsg;\n            scripts.push({\n                type: 'img',\n                img: task.recorder && task.recorder.length > 0 ? task.recorder[task.recorder.length - 1].screenshot : '',\n                camera: fullPageCameraState,\n                duration: stillDuration,\n                title: errorTitle,\n                subTitle: errorSubTitle,\n                imageWidth: (null == (_task_uiContext8 = task.uiContext) ? void 0 : null == (_task_uiContext_size8 = _task_uiContext8.size) ? void 0 : _task_uiContext_size8.width) || imageWidth,\n                imageHeight: (null == (_task_uiContext9 = task.uiContext) ? void 0 : null == (_task_uiContext_size9 = _task_uiContext9.size) ? void 0 : _task_uiContext_size9.height) || imageHeight\n            });\n            return;\n        }\n    });\n    if (!errorStateFlag) scripts.push({\n        title: 'Done',\n        subTitle: initSubTitle,\n        type: 'img',\n        duration: stillDuration,\n        camera: fullPageCameraState\n    });\n    return scripts;\n};\nexport { allScriptsFromDump, cameraStateForRect, generateAnimationScripts, mergeTwoCameraState };\n","function _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nclass IndexedDBManager {\n    initDB() {\n        return new Promise((resolve, reject)=>{\n            const request = indexedDB.open(this.dbName, this.version);\n            request.onerror = ()=>reject(request.error);\n            request.onsuccess = ()=>resolve(request.result);\n            request.onupgradeneeded = (event)=>{\n                const db = event.target.result;\n                this.storeConfigs.forEach(({ name, keyPath })=>{\n                    if (!db.objectStoreNames.contains(name)) {\n                        const store = db.createObjectStore(name, {\n                            keyPath\n                        });\n                        store.createIndex('timestamp', 'timestamp', {\n                            unique: false\n                        });\n                    }\n                });\n            };\n        });\n    }\n    async withTransaction(storeNames, mode, operation) {\n        const db = await this.dbPromise;\n        const transaction = db.transaction(storeNames, mode);\n        const stores = Array.isArray(storeNames) ? storeNames.map((name)=>transaction.objectStore(name)) : transaction.objectStore(storeNames);\n        return operation(stores);\n    }\n    promisifyRequest(request) {\n        return new Promise((resolve, reject)=>{\n            request.onsuccess = ()=>resolve(request.result);\n            request.onerror = ()=>reject(request.error);\n        });\n    }\n    async put(storeName, data) {\n        await this.withTransaction(storeName, 'readwrite', async (store)=>{\n            await this.promisifyRequest(store.put(data));\n        });\n    }\n    async get(storeName, key) {\n        return this.withTransaction(storeName, 'readonly', async (store)=>this.promisifyRequest(store.get(key)));\n    }\n    async getAll(storeName, sortByTimestamp = true) {\n        return this.withTransaction(storeName, 'readonly', async (store)=>{\n            const objectStore = store;\n            const results = sortByTimestamp ? await this.promisifyRequest(objectStore.index('timestamp').getAll()) : await this.promisifyRequest(objectStore.getAll());\n            return sortByTimestamp ? results.sort((a, b)=>a.timestamp - b.timestamp) : results;\n        });\n    }\n    async clear(storeName) {\n        await this.withTransaction(storeName, 'readwrite', async (store)=>{\n            await this.promisifyRequest(store.clear());\n        });\n    }\n    async delete(storeName, key) {\n        await this.withTransaction(storeName, 'readwrite', async (store)=>{\n            await this.promisifyRequest(store.delete(key));\n        });\n    }\n    async count(storeName) {\n        return this.withTransaction(storeName, 'readonly', async (store)=>this.promisifyRequest(store.count()));\n    }\n    getDBPromise() {\n        return this.dbPromise;\n    }\n    constructor(dbName, version, storeConfigs){\n        _define_property(this, \"dbPromise\", void 0);\n        _define_property(this, \"dbName\", void 0);\n        _define_property(this, \"version\", void 0);\n        _define_property(this, \"storeConfigs\", void 0);\n        this.dbName = dbName;\n        this.version = version;\n        this.storeConfigs = storeConfigs;\n        this.dbPromise = this.initDB();\n    }\n}\nconst withErrorHandling = async (operation, errorMessage, defaultValue, onQuotaExceeded)=>{\n    try {\n        return await operation();\n    } catch (e) {\n        console.error(errorMessage, e);\n        if (e instanceof Error && 'QuotaExceededError' === e.name && onQuotaExceeded) {\n            console.log('Storage quota exceeded, running cleanup...');\n            await onQuotaExceeded();\n        }\n        return defaultValue;\n    }\n};\nconst createCleanupFunction = (dbManager, storeName, maxItems)=>async ()=>{\n        try {\n            const results = await dbManager.getAll(storeName);\n            if (results.length > maxItems) {\n                const toDelete = results.sort((a, b)=>a.timestamp - b.timestamp).slice(0, results.length - maxItems);\n                await Promise.all(toDelete.map((item)=>dbManager.delete(storeName, item.id)));\n            }\n        } catch (e) {\n            console.error(`Failed to cleanup ${storeName}:`, e);\n        }\n    };\nexport { IndexedDBManager, createCleanupFunction, withErrorHandling };\n","import { IndexedDBManager, createCleanupFunction, withErrorHandling } from \"@sqaitech/shared/baseDB\";\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nconst DB_NAME = 'midscene_playground';\nconst DB_VERSION = 1;\nconst MESSAGES_STORE = 'playground_messages';\nconst RESULTS_STORE = 'playground_results';\nconst MAX_STORED_MESSAGES = 100;\nconst MAX_STORED_RESULTS = 50;\nclass IndexedDBStorageProvider {\n    async saveMessages(messages) {\n        await withErrorHandling(async ()=>{\n            await this.dbManager.clear(MESSAGES_STORE);\n            const messagesToSave = messages.slice(-MAX_STORED_MESSAGES);\n            await Promise.all(messagesToSave.map((msg, index)=>{\n                const lightMessage = {\n                    ...msg,\n                    result: void 0\n                };\n                const data = {\n                    id: msg.id || `msg-${index}`,\n                    data: lightMessage,\n                    timestamp: msg.timestamp ? msg.timestamp.getTime() : Date.now() + index\n                };\n                return this.dbManager.put(MESSAGES_STORE, data);\n            }));\n        }, 'Failed to save messages to IndexedDB', void 0, this.messagesCleanup);\n    }\n    async loadMessages() {\n        const result = await withErrorHandling(async ()=>{\n            const messages = await this.dbManager.getAll(MESSAGES_STORE, true);\n            if (0 === messages.length) return [];\n            return Promise.all(messages.map(async (msg)=>{\n                const item = msg.data;\n                const restoredItem = {\n                    ...item,\n                    timestamp: new Date(item.timestamp)\n                };\n                if ('result' === item.type && item.id) {\n                    const fullResult = await this.loadResult(item.id);\n                    if (fullResult) {\n                        restoredItem.result = fullResult.result;\n                        restoredItem.replayScriptsInfo = fullResult.replayScriptsInfo;\n                        restoredItem.replayCounter = fullResult.replayCounter;\n                        restoredItem.verticalMode = fullResult.verticalMode;\n                    }\n                }\n                return restoredItem;\n            }));\n        }, 'Failed to load messages from IndexedDB', [], this.messagesCleanup);\n        return result || [];\n    }\n    async clearMessages() {\n        await withErrorHandling(async ()=>{\n            await Promise.all([\n                this.dbManager.clear(MESSAGES_STORE),\n                this.dbManager.clear(RESULTS_STORE)\n            ]);\n        }, 'Failed to clear messages from IndexedDB');\n    }\n    async saveResult(id, result) {\n        await withErrorHandling(async ()=>{\n            const compressedResult = this.compressResultForStorage(result);\n            const data = {\n                id,\n                data: compressedResult,\n                timestamp: Date.now(),\n                size: JSON.stringify(compressedResult).length\n            };\n            await this.dbManager.put(RESULTS_STORE, data);\n        }, 'Failed to save result to IndexedDB', void 0, this.resultsCleanup);\n    }\n    async loadResult(id) {\n        const result = await withErrorHandling(async ()=>{\n            const data = await this.dbManager.get(RESULTS_STORE, id);\n            return (null == data ? void 0 : data.data) || null;\n        }, 'Failed to load result from IndexedDB', null);\n        return result || null;\n    }\n    compressResultForStorage(result) {\n        var _result_result_dump, _result_result;\n        if (!(null == (_result_result = result.result) ? void 0 : null == (_result_result_dump = _result_result.dump) ? void 0 : _result_result_dump.executions)) return result;\n        const compressedExecutions = result.result.dump.executions.map((execution)=>{\n            var _execution_tasks;\n            return {\n                ...execution,\n                tasks: (null == (_execution_tasks = execution.tasks) ? void 0 : _execution_tasks.map((task)=>{\n                    var _task_recorder;\n                    var _this_compressScreenshotIfNeeded;\n                    return {\n                        ...task,\n                        uiContext: task.uiContext ? {\n                            ...task.uiContext,\n                            screenshotBase64: null != (_this_compressScreenshotIfNeeded = this.compressScreenshotIfNeeded(task.uiContext.screenshotBase64)) ? _this_compressScreenshotIfNeeded : task.uiContext.screenshotBase64\n                        } : task.uiContext,\n                        recorder: null == (_task_recorder = task.recorder) ? void 0 : _task_recorder.map((record)=>({\n                                ...record,\n                                screenshot: this.compressScreenshotIfNeeded(record.screenshot)\n                            }))\n                    };\n                })) || []\n            };\n        });\n        return {\n            ...result,\n            result: {\n                ...result.result,\n                dump: {\n                    ...result.result.dump,\n                    executions: compressedExecutions\n                }\n            }\n        };\n    }\n    compressScreenshotIfNeeded(screenshot) {\n        if (!screenshot) return screenshot;\n        if (screenshot.length > 1048576) {\n            const sizeKB = Math.round(screenshot.length / 1024);\n            return `[COMPRESSED: ${sizeKB}KB screenshot removed for storage]`;\n        }\n        return screenshot;\n    }\n    async getStorageStats() {\n        const result = await withErrorHandling(async ()=>{\n            const [messageCount, resultCount] = await Promise.all([\n                this.dbManager.count(MESSAGES_STORE),\n                this.dbManager.count(RESULTS_STORE)\n            ]);\n            return {\n                messageCount,\n                resultCount\n            };\n        }, 'Failed to get storage statistics', {\n            messageCount: 0,\n            resultCount: 0\n        });\n        return result || {\n            messageCount: 0,\n            resultCount: 0\n        };\n    }\n    async cleanup() {\n        await Promise.all([\n            this.messagesCleanup(),\n            this.resultsCleanup()\n        ]);\n    }\n    constructor(namespace = 'playground'){\n        _define_property(this, \"dbManager\", void 0);\n        _define_property(this, \"namespace\", void 0);\n        _define_property(this, \"messagesCleanup\", void 0);\n        _define_property(this, \"resultsCleanup\", void 0);\n        this.namespace = namespace;\n        this.dbManager = new IndexedDBManager(`${DB_NAME}_${namespace}`, DB_VERSION, [\n            {\n                name: MESSAGES_STORE,\n                keyPath: 'id'\n            },\n            {\n                name: RESULTS_STORE,\n                keyPath: 'id'\n            }\n        ]);\n        this.messagesCleanup = createCleanupFunction(this.dbManager, MESSAGES_STORE, MAX_STORED_MESSAGES);\n        this.resultsCleanup = createCleanupFunction(this.dbManager, RESULTS_STORE, MAX_STORED_RESULTS);\n    }\n}\nclass MemoryStorageProvider {\n    async saveMessages(messages) {\n        this.messages = [\n            ...messages\n        ];\n    }\n    async loadMessages() {\n        return [\n            ...this.messages\n        ];\n    }\n    async clearMessages() {\n        this.messages = [];\n        this.results.clear();\n    }\n    async saveResult(id, result) {\n        this.results.set(id, result);\n    }\n    constructor(){\n        _define_property(this, \"messages\", []);\n        _define_property(this, \"results\", new Map());\n    }\n}\nclass NoOpStorageProvider {\n    async saveMessages(_messages) {}\n    async loadMessages() {\n        return [];\n    }\n    async clearMessages() {}\n    async saveResult(_id, _result) {}\n}\nexport { IndexedDBStorageProvider, MemoryStorageProvider, NoOpStorageProvider };\n","import { IndexedDBStorageProvider, MemoryStorageProvider, NoOpStorageProvider } from \"./indexeddb-storage-provider.mjs\";\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nclass LocalStorageProvider {\n    checkStorageSpace() {\n        try {\n            const testKey = 'storage-test';\n            const testData = 'x'.repeat(102400);\n            localStorage.setItem(testKey, testData);\n            localStorage.removeItem(testKey);\n            return true;\n        } catch (e) {\n            return false;\n        }\n    }\n    async saveMessages(messages) {\n        try {\n            if (!this.checkStorageSpace()) {\n                console.warn('Low storage space detected, clearing old data...');\n                await this.handleQuotaExceeded();\n            }\n            const messagesToSave = messages.slice(-this.maxStorageItems);\n            const lightMessages = messagesToSave.map((msg)=>({\n                    ...msg,\n                    result: void 0\n                }));\n            const messageData = JSON.stringify(lightMessages);\n            localStorage.setItem(this.messagesKey, messageData);\n        } catch (error) {\n            if (error instanceof DOMException && 'QuotaExceededError' === error.name) {\n                console.warn('LocalStorage quota exceeded, attempting to clear old data and retry...');\n                await this.handleQuotaExceeded();\n                try {\n                    const recentMessages = messages.slice(-10);\n                    const lightRecentMessages = recentMessages.map((msg)=>({\n                            ...msg,\n                            result: void 0\n                        }));\n                    const messageData = JSON.stringify(lightRecentMessages);\n                    localStorage.setItem(this.messagesKey, messageData);\n                    console.info('Successfully saved recent messages after clearing storage');\n                } catch (retryError) {\n                    console.error('Failed to save even after clearing storage:', retryError);\n                    await this.clearMessages();\n                }\n            } else console.error('Failed to save messages to localStorage:', error);\n        }\n    }\n    async loadMessages() {\n        try {\n            const stored = localStorage.getItem(this.messagesKey);\n            if (!stored) return [];\n            const messages = JSON.parse(stored);\n            const restoredMessages = await Promise.all(messages.map(async (msg)=>{\n                if ('result' === msg.type && msg.id) {\n                    const resultKey = `${this.resultsKey}-${msg.id}`;\n                    const storedResult = localStorage.getItem(resultKey);\n                    if (storedResult) try {\n                        const resultItem = JSON.parse(storedResult);\n                        return {\n                            ...msg,\n                            ...resultItem\n                        };\n                    } catch (e) {\n                        console.warn('Failed to parse stored result:', e);\n                    }\n                }\n                return msg;\n            }));\n            return restoredMessages;\n        } catch (error) {\n            console.error('Failed to load messages from localStorage:', error);\n            return [];\n        }\n    }\n    async clearMessages() {\n        try {\n            localStorage.removeItem(this.messagesKey);\n            const keys = Object.keys(localStorage);\n            keys.forEach((key)=>{\n                if (key.startsWith(this.resultsKey)) localStorage.removeItem(key);\n            });\n        } catch (error) {\n            console.error('Failed to clear messages from localStorage:', error);\n        }\n    }\n    async saveResult(id, result) {\n        try {\n            const resultKey = `${this.resultsKey}-${id}`;\n            localStorage.setItem(resultKey, JSON.stringify(result));\n        } catch (error) {\n            if (error instanceof DOMException && 'QuotaExceededError' === error.name) {\n                console.warn('LocalStorage quota exceeded when saving result, clearing old results...');\n                await this.handleQuotaExceeded();\n                try {\n                    const resultKey = `${this.resultsKey}-${id}`;\n                    localStorage.setItem(resultKey, JSON.stringify(result));\n                } catch (retryError) {\n                    console.error('Failed to save result even after clearing storage:', retryError);\n                }\n            } else console.error('Failed to save result to localStorage:', error);\n        }\n    }\n    async handleQuotaExceeded() {\n        try {\n            const keys = Object.keys(localStorage);\n            const resultKeys = keys.filter((key)=>key.startsWith(this.resultsKey));\n            const keysToRemove = resultKeys.slice(0, Math.max(1, Math.floor(resultKeys.length / 2)));\n            keysToRemove.forEach((key)=>{\n                localStorage.removeItem(key);\n            });\n            console.info(`Cleared ${keysToRemove.length} old result entries to free up storage space`);\n            const playgroundKeys = keys.filter((key)=>key.includes('playground') || key.includes('agent') || key.startsWith('midscene'));\n            if (playgroundKeys.length > 10) {\n                const additionalKeysToRemove = playgroundKeys.slice(0, Math.floor(playgroundKeys.length / 3));\n                additionalKeysToRemove.forEach((key)=>{\n                    if (key !== this.messagesKey) localStorage.removeItem(key);\n                });\n                console.info(`Cleared ${additionalKeysToRemove.length} additional playground-related entries`);\n            }\n        } catch (error) {\n            console.error('Failed to handle quota exceeded:', error);\n        }\n    }\n    constructor(namespace = 'playground'){\n        _define_property(this, \"messagesKey\", void 0);\n        _define_property(this, \"resultsKey\", void 0);\n        _define_property(this, \"maxStorageItems\", 50);\n        this.messagesKey = `${namespace}-messages`;\n        this.resultsKey = `${namespace}-results`;\n    }\n}\nclass storage_provider_MemoryStorageProvider {\n    async saveMessages(messages) {\n        this.messages = [\n            ...messages\n        ];\n    }\n    async loadMessages() {\n        return [\n            ...this.messages\n        ];\n    }\n    async clearMessages() {\n        this.messages = [];\n        this.results.clear();\n    }\n    async saveResult(id, result) {\n        this.results.set(id, result);\n    }\n    constructor(){\n        _define_property(this, \"messages\", []);\n        _define_property(this, \"results\", new Map());\n    }\n}\nclass storage_provider_NoOpStorageProvider {\n    async saveMessages(_messages) {}\n    async loadMessages() {\n        return [];\n    }\n    async clearMessages() {}\n    async saveResult(_id, _result) {}\n}\nvar storage_provider_StorageType = /*#__PURE__*/ function(StorageType) {\n    StorageType[\"INDEXEDDB\"] = \"indexeddb\";\n    StorageType[\"LOCALSTORAGE\"] = \"localStorage\";\n    StorageType[\"MEMORY\"] = \"memory\";\n    StorageType[\"NONE\"] = \"none\";\n    return StorageType;\n}({});\nfunction createStorageProvider() {\n    let type = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : \"indexeddb\", namespace = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 'playground';\n    switch(type){\n        case \"indexeddb\":\n            if ('undefined' != typeof indexedDB) return new IndexedDBStorageProvider(namespace);\n            console.warn('IndexedDB not available, falling back to localStorage');\n            return createStorageProvider(\"localStorage\", namespace);\n        case \"localStorage\":\n            if ('undefined' != typeof localStorage) return new LocalStorageProvider(namespace);\n            console.warn('localStorage not available, falling back to memory storage');\n            return createStorageProvider(\"memory\", namespace);\n        case \"memory\":\n            return new storage_provider_MemoryStorageProvider();\n        case \"none\":\n            return new storage_provider_NoOpStorageProvider();\n        default:\n            throw new Error(`Unknown storage type: ${type}`);\n    }\n}\nfunction detectBestStorageType() {\n    if ('undefined' != typeof indexedDB) try {\n        indexedDB.open('test', 1).onerror = ()=>{};\n        return \"indexeddb\";\n    } catch (e) {}\n    if ('undefined' != typeof localStorage) try {\n        localStorage.setItem('test', 'test');\n        localStorage.removeItem('test');\n        return \"localStorage\";\n    } catch (e) {}\n    return \"memory\";\n}\nexport { MemoryStorageProvider as IndexedDBMemoryStorageProvider, NoOpStorageProvider as IndexedDBNoOpStorageProvider, IndexedDBStorageProvider, LocalStorageProvider, storage_provider_MemoryStorageProvider as MemoryStorageProvider, storage_provider_NoOpStorageProvider as NoOpStorageProvider, storage_provider_StorageType as StorageType, createStorageProvider, detectBestStorageType };\n","'use client';\nimport { jsx, jsxs } from \"react/jsx-runtime\";\nimport \"pixi.js/unsafe-eval\";\nimport { Checkbox } from \"antd\";\nimport { Application, Container, Graphics, Rectangle, Sprite, Text, Texture } from \"pixi.js\";\nimport { useEffect, useMemo, useRef, useState } from \"react\";\nimport { colorForName, highlightColorForType } from \"../../utils/color.mjs\";\nimport \"./index.css\";\nimport { treeToList } from \"@sqaitech/shared/extractor\";\nimport { DropShadowFilter } from \"pixi-filters\";\nimport { useBlackboardPreference } from \"../../store/store.mjs\";\nconst itemFillAlpha = 0.4;\nconst highlightAlpha = 0.4;\nconst pointRadius = 10;\nconst pointMarkForItem = (point, type)=>{\n    const [x, y] = point;\n    const themeColor = highlightColorForType('element');\n    const graphics = new Graphics();\n    graphics.beginFill(themeColor, itemFillAlpha);\n    graphics.drawCircle(x, y, pointRadius);\n    graphics.endFill();\n    return graphics;\n};\nconst rectMarkForItem = (rect, name, type)=>{\n    const { left, top, width, height } = rect;\n    let themeColor;\n    themeColor = 'element' === type ? colorForName(name) : 'searchArea' === type ? highlightColorForType('searchArea') : highlightColorForType('element');\n    const alpha = 'highlight' === type ? highlightAlpha : itemFillAlpha;\n    const graphics = new Graphics();\n    graphics.beginFill(themeColor, alpha);\n    graphics.lineStyle(1, themeColor, 1);\n    graphics.drawRect(left, top, width, height);\n    graphics.endFill();\n    const dropShadowFilter = new DropShadowFilter({\n        blur: 2,\n        quality: 3,\n        alpha: 0.4,\n        offset: {\n            x: 4,\n            y: 4\n        },\n        color: 0x333333\n    });\n    graphics.filters = [\n        dropShadowFilter\n    ];\n    const nameFontSize = 18;\n    if (!name) return [\n        graphics\n    ];\n    const texts = new Text(name, {\n        fontSize: nameFontSize,\n        fill: 0x0\n    });\n    texts.x = left;\n    texts.y = Math.max(top - (nameFontSize + 4), 0);\n    return [\n        graphics,\n        texts\n    ];\n};\nconst Blackboard = (props)=>{\n    const highlightElements = props.highlightElements || [];\n    const highlightIds = highlightElements.map((e)=>e.id);\n    const highlightRect = props.highlightRect;\n    const highlightPoints = props.highlightPoints;\n    const context = props.uiContext;\n    const { size, screenshotBase64 } = context;\n    const screenWidth = size.width;\n    const screenHeight = size.height;\n    const domRef = useRef(null);\n    const app = useMemo(()=>new Application(), []);\n    const [appInitialed, setAppInitialed] = useState(false);\n    const highlightContainer = useMemo(()=>new Container(), []);\n    const elementMarkContainer = useMemo(()=>new Container(), []);\n    const [hoverElement, setHoverElement] = useState(null);\n    const pixiBgRef = useRef(void 0);\n    const { backgroundVisible, setBackgroundVisible, elementsVisible, setElementsVisible } = useBlackboardPreference();\n    useEffect(()=>{\n        Promise.resolve((async ()=>{\n            if (!domRef.current || !screenWidth) return;\n            await app.init({\n                width: screenWidth,\n                height: screenHeight,\n                background: 0xffffff\n            });\n            const canvasEl = domRef.current;\n            domRef.current.appendChild(app.canvas);\n            const { clientWidth } = domRef.current.parentElement;\n            const targetHeight = 0.6 * window.innerHeight;\n            const viewportRatio = clientWidth / targetHeight;\n            if (screenWidth / screenHeight <= viewportRatio) {\n                const ratio = targetHeight / screenHeight;\n                canvasEl.style.width = `${Math.floor(screenWidth * ratio)}px`;\n                canvasEl.style.height = `${Math.floor(screenHeight * ratio)}px`;\n            }\n            app.stage.addChild(highlightContainer);\n            app.stage.addChild(elementMarkContainer);\n            setAppInitialed(true);\n        })());\n        return ()=>{\n            console.log('will destroy');\n            try {\n                app.destroy(true, {\n                    children: true,\n                    texture: true\n                });\n            } catch (e) {\n                console.warn('destroy failed', e);\n            }\n        };\n    }, [\n        app,\n        screenWidth,\n        screenHeight\n    ]);\n    useEffect(()=>{\n        if (!appInitialed) return;\n        app.stage.eventMode = 'static';\n        app.stage.hitArea = new Rectangle(0, 0, screenWidth, screenHeight);\n        const clickHandler = (event)=>{\n            var _props_onCanvasClick;\n            console.log('pixi click', event);\n            const { x, y } = event.data.global;\n            null == (_props_onCanvasClick = props.onCanvasClick) || _props_onCanvasClick.call(props, [\n                Math.round(x),\n                Math.round(y)\n            ]);\n        };\n        app.stage.on('click', clickHandler);\n        return ()=>{\n            var _app_stage;\n            null == app || null == (_app_stage = app.stage) || _app_stage.off('click');\n        };\n    }, [\n        appInitialed,\n        props.onCanvasClick,\n        screenWidth,\n        screenHeight\n    ]);\n    useEffect(()=>{\n        if (!appInitialed) return;\n        const img = new Image();\n        img.onload = ()=>{\n            if (!app.stage) return;\n            const screenshotTexture = Texture.from(img);\n            const backgroundSprite = new Sprite(screenshotTexture);\n            backgroundSprite.x = 0;\n            backgroundSprite.y = 0;\n            backgroundSprite.width = screenWidth;\n            backgroundSprite.height = screenHeight;\n            backgroundSprite.eventMode = 'passive';\n            app.stage.addChildAt(backgroundSprite, 0);\n            pixiBgRef.current = backgroundSprite;\n            backgroundSprite.visible = backgroundVisible;\n        };\n        img.onerror = (e)=>{\n            console.error('load screenshot failed', e);\n        };\n        img.src = screenshotBase64;\n    }, [\n        app.stage,\n        appInitialed,\n        screenWidth,\n        screenHeight\n    ]);\n    const { highlightElementRects } = useMemo(()=>{\n        const highlightElementRects = [];\n        highlightContainer.removeChildren();\n        elementMarkContainer.removeChildren();\n        highlightContainer.eventMode = 'passive';\n        elementMarkContainer.eventMode = 'passive';\n        if (highlightRect) {\n            const [graphics] = rectMarkForItem(highlightRect, 'Search Area', 'searchArea');\n            highlightContainer.addChild(graphics);\n        }\n        if (highlightElements.length) highlightElements.forEach((element)=>{\n            const { rect, content, id } = element;\n            const [graphics] = rectMarkForItem(rect, content, 'highlight');\n            highlightContainer.addChild(graphics);\n        });\n        if (null == highlightPoints ? void 0 : highlightPoints.length) highlightPoints.forEach((point)=>{\n            const graphics = pointMarkForItem(point, 'highlightPoint');\n            highlightContainer.addChild(graphics);\n        });\n        const elements = treeToList(context.tree);\n        elements.forEach((element)=>{\n            const { rect, content, id } = element;\n            const ifHighlight = highlightIds.includes(id) || (null == hoverElement ? void 0 : hoverElement.id) === id;\n            if (ifHighlight) return;\n            const [graphics] = rectMarkForItem(rect, content, 'element');\n            elementMarkContainer.addChild(graphics);\n        });\n        elementMarkContainer.visible = elementsVisible;\n        return {\n            highlightElementRects\n        };\n    }, [\n        app,\n        appInitialed,\n        highlightElements,\n        context.tree,\n        hoverElement,\n        highlightRect,\n        highlightPoints\n    ]);\n    const onSetBackgroundVisible = (e)=>{\n        setBackgroundVisible(e.target.checked);\n        if (pixiBgRef.current) pixiBgRef.current.visible = e.target.checked;\n    };\n    const onSetElementsVisible = (e)=>{\n        setElementsVisible(e.target.checked);\n        elementMarkContainer.visible = e.target.checked;\n    };\n    let bottomTipA = null;\n    if (1 === highlightElementRects.length) bottomTipA = /*#__PURE__*/ jsx(\"div\", {\n        className: \"bottom-tip\",\n        children: /*#__PURE__*/ jsxs(\"div\", {\n            className: \"bottom-tip-item\",\n            children: [\n                \"Element: \",\n                JSON.stringify(highlightElementRects[0])\n            ]\n        })\n    });\n    else if (highlightElementRects.length > 1) bottomTipA = /*#__PURE__*/ jsx(\"div\", {\n        className: \"bottom-tip\",\n        children: /*#__PURE__*/ jsxs(\"div\", {\n            className: \"bottom-tip-item\",\n            children: [\n                \"Element: \",\n                JSON.stringify(highlightElementRects)\n            ]\n        })\n    });\n    return /*#__PURE__*/ jsxs(\"div\", {\n        className: \"blackboard\",\n        children: [\n            /*#__PURE__*/ jsx(\"div\", {\n                className: \"blackboard-main-content\",\n                style: {\n                    width: '100%'\n                },\n                ref: domRef\n            }),\n            /*#__PURE__*/ jsx(\"div\", {\n                className: \"blackboard-filter\",\n                style: {\n                    display: props.hideController ? 'none' : 'block'\n                },\n                children: /*#__PURE__*/ jsxs(\"div\", {\n                    className: \"overlay-control\",\n                    children: [\n                        /*#__PURE__*/ jsx(Checkbox, {\n                            checked: backgroundVisible,\n                            onChange: onSetBackgroundVisible,\n                            children: \"Background\"\n                        }),\n                        /*#__PURE__*/ jsx(Checkbox, {\n                            checked: elementsVisible,\n                            onChange: onSetElementsVisible,\n                            children: \"Elements\"\n                        })\n                    ]\n                })\n            }),\n            /*#__PURE__*/ jsx(\"div\", {\n                className: \"bottom-tip\",\n                style: {\n                    display: props.hideController ? 'none' : 'block'\n                },\n                children: bottomTipA\n            })\n        ]\n    });\n};\nconst blackboard = Blackboard;\nexport { Blackboard, blackboard as default, pointMarkForItem, rectMarkForItem };\n","import { jsx } from \"react/jsx-runtime\";\nimport \"./index.css\";\nconst ShinyText = (param)=>{\n    let { text, disabled = false, speed = 5, className = '' } = param;\n    const style = {\n        '--animation-duration': `${speed}s`\n    };\n    return /*#__PURE__*/ jsx(\"div\", {\n        className: `shiny-text ${disabled ? 'disabled' : ''} ${className}`,\n        style: style,\n        children: text\n    });\n};\nconst shiny_text = ShinyText;\nexport { shiny_text as default };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport { ArrowRightOutlined, CheckOutlined, ClockCircleOutlined, CloseOutlined, LogoutOutlined, MinusOutlined, WarningOutlined } from \"@ant-design/icons\";\nimport { Alert } from \"antd\";\nimport shiny_text from \"../shiny-text/index.mjs\";\nfunction timeCostStrElement(timeCost) {\n    let str;\n    str = 'number' != typeof timeCost ? '-' : `${(timeCost / 1000).toFixed(2)}s`;\n    return /*#__PURE__*/ jsx(\"span\", {\n        style: {\n            fontVariantNumeric: 'tabular-nums',\n            fontFeatureSettings: 'tnum'\n        },\n        children: str\n    });\n}\nconst iconForStatus = (status)=>{\n    switch(status){\n        case 'finished':\n        case 'passed':\n        case 'success':\n        case 'connected':\n            return /*#__PURE__*/ jsx(\"span\", {\n                style: {\n                    color: '#00AD4B'\n                },\n                children: /*#__PURE__*/ jsx(CheckOutlined, {})\n            });\n        case 'finishedWithWarning':\n            return /*#__PURE__*/ jsx(\"span\", {\n                style: {\n                    color: '#f7bb05'\n                },\n                children: /*#__PURE__*/ jsx(WarningOutlined, {})\n            });\n        case 'failed':\n        case 'closed':\n        case 'timedOut':\n        case 'interrupted':\n            return /*#__PURE__*/ jsx(\"span\", {\n                style: {\n                    color: '#FF0A0A'\n                },\n                children: /*#__PURE__*/ jsx(CloseOutlined, {})\n            });\n        case 'pending':\n            return /*#__PURE__*/ jsx(ClockCircleOutlined, {});\n        case 'cancelled':\n        case 'skipped':\n            return /*#__PURE__*/ jsx(LogoutOutlined, {});\n        case 'running':\n            return /*#__PURE__*/ jsx(ArrowRightOutlined, {});\n        default:\n            return /*#__PURE__*/ jsx(MinusOutlined, {});\n    }\n};\nconst errorMessageServerNotReady = /*#__PURE__*/ jsxs(\"span\", {\n    children: [\n        \"Don't worry, just one more step to launch the playground server.\",\n        /*#__PURE__*/ jsx(\"br\", {}),\n        \"Please run one of the commands under the midscene project directory:\",\n        /*#__PURE__*/ jsx(\"br\", {}),\n        \"a. \",\n        /*#__PURE__*/ jsx(\"strong\", {\n            children: \"npx midscene-playground\"\n        }),\n        /*#__PURE__*/ jsx(\"br\", {}),\n        \"b. \",\n        /*#__PURE__*/ jsx(\"strong\", {\n            children: \"npx --yes @sqaitech/web\"\n        })\n    ]\n});\nconst serverLaunchTip = function() {\n    let notReadyMessage = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : errorMessageServerNotReady;\n    return /*#__PURE__*/ jsx(\"div\", {\n        className: \"server-tip\",\n        children: /*#__PURE__*/ jsx(Alert, {\n            message: \"Playground Server Not Ready\",\n            description: notReadyMessage,\n            type: \"warning\"\n        })\n    });\n};\nconst emptyResultTip = /*#__PURE__*/ jsx(\"div\", {\n    className: \"result-empty-tip\",\n    style: {\n        textAlign: 'center'\n    },\n    children: /*#__PURE__*/ jsx(shiny_text, {\n        disabled: true,\n        text: \"The result will be shown here\"\n    })\n});\nexport { emptyResultTip, errorMessageServerNotReady, iconForStatus, serverLaunchTip, timeCostStrElement };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport { Button } from \"antd\";\nimport blackboard from \"../blackboard/index.mjs\";\nimport { iconForStatus } from \"../misc/index.mjs\";\nimport playground_demo_ui_context from \"../playground/playground-demo-ui-context.json\";\nconst ContextPreview = (param)=>{\n    let { uiContextPreview, setUiContextPreview, showContextPreview } = param;\n    if (!showContextPreview) return null;\n    return /*#__PURE__*/ jsxs(\"div\", {\n        className: \"form-part context-panel\",\n        children: [\n            /*#__PURE__*/ jsx(\"h3\", {\n                children: \"UI Context\"\n            }),\n            uiContextPreview ? /*#__PURE__*/ jsx(blackboard, {\n                uiContext: uiContextPreview,\n                hideController: true\n            }) : /*#__PURE__*/ jsxs(\"div\", {\n                children: [\n                    iconForStatus('failed'),\n                    \" No UI context\",\n                    /*#__PURE__*/ jsx(Button, {\n                        type: \"link\",\n                        onClick: (e)=>{\n                            e.preventDefault();\n                            setUiContextPreview(playground_demo_ui_context);\n                        },\n                        children: \"Load Demo\"\n                    }),\n                    /*#__PURE__*/ jsx(\"div\", {\n                        children: \"To load the UI context, you can either use the demo data above, or click the 'Send to Playground' in the report page.\"\n                    })\n                ]\n            })\n        ]\n    });\n};\nexport { ContextPreview };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport { ExclamationCircleFilled } from \"@ant-design/icons\";\nimport { useEnvConfig } from \"../../store/store.mjs\";\nimport { EnvConfig } from \"../env-config/index.mjs\";\nimport \"./index.css\";\nconst EnvConfigReminder = (param)=>{\n    let { className = '' } = param;\n    const { config } = useEnvConfig();\n    const configAlreadySet = Object.keys(config || {}).length >= 1;\n    if (configAlreadySet) return null;\n    return /*#__PURE__*/ jsxs(\"div\", {\n        className: `env-config-reminder ${className}`,\n        children: [\n            /*#__PURE__*/ jsx(ExclamationCircleFilled, {\n                className: \"reminder-icon\"\n            }),\n            /*#__PURE__*/ jsx(\"span\", {\n                className: \"reminder-text\",\n                children: \"Please set up your environment variables before using.\"\n            }),\n            /*#__PURE__*/ jsx(EnvConfig, {\n                mode: \"text\",\n                showTooltipWhenEmpty: false\n            })\n        ]\n    });\n};\nexport { EnvConfigReminder };\n","import { jsx } from \"react/jsx-runtime\";\nimport \"react\";\nconst SvgGlobalPerspective = (props)=>/*#__PURE__*/ jsx(\"svg\", {\n        xmlns: \"http://www.w3.org/2000/svg\",\n        width: 16,\n        height: 16,\n        fill: \"none\",\n        viewBox: \"0 0 16 16\",\n        ...props,\n        children: /*#__PURE__*/ jsx(\"path\", {\n            fill: \"#333\",\n            d: \"M1.333 13v-2.5a.667.667 0 0 1 1.334 0V13c0 .184.149.333.333.333h2.5a.667.667 0 0 1 0 1.334H3c-.92 0-1.667-.746-1.667-1.667m12 0v-2.5a.667.667 0 0 1 1.334 0V13c0 .92-.746 1.667-1.667 1.667h-2.5a.667.667 0 0 1 0-1.334H13a.333.333 0 0 0 .333-.333m-12-7.5V3c0-.92.747-1.667 1.667-1.667h2.5a.667.667 0 0 1 0 1.334H3A.333.333 0 0 0 2.667 3v2.5a.667.667 0 0 1-1.334 0m12 0V3A.333.333 0 0 0 13 2.667h-2.5a.667.667 0 0 1 0-1.334H13c.92 0 1.667.747 1.667 1.667v2.5a.667.667 0 0 1-1.334 0M5.667 10.333h4.666V5.667H5.667zm6 .167c0 .644-.523 1.167-1.167 1.167h-5A1.167 1.167 0 0 1 4.333 10.5v-5c0-.644.523-1.167 1.167-1.167h5c.644 0 1.167.523 1.167 1.167z\"\n        })\n    });\nconst global_perspective = SvgGlobalPerspective;\nexport { global_perspective as default };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport \"react\";\nconst SvgPlayerSetting = (props)=>/*#__PURE__*/ jsxs(\"svg\", {\n        xmlns: \"http://www.w3.org/2000/svg\",\n        width: 16,\n        height: 16,\n        fill: \"none\",\n        viewBox: \"0 0 16 16\",\n        ...props,\n        children: [\n            /*#__PURE__*/ jsx(\"path\", {\n                stroke: \"#333\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 1.333,\n                d: \"M11.333 13.667 14.667 8l-3.334-5.667H4.667L1.333 8l3.334 5.667z\"\n            }),\n            /*#__PURE__*/ jsx(\"path\", {\n                stroke: \"#333\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 1.333,\n                d: \"M8 9.667a1.667 1.667 0 1 0 0-3.334 1.667 1.667 0 0 0 0 3.334Z\"\n            })\n        ]\n    });\nconst player_setting = SvgPlayerSetting;\nexport { player_setting as default };\n","import { jsx } from \"react/jsx-runtime\";\nimport \"react\";\nconst SvgShowMarker = (props)=>/*#__PURE__*/ jsx(\"svg\", {\n        xmlns: \"http://www.w3.org/2000/svg\",\n        width: 16,\n        height: 16,\n        fill: \"none\",\n        viewBox: \"0 0 16 16\",\n        ...props,\n        children: /*#__PURE__*/ jsx(\"path\", {\n            fill: \"#333\",\n            d: \"M13 1.835a2.165 2.165 0 0 1 .665 4.225v3.88a2.166 2.166 0 1 1-2.725 2.725H5.06a2.165 2.165 0 1 1-2.725-2.726V6.06A2.165 2.165 0 1 1 5.06 3.336h5.88c.281-.87 1.097-1.5 2.06-1.5m-10 9.33a.835.835 0 1 0 0 1.67.835.835 0 0 0 0-1.67m10 0a.835.835 0 1 0 0 1.67.835.835 0 0 0 0-1.67m-7.94-6.5A2.17 2.17 0 0 1 3.665 6.06v3.88c.66.213 1.181.734 1.395 1.395h5.88a2.17 2.17 0 0 1 1.395-1.396V6.06a2.17 2.17 0 0 1-1.395-1.394zM3 3.165a.835.835 0 1 0 0 1.67.835.835 0 0 0 0-1.67m10 0a.835.835 0 1 0 0 1.67.835.835 0 0 0 0-1.67\"\n        })\n    });\nconst show_marker = SvgShowMarker;\nexport { show_marker as default };\n","import \"pixi.js/unsafe-eval\";\nimport { Assets } from \"pixi.js\";\nconst globalTextureMap = new Map();\nconst loadTexture = async (img)=>{\n    if (globalTextureMap.has(img)) return;\n    return Assets.load(img).then((texture)=>{\n        globalTextureMap.set(img, texture);\n    });\n};\nconst getTextureFromCache = (name)=>globalTextureMap.get(name);\nconst getTexture = async (name)=>{\n    if (globalTextureMap.has(name)) return globalTextureMap.get(name);\n    await loadTexture(name);\n    return globalTextureMap.get(name);\n};\nexport { getTexture, getTextureFromCache, loadTexture };\n","'use client';\nimport { jsx, jsxs } from \"react/jsx-runtime\";\nimport \"pixi.js/unsafe-eval\";\nimport { Application, Container, Sprite } from \"pixi.js\";\nimport { useEffect, useMemo, useRef, useState } from \"react\";\nimport \"./index.css\";\nimport { mouseLoading, mousePointer } from \"../../utils/index.mjs\";\nimport { CaretRightOutlined, DownloadOutlined, ExportOutlined, LoadingOutlined } from \"@ant-design/icons\";\nimport { treeToList } from \"@sqaitech/shared/extractor\";\nimport { Dropdown, Spin, Switch, Tooltip } from \"antd\";\nimport global_perspective from \"../../icons/global-perspective.mjs\";\nimport player_setting from \"../../icons/player-setting.mjs\";\nimport show_marker from \"../../icons/show-marker.mjs\";\nimport { useBlackboardPreference } from \"../../store/store.mjs\";\nimport { getTextureFromCache, loadTexture } from \"../../utils/pixi-loader.mjs\";\nimport { rectMarkForItem } from \"../blackboard/index.mjs\";\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nconst canvasPaddingLeft = 0;\nconst canvasPaddingTop = 0;\nconst cubicBezier = (t, p0, p1, p2, p3)=>{\n    const t2 = 1 - t;\n    return p0 * t2 * t2 * t2 + 3 * p1 * t * t2 * t2 + 3 * p2 * t * t * t2 + p3 * t * t * t;\n};\nconst cubicImage = (t)=>linear(t);\nconst cubicInsightElement = (t)=>cubicBezier(t, 0, 0.5, 0.5, 1);\nconst cubicMouse = (t)=>linear(t);\nconst linear = (t)=>t;\nconst sleep = (ms)=>new Promise((resolve)=>setTimeout(resolve, ms));\nconst ERROR_FRAME_CANCEL = 'frame cancel (this is an error on purpose)';\nconst frameKit = ()=>{\n    let cancelFlag = false;\n    return {\n        frame: (callback)=>{\n            if (cancelFlag) throw new Error(ERROR_FRAME_CANCEL);\n            requestAnimationFrame(()=>{\n                if (cancelFlag) throw new Error(ERROR_FRAME_CANCEL);\n                callback(performance.now());\n            });\n        },\n        timeout: (callback, ms)=>{\n            if (cancelFlag) throw new Error(ERROR_FRAME_CANCEL);\n            setTimeout(()=>{\n                if (cancelFlag) throw new Error(ERROR_FRAME_CANCEL);\n                callback();\n            }, ms);\n        },\n        cancel: ()=>{\n            cancelFlag = true;\n        }\n    };\n};\nconst singleElementFadeInDuration = 80;\nconst LAYER_ORDER_IMG = 0;\nconst LAYER_ORDER_INSIGHT = 1;\nconst LAYER_ORDER_POINTER = 2;\nconst LAYER_ORDER_SPINNING_POINTER = 3;\nconst downloadReport = (content)=>{\n    const blob = new Blob([\n        content\n    ], {\n        type: 'text/html'\n    });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = 'sqai_report.html';\n    a.click();\n};\nclass RecordingSession {\n    start() {\n        const stream = this.canvas.captureStream(60);\n        const mediaRecorder = new MediaRecorder(stream, {\n            mimeType: 'video/webm'\n        });\n        mediaRecorder.ondataavailable = (event)=>{\n            if (event.data.size > 0) this.chunks.push(event.data);\n        };\n        this.mediaRecorder = mediaRecorder;\n        this.recording = true;\n        return this.mediaRecorder.start();\n    }\n    stop() {\n        var _this_mediaRecorder;\n        if (!this.recording || !this.mediaRecorder) return void console.warn('not recording');\n        this.mediaRecorder.onstop = ()=>{\n            const blob = new Blob(this.chunks, {\n                type: 'video/webm'\n            });\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = 'sqai_replay.webm';\n            a.click();\n            URL.revokeObjectURL(url);\n        };\n        null == (_this_mediaRecorder = this.mediaRecorder) || _this_mediaRecorder.stop();\n        this.recording = false;\n        this.mediaRecorder = null;\n    }\n    constructor(canvas){\n        _define_property(this, \"canvas\", void 0);\n        _define_property(this, \"mediaRecorder\", null);\n        _define_property(this, \"chunks\", void 0);\n        _define_property(this, \"recording\", false);\n        this.canvas = canvas;\n        this.chunks = [];\n    }\n}\nfunction Player(props) {\n    var _scripts_;\n    const [titleText, setTitleText] = useState('');\n    const [subTitleText, setSubTitleText] = useState('');\n    const { autoZoom, setAutoZoom, elementsVisible, setElementsVisible } = useBlackboardPreference();\n    useEffect(()=>{\n        if ((null == props ? void 0 : props.autoZoom) !== void 0) setAutoZoom(props.autoZoom);\n    }, [\n        null == props ? void 0 : props.autoZoom,\n        setAutoZoom\n    ]);\n    useEffect(()=>{\n        if ((null == props ? void 0 : props.elementsVisible) !== void 0) setElementsVisible(props.elementsVisible);\n    }, [\n        null == props ? void 0 : props.elementsVisible,\n        setElementsVisible\n    ]);\n    const scripts = null == props ? void 0 : props.replayScripts;\n    const imageWidth = (null == props ? void 0 : props.imageWidth) || 1920;\n    const imageHeight = (null == props ? void 0 : props.imageHeight) || 1080;\n    const fitMode = (null == props ? void 0 : props.fitMode) || 'height';\n    const currentImg = useRef((null == scripts ? void 0 : null == (_scripts_ = scripts[0]) ? void 0 : _scripts_.img) || null);\n    const divContainerRef = useRef(null);\n    const app = useMemo(()=>new Application(), []);\n    const pointerSprite = useRef(null);\n    const spinningPointerSprite = useRef(null);\n    const [replayMark, setReplayMark] = useState(0);\n    const triggerReplay = ()=>{\n        setReplayMark(Date.now());\n    };\n    const windowContentContainer = useMemo(()=>{\n        const container = new Container();\n        return container;\n    }, []);\n    const insightMarkContainer = useMemo(()=>{\n        const container = new Container();\n        container.zIndex = LAYER_ORDER_INSIGHT;\n        return container;\n    }, []);\n    useEffect(()=>{\n        insightMarkContainer.visible = elementsVisible;\n    }, [\n        elementsVisible,\n        insightMarkContainer\n    ]);\n    const basicCameraState = {\n        left: 0,\n        top: 0,\n        width: imageWidth,\n        pointerLeft: Math.round(imageWidth / 2),\n        pointerTop: Math.round(imageHeight / 2)\n    };\n    const [animationProgress, setAnimationProgress] = useState(-1);\n    const cancelFlag = useRef(false);\n    useEffect(()=>{\n        cancelFlag.current = false;\n        return ()=>{\n            cancelFlag.current = true;\n        };\n    }, []);\n    const cameraState = useRef({\n        ...basicCameraState\n    });\n    const resizeCanvasIfNeeded = async (newWidth, newHeight)=>{\n        if (app.screen.width !== newWidth || app.screen.height !== newHeight) {\n            app.renderer.resize(newWidth, newHeight);\n            if (divContainerRef.current) {\n                const aspectRatio = newWidth / newHeight;\n                divContainerRef.current.style.setProperty('--canvas-aspect-ratio', aspectRatio.toString());\n            }\n            const newBasicCameraState = {\n                left: 0,\n                top: 0,\n                width: newWidth,\n                pointerLeft: Math.round(newWidth / 2),\n                pointerTop: Math.round(newHeight / 2)\n            };\n            cameraState.current = newBasicCameraState;\n        }\n    };\n    const repaintImage = async (scriptWidth, scriptHeight)=>{\n        const imgToUpdate = currentImg.current;\n        if (!imgToUpdate) return void console.warn('no image to update');\n        const targetWidth = scriptWidth || imageWidth;\n        const targetHeight = scriptHeight || imageHeight;\n        await resizeCanvasIfNeeded(targetWidth, targetHeight);\n        if (!getTextureFromCache(imgToUpdate)) {\n            console.warn('image not loaded', imgToUpdate);\n            await loadTexture(imgToUpdate);\n        }\n        const texture = getTextureFromCache(imgToUpdate);\n        if (!texture) throw new Error('texture not found');\n        const sprite = Sprite.from(texture);\n        if (!sprite) throw new Error('sprite not found');\n        const mainImgLabel = 'main-img';\n        const child = windowContentContainer.getChildByLabel(mainImgLabel);\n        if (child) windowContentContainer.removeChild(child);\n        sprite.label = mainImgLabel;\n        sprite.zIndex = LAYER_ORDER_IMG;\n        sprite.width = targetWidth;\n        sprite.height = targetHeight;\n        windowContentContainer.addChild(sprite);\n    };\n    const spinningPointer = (frame)=>{\n        var _pointerSprite_current, _pointerSprite_current1;\n        if (!spinningPointerSprite.current) {\n            spinningPointerSprite.current = Sprite.from(mouseLoading);\n            spinningPointerSprite.current.zIndex = LAYER_ORDER_SPINNING_POINTER;\n            spinningPointerSprite.current.anchor.set(0.5, 0.5);\n            spinningPointerSprite.current.scale.set(0.5);\n            spinningPointerSprite.current.label = 'spinning-pointer';\n        }\n        spinningPointerSprite.current.x = (null == (_pointerSprite_current = pointerSprite.current) ? void 0 : _pointerSprite_current.x) || 0;\n        spinningPointerSprite.current.y = (null == (_pointerSprite_current1 = pointerSprite.current) ? void 0 : _pointerSprite_current1.y) || 0;\n        windowContentContainer.addChild(spinningPointerSprite.current);\n        let startTime;\n        let isCancelled = false;\n        const animate = (currentTime)=>{\n            if (isCancelled) return;\n            if (!startTime) startTime = currentTime;\n            const elapsedTime = currentTime - startTime;\n            const progress = (Math.sin(elapsedTime / 500 - Math.PI / 2) + 1) / 2;\n            const rotation = progress * Math.PI * 2;\n            if (spinningPointerSprite.current) spinningPointerSprite.current.rotation = rotation;\n            frame(animate);\n        };\n        frame(animate);\n        const stopFn = ()=>{\n            if (spinningPointerSprite.current) windowContentContainer.removeChild(spinningPointerSprite.current);\n            isCancelled = true;\n        };\n        return stopFn;\n    };\n    const updatePointer = async (img, x, y)=>{\n        var _pointerSprite_current, _pointerSprite_current1;\n        if (!getTextureFromCache(img)) {\n            console.warn('image not loaded', img);\n            await loadTexture(img);\n        }\n        const texture = getTextureFromCache(img);\n        if (!texture) throw new Error('texture not found');\n        const sprite = Sprite.from(texture);\n        let targetX = null == (_pointerSprite_current = pointerSprite.current) ? void 0 : _pointerSprite_current.x;\n        let targetY = null == (_pointerSprite_current1 = pointerSprite.current) ? void 0 : _pointerSprite_current1.y;\n        if ('number' == typeof x) targetX = x;\n        if ('number' == typeof y) targetY = y;\n        if (void 0 === targetX || void 0 === targetY) return void console.warn('invalid pointer position', x, y);\n        if (pointerSprite.current) {\n            const pointer = windowContentContainer.getChildByLabel('pointer');\n            if (pointer) windowContentContainer.removeChild(pointer);\n        }\n        pointerSprite.current = sprite;\n        pointerSprite.current.x = targetX;\n        pointerSprite.current.y = targetY;\n        pointerSprite.current.label = 'pointer';\n        pointerSprite.current.zIndex = LAYER_ORDER_POINTER;\n        windowContentContainer.addChild(pointerSprite.current);\n    };\n    const updateCamera = (state, currentWidth)=>{\n        cameraState.current = state;\n        const effectiveWidth = currentWidth || app.screen.width || imageWidth;\n        const newScale = autoZoom ? Math.max(1, effectiveWidth / state.width) : 1;\n        windowContentContainer.scale.set(newScale);\n        windowContentContainer.x = autoZoom ? Math.round(canvasPaddingLeft - state.left * newScale) : canvasPaddingLeft;\n        windowContentContainer.y = autoZoom ? Math.round(canvasPaddingTop - state.top * newScale) : canvasPaddingTop;\n        const pointer = windowContentContainer.getChildByLabel('pointer');\n        if (pointer) {\n            pointer.scale.set(1 / newScale);\n            if ('number' == typeof state.pointerLeft && 'number' == typeof state.pointerTop) {\n                pointer.x = state.pointerLeft;\n                pointer.y = state.pointerTop;\n            }\n        }\n    };\n    const cameraAnimation = async (targetState, duration, frame)=>{\n        const currentCanvasWidth = app.screen.width || imageWidth;\n        const currentCanvasHeight = app.screen.height || imageHeight;\n        if (!autoZoom) {\n            const currentState = {\n                ...cameraState.current\n            };\n            const startPointerLeft = currentState.pointerLeft;\n            const startPointerTop = currentState.pointerTop;\n            const startTime = performance.now();\n            const shouldMovePointer = 'number' == typeof targetState.pointerLeft && 'number' == typeof targetState.pointerTop && (targetState.pointerLeft !== startPointerLeft || targetState.pointerTop !== startPointerTop);\n            if (!shouldMovePointer) return;\n            await new Promise((resolve)=>{\n                const animate = (currentTime)=>{\n                    const elapsedTime = currentTime - startTime;\n                    const rawProgress = Math.min(elapsedTime / duration, 1);\n                    const progress = cubicMouse(rawProgress);\n                    const nextState = {\n                        ...currentState,\n                        pointerLeft: startPointerLeft + (targetState.pointerLeft - startPointerLeft) * progress,\n                        pointerTop: startPointerTop + (targetState.pointerTop - startPointerTop) * progress\n                    };\n                    updateCamera(nextState, currentCanvasWidth);\n                    if (elapsedTime < duration) frame(animate);\n                    else resolve();\n                };\n                frame(animate);\n            });\n            return;\n        }\n        const currentState = {\n            ...cameraState.current\n        };\n        const startLeft = currentState.left;\n        const startTop = currentState.top;\n        const startPointerLeft = currentState.pointerLeft;\n        const startPointerTop = currentState.pointerTop;\n        const startScale = currentState.width / currentCanvasWidth;\n        const startTime = performance.now();\n        const shouldMovePointer = 'number' == typeof targetState.pointerLeft && 'number' == typeof targetState.pointerTop && (targetState.pointerLeft !== startPointerLeft || targetState.pointerTop !== startPointerTop);\n        const pointerMoveDuration = shouldMovePointer ? 0.375 * duration : 0;\n        const cameraMoveStart = pointerMoveDuration;\n        const cameraMoveDuration = duration - pointerMoveDuration;\n        await new Promise((resolve)=>{\n            const animate = (currentTime)=>{\n                const nextState = {\n                    ...cameraState.current\n                };\n                const elapsedTime = currentTime - startTime;\n                if (shouldMovePointer) if (elapsedTime <= pointerMoveDuration) {\n                    const rawMouseProgress = Math.min(elapsedTime / pointerMoveDuration, 1);\n                    const mouseProgress = cubicMouse(rawMouseProgress);\n                    nextState.pointerLeft = startPointerLeft + (targetState.pointerLeft - startPointerLeft) * mouseProgress;\n                    nextState.pointerTop = startPointerTop + (targetState.pointerTop - startPointerTop) * mouseProgress;\n                } else {\n                    nextState.pointerLeft = targetState.pointerLeft;\n                    nextState.pointerTop = targetState.pointerTop;\n                }\n                if (elapsedTime > cameraMoveStart) {\n                    const cameraElapsedTime = elapsedTime - cameraMoveStart;\n                    const rawCameraProgress = Math.min(cameraElapsedTime / cameraMoveDuration, 1);\n                    const cameraProgress = cubicImage(rawCameraProgress);\n                    const targetScale = targetState.width / currentCanvasWidth;\n                    const progressScale = startScale + (targetScale - startScale) * cameraProgress;\n                    const progressWidth = currentCanvasWidth * progressScale;\n                    const progressHeight = currentCanvasHeight * progressScale;\n                    nextState.width = progressWidth;\n                    const progressLeft = startLeft + (targetState.left - startLeft) * cameraProgress;\n                    const progressTop = startTop + (targetState.top - startTop) * cameraProgress;\n                    const horizontalExceed = progressLeft + progressWidth - currentCanvasWidth;\n                    const verticalExceed = progressTop + progressHeight - currentCanvasHeight;\n                    nextState.left = horizontalExceed > 0 ? progressLeft + horizontalExceed : progressLeft;\n                    nextState.top = verticalExceed > 0 ? progressTop + verticalExceed : progressTop;\n                }\n                updateCamera(nextState, currentCanvasWidth);\n                if (elapsedTime < duration) frame(animate);\n                else resolve();\n            };\n            frame(animate);\n        });\n    };\n    const fadeInGraphics = function(graphics, duration, frame) {\n        let targetAlpha = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 1;\n        return new Promise((resolve)=>{\n            const startTime = performance.now();\n            const animate = (currentTime)=>{\n                const elapsedTime = currentTime - startTime;\n                const progress = Math.min(elapsedTime / duration, 1);\n                graphics.alpha = 0 === targetAlpha ? 1 - linear(progress) : linear(progress);\n                if (elapsedTime < duration) frame(animate);\n                else resolve();\n            };\n            frame(animate);\n        });\n    };\n    const fadeOutItem = async (graphics, duration, frame)=>fadeInGraphics(graphics, duration, frame, 0);\n    const insightElementsAnimation = async (elements, highlightElements, searchArea, duration, frame)=>{\n        insightMarkContainer.removeChildren();\n        const elementsToAdd = [\n            ...elements\n        ];\n        const totalLength = elementsToAdd.length;\n        let childrenCount = 0;\n        await new Promise((resolve)=>{\n            const startTime = performance.now();\n            const animate = (currentTime)=>{\n                const elapsedTime = currentTime - startTime;\n                const progress = cubicInsightElement(Math.min(elapsedTime / duration, 1));\n                const elementsToAddNow = Math.floor(progress * totalLength);\n                while(childrenCount < elementsToAddNow){\n                    const randomIndex = Math.floor(Math.random() * elementsToAdd.length);\n                    const element = elementsToAdd.splice(randomIndex, 1)[0];\n                    if (element) {\n                        const [insightMarkGraphic] = rectMarkForItem(element.rect, element.content, 'element');\n                        insightMarkGraphic.alpha = 0;\n                        insightMarkContainer.addChild(insightMarkGraphic);\n                        childrenCount++;\n                        fadeInGraphics(insightMarkGraphic, singleElementFadeInDuration, frame);\n                    }\n                }\n                if (elapsedTime < duration) frame(animate);\n                else {\n                    while(elementsToAdd.length > 0){\n                        const randomIndex = Math.floor(Math.random() * elementsToAdd.length);\n                        const element = elementsToAdd.splice(randomIndex, 1)[0];\n                        const [insightMarkGraphic] = rectMarkForItem(element.rect, element.content, 'element');\n                        insightMarkGraphic.alpha = 1;\n                        insightMarkContainer.addChild(insightMarkGraphic);\n                    }\n                    if (searchArea) {\n                        const [searchAreaGraphic] = rectMarkForItem(searchArea, 'Search Area', 'searchArea');\n                        searchAreaGraphic.alpha = 1;\n                        insightMarkContainer.addChild(searchAreaGraphic);\n                    }\n                    highlightElements.map((element)=>{\n                        const [insightMarkGraphic] = rectMarkForItem(element.rect, element.content || '', 'highlight');\n                        insightMarkGraphic.alpha = 1;\n                        insightMarkContainer.addChild(insightMarkGraphic);\n                    });\n                    resolve();\n                }\n            };\n            frame(animate);\n        });\n    };\n    const init = async ()=>{\n        if (!divContainerRef.current || !scripts) return;\n        await app.init({\n            width: imageWidth,\n            height: imageHeight,\n            background: 0xf4f4f4,\n            autoDensity: true,\n            antialias: true\n        });\n        if (!divContainerRef.current) return;\n        divContainerRef.current.appendChild(app.canvas);\n        windowContentContainer.x = 0;\n        windowContentContainer.y = 0;\n        app.stage.addChild(windowContentContainer);\n        insightMarkContainer.x = 0;\n        insightMarkContainer.y = 0;\n        windowContentContainer.addChild(insightMarkContainer);\n    };\n    const [isRecording, setIsRecording] = useState(false);\n    const recorderSessionRef = useRef(null);\n    const handleExport = ()=>{\n        if (recorderSessionRef.current) return void console.warn('recorderSession exists');\n        if (!app.canvas) return void console.warn('canvas is not initialized');\n        recorderSessionRef.current = new RecordingSession(app.canvas);\n        setIsRecording(true);\n        triggerReplay();\n    };\n    const play = ()=>{\n        let cancelFn;\n        Promise.resolve((async ()=>{\n            if (!app) throw new Error('app is not initialized');\n            if (!scripts) throw new Error(\"scripts is required\");\n            const { frame, cancel, timeout } = frameKit();\n            cancelFn = cancel;\n            const allImages = scripts.filter((item)=>!!item.img).map((item)=>item.img);\n            await Promise.all([\n                ...allImages,\n                mouseLoading,\n                mousePointer\n            ].map(loadTexture));\n            insightMarkContainer.removeChildren();\n            await updatePointer(mousePointer, imageWidth / 2, imageHeight / 2);\n            await repaintImage();\n            await updateCamera({\n                ...basicCameraState\n            });\n            const totalDuration = scripts.reduce((acc, item)=>acc + item.duration + (item.camera && item.insightCameraDuration ? item.insightCameraDuration : 0), 0);\n            const progressUpdateInterval = 200;\n            const startTime = performance.now();\n            setAnimationProgress(0);\n            const updateProgress = ()=>{\n                const progress = Math.min((performance.now() - startTime) / totalDuration, 1);\n                setAnimationProgress(progress);\n                if (progress < 1) return timeout(updateProgress, progressUpdateInterval);\n            };\n            frame(updateProgress);\n            if (recorderSessionRef.current) recorderSessionRef.current.start();\n            for(const index in scripts){\n                const item = scripts[index];\n                setTitleText(item.title || '');\n                setSubTitleText(item.subTitle || '');\n                if ('sleep' === item.type) await sleep(item.duration);\n                else if ('insight' === item.type) {\n                    var _item_context;\n                    if (!item.img) throw new Error('img is required');\n                    currentImg.current = item.img;\n                    await repaintImage(item.imageWidth, item.imageHeight);\n                    const elements = (null == (_item_context = item.context) ? void 0 : _item_context.tree) ? treeToList(item.context.tree) : [];\n                    const highlightElements = item.highlightElement ? [\n                        item.highlightElement\n                    ] : [];\n                    await insightElementsAnimation(elements, highlightElements, item.searchArea, item.duration, frame);\n                    if (item.camera) {\n                        if (!item.insightCameraDuration) throw new Error('insightCameraDuration is required');\n                        await cameraAnimation(item.camera, item.insightCameraDuration, frame);\n                    }\n                } else if ('clear-insight' === item.type) {\n                    await fadeOutItem(insightMarkContainer, item.duration, frame);\n                    insightMarkContainer.removeChildren();\n                    insightMarkContainer.alpha = 1;\n                } else if ('img' === item.type) {\n                    if (item.img && item.img !== currentImg.current) {\n                        currentImg.current = item.img;\n                        await repaintImage(item.imageWidth, item.imageHeight);\n                    }\n                    if (item.camera) await cameraAnimation(item.camera, item.duration, frame);\n                    else await sleep(item.duration);\n                } else if ('pointer' === item.type) {\n                    if (!item.img) throw new Error('pointer img is required');\n                    await updatePointer(item.img);\n                } else if ('spinning-pointer' === item.type) {\n                    const stop = spinningPointer(frame);\n                    await sleep(item.duration);\n                    stop();\n                }\n            }\n            if (recorderSessionRef.current) {\n                await sleep(1200);\n                recorderSessionRef.current.stop();\n                recorderSessionRef.current = null;\n                setIsRecording(false);\n            }\n        })().catch((e)=>{\n            console.error('player error', e);\n        }));\n        return ()=>{\n            null == cancelFn || cancelFn();\n        };\n    };\n    useEffect(()=>{\n        Promise.resolve((async ()=>{\n            await init();\n            if (divContainerRef.current && imageWidth && imageHeight) {\n                const aspectRatio = imageWidth / imageHeight;\n                divContainerRef.current.style.setProperty('--canvas-aspect-ratio', aspectRatio.toString());\n                divContainerRef.current.setAttribute('data-fit-mode', fitMode);\n                const playerContainer = divContainerRef.current.closest('.player-container');\n                if (playerContainer) playerContainer.setAttribute('data-fit-mode', fitMode);\n            }\n            triggerReplay();\n        })());\n        return ()=>{\n            try {\n                app.destroy(true, {\n                    children: true,\n                    texture: true\n                });\n            } catch (e) {\n                console.warn('destroy failed', e);\n            }\n        };\n    }, [\n        imageWidth,\n        imageHeight,\n        fitMode\n    ]);\n    useEffect(()=>{\n        if (replayMark) return play();\n    }, [\n        replayMark\n    ]);\n    const [mouseOverStatusIcon, setMouseOverStatusIcon] = useState(false);\n    const [mouseOverSettingsIcon, setMouseOverSettingsIcon] = useState(false);\n    const progressString = Math.round(100 * animationProgress);\n    const transitionStyle = 0 === animationProgress ? 'none' : '0.3s';\n    const canReplayNow = 1 === animationProgress;\n    useEffect(()=>{\n        if (canReplayNow) {\n            const listener = (event)=>{\n                if (' ' === event.key) triggerReplay();\n            };\n            window.addEventListener('keydown', listener);\n            return ()=>{\n                window.removeEventListener('keydown', listener);\n            };\n        }\n    }, [\n        canReplayNow\n    ]);\n    let statusIconElement;\n    let statusOnClick = ()=>{};\n    if (animationProgress < 1) statusIconElement = /*#__PURE__*/ jsx(Spin, {\n        indicator: /*#__PURE__*/ jsx(LoadingOutlined, {\n            spin: true,\n            color: \"#333\"\n        }),\n        size: \"default\"\n    });\n    else if (mouseOverStatusIcon) {\n        statusIconElement = /*#__PURE__*/ jsx(Spin, {\n            indicator: /*#__PURE__*/ jsx(CaretRightOutlined, {\n                color: \"#333\"\n            }),\n            size: \"default\"\n        });\n        statusOnClick = ()=>triggerReplay();\n    } else statusIconElement = /*#__PURE__*/ jsx(Spin, {\n        indicator: /*#__PURE__*/ jsx(CaretRightOutlined, {\n            color: \"#333\"\n        }),\n        size: \"default\"\n    });\n    return /*#__PURE__*/ jsxs(\"div\", {\n        className: \"player-container\",\n        children: [\n            /*#__PURE__*/ jsx(\"div\", {\n                className: \"canvas-container\",\n                ref: divContainerRef\n            }),\n            /*#__PURE__*/ jsx(\"div\", {\n                className: \"player-timeline-wrapper\",\n                children: /*#__PURE__*/ jsx(\"div\", {\n                    className: \"player-timeline\",\n                    children: /*#__PURE__*/ jsx(\"div\", {\n                        className: \"player-timeline-progress\",\n                        style: {\n                            width: `${progressString}%`,\n                            transition: transitionStyle\n                        }\n                    })\n                })\n            }),\n            /*#__PURE__*/ jsx(\"div\", {\n                className: \"player-tools-wrapper\",\n                children: /*#__PURE__*/ jsx(\"div\", {\n                    className: \"player-tools\",\n                    children: /*#__PURE__*/ jsxs(\"div\", {\n                        className: \"player-control\",\n                        children: [\n                            /*#__PURE__*/ jsxs(\"div\", {\n                                className: \"status-text\",\n                                children: [\n                                    /*#__PURE__*/ jsx(\"div\", {\n                                        className: \"title\",\n                                        children: titleText\n                                    }),\n                                    /*#__PURE__*/ jsx(Tooltip, {\n                                        title: subTitleText,\n                                        children: /*#__PURE__*/ jsx(\"div\", {\n                                            className: \"subtitle\",\n                                            children: subTitleText\n                                        })\n                                    })\n                                ]\n                            }),\n                            isRecording ? null : /*#__PURE__*/ jsx(\"div\", {\n                                className: \"status-icon\",\n                                onMouseEnter: ()=>setMouseOverStatusIcon(true),\n                                onMouseLeave: ()=>setMouseOverStatusIcon(false),\n                                onClick: statusOnClick,\n                                children: statusIconElement\n                            }),\n                            (null == props ? void 0 : props.reportFileContent) ? /*#__PURE__*/ jsx(Tooltip, {\n                                title: \"Download Report\",\n                                children: /*#__PURE__*/ jsx(\"div\", {\n                                    className: \"status-icon\",\n                                    onMouseEnter: ()=>setMouseOverStatusIcon(true),\n                                    onMouseLeave: ()=>setMouseOverStatusIcon(false),\n                                    onClick: ()=>downloadReport(props.reportFileContent),\n                                    children: /*#__PURE__*/ jsx(DownloadOutlined, {\n                                        color: \"#333\"\n                                    })\n                                })\n                            }) : null,\n                            /*#__PURE__*/ jsx(Tooltip, {\n                                title: isRecording ? 'Generating...' : 'Export Video',\n                                children: /*#__PURE__*/ jsx(\"div\", {\n                                    className: \"status-icon\",\n                                    onClick: isRecording ? void 0 : handleExport,\n                                    style: {\n                                        opacity: isRecording ? 0.5 : 1,\n                                        cursor: isRecording ? 'not-allowed' : 'pointer'\n                                    },\n                                    children: isRecording ? /*#__PURE__*/ jsx(Spin, {\n                                        size: \"default\",\n                                        percent: progressString\n                                    }) : /*#__PURE__*/ jsx(ExportOutlined, {})\n                                })\n                            }),\n                            /*#__PURE__*/ jsx(Dropdown, {\n                                trigger: [\n                                    'hover',\n                                    'click'\n                                ],\n                                placement: \"bottomRight\",\n                                overlayStyle: {\n                                    minWidth: '148px'\n                                },\n                                dropdownRender: (menu)=>/*#__PURE__*/ jsx(\"div\", {\n                                        style: {\n                                            borderRadius: '8px',\n                                            border: '1px solid rgba(0, 0, 0, 0.08)',\n                                            backgroundColor: '#fff',\n                                            boxShadow: '0 2px 8px rgba(0, 0, 0, 0.08)',\n                                            overflow: 'hidden'\n                                        },\n                                        children: menu\n                                    }),\n                                menu: {\n                                    style: {\n                                        borderRadius: '8px',\n                                        padding: 0\n                                    },\n                                    items: [\n                                        {\n                                            key: 'autoZoom',\n                                            style: {\n                                                height: '39px',\n                                                margin: 0,\n                                                padding: '0 12px'\n                                            },\n                                            label: /*#__PURE__*/ jsxs(\"div\", {\n                                                style: {\n                                                    display: 'flex',\n                                                    alignItems: 'center',\n                                                    justifyContent: 'space-between',\n                                                    width: '100%',\n                                                    height: '39px'\n                                                },\n                                                children: [\n                                                    /*#__PURE__*/ jsxs(\"div\", {\n                                                        style: {\n                                                            display: 'flex',\n                                                            alignItems: 'center',\n                                                            gap: '4px'\n                                                        },\n                                                        children: [\n                                                            /*#__PURE__*/ jsx(global_perspective, {\n                                                                style: {\n                                                                    width: '16px',\n                                                                    height: '16px'\n                                                                }\n                                                            }),\n                                                            /*#__PURE__*/ jsx(\"span\", {\n                                                                style: {\n                                                                    fontSize: '12px',\n                                                                    marginRight: '16px'\n                                                                },\n                                                                children: \"Focus on cursor\"\n                                                            })\n                                                        ]\n                                                    }),\n                                                    /*#__PURE__*/ jsx(Switch, {\n                                                        size: \"small\",\n                                                        checked: autoZoom,\n                                                        onChange: (checked)=>{\n                                                            setAutoZoom(checked);\n                                                            triggerReplay();\n                                                        },\n                                                        onClick: (_, e)=>{\n                                                            var _e_stopPropagation;\n                                                            return null == e ? void 0 : null == (_e_stopPropagation = e.stopPropagation) ? void 0 : _e_stopPropagation.call(e);\n                                                        }\n                                                    })\n                                                ]\n                                            })\n                                        },\n                                        {\n                                            key: 'elementsVisible',\n                                            style: {\n                                                height: '39px',\n                                                margin: 0,\n                                                padding: '0 12px'\n                                            },\n                                            label: /*#__PURE__*/ jsxs(\"div\", {\n                                                style: {\n                                                    display: 'flex',\n                                                    alignItems: 'center',\n                                                    justifyContent: 'space-between',\n                                                    width: '100%',\n                                                    height: '39px'\n                                                },\n                                                children: [\n                                                    /*#__PURE__*/ jsxs(\"div\", {\n                                                        style: {\n                                                            display: 'flex',\n                                                            alignItems: 'center',\n                                                            gap: '4px'\n                                                        },\n                                                        children: [\n                                                            /*#__PURE__*/ jsx(show_marker, {\n                                                                style: {\n                                                                    width: '16px',\n                                                                    height: '16px'\n                                                                }\n                                                            }),\n                                                            /*#__PURE__*/ jsx(\"span\", {\n                                                                style: {\n                                                                    fontSize: '12px',\n                                                                    marginRight: '16px'\n                                                                },\n                                                                children: \"Show element markers\"\n                                                            })\n                                                        ]\n                                                    }),\n                                                    /*#__PURE__*/ jsx(Switch, {\n                                                        size: \"small\",\n                                                        checked: elementsVisible,\n                                                        onChange: (checked)=>{\n                                                            setElementsVisible(checked);\n                                                            triggerReplay();\n                                                        },\n                                                        onClick: (_, e)=>{\n                                                            var _e_stopPropagation;\n                                                            return null == e ? void 0 : null == (_e_stopPropagation = e.stopPropagation) ? void 0 : _e_stopPropagation.call(e);\n                                                        }\n                                                    })\n                                                ]\n                                            })\n                                        }\n                                    ]\n                                },\n                                children: /*#__PURE__*/ jsx(\"div\", {\n                                    className: \"status-icon\",\n                                    onMouseEnter: ()=>setMouseOverSettingsIcon(true),\n                                    onMouseLeave: ()=>setMouseOverSettingsIcon(false),\n                                    style: {\n                                        cursor: 'pointer',\n                                        display: 'flex',\n                                        alignItems: 'center',\n                                        justifyContent: 'center',\n                                        opacity: mouseOverSettingsIcon ? 1 : 0.7,\n                                        transition: 'opacity 0.2s'\n                                    },\n                                    children: /*#__PURE__*/ jsx(player_setting, {\n                                        style: {\n                                            width: '16px',\n                                            height: '16px'\n                                        }\n                                    })\n                                })\n                            })\n                        ]\n                    })\n                })\n            })\n        ]\n    });\n}\nexport { Player };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport { LoadingOutlined } from \"@ant-design/icons\";\nimport { Spin } from \"antd\";\nimport { emptyResultTip, serverLaunchTip } from \"../misc/index.mjs\";\nimport { Player } from \"../player/index.mjs\";\nimport shiny_text from \"../shiny-text/index.mjs\";\nimport \"./index.css\";\nconst PlaygroundResultView = (param)=>{\n    let { result, loading, serverValid, serviceMode, replayScriptsInfo, replayCounter, loadingProgressText, verticalMode = false, notReadyMessage, fitMode, autoZoom } = param;\n    let resultWrapperClassName = 'result-wrapper';\n    if (verticalMode) resultWrapperClassName += ' vertical-mode-result';\n    if (replayScriptsInfo && verticalMode) resultWrapperClassName += ' result-wrapper-compact';\n    let resultDataToShow = emptyResultTip;\n    if (serverValid || 'Server' !== serviceMode) {\n        if (loading) resultDataToShow = /*#__PURE__*/ jsxs(\"div\", {\n            className: \"loading-container\",\n            children: [\n                /*#__PURE__*/ jsx(Spin, {\n                    spinning: loading,\n                    indicator: /*#__PURE__*/ jsx(LoadingOutlined, {\n                        spin: true\n                    })\n                }),\n                /*#__PURE__*/ jsx(\"div\", {\n                    className: \"loading-progress-text loading-progress-text-progress\",\n                    children: /*#__PURE__*/ jsx(shiny_text, {\n                        text: loadingProgressText,\n                        speed: 3\n                    })\n                })\n            ]\n        });\n        else if (replayScriptsInfo) resultDataToShow = /*#__PURE__*/ jsx(Player, {\n            replayScripts: replayScriptsInfo.scripts,\n            imageWidth: replayScriptsInfo.width,\n            imageHeight: replayScriptsInfo.height,\n            reportFileContent: ('In-Browser-Extension' === serviceMode || 'Server' === serviceMode) && (null == result ? void 0 : result.reportHTML) ? null == result ? void 0 : result.reportHTML : null,\n            fitMode: fitMode,\n            autoZoom: autoZoom\n        }, replayCounter);\n        else if (null == result ? void 0 : result.error) resultDataToShow = /*#__PURE__*/ jsx(\"pre\", {\n            children: null == result ? void 0 : result.error\n        });\n        else if ((null == result ? void 0 : result.result) !== void 0) resultDataToShow = 'string' == typeof (null == result ? void 0 : result.result) ? /*#__PURE__*/ jsx(\"pre\", {\n            children: null == result ? void 0 : result.result\n        }) : /*#__PURE__*/ jsx(\"pre\", {\n            children: JSON.stringify(null == result ? void 0 : result.result, null, 2)\n        });\n    } else resultDataToShow = serverLaunchTip(notReadyMessage);\n    return /*#__PURE__*/ jsx(\"div\", {\n        className: resultWrapperClassName,\n        style: {\n            height: '100%',\n            display: 'flex',\n            flexDirection: 'column',\n            flex: '1 1 auto',\n            justifyContent: 'center'\n        },\n        children: resultDataToShow\n    });\n};\nexport { PlaygroundResultView };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport \"react\";\nconst SvgAvatar = (props)=>/*#__PURE__*/ jsxs(\"svg\", {\n        xmlns: \"http://www.w3.org/2000/svg\",\n        width: 20,\n        height: 20,\n        fill: \"none\",\n        \"aria-label\": \"Playground\",\n        viewBox: \"0 0 20 20\",\n        ...props,\n        children: [\n            /*#__PURE__*/ jsx(\"rect\", {\n                width: 20,\n                height: 20,\n                fill: \"#2B83FF\",\n                rx: 10\n            }),\n            /*#__PURE__*/ jsx(\"path\", {\n                fill: \"#2B83FF\",\n                stroke: \"#fff\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 1.125,\n                d: \"M6.866 5.882a.56.56 0 0 1 .667-.078l3.248 1.875 3.247 1.875a.563.563 0 0 1 0 .974l-3.247 1.875-3.248 1.875a.563.563 0 0 1-.784-.74l1.749-3.497-1.75-3.498a.56.56 0 0 1 .118-.661Z\"\n            })\n        ]\n    });\nconst avatar = SvgAvatar;\nexport { avatar as default };\n","import { create } from \"zustand\";\nvar __webpack_require__ = {};\n(()=>{\n    __webpack_require__.d = (exports, definition)=>{\n        for(var key in definition)if (__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) Object.defineProperty(exports, key, {\n            enumerable: true,\n            get: definition[key]\n        });\n    };\n})();\n(()=>{\n    __webpack_require__.o = (obj, prop)=>Object.prototype.hasOwnProperty.call(obj, prop);\n})();\n(()=>{\n    __webpack_require__.r = (exports)=>{\n        if ('undefined' != typeof Symbol && Symbol.toStringTag) Object.defineProperty(exports, Symbol.toStringTag, {\n            value: 'Module'\n        });\n        Object.defineProperty(exports, '__esModule', {\n            value: true\n        });\n    };\n})();\nvar external_zustand_namespaceObject = {};\n__webpack_require__.r(external_zustand_namespaceObject);\n__webpack_require__.d(external_zustand_namespaceObject, {\n    create: ()=>create\n});\nconst { create: history_create } = external_zustand_namespaceObject;\nconst HISTORY_KEY = 'sqai-prompt-history-v2';\nconst LAST_SELECTED_TYPE_KEY = 'sqai-last-selected-type';\nconst getHistoryFromLocalStorage = ()=>{\n    const historyString = localStorage.getItem(HISTORY_KEY);\n    return historyString ? JSON.parse(historyString) : {};\n};\nconst getLastSelectedType = ()=>localStorage.getItem(LAST_SELECTED_TYPE_KEY) || 'aiAction';\nconst setLastSelectedType = (type)=>{\n    localStorage.setItem(LAST_SELECTED_TYPE_KEY, type);\n};\nconst useHistoryStore = history_create((set, get)=>({\n        history: getHistoryFromLocalStorage(),\n        lastSelectedType: getLastSelectedType(),\n        clearHistory: (type)=>{\n            const newHistory = {\n                ...get().history\n            };\n            delete newHistory[type];\n            set({\n                history: newHistory\n            });\n            localStorage.setItem(HISTORY_KEY, JSON.stringify(newHistory));\n        },\n        addHistory: (historyItem)=>{\n            const { type } = historyItem;\n            const currentHistory = get().history;\n            const typeHistory = currentHistory[type] || [];\n            const stringifiedNewItem = JSON.stringify({\n                prompt: historyItem.prompt,\n                params: historyItem.params\n            });\n            const newTypeHistory = [\n                historyItem,\n                ...typeHistory.filter((h)=>{\n                    const stringifiedOldItem = JSON.stringify({\n                        prompt: h.prompt,\n                        params: h.params\n                    });\n                    return stringifiedOldItem !== stringifiedNewItem;\n                })\n            ];\n            if (newTypeHistory.length > 10) newTypeHistory.length = 10;\n            const newHistory = {\n                ...currentHistory,\n                [type]: newTypeHistory\n            };\n            set({\n                history: newHistory\n            });\n            localStorage.setItem(HISTORY_KEY, JSON.stringify(newHistory));\n        },\n        getHistoryForType: (type)=>get().history[type] || [],\n        setLastSelectedType: (type)=>{\n            set({\n                lastSelectedType: type\n            });\n            setLastSelectedType(type);\n        }\n    }));\nexport { useHistoryStore };\n","const VALIDATION_CONSTANTS = {\n    ZOD_TYPES: {\n        OPTIONAL: 'ZodOptional',\n        DEFAULT: 'ZodDefault',\n        NULLABLE: 'ZodNullable',\n        OBJECT: 'ZodObject',\n        ENUM: 'ZodEnum',\n        NUMBER: 'ZodNumber',\n        STRING: 'ZodString',\n        BOOLEAN: 'ZodBoolean'\n    },\n    FIELD_FLAGS: {\n        LOCATION: 'midscene_location_field_flag'\n    },\n    DEFAULT_VALUES: {\n        ACTION_TYPE: 'aiAction',\n        TIMEOUT_MS: 15000,\n        CHECK_INTERVAL_MS: 3000\n    }\n};\nconst isZodObjectSchema = (schema)=>'object' == typeof schema && null !== schema && ('shape' in schema || 'ZodObject' === schema.type);\nconst isLocateField = (field)=>{\n    var _field__def;\n    const fieldWithRuntime = field;\n    if ((null == (_field__def = field._def) ? void 0 : _field__def.typeName) === VALIDATION_CONSTANTS.ZOD_TYPES.OBJECT) {\n        var _field__def1;\n        let shape;\n        if (field._def.shape) shape = 'function' == typeof field._def.shape ? field._def.shape() : field._def.shape;\n        if (!shape && fieldWithRuntime.shape) shape = fieldWithRuntime.shape;\n        if (shape && VALIDATION_CONSTANTS.FIELD_FLAGS.LOCATION in shape) return true;\n        const description = (null == (_field__def1 = field._def) ? void 0 : _field__def1.description) || fieldWithRuntime.description || '';\n        if ('string' == typeof description && description.toLowerCase().includes('input field')) return true;\n    }\n    if ('object' == typeof field && null !== field) {\n        var _fieldWithRuntime__def;\n        const description = fieldWithRuntime.description || (null == (_fieldWithRuntime__def = fieldWithRuntime._def) ? void 0 : _fieldWithRuntime__def.description) || '';\n        if ('string' == typeof description) {\n            const desc = description.toLowerCase();\n            if (desc.includes('input field') || desc.includes('element') || desc.includes('locate')) return true;\n        }\n        if ('ZodObject' === fieldWithRuntime.typeName || 'ZodObject' === fieldWithRuntime.type) return 'string' == typeof description && description.toLowerCase().includes('input field');\n    }\n    return false;\n};\nconst unwrapZodType = (field)=>{\n    var _actualField__def, _actualField__def1, _actualField__def2;\n    let actualField = field;\n    let isOptional = false;\n    let hasDefault = false;\n    while((null == (_actualField__def = actualField._def) ? void 0 : _actualField__def.typeName) === VALIDATION_CONSTANTS.ZOD_TYPES.OPTIONAL || (null == (_actualField__def1 = actualField._def) ? void 0 : _actualField__def1.typeName) === VALIDATION_CONSTANTS.ZOD_TYPES.DEFAULT || (null == (_actualField__def2 = actualField._def) ? void 0 : _actualField__def2.typeName) === VALIDATION_CONSTANTS.ZOD_TYPES.NULLABLE){\n        var _actualField__def3, _actualField__def4;\n        if ((null == (_actualField__def3 = actualField._def) ? void 0 : _actualField__def3.typeName) === VALIDATION_CONSTANTS.ZOD_TYPES.OPTIONAL) isOptional = true;\n        if ((null == (_actualField__def4 = actualField._def) ? void 0 : _actualField__def4.typeName) === VALIDATION_CONSTANTS.ZOD_TYPES.DEFAULT) hasDefault = true;\n        actualField = actualField._def.innerType || actualField;\n    }\n    return {\n        actualField,\n        isOptional,\n        hasDefault\n    };\n};\nconst extractDefaultValue = (field)=>{\n    var _currentField__def;\n    let currentField = field;\n    while(null == (_currentField__def = currentField._def) ? void 0 : _currentField__def.innerType){\n        if (currentField._def.typeName === VALIDATION_CONSTANTS.ZOD_TYPES.DEFAULT && currentField._def.defaultValue) return currentField._def.defaultValue();\n        currentField = currentField._def.innerType;\n    }\n};\nexport { VALIDATION_CONSTANTS, extractDefaultValue, isLocateField, isZodObjectSchema, unwrapZodType };\n","import { getMidsceneLocationSchema } from '@/ai-model';\r\nimport type { DeviceAction, LocateResultElement } from '@/types';\r\nimport type { ElementNode } from '@sqaitech/shared/extractor';\r\nimport { _keyDefinitions } from '@sqaitech/shared/us-keyboard-layout';\r\nimport { z } from 'zod';\r\nimport type { ElementCacheFeature, Rect, Size, UIContext } from '../types';\r\n\r\nexport abstract class AbstractInterface {\r\n  abstract interfaceType: string;\r\n\r\n  abstract screenshotBase64(): Promise<string>;\r\n  abstract size(): Promise<Size>;\r\n  abstract actionSpace(): DeviceAction[] | Promise<DeviceAction[]>;\r\n\r\n  abstract cacheFeatureForRect?(\r\n    rect: Rect,\r\n    opt?: { _orderSensitive: boolean },\r\n  ): Promise<ElementCacheFeature>;\r\n  abstract rectMatchesCacheFeature?(\r\n    feature: ElementCacheFeature,\r\n  ): Promise<Rect>;\r\n\r\n  abstract destroy?(): Promise<void>;\r\n\r\n  abstract describe?(): string;\r\n  abstract beforeInvokeAction?(actionName: string, param: any): Promise<void>;\r\n  abstract afterInvokeAction?(actionName: string, param: any): Promise<void>;\r\n\r\n  // @deprecated do NOT extend this method\r\n  abstract getElementsNodeTree?: () => Promise<ElementNode>;\r\n\r\n  // @deprecated do NOT extend this method\r\n  abstract url?: () => string | Promise<string>;\r\n\r\n  // @deprecated do NOT extend this method\r\n  abstract evaluateJavaScript?<T = any>(script: string): Promise<T>;\r\n\r\n  // @deprecated do NOT extend this method\r\n  abstract getContext?(): Promise<UIContext>;\r\n}\r\n\r\n// Generic function to define actions with proper type inference\r\n// TRuntime allows specifying a different type for the runtime parameter (after location resolution)\r\nexport const defineAction = <\r\n  TSchema extends z.ZodType,\r\n  TRuntime = z.infer<TSchema>,\r\n>(\r\n  config: {\r\n    name: string;\r\n    description: string;\r\n    interfaceAlias?: string;\r\n    paramSchema: TSchema;\r\n    call: (param: TRuntime) => Promise<void>;\r\n  } & Partial<\r\n    Omit<\r\n      DeviceAction<TRuntime>,\r\n      'name' | 'description' | 'interfaceAlias' | 'paramSchema' | 'call'\r\n    >\r\n  >,\r\n): DeviceAction<TRuntime> => {\r\n  return config as any; // Type assertion needed because schema validation type differs from runtime type\r\n};\r\n\r\n// Tap\r\nexport const actionTapParamSchema = z.object({\r\n  locate: getMidsceneLocationSchema().describe('The element to be tapped'),\r\n});\r\n// Override the inferred type to use LocateResultElement for the runtime locate field\r\nexport type ActionTapParam = {\r\n  locate: LocateResultElement;\r\n};\r\n\r\nexport const defineActionTap = (\r\n  call: (param: ActionTapParam) => Promise<void>,\r\n): DeviceAction<ActionTapParam> => {\r\n  return defineAction<typeof actionTapParamSchema, ActionTapParam>({\r\n    name: 'Tap',\r\n    description: 'Tap the element',\r\n    interfaceAlias: 'aiTap',\r\n    paramSchema: actionTapParamSchema,\r\n    call,\r\n  });\r\n};\r\n\r\n// RightClick\r\nexport const actionRightClickParamSchema = z.object({\r\n  locate: getMidsceneLocationSchema().describe(\r\n    'The element to be right clicked',\r\n  ),\r\n});\r\nexport type ActionRightClickParam = {\r\n  locate: LocateResultElement;\r\n};\r\n\r\nexport const defineActionRightClick = (\r\n  call: (param: ActionRightClickParam) => Promise<void>,\r\n): DeviceAction<ActionRightClickParam> => {\r\n  return defineAction<\r\n    typeof actionRightClickParamSchema,\r\n    ActionRightClickParam\r\n  >({\r\n    name: 'RightClick',\r\n    description: 'Right click the element',\r\n    interfaceAlias: 'aiRightClick',\r\n    paramSchema: actionRightClickParamSchema,\r\n    call,\r\n  });\r\n};\r\n\r\n// DoubleClick\r\nexport const actionDoubleClickParamSchema = z.object({\r\n  locate: getMidsceneLocationSchema().describe(\r\n    'The element to be double clicked',\r\n  ),\r\n});\r\nexport type ActionDoubleClickParam = {\r\n  locate: LocateResultElement;\r\n};\r\n\r\nexport const defineActionDoubleClick = (\r\n  call: (param: ActionDoubleClickParam) => Promise<void>,\r\n): DeviceAction<ActionDoubleClickParam> => {\r\n  return defineAction<\r\n    typeof actionDoubleClickParamSchema,\r\n    ActionDoubleClickParam\r\n  >({\r\n    name: 'DoubleClick',\r\n    description: 'Double click the element',\r\n    interfaceAlias: 'aiDoubleClick',\r\n    paramSchema: actionDoubleClickParamSchema,\r\n    call,\r\n  });\r\n};\r\n\r\n// Hover\r\nexport const actionHoverParamSchema = z.object({\r\n  locate: getMidsceneLocationSchema().describe('The element to be hovered'),\r\n});\r\nexport type ActionHoverParam = {\r\n  locate: LocateResultElement;\r\n};\r\n\r\nexport const defineActionHover = (\r\n  call: (param: ActionHoverParam) => Promise<void>,\r\n): DeviceAction<ActionHoverParam> => {\r\n  return defineAction<typeof actionHoverParamSchema, ActionHoverParam>({\r\n    name: 'Hover',\r\n    description: 'Move the mouse to the element',\r\n    interfaceAlias: 'aiHover',\r\n    paramSchema: actionHoverParamSchema,\r\n    call,\r\n  });\r\n};\r\n\r\n// Input\r\nexport const actionInputParamSchema = z.object({\r\n  value: z\r\n    .union([z.string(), z.number()])\r\n    .transform((val) => String(val))\r\n    .describe(\r\n      'The text to input. Provide the final content for replace/append modes, or an empty string when using clear mode to remove existing text.',\r\n    ),\r\n  locate: getMidsceneLocationSchema()\r\n    .describe('The element to be input')\r\n    .optional(),\r\n  mode: z\r\n    .enum(['replace', 'clear', 'append'])\r\n    .default('replace')\r\n    .optional()\r\n    .describe(\r\n      'Input mode: \"replace\" (default) - clear the field and input the value; \"append\" - append the value to existing content; \"clear\" - clear the field without inputting new text.',\r\n    ),\r\n});\r\nexport type ActionInputParam = {\r\n  value: string;\r\n  locate?: LocateResultElement;\r\n  mode?: 'replace' | 'clear' | 'append';\r\n};\r\n\r\nexport const defineActionInput = (\r\n  call: (param: ActionInputParam) => Promise<void>,\r\n): DeviceAction<ActionInputParam> => {\r\n  return defineAction<typeof actionInputParamSchema, ActionInputParam>({\r\n    name: 'Input',\r\n    description: 'Input the value into the element',\r\n    interfaceAlias: 'aiInput',\r\n    paramSchema: actionInputParamSchema,\r\n    call,\r\n  });\r\n};\r\n\r\n// KeyboardPress\r\nexport const actionKeyboardPressParamSchema = z.object({\r\n  locate: getMidsceneLocationSchema()\r\n    .describe('The element to be clicked before pressing the key')\r\n    .optional(),\r\n  keyName: z\r\n    .string()\r\n    .describe(\r\n      \"The key to be pressed. Use '+' for key combinations, e.g., 'Control+A', 'Shift+Enter'\",\r\n    ),\r\n});\r\nexport type ActionKeyboardPressParam = {\r\n  locate?: LocateResultElement;\r\n  keyName: string;\r\n};\r\n\r\nexport const defineActionKeyboardPress = (\r\n  call: (param: ActionKeyboardPressParam) => Promise<void>,\r\n): DeviceAction<ActionKeyboardPressParam> => {\r\n  return defineAction<\r\n    typeof actionKeyboardPressParamSchema,\r\n    ActionKeyboardPressParam\r\n  >({\r\n    name: 'KeyboardPress',\r\n    description:\r\n      'Press a key or key combination, like \"Enter\", \"Tab\", \"Escape\", or \"Control+A\", \"Shift+Enter\". Do not use this to type text.',\r\n    interfaceAlias: 'aiKeyboardPress',\r\n    paramSchema: actionKeyboardPressParamSchema,\r\n    call,\r\n  });\r\n};\r\n\r\n// Scroll\r\nexport const actionScrollParamSchema = z.object({\r\n  direction: z\r\n    .enum(['down', 'up', 'right', 'left'])\r\n    .default('down')\r\n    .describe('The direction to scroll'),\r\n  scrollType: z\r\n    .enum(['once', 'untilBottom', 'untilTop', 'untilRight', 'untilLeft'])\r\n    .default('once')\r\n    .describe('The scroll type'),\r\n  distance: z\r\n    .number()\r\n    .nullable()\r\n    .optional()\r\n    .describe('The distance in pixels to scroll'),\r\n  locate: getMidsceneLocationSchema()\r\n    .optional()\r\n    .describe('The element to be scrolled'),\r\n});\r\nexport type ActionScrollParam = {\r\n  direction?: 'down' | 'up' | 'right' | 'left';\r\n  scrollType?: 'once' | 'untilBottom' | 'untilTop' | 'untilRight' | 'untilLeft';\r\n  distance?: number | null;\r\n  locate?: LocateResultElement;\r\n};\r\n\r\nexport const defineActionScroll = (\r\n  call: (param: ActionScrollParam) => Promise<void>,\r\n): DeviceAction<ActionScrollParam> => {\r\n  return defineAction<typeof actionScrollParamSchema, ActionScrollParam>({\r\n    name: 'Scroll',\r\n    description:\r\n      'Scroll the page or an element. The direction to scroll, the scroll type, and the distance to scroll. The distance is the number of pixels to scroll. If not specified, use `down` direction, `once` scroll type, and `null` distance.',\r\n    interfaceAlias: 'aiScroll',\r\n    paramSchema: actionScrollParamSchema,\r\n    call,\r\n  });\r\n};\r\n\r\n// DragAndDrop\r\nexport const actionDragAndDropParamSchema = z.object({\r\n  from: getMidsceneLocationSchema().describe('The position to be dragged'),\r\n  to: getMidsceneLocationSchema().describe('The position to be dropped'),\r\n});\r\nexport type ActionDragAndDropParam = {\r\n  from: LocateResultElement;\r\n  to: LocateResultElement;\r\n};\r\n\r\nexport const defineActionDragAndDrop = (\r\n  call: (param: ActionDragAndDropParam) => Promise<void>,\r\n): DeviceAction<ActionDragAndDropParam> => {\r\n  return defineAction<\r\n    typeof actionDragAndDropParamSchema,\r\n    ActionDragAndDropParam\r\n  >({\r\n    name: 'DragAndDrop',\r\n    description: 'Drag and drop the element',\r\n    interfaceAlias: 'aiDragAndDrop',\r\n    paramSchema: actionDragAndDropParamSchema,\r\n    call,\r\n  });\r\n};\r\n\r\nexport const ActionLongPressParamSchema = z.object({\r\n  locate: getMidsceneLocationSchema().describe(\r\n    'The element to be long pressed',\r\n  ),\r\n  duration: z\r\n    .number()\r\n    .default(500)\r\n    .optional()\r\n    .describe('Long press duration in milliseconds'),\r\n});\r\n\r\nexport type ActionLongPressParam = {\r\n  locate: LocateResultElement;\r\n  duration?: number;\r\n};\r\nexport const defineActionLongPress = (\r\n  call: (param: ActionLongPressParam) => Promise<void>,\r\n): DeviceAction<ActionLongPressParam> => {\r\n  return defineAction<typeof ActionLongPressParamSchema, ActionLongPressParam>({\r\n    name: 'LongPress',\r\n    description: 'Long press the element',\r\n    paramSchema: ActionLongPressParamSchema,\r\n    call,\r\n  });\r\n};\r\n\r\nexport const ActionSwipeParamSchema = z.object({\r\n  start: getMidsceneLocationSchema()\r\n    .optional()\r\n    .describe(\r\n      'Starting point of the swipe gesture, if not specified, the center of the page will be used',\r\n    ),\r\n  direction: z\r\n    .enum(['up', 'down', 'left', 'right'])\r\n    .optional()\r\n    .describe(\r\n      'The direction to swipe (required when using distance). The direction means the direction of the finger swipe.',\r\n    ),\r\n  distance: z\r\n    .number()\r\n    .optional()\r\n    .describe('The distance in pixels to swipe (mutually exclusive with end)'),\r\n  end: getMidsceneLocationSchema()\r\n    .optional()\r\n    .describe(\r\n      'Ending point of the swipe gesture (mutually exclusive with distance)',\r\n    ),\r\n  duration: z\r\n    .number()\r\n    .default(300)\r\n    .describe('Duration of the swipe gesture in milliseconds'),\r\n  repeat: z\r\n    .number()\r\n    .optional()\r\n    .describe(\r\n      'The number of times to repeat the swipe gesture. 1 for default, 0 for infinite (e.g. endless swipe until the end of the page)',\r\n    ),\r\n});\r\n\r\nexport type ActionSwipeParam = {\r\n  start?: LocateResultElement;\r\n  direction?: 'up' | 'down' | 'left' | 'right';\r\n  distance?: number;\r\n  end?: LocateResultElement;\r\n  duration?: number;\r\n  repeat?: number;\r\n};\r\n\r\nexport const defineActionSwipe = (\r\n  call: (param: ActionSwipeParam) => Promise<void>,\r\n): DeviceAction<ActionSwipeParam> => {\r\n  return defineAction<typeof ActionSwipeParamSchema, ActionSwipeParam>({\r\n    name: 'Swipe',\r\n    description:\r\n      'Perform a swipe gesture. You must specify either \"end\" (target location) or \"distance\" + \"direction\" - they are mutually exclusive. Use \"end\" for precise location-based swipes, or \"distance\" + \"direction\" for relative movement.',\r\n    paramSchema: ActionSwipeParamSchema,\r\n    call,\r\n  });\r\n};\r\n\r\n// ClearInput\r\nexport const actionClearInputParamSchema = z.object({\r\n  locate: getMidsceneLocationSchema().describe('The input field to be cleared'),\r\n});\r\nexport type ActionClearInputParam = {\r\n  locate: LocateResultElement;\r\n};\r\n\r\nexport const defineActionClearInput = (\r\n  call: (param: ActionClearInputParam) => Promise<void>,\r\n): DeviceAction<ActionClearInputParam> => {\r\n  return defineAction<\r\n    typeof actionClearInputParamSchema,\r\n    ActionClearInputParam\r\n  >({\r\n    name: 'ClearInput',\r\n    description: 'Clear the text content of an input field',\r\n    interfaceAlias: 'aiClearInput',\r\n    paramSchema: actionClearInputParamSchema,\r\n    call,\r\n  });\r\n};\r\n\r\nexport type { DeviceAction } from '../types';\r\n","import { StaticPage, StaticPageAgent } from \"@sqaitech/web/static\";\nimport { isZodObjectSchema, unwrapZodType } from \"../types.mjs\";\nconst actionNameForType = (type)=>{\n    const typeWithoutAi = type.startsWith('ai') ? type.slice(2) : type;\n    if (typeWithoutAi.startsWith('IOS')) return typeWithoutAi.substring(3).replace(/([A-Z])/g, ' $1').replace(/^/, 'IOS').trim();\n    const fullName = typeWithoutAi.replace(/([A-Z])/g, ' $1').trim();\n    const words = fullName.split(' ');\n    if (words.length > 3) return words.slice(-3).join(' ');\n    return fullName;\n};\nconst staticAgentFromContext = (context)=>{\n    const page = new StaticPage(context);\n    return new StaticPageAgent(page);\n};\nconst getPlaceholderForType = (type)=>{\n    if ('aiQuery' === type) return 'What do you want to query?';\n    if ('aiAssert' === type) return 'What do you want to assert?';\n    if ('aiTap' === type) return 'What element do you want to tap?';\n    if ('aiDoubleClick' === type) return 'What element do you want to double-click?';\n    if ('aiHover' === type) return 'What element do you want to hover over?';\n    if ('aiInput' === type) return 'Format: <value> | <element>\\nExample: hello world | search box';\n    if ('aiRightClick' === type) return 'What element do you want to right-click?';\n    if ('aiKeyboardPress' === type) return 'Format: <key> | <element (optional)>\\nExample: Enter | text field';\n    if ('aiScroll' === type) return 'Format: <direction> <amount> | <element (optional)>\\nExample: down 500 | main content';\n    if ('aiLocate' === type) return 'What element do you want to locate?';\n    if ('aiBoolean' === type) return 'What do you want to check (returns true/false)?';\n    if ('aiNumber' === type) return 'What number do you want to extract?';\n    if ('aiString' === type) return 'What text do you want to extract?';\n    if ('aiAsk' === type) return 'What do you want to ask?';\n    if ('aiWaitFor' === type) return 'What condition do you want to wait for?';\n    return 'What do you want to do?';\n};\nconst isRunButtonEnabled = (runButtonEnabled, needsStructuredParams, params, actionSpace, selectedType, promptValue)=>{\n    if (!runButtonEnabled) return false;\n    const needsAnyInput = (()=>{\n        if (actionSpace) {\n            const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n            if (action) {\n                if (!action.paramSchema) return false;\n                if ('object' == typeof action.paramSchema && 'shape' in action.paramSchema) {\n                    const shape = action.paramSchema.shape || {};\n                    const shapeKeys = Object.keys(shape);\n                    return shapeKeys.length > 0;\n                }\n            }\n        }\n        return true;\n    })();\n    if (!needsAnyInput) return true;\n    if (needsStructuredParams) {\n        const currentParams = params || {};\n        const action = null == actionSpace ? void 0 : actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n        if ((null == action ? void 0 : action.paramSchema) && isZodObjectSchema(action.paramSchema)) {\n            const schema = action.paramSchema;\n            const shape = schema.shape || {};\n            return Object.keys(shape).every((key)=>{\n                const field = shape[key];\n                const { isOptional } = unwrapZodType(field);\n                const value = currentParams[key];\n                return isOptional || void 0 !== value && '' !== value && null !== value;\n            });\n        }\n        return true;\n    }\n    return promptValue.trim().length > 0;\n};\nexport { actionNameForType, getPlaceholderForType, isRunButtonEnabled, staticAgentFromContext };\n","import { jsx } from \"react/jsx-runtime\";\nimport \"react\";\nconst SvgSetting = (props)=>/*#__PURE__*/ jsx(\"svg\", {\n        xmlns: \"http://www.w3.org/2000/svg\",\n        width: 27,\n        height: 27,\n        fill: \"none\",\n        viewBox: \"0 0 27 27\",\n        ...props,\n        children: /*#__PURE__*/ jsx(\"path\", {\n            stroke: \"#000\",\n            strokeLinecap: \"round\",\n            strokeLinejoin: \"round\",\n            strokeOpacity: 0.85,\n            strokeWidth: 1.333,\n            d: \"M19.527 8.855h-2M14.86 7.522v2.667M14.86 8.855H7.527M10.194 13.522H7.527M12.86 12.189v2.666M20.193 13.522H12.86M19.527 18.189h-2M14.86 16.855v2.667M14.86 18.189H7.527\"\n        })\n    });\nconst setting = SvgSetting;\nexport { setting as default };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport { Checkbox, Dropdown, Radio } from \"antd\";\nimport setting from \"../../icons/setting.mjs\";\nimport { useEnvConfig } from \"../../store/store.mjs\";\nimport { deepThinkTip, domIncludedTip, screenshotIncludedTip, trackingTip } from \"../../utils/constants.mjs\";\nconst ConfigSelector = (param)=>{\n    let { showDeepThinkOption = false, enableTracking = false, showDataExtractionOptions = false, hideDomAndScreenshotOptions = false } = param;\n    const forceSameTabNavigation = useEnvConfig((state)=>state.forceSameTabNavigation);\n    const setForceSameTabNavigation = useEnvConfig((state)=>state.setForceSameTabNavigation);\n    const deepThink = useEnvConfig((state)=>state.deepThink);\n    const setDeepThink = useEnvConfig((state)=>state.setDeepThink);\n    const screenshotIncluded = useEnvConfig((state)=>state.screenshotIncluded);\n    const setScreenshotIncluded = useEnvConfig((state)=>state.setScreenshotIncluded);\n    const domIncluded = useEnvConfig((state)=>state.domIncluded);\n    const setDomIncluded = useEnvConfig((state)=>state.setDomIncluded);\n    if (!enableTracking && !showDeepThinkOption && !showDataExtractionOptions) return null;\n    const configItems = buildConfigItems();\n    return /*#__PURE__*/ jsx(\"div\", {\n        className: \"selector-trigger\",\n        children: /*#__PURE__*/ jsx(Dropdown, {\n            menu: {\n                items: configItems\n            },\n            trigger: [\n                'click'\n            ],\n            children: /*#__PURE__*/ jsx(setting, {\n                width: 24,\n                height: 24\n            })\n        })\n    });\n    function buildConfigItems() {\n        const items = [];\n        if (enableTracking) items.push({\n            label: /*#__PURE__*/ jsx(Checkbox, {\n                onChange: (e)=>setForceSameTabNavigation(e.target.checked),\n                checked: forceSameTabNavigation,\n                children: trackingTip\n            }),\n            key: 'track-config'\n        });\n        if (showDeepThinkOption) items.push({\n            label: /*#__PURE__*/ jsx(Checkbox, {\n                onChange: (e)=>{\n                    setDeepThink(e.target.checked);\n                },\n                checked: deepThink,\n                children: deepThinkTip\n            }),\n            key: 'deep-think-config'\n        });\n        if (showDataExtractionOptions && !hideDomAndScreenshotOptions) {\n            items.push({\n                label: /*#__PURE__*/ jsx(Checkbox, {\n                    onChange: (e)=>{\n                        setScreenshotIncluded(e.target.checked);\n                    },\n                    checked: screenshotIncluded,\n                    children: screenshotIncludedTip\n                }),\n                key: 'screenshot-included-config'\n            });\n            items.push({\n                label: /*#__PURE__*/ jsxs(\"div\", {\n                    style: {\n                        padding: '4px 0'\n                    },\n                    children: [\n                        /*#__PURE__*/ jsx(\"div\", {\n                            style: {\n                                marginBottom: '4px',\n                                fontSize: '14px'\n                            },\n                            children: domIncludedTip\n                        }),\n                        /*#__PURE__*/ jsxs(Radio.Group, {\n                            size: \"small\",\n                            value: domIncluded,\n                            onChange: (e)=>setDomIncluded(e.target.value),\n                            children: [\n                                /*#__PURE__*/ jsx(Radio, {\n                                    value: false,\n                                    children: \"Off\"\n                                }),\n                                /*#__PURE__*/ jsx(Radio, {\n                                    value: true,\n                                    children: \"All\"\n                                }),\n                                /*#__PURE__*/ jsx(Radio, {\n                                    value: 'visible-only',\n                                    children: \"Visible only\"\n                                })\n                            ]\n                        })\n                    ]\n                }),\n                key: 'dom-included-config'\n            });\n        }\n        return items;\n    }\n};\nexport { ConfigSelector };\n","import { jsx } from \"react/jsx-runtime\";\nimport { Form, Input, InputNumber, Select } from \"antd\";\nconst { TextArea } = Input;\nconst renderLabel = (label, isOptional)=>`${label}${isOptional ? ' (Optional)' : ''}`;\nconst TextField = (param)=>{\n    let { name, label, isRequired, marginBottom, placeholder: customPlaceholder } = param;\n    const placeholder = customPlaceholder || `Enter ${name}`;\n    return /*#__PURE__*/ jsx(Form.Item, {\n        name: [\n            'params',\n            name\n        ],\n        label: renderLabel(label, !isRequired),\n        rules: isRequired ? [\n            {\n                required: true,\n                message: `Please input ${name}`\n            }\n        ] : [],\n        style: {\n            marginBottom\n        },\n        colon: false,\n        children: /*#__PURE__*/ jsx(Input, {\n            placeholder: placeholder\n        })\n    }, name);\n};\nconst LocateField = (param)=>{\n    let { name, label, isRequired, marginBottom, placeholder: customPlaceholder } = param;\n    const placeholder = customPlaceholder || `Describe the ${name}, use natural language`;\n    return /*#__PURE__*/ jsx(Form.Item, {\n        name: [\n            'params',\n            name\n        ],\n        label: renderLabel(label, !isRequired),\n        rules: isRequired ? [\n            {\n                required: true,\n                message: `The ${name} is required`\n            }\n        ] : [],\n        style: {\n            marginBottom\n        },\n        colon: false,\n        children: /*#__PURE__*/ jsx(TextArea, {\n            rows: 2,\n            placeholder: placeholder\n        })\n    }, name);\n};\nconst EnumField = (param)=>{\n    let { name, label, fieldSchema, isRequired, marginBottom, placeholder: customPlaceholder } = param;\n    var _fieldSchema__def;\n    const enumValues = (null == (_fieldSchema__def = fieldSchema._def) ? void 0 : _fieldSchema__def.values) || [];\n    const selectOptions = enumValues.map((value)=>({\n            value,\n            label: value.charAt(0).toUpperCase() + value.slice(1)\n        }));\n    return /*#__PURE__*/ jsx(Form.Item, {\n        name: [\n            'params',\n            name\n        ],\n        label: label,\n        rules: isRequired ? [\n            {\n                required: true,\n                message: `Please select ${name}`\n            }\n        ] : [],\n        style: {\n            marginBottom\n        },\n        colon: false,\n        children: /*#__PURE__*/ jsx(Select, {\n            placeholder: customPlaceholder || `Select ${name}`,\n            options: selectOptions\n        })\n    }, name);\n};\nconst NumberField = (param)=>{\n    let { name, label, isRequired, marginBottom, placeholder: customPlaceholder } = param;\n    const defaultPlaceholder = 'distance' === name ? 500 : 0;\n    const placeholderValue = customPlaceholder ? Number(customPlaceholder) || defaultPlaceholder : defaultPlaceholder;\n    const min = 0;\n    const max = 'distance' === name ? 10000 : void 0;\n    return /*#__PURE__*/ jsx(Form.Item, {\n        name: [\n            'params',\n            name\n        ],\n        label: `${label}${'distance' === name ? ' (px)' : ''}`,\n        rules: isRequired ? [\n            {\n                required: true,\n                message: `Please input ${name}`\n            },\n            {\n                type: 'number',\n                min,\n                message: `${label} must be at least ${min}`\n            }\n        ] : [\n            {\n                type: 'number',\n                min,\n                message: `${label} must be at least ${min}`\n            }\n        ],\n        style: {\n            flex: 'distance' === name ? 1 : void 0,\n            marginBottom\n        },\n        colon: false,\n        children: /*#__PURE__*/ jsx(InputNumber, {\n            placeholder: placeholderValue.toString(),\n            min: min,\n            max: max,\n            step: 'distance' === name ? 10 : 1,\n            style: {\n                width: '100%'\n            }\n        })\n    }, name);\n};\nconst BooleanField = (param)=>{\n    let { name, label, isRequired, marginBottom, placeholder: customPlaceholder } = param;\n    const selectOptions = [\n        {\n            value: true,\n            label: 'True'\n        },\n        {\n            value: false,\n            label: 'False'\n        }\n    ];\n    return /*#__PURE__*/ jsx(Form.Item, {\n        name: [\n            'params',\n            name\n        ],\n        label: renderLabel(label, !isRequired),\n        rules: isRequired ? [\n            {\n                required: true,\n                message: `Please select ${name}`\n            }\n        ] : [],\n        style: {\n            marginBottom\n        },\n        colon: false,\n        children: /*#__PURE__*/ jsx(Select, {\n            placeholder: customPlaceholder || `Select ${name}`,\n            options: selectOptions\n        })\n    }, name);\n};\nexport { BooleanField, EnumField, LocateField, NumberField, TextField };\n","import { jsx } from \"react/jsx-runtime\";\nimport \"react\";\nconst SvgClose = (props)=>/*#__PURE__*/ jsx(\"svg\", {\n        xmlns: \"http://www.w3.org/2000/svg\",\n        width: 18,\n        height: 16,\n        fill: \"none\",\n        viewBox: \"0 0 18 16\",\n        ...props,\n        children: /*#__PURE__*/ jsx(\"path\", {\n            stroke: \"#333\",\n            strokeLinecap: \"round\",\n            strokeLinejoin: \"round\",\n            strokeWidth: 1.333,\n            d: \"m3.124 2.667 11.162 10.666M3.124 13.333 14.286 2.667\"\n        })\n    });\nconst icons_close = SvgClose;\nexport { icons_close as default };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport \"react\";\nconst SvgHistory = (props)=>/*#__PURE__*/ jsxs(\"svg\", {\n        xmlns: \"http://www.w3.org/2000/svg\",\n        width: 25,\n        height: 25,\n        fill: \"none\",\n        viewBox: \"0 0 25 25\",\n        ...props,\n        children: [\n            /*#__PURE__*/ jsx(\"path\", {\n                stroke: \"#000\",\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeOpacity: 0.85,\n                strokeWidth: 1.33,\n                d: \"M6.63 9.021c-2.862 6.126 2.197 10.501 6.063 10.501a7 7 0 1 0-6.063-10.5\"\n            }),\n            /*#__PURE__*/ jsx(\"path\", {\n                stroke: \"#000\",\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeOpacity: 0.85,\n                strokeWidth: 1.33,\n                d: \"M12.695 8.322v4.203l2.967 2.968\"\n            })\n        ]\n    });\nconst icons_history = SvgHistory;\nexport { icons_history as default };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport \"react\";\nconst SvgMagnifyingGlass = (props)=>/*#__PURE__*/ jsxs(\"svg\", {\n        xmlns: \"http://www.w3.org/2000/svg\",\n        width: 19,\n        height: 19,\n        fill: \"none\",\n        viewBox: \"0 0 19 19\",\n        ...props,\n        children: [\n            /*#__PURE__*/ jsxs(\"g\", {\n                stroke: \"#000\",\n                strokeLinejoin: \"round\",\n                strokeOpacity: 0.65,\n                strokeWidth: 1.5,\n                clipPath: \"url(#magnifying-glass_svg__a)\",\n                children: [\n                    /*#__PURE__*/ jsx(\"path\", {\n                        d: \"M8.397 14.29a6.375 6.375 0 1 0 0-12.75 6.375 6.375 0 0 0 0 12.75Z\"\n                    }),\n                    /*#__PURE__*/ jsx(\"path\", {\n                        strokeLinecap: \"round\",\n                        d: \"M10.519 5.42a3 3 0 0 0-2.122-.88 3 3 0 0 0-2.121.88M12.98 12.499l3.182 3.182\"\n                    })\n                ]\n            }),\n            /*#__PURE__*/ jsx(\"defs\", {\n                children: /*#__PURE__*/ jsx(\"clipPath\", {\n                    id: \"magnifying-glass_svg__a\",\n                    children: /*#__PURE__*/ jsx(\"path\", {\n                        fill: \"#fff\",\n                        d: \"M.522.04h18v18h-18z\"\n                    })\n                })\n            })\n        ]\n    });\nconst magnifying_glass = SvgMagnifyingGlass;\nexport { magnifying_glass as default };\n","import { Fragment, jsx, jsxs } from \"react/jsx-runtime\";\nimport { Button, Input, Typography } from \"antd\";\nimport { useEffect, useMemo, useRef, useState } from \"react\";\nimport icons_close from \"../../icons/close.mjs\";\nimport icons_history from \"../../icons/history.mjs\";\nimport magnifying_glass from \"../../icons/magnifying-glass.mjs\";\nimport { useHistoryStore } from \"../../store/history.mjs\";\nimport \"./index.css\";\nconst { Text } = Typography;\nconst HistorySelector = (param)=>{\n    let { onSelect, history, currentType } = param;\n    const [isModalOpen, setIsModalOpen] = useState(false);\n    const [searchText, setSearchText] = useState('');\n    const clearHistory = useHistoryStore((state)=>state.clearHistory);\n    const modalRef = useRef(null);\n    const groupedHistory = useMemo(()=>{\n        const now = Date.now();\n        const sevenDaysAgo = now - 604800000;\n        const oneYearAgo = now - 31536000000;\n        const filteredHistory = history.filter((item)=>item.prompt.toLowerCase().includes(searchText.toLowerCase()));\n        const groups = {\n            recent7Days: filteredHistory.filter((item)=>item.timestamp >= sevenDaysAgo),\n            recent1Year: filteredHistory.filter((item)=>item.timestamp < sevenDaysAgo && item.timestamp >= oneYearAgo),\n            older: filteredHistory.filter((item)=>item.timestamp < oneYearAgo)\n        };\n        return groups;\n    }, [\n        history,\n        searchText\n    ]);\n    const handleHistoryClick = (item)=>{\n        onSelect(item);\n        setIsModalOpen(false);\n    };\n    const handleClearHistory = ()=>{\n        clearHistory(currentType);\n        setSearchText('');\n        setIsModalOpen(false);\n    };\n    useEffect(()=>{\n        if (!isModalOpen) return;\n        const handleClickOutside = (event)=>{\n            if (modalRef.current && !modalRef.current.contains(event.target)) setIsModalOpen(false);\n        };\n        const timer = setTimeout(()=>{\n            document.addEventListener('click', handleClickOutside);\n        }, 100);\n        return ()=>{\n            clearTimeout(timer);\n            document.removeEventListener('click', handleClickOutside);\n        };\n    }, [\n        isModalOpen\n    ]);\n    const renderHistoryGroup = (title, items)=>{\n        if (0 === items.length) return null;\n        return /*#__PURE__*/ jsxs(\"div\", {\n            className: \"history-group\",\n            children: [\n                /*#__PURE__*/ jsx(\"div\", {\n                    className: \"history-group-title\",\n                    children: title\n                }),\n                items.map((item, index)=>/*#__PURE__*/ jsx(\"div\", {\n                        className: \"history-item\",\n                        onClick: ()=>handleHistoryClick(item),\n                        children: item.prompt\n                    }, `${item.timestamp}-${index}`))\n            ]\n        }, title);\n    };\n    return /*#__PURE__*/ jsxs(\"div\", {\n        className: \"history-selector-wrapper\",\n        children: [\n            /*#__PURE__*/ jsx(\"div\", {\n                className: \"selector-trigger\",\n                onClick: ()=>setIsModalOpen(true),\n                children: /*#__PURE__*/ jsx(icons_history, {\n                    width: 24,\n                    height: 24\n                })\n            }),\n            isModalOpen && /*#__PURE__*/ jsx(\"div\", {\n                className: \"history-modal-overlay\",\n                ref: modalRef,\n                children: /*#__PURE__*/ jsxs(\"div\", {\n                    className: \"history-modal-container\",\n                    children: [\n                        /*#__PURE__*/ jsxs(\"div\", {\n                            className: \"history-modal-header\",\n                            children: [\n                                /*#__PURE__*/ jsxs(Text, {\n                                    strong: true,\n                                    style: {\n                                        fontSize: '16px'\n                                    },\n                                    children: [\n                                        \"History (\",\n                                        history.length,\n                                        \")\"\n                                    ]\n                                }),\n                                /*#__PURE__*/ jsx(Button, {\n                                    size: \"small\",\n                                    type: \"text\",\n                                    icon: /*#__PURE__*/ jsx(icons_close, {\n                                        width: 16,\n                                        height: 16\n                                    }),\n                                    onClick: ()=>setIsModalOpen(false),\n                                    className: \"close-button\"\n                                })\n                            ]\n                        }),\n                        /*#__PURE__*/ jsx(\"div\", {\n                            className: \"history-search-section\",\n                            children: /*#__PURE__*/ jsxs(\"div\", {\n                                className: \"search-input-wrapper\",\n                                children: [\n                                    /*#__PURE__*/ jsx(Input, {\n                                        placeholder: \"Search\",\n                                        value: searchText,\n                                        onChange: (e)=>setSearchText(e.target.value),\n                                        prefix: /*#__PURE__*/ jsx(magnifying_glass, {\n                                            width: 18,\n                                            height: 18\n                                        }),\n                                        className: \"search-input\",\n                                        allowClear: true\n                                    }),\n                                    /*#__PURE__*/ jsx(Button, {\n                                        type: \"link\",\n                                        onClick: handleClearHistory,\n                                        className: \"clear-button\",\n                                        disabled: 0 === history.length,\n                                        children: \"Clear\"\n                                    })\n                                ]\n                            })\n                        }),\n                        /*#__PURE__*/ jsx(\"div\", {\n                            className: \"history-content\",\n                            children: 0 === history.length ? /*#__PURE__*/ jsx(\"div\", {\n                                className: \"no-results\",\n                                children: /*#__PURE__*/ jsx(Text, {\n                                    type: \"secondary\",\n                                    children: \"No history record\"\n                                })\n                            }) : /*#__PURE__*/ jsxs(Fragment, {\n                                children: [\n                                    renderHistoryGroup('Last 7 days', groupedHistory.recent7Days),\n                                    renderHistoryGroup('Last 1 year', groupedHistory.recent1Year),\n                                    renderHistoryGroup('Earlier', groupedHistory.older),\n                                    searchText && 0 === groupedHistory.recent7Days.length && 0 === groupedHistory.recent1Year.length && 0 === groupedHistory.older.length && /*#__PURE__*/ jsx(\"div\", {\n                                        className: \"no-results\",\n                                        children: /*#__PURE__*/ jsx(Text, {\n                                            type: \"secondary\",\n                                            children: \"No matching history record\"\n                                        })\n                                    })\n                                ]\n                            })\n                        })\n                    ]\n                })\n            })\n        ]\n    });\n};\nexport { HistorySelector };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport { BorderOutlined, DownOutlined, SendOutlined } from \"@ant-design/icons\";\nimport \"./index.css\";\nimport { Button, Dropdown, Form, Input, Radio, Tooltip } from \"antd\";\nimport react, { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { useHistoryStore } from \"../../store/history.mjs\";\nimport { extractDefaultValue, isLocateField, isZodObjectSchema, unwrapZodType } from \"../../types.mjs\";\nimport { apiMetadata, defaultMainButtons } from \"../../utils/constants.mjs\";\nimport { actionNameForType, getPlaceholderForType, isRunButtonEnabled as playground_utils_mjs_isRunButtonEnabled } from \"../../utils/playground-utils.mjs\";\nimport { ConfigSelector } from \"../config-selector/index.mjs\";\nimport { BooleanField, EnumField, LocateField, NumberField, TextField } from \"../form-field/index.mjs\";\nimport { HistorySelector } from \"../history-selector/index.mjs\";\nconst { TextArea } = Input;\nconst PromptInput = (param)=>{\n    let { runButtonEnabled, form, serviceMode, selectedType, dryMode, stoppable, loading, onRun, onStop, clearPromptAfterRun = true, actionSpace, hideDomAndScreenshotOptions = false } = param;\n    const [hoveringSettings, setHoveringSettings] = useState(false);\n    const [promptValue, setPromptValue] = useState('');\n    const placeholder = getPlaceholderForType(selectedType);\n    const textAreaRef = useRef(null);\n    const modeRadioGroupRef = useRef(null);\n    const params = Form.useWatch('params', form);\n    const lastHistoryRef = useRef(null);\n    const history = useHistoryStore((state)=>state.history);\n    const lastSelectedType = useHistoryStore((state)=>state.lastSelectedType);\n    const addHistory = useHistoryStore((state)=>state.addHistory);\n    const setLastSelectedType = useHistoryStore((state)=>state.setLastSelectedType);\n    const historyForSelectedType = useMemo(()=>history[selectedType] || [], [\n        history,\n        selectedType\n    ]);\n    const needsStructuredParams = useMemo(()=>{\n        if (actionSpace) {\n            const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n            if (!(null == action ? void 0 : action.paramSchema)) return false;\n            if (isZodObjectSchema(action.paramSchema)) {\n                const schema = action.paramSchema;\n                const shape = schema.shape || {};\n                const shapeKeys = Object.keys(shape);\n                return shapeKeys.length > 0;\n            }\n            return true;\n        }\n        return false;\n    }, [\n        selectedType,\n        actionSpace\n    ]);\n    const needsAnyInput = useMemo(()=>{\n        if (actionSpace && actionSpace.length > 0) {\n            const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n            if (action) {\n                if (action.paramSchema && isZodObjectSchema(action.paramSchema)) {\n                    const schema = action.paramSchema;\n                    const shape = schema.shape || {};\n                    const hasRequiredFields = Object.keys(shape).some((key)=>{\n                        const field = shape[key];\n                        const { isOptional } = unwrapZodType(field);\n                        return !isOptional;\n                    });\n                    return hasRequiredFields;\n                }\n                return !!action.paramSchema;\n            }\n        }\n        return true;\n    }, [\n        selectedType,\n        actionSpace\n    ]);\n    const showDataExtractionOptions = useMemo(()=>{\n        const dataExtractionMethods = [\n            'aiQuery',\n            'aiBoolean',\n            'aiNumber',\n            'aiString',\n            'aiAsk',\n            'aiAssert'\n        ];\n        return dataExtractionMethods.includes(selectedType);\n    }, [\n        selectedType\n    ]);\n    const showDeepThinkOption = useMemo(()=>{\n        if ('aiLocate' === selectedType) return true;\n        if (actionSpace) {\n            const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n            if ((null == action ? void 0 : action.paramSchema) && isZodObjectSchema(action.paramSchema)) {\n                const schema = action.paramSchema;\n                const shape = schema.shape || {};\n                const hasLocateField = Object.keys(shape).some((key)=>{\n                    const field = shape[key];\n                    const { actualField } = unwrapZodType(field);\n                    return isLocateField(actualField);\n                });\n                return hasLocateField;\n            }\n        }\n        return false;\n    }, [\n        selectedType,\n        actionSpace\n    ]);\n    const hasConfigOptions = useMemo(()=>{\n        const hasTracking = 'In-Browser-Extension' === serviceMode;\n        const hasDeepThink = showDeepThinkOption;\n        const hasDataExtraction = showDataExtractionOptions && !hideDomAndScreenshotOptions;\n        return hasTracking || hasDeepThink || hasDataExtraction;\n    }, [\n        serviceMode,\n        showDeepThinkOption,\n        showDataExtractionOptions,\n        hideDomAndScreenshotOptions\n    ]);\n    const availableDropdownMethods = useMemo(()=>{\n        const metadataMethods = Object.keys(apiMetadata);\n        if (!actionSpace || 0 === actionSpace.length) return metadataMethods;\n        const availableMethods = actionSpace.map((action)=>action.interfaceAlias || action.name);\n        const finalMethods = new Set();\n        metadataMethods.forEach((method)=>{\n            const methodInfo = apiMetadata[method];\n            if ((null == methodInfo ? void 0 : methodInfo.group) === 'extraction' || (null == methodInfo ? void 0 : methodInfo.group) === 'validation') finalMethods.add(method);\n            else if (availableMethods.includes(method)) finalMethods.add(method);\n        });\n        availableMethods.forEach((method)=>{\n            finalMethods.add(method);\n        });\n        return Array.from(finalMethods);\n    }, [\n        actionSpace\n    ]);\n    const getDefaultParams = useCallback(()=>{\n        if (!needsStructuredParams || !actionSpace) return {};\n        const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n        if ((null == action ? void 0 : action.paramSchema) && isZodObjectSchema(action.paramSchema)) {\n            const defaultParams = {};\n            const schema = action.paramSchema;\n            const shape = schema.shape || {};\n            Object.keys(shape).forEach((key)=>{\n                const field = shape[key];\n                const defaultValue = extractDefaultValue(field);\n                if (void 0 !== defaultValue) defaultParams[key] = defaultValue;\n            });\n            return defaultParams;\n        }\n        return {};\n    }, [\n        selectedType,\n        needsStructuredParams,\n        actionSpace\n    ]);\n    useEffect(()=>{\n        if (!form.getFieldValue('type') && lastSelectedType) form.setFieldValue('type', lastSelectedType);\n    }, [\n        form,\n        lastSelectedType\n    ]);\n    useEffect(()=>{\n        if (selectedType && selectedType !== lastSelectedType) setLastSelectedType(selectedType);\n    }, [\n        selectedType,\n        lastSelectedType,\n        setLastSelectedType\n    ]);\n    const scrollToSelectedItem = useCallback(()=>{\n        const container = modeRadioGroupRef.current;\n        if (!container) return;\n        let targetElement = null;\n        const selectedRadioButton = container.querySelector('.ant-radio-button-wrapper-checked');\n        const dropdownButton = container.querySelector('.more-apis-button.selected-from-dropdown');\n        if (selectedRadioButton) targetElement = selectedRadioButton;\n        else if (dropdownButton) targetElement = dropdownButton;\n        if (targetElement) {\n            const containerRect = container.getBoundingClientRect();\n            const targetRect = targetElement.getBoundingClientRect();\n            const targetLeft = targetRect.left - containerRect.left + container.scrollLeft;\n            const targetWidth = targetRect.width;\n            const containerWidth = containerRect.width;\n            const optimalScrollLeft = targetLeft - (containerWidth - targetWidth) / 2;\n            container.scrollTo({\n                left: Math.max(0, optimalScrollLeft),\n                behavior: 'smooth'\n            });\n        }\n    }, []);\n    useEffect(()=>{\n        const lastHistory = historyForSelectedType[0];\n        if (lastHistory && lastHistoryRef.current && lastHistory.timestamp === lastHistoryRef.current.timestamp) return;\n        if (lastHistory) {\n            form.setFieldsValue({\n                type: lastHistory.type,\n                prompt: lastHistory.prompt || '',\n                params: lastHistory.params\n            });\n            setPromptValue(lastHistory.prompt || '');\n            lastHistoryRef.current = lastHistory;\n        } else {\n            const defaultParams = getDefaultParams();\n            form.setFieldsValue({\n                prompt: '',\n                params: defaultParams\n            });\n            setPromptValue('');\n            lastHistoryRef.current = null;\n        }\n    }, [\n        selectedType,\n        historyForSelectedType,\n        form,\n        getDefaultParams\n    ]);\n    useEffect(()=>{\n        const timeoutId = setTimeout(()=>{\n            scrollToSelectedItem();\n        }, 100);\n        return ()=>clearTimeout(timeoutId);\n    }, [\n        selectedType,\n        scrollToSelectedItem\n    ]);\n    const formPromptValue = Form.useWatch('prompt', form);\n    useEffect(()=>{\n        if (formPromptValue !== promptValue) setPromptValue(formPromptValue || '');\n    }, [\n        formPromptValue,\n        promptValue\n    ]);\n    const handleSelectHistory = useCallback((historyItem)=>{\n        form.setFieldsValue({\n            prompt: historyItem.prompt,\n            type: historyItem.type,\n            params: historyItem.params\n        });\n        setPromptValue(historyItem.prompt);\n    }, [\n        form\n    ]);\n    const handlePromptChange = useCallback((e)=>{\n        const value = e.target.value;\n        setPromptValue(value);\n    }, []);\n    const hasSingleStructuredParam = useMemo(()=>{\n        if (!needsStructuredParams || !actionSpace) return false;\n        const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n        if ((null == action ? void 0 : action.paramSchema) && isZodObjectSchema(action.paramSchema)) {\n            const schema = action.paramSchema;\n            const shape = schema.shape || {};\n            return 1 === Object.keys(shape).length;\n        }\n        return false;\n    }, [\n        selectedType,\n        needsStructuredParams,\n        actionSpace\n    ]);\n    const isRunButtonEnabled = useMemo(()=>playground_utils_mjs_isRunButtonEnabled(runButtonEnabled, !!needsStructuredParams, params, actionSpace, selectedType, promptValue), [\n        runButtonEnabled,\n        needsStructuredParams,\n        selectedType,\n        actionSpace,\n        promptValue,\n        params\n    ]);\n    const handleRunWithHistory = useCallback(()=>{\n        const values = form.getFieldsValue();\n        let historyPrompt = '';\n        if (needsStructuredParams && values.params && actionSpace) {\n            const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n            if ((null == action ? void 0 : action.paramSchema) && isZodObjectSchema(action.paramSchema)) {\n                let locateValue = '';\n                const otherValues = [];\n                const schema = action.paramSchema;\n                const shape = schema.shape || {};\n                Object.keys(shape).forEach((key)=>{\n                    var _values_params;\n                    const paramValue = null == (_values_params = values.params) ? void 0 : _values_params[key];\n                    if (null != paramValue && '' !== paramValue) {\n                        const field = shape[key];\n                        const { actualField } = unwrapZodType(field);\n                        if (isLocateField(actualField)) locateValue = String(paramValue);\n                        else if ('distance' === key) otherValues.push(`${paramValue}`);\n                        else otherValues.push(String(paramValue));\n                    }\n                });\n                const mainPart = otherValues.join(' ');\n                historyPrompt = locateValue ? `${locateValue} - ${mainPart}` : mainPart;\n            } else historyPrompt = values.prompt || '';\n        } else historyPrompt = values.prompt || '';\n        const newHistoryItem = {\n            type: values.type,\n            prompt: historyPrompt,\n            params: values.params,\n            timestamp: Date.now()\n        };\n        addHistory(newHistoryItem);\n        onRun();\n        if (clearPromptAfterRun) {\n            lastHistoryRef.current = newHistoryItem;\n            setPromptValue('');\n            if (needsStructuredParams) {\n                const defaultParams = getDefaultParams();\n                form.setFieldValue('params', defaultParams);\n            } else form.setFieldValue('prompt', '');\n        }\n    }, [\n        form,\n        addHistory,\n        onRun,\n        needsStructuredParams,\n        selectedType,\n        clearPromptAfterRun,\n        actionSpace,\n        getDefaultParams\n    ]);\n    const handleKeyDown = useCallback((e)=>{\n        if ('Enter' === e.key && e.metaKey && isRunButtonEnabled) {\n            handleRunWithHistory();\n            e.preventDefault();\n            e.stopPropagation();\n        } else if ('Enter' === e.key) setTimeout(()=>{\n            if (textAreaRef.current) {\n                var _textAreaRef_current_resizableTextArea;\n                const textarea = null == (_textAreaRef_current_resizableTextArea = textAreaRef.current.resizableTextArea) ? void 0 : _textAreaRef_current_resizableTextArea.textArea;\n                if (textarea) {\n                    const selectionStart = textarea.selectionStart;\n                    const value = textarea.value;\n                    const lastNewlineIndex = value.lastIndexOf('\\n');\n                    const isAtLastLine = -1 === lastNewlineIndex || selectionStart > lastNewlineIndex;\n                    if (isAtLastLine) textarea.scrollTop = textarea.scrollHeight;\n                }\n            }\n        }, 0);\n    }, [\n        handleRunWithHistory,\n        isRunButtonEnabled\n    ]);\n    const handleStructuredKeyDown = useCallback((e)=>{\n        if ('Enter' === e.key && e.metaKey && isRunButtonEnabled) {\n            handleRunWithHistory();\n            e.preventDefault();\n            e.stopPropagation();\n        }\n    }, [\n        handleRunWithHistory,\n        isRunButtonEnabled\n    ]);\n    const renderStructuredParams = useCallback(()=>{\n        if (!needsStructuredParams) return null;\n        if (actionSpace) {\n            const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n            if ((null == action ? void 0 : action.paramSchema) && isZodObjectSchema(action.paramSchema)) {\n                const schema = action.paramSchema;\n                const shape = schema.shape || {};\n                const schemaKeys = Object.keys(shape);\n                if (1 === schemaKeys.length) {\n                    const key = schemaKeys[0];\n                    const field = shape[key];\n                    const { actualField } = unwrapZodType(field);\n                    const isLocateFieldFlag = isLocateField(actualField);\n                    const placeholderText = (()=>{\n                        var _fieldWithRuntime__def;\n                        const fieldWithRuntime = actualField;\n                        if (null == (_fieldWithRuntime__def = fieldWithRuntime._def) ? void 0 : _fieldWithRuntime__def.description) return fieldWithRuntime._def.description;\n                        if (fieldWithRuntime.description) return fieldWithRuntime.description;\n                        if (actionSpace) {\n                            const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n                            if ((null == action ? void 0 : action.paramSchema) && 'object' == typeof action.paramSchema && 'shape' in action.paramSchema) {\n                                var _fieldDef__def;\n                                const shape = action.paramSchema.shape || {};\n                                const fieldDef = shape[key];\n                                if (null == fieldDef ? void 0 : null == (_fieldDef__def = fieldDef._def) ? void 0 : _fieldDef__def.description) return fieldDef._def.description;\n                                if (null == fieldDef ? void 0 : fieldDef.description) return fieldDef.description;\n                            }\n                        }\n                        if (isLocateFieldFlag) return 'Describe the element you want to interact with';\n                        if ('keyName' === key) return 'Enter key name or text to type';\n                        if ('value' === key) return 'Enter text to input';\n                        return `Enter ${key}`;\n                    })();\n                    return /*#__PURE__*/ jsx(Form.Item, {\n                        name: [\n                            'params',\n                            key\n                        ],\n                        style: {\n                            margin: 0\n                        },\n                        children: /*#__PURE__*/ jsx(Input.TextArea, {\n                            className: \"main-side-console-input-textarea\",\n                            rows: 4,\n                            placeholder: placeholderText,\n                            autoFocus: true,\n                            onKeyDown: handleStructuredKeyDown\n                        })\n                    });\n                }\n                const fields = [];\n                const sortedKeys = schemaKeys.sort((keyA, keyB)=>{\n                    const fieldSchemaA = shape[keyA];\n                    const fieldSchemaB = shape[keyB];\n                    const { isOptional: isOptionalA } = unwrapZodType(fieldSchemaA);\n                    const { isOptional: isOptionalB } = unwrapZodType(fieldSchemaB);\n                    if (!isOptionalA && isOptionalB) return -1;\n                    if (isOptionalA && !isOptionalB) return 1;\n                    return 0;\n                });\n                sortedKeys.forEach((key, index)=>{\n                    var _actualField__def, _actualField__def1, _actualField__def2;\n                    const fieldSchema = shape[key];\n                    const { actualField, isOptional } = unwrapZodType(fieldSchema);\n                    const isLocateFieldFlag = isLocateField(actualField);\n                    const label = key.charAt(0).toUpperCase() + key.slice(1);\n                    const isRequired = !isOptional;\n                    const marginBottom = index === sortedKeys.length - 1 ? 0 : 12;\n                    const placeholder = (()=>{\n                        var _fieldWithRuntime__def;\n                        const fieldWithRuntime = actualField;\n                        if (null == (_fieldWithRuntime__def = fieldWithRuntime._def) ? void 0 : _fieldWithRuntime__def.description) return fieldWithRuntime._def.description;\n                        if (fieldWithRuntime.description) return fieldWithRuntime.description;\n                        if (actionSpace) {\n                            const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n                            if ((null == action ? void 0 : action.paramSchema) && 'object' == typeof action.paramSchema && 'shape' in action.paramSchema) {\n                                var _fieldDef__def;\n                                const shape = action.paramSchema.shape || {};\n                                const fieldDef = shape[key];\n                                if (null == fieldDef ? void 0 : null == (_fieldDef__def = fieldDef._def) ? void 0 : _fieldDef__def.description) return fieldDef._def.description;\n                                if (null == fieldDef ? void 0 : fieldDef.description) return fieldDef.description;\n                            }\n                        }\n                        if (isLocateFieldFlag) return 'Describe the element you want to interact with';\n                    })();\n                    const fieldProps = {\n                        name: key,\n                        label,\n                        fieldSchema: actualField,\n                        isRequired,\n                        marginBottom,\n                        placeholder\n                    };\n                    if (isLocateFieldFlag) fields.push(/*#__PURE__*/ jsx(LocateField, {\n                        ...fieldProps\n                    }, key));\n                    else if ((null == (_actualField__def = actualField._def) ? void 0 : _actualField__def.typeName) === 'ZodEnum') fields.push(/*#__PURE__*/ jsx(EnumField, {\n                        ...fieldProps\n                    }, key));\n                    else if ((null == (_actualField__def1 = actualField._def) ? void 0 : _actualField__def1.typeName) === 'ZodNumber') fields.push(/*#__PURE__*/ jsx(NumberField, {\n                        ...fieldProps\n                    }, key));\n                    else if ((null == (_actualField__def2 = actualField._def) ? void 0 : _actualField__def2.typeName) === 'ZodBoolean') fields.push(/*#__PURE__*/ jsx(BooleanField, {\n                        ...fieldProps\n                    }, key));\n                    else fields.push(/*#__PURE__*/ jsx(TextField, {\n                        ...fieldProps\n                    }, key));\n                });\n                if ('aiScroll' === selectedType) {\n                    const directionField = fields.find((field)=>/*#__PURE__*/ react.isValidElement(field) && 'direction' === field.props.name);\n                    const distanceField = fields.find((field)=>/*#__PURE__*/ react.isValidElement(field) && 'distance' === field.props.name);\n                    const otherFields = fields.filter((field)=>/*#__PURE__*/ react.isValidElement(field) && 'direction' !== field.props.name && 'distance' !== field.props.name);\n                    if (directionField && distanceField) return /*#__PURE__*/ jsxs(\"div\", {\n                        className: \"structured-params\",\n                        children: [\n                            /*#__PURE__*/ jsxs(\"div\", {\n                                style: {\n                                    display: 'flex',\n                                    gap: 12,\n                                    marginBottom: 12\n                                },\n                                children: [\n                                    directionField,\n                                    distanceField\n                                ]\n                            }),\n                            otherFields\n                        ]\n                    });\n                }\n                return /*#__PURE__*/ jsx(\"div\", {\n                    className: \"structured-params\",\n                    children: fields\n                });\n            }\n        }\n        return null;\n    }, [\n        selectedType,\n        needsStructuredParams,\n        actionSpace,\n        handleStructuredKeyDown\n    ]);\n    const handleMouseEnter = useCallback(()=>{\n        setHoveringSettings(true);\n    }, []);\n    const handleMouseLeave = useCallback(()=>{\n        setHoveringSettings(false);\n    }, []);\n    const renderActionButton = useCallback(()=>{\n        const runButton = (text)=>/*#__PURE__*/ jsx(Button, {\n                type: \"primary\",\n                icon: /*#__PURE__*/ jsx(SendOutlined, {}),\n                style: {\n                    borderRadius: 20,\n                    zIndex: 999\n                },\n                onClick: handleRunWithHistory,\n                disabled: !isRunButtonEnabled,\n                loading: loading,\n                children: text\n            });\n        if (dryMode) return 'aiAction' === selectedType ? /*#__PURE__*/ jsx(Tooltip, {\n            title: \"Start executing until some interaction actions need to be performed. You can see the process of planning and locating.\",\n            children: runButton('Dry Run')\n        }) : runButton('Run');\n        if (stoppable) return /*#__PURE__*/ jsx(Button, {\n            icon: /*#__PURE__*/ jsx(BorderOutlined, {}),\n            onClick: onStop,\n            style: {\n                borderRadius: 20,\n                zIndex: 999\n            },\n            children: \"Stop\"\n        });\n        return runButton('Run');\n    }, [\n        dryMode,\n        loading,\n        handleRunWithHistory,\n        onStop,\n        isRunButtonEnabled,\n        selectedType,\n        stoppable\n    ]);\n    return /*#__PURE__*/ jsxs(\"div\", {\n        className: \"prompt-input-wrapper\",\n        children: [\n            /*#__PURE__*/ jsxs(\"div\", {\n                className: \"mode-radio-group-wrapper\",\n                children: [\n                    /*#__PURE__*/ jsxs(\"div\", {\n                        className: \"mode-radio-group\",\n                        ref: modeRadioGroupRef,\n                        children: [\n                            /*#__PURE__*/ jsx(Form.Item, {\n                                name: \"type\",\n                                style: {\n                                    margin: 0\n                                },\n                                children: /*#__PURE__*/ jsx(Radio.Group, {\n                                    buttonStyle: \"solid\",\n                                    disabled: !runButtonEnabled,\n                                    children: defaultMainButtons.map((apiType)=>{\n                                        var _apiMetadata_apiType;\n                                        return /*#__PURE__*/ jsx(Tooltip, {\n                                            title: (null == (_apiMetadata_apiType = apiMetadata[apiType]) ? void 0 : _apiMetadata_apiType.title) || '',\n                                            children: /*#__PURE__*/ jsx(Radio.Button, {\n                                                value: apiType,\n                                                children: actionNameForType(apiType)\n                                            })\n                                        }, apiType);\n                                    })\n                                })\n                            }),\n                            /*#__PURE__*/ jsx(Dropdown, {\n                                menu: (()=>{\n                                    const hiddenAPIs = availableDropdownMethods.filter((api)=>!defaultMainButtons.includes(api));\n                                    const groupedItems = [];\n                                    const interactionAPIs = hiddenAPIs.filter((api)=>{\n                                        var _apiMetadata_api;\n                                        return (null == (_apiMetadata_api = apiMetadata[api]) ? void 0 : _apiMetadata_api.group) === 'interaction';\n                                    });\n                                    if (interactionAPIs.length > 0) groupedItems.push({\n                                        key: 'interaction-group',\n                                        type: 'group',\n                                        label: 'Interaction APIs',\n                                        children: interactionAPIs.map((api)=>{\n                                            var _apiMetadata_api;\n                                            return {\n                                                key: api,\n                                                label: actionNameForType(api),\n                                                title: (null == (_apiMetadata_api = apiMetadata[api]) ? void 0 : _apiMetadata_api.title) || '',\n                                                onClick: ()=>{\n                                                    form.setFieldValue('type', api);\n                                                }\n                                            };\n                                        })\n                                    });\n                                    const extractionAPIs = hiddenAPIs.filter((api)=>{\n                                        var _apiMetadata_api;\n                                        return (null == (_apiMetadata_api = apiMetadata[api]) ? void 0 : _apiMetadata_api.group) === 'extraction';\n                                    });\n                                    if (extractionAPIs.length > 0) groupedItems.push({\n                                        key: 'extraction-group',\n                                        type: 'group',\n                                        label: 'Data Extraction APIs',\n                                        children: extractionAPIs.map((api)=>{\n                                            var _apiMetadata_api;\n                                            return {\n                                                key: api,\n                                                label: actionNameForType(api),\n                                                title: (null == (_apiMetadata_api = apiMetadata[api]) ? void 0 : _apiMetadata_api.title) || '',\n                                                onClick: ()=>{\n                                                    form.setFieldValue('type', api);\n                                                }\n                                            };\n                                        })\n                                    });\n                                    const validationAPIs = hiddenAPIs.filter((api)=>{\n                                        var _apiMetadata_api;\n                                        return (null == (_apiMetadata_api = apiMetadata[api]) ? void 0 : _apiMetadata_api.group) === 'validation';\n                                    });\n                                    if (validationAPIs.length > 0) groupedItems.push({\n                                        key: 'validation-group',\n                                        type: 'group',\n                                        label: 'Validation APIs',\n                                        children: validationAPIs.map((api)=>{\n                                            var _apiMetadata_api;\n                                            return {\n                                                key: api,\n                                                label: actionNameForType(api),\n                                                title: (null == (_apiMetadata_api = apiMetadata[api]) ? void 0 : _apiMetadata_api.title) || '',\n                                                onClick: ()=>{\n                                                    form.setFieldValue('type', api);\n                                                }\n                                            };\n                                        })\n                                    });\n                                    const deviceSpecificAPIs = hiddenAPIs.filter((api)=>!apiMetadata[api]);\n                                    if (deviceSpecificAPIs.length > 0) groupedItems.push({\n                                        key: 'device-specific-group',\n                                        type: 'group',\n                                        label: 'Device-Specific APIs',\n                                        children: deviceSpecificAPIs.map((api)=>({\n                                                key: api,\n                                                label: actionNameForType(api),\n                                                title: '',\n                                                onClick: ()=>{\n                                                    form.setFieldValue('type', api);\n                                                }\n                                            }))\n                                    });\n                                    return {\n                                        items: groupedItems\n                                    };\n                                })(),\n                                placement: \"bottomLeft\",\n                                trigger: [\n                                    'click'\n                                ],\n                                disabled: !runButtonEnabled,\n                                children: /*#__PURE__*/ jsxs(Button, {\n                                    className: `more-apis-button ${!defaultMainButtons.includes(selectedType) ? 'selected-from-dropdown' : ''}`,\n                                    children: [\n                                        selectedType && !defaultMainButtons.includes(selectedType) ? actionNameForType(selectedType) : 'more',\n                                        /*#__PURE__*/ jsx(DownOutlined, {\n                                            style: {\n                                                fontSize: '10px',\n                                                marginLeft: '2px'\n                                            }\n                                        })\n                                    ]\n                                })\n                            })\n                        ]\n                    }),\n                    /*#__PURE__*/ jsxs(\"div\", {\n                        className: \"action-icons\",\n                        children: [\n                            hasConfigOptions && /*#__PURE__*/ jsx(\"div\", {\n                                className: hoveringSettings ? 'settings-wrapper settings-wrapper-hover' : 'settings-wrapper',\n                                onMouseEnter: handleMouseEnter,\n                                onMouseLeave: handleMouseLeave,\n                                children: /*#__PURE__*/ jsx(ConfigSelector, {\n                                    enableTracking: 'In-Browser-Extension' === serviceMode,\n                                    showDeepThinkOption: showDeepThinkOption,\n                                    showDataExtractionOptions: showDataExtractionOptions,\n                                    hideDomAndScreenshotOptions: hideDomAndScreenshotOptions\n                                })\n                            }),\n                            /*#__PURE__*/ jsx(HistorySelector, {\n                                onSelect: handleSelectHistory,\n                                history: historyForSelectedType,\n                                currentType: selectedType\n                            })\n                        ]\n                    })\n                ]\n            }),\n            /*#__PURE__*/ jsxs(\"div\", {\n                className: `main-side-console-input ${!runButtonEnabled ? 'disabled' : ''} ${loading ? 'loading' : ''}`,\n                children: [\n                    needsAnyInput ? needsStructuredParams ? hasSingleStructuredParam ? renderStructuredParams() : /*#__PURE__*/ jsx(\"div\", {\n                        className: \"structured-params-container\",\n                        children: renderStructuredParams()\n                    }) : /*#__PURE__*/ jsx(Form.Item, {\n                        name: \"prompt\",\n                        style: {\n                            margin: 0\n                        },\n                        children: /*#__PURE__*/ jsx(TextArea, {\n                            className: \"main-side-console-input-textarea\",\n                            disabled: !runButtonEnabled,\n                            rows: 4,\n                            placeholder: placeholder,\n                            autoFocus: true,\n                            onKeyDown: handleKeyDown,\n                            onChange: handlePromptChange,\n                            ref: textAreaRef\n                        })\n                    }) : /*#__PURE__*/ jsxs(\"div\", {\n                        className: \"no-input-method\",\n                        style: {\n                            padding: '20px',\n                            textAlign: 'center',\n                            color: '#666',\n                            fontSize: '14px'\n                        },\n                        children: [\n                            'Click \"Run\" to execute ',\n                            actionNameForType(selectedType)\n                        ]\n                    }),\n                    /*#__PURE__*/ jsx(\"div\", {\n                        className: \"form-controller-wrapper\",\n                        children: renderActionButton()\n                    })\n                ]\n            })\n        ]\n    });\n};\nexport { PromptInput };\n","import { Fragment, jsx, jsxs } from \"react/jsx-runtime\";\nimport icons, { ArrowDownOutlined, ClearOutlined, LoadingOutlined } from \"@ant-design/icons\";\nimport { Button, Form, List, Tooltip, Typography, message } from \"antd\";\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { usePlaygroundExecution } from \"../../hooks/usePlaygroundExecution.mjs\";\nimport { usePlaygroundState } from \"../../hooks/usePlaygroundState.mjs\";\nimport { useEnvConfig } from \"../../store/store.mjs\";\nimport { ContextPreview } from \"../context-preview/index.mjs\";\nimport { EnvConfigReminder } from \"../env-config-reminder/index.mjs\";\nimport { PlaygroundResultView } from \"../playground-result/index.mjs\";\nimport \"./index.css\";\nimport avatar from \"../../icons/avatar.mjs\";\nimport { PromptInput } from \"../prompt-input/index.mjs\";\nimport { createStorageProvider, detectBestStorageType } from \"./providers/storage-provider.mjs\";\nconst { Text } = Typography;\nfunction getSDKId(sdk) {\n    if (sdk.id && 'string' == typeof sdk.id) return `agent-${sdk.id}`;\n    return 'playground-default';\n}\nfunction ErrorMessage(param) {\n    let { error } = param;\n    if (!error) return null;\n    return /*#__PURE__*/ jsxs(Tooltip, {\n        title: /*#__PURE__*/ jsx(\"span\", {\n            style: {\n                whiteSpace: 'pre-wrap',\n                wordBreak: 'break-all'\n            },\n            children: error\n        }),\n        overlayStyle: {\n            maxWidth: '100vw'\n        },\n        children: [\n            \"Error: \",\n            error.split('\\n')[0]\n        ]\n    });\n}\nfunction UniversalPlayground(param) {\n    let { playgroundSDK, storage, contextProvider, config: componentConfig = {}, branding = {}, className = '', dryMode = false, showContextPreview = true } = param;\n    const [form] = Form.useForm();\n    const { config } = useEnvConfig();\n    const [sdkReady, setSdkReady] = useState(false);\n    useEffect(()=>{\n        const initializeSDK = async ()=>{\n            if (playgroundSDK && 'function' == typeof playgroundSDK.checkStatus) try {\n                await playgroundSDK.checkStatus();\n                setSdkReady(true);\n            } catch (error) {\n                console.warn('Failed to initialize SDK, using default namespace:', error);\n                setSdkReady(true);\n            }\n            else setSdkReady(true);\n        };\n        initializeSDK();\n    }, [\n        playgroundSDK\n    ]);\n    const effectiveStorage = useMemo(()=>{\n        if (storage) return storage;\n        if (!sdkReady) return null;\n        const namespace = componentConfig.storageNamespace || getSDKId(playgroundSDK);\n        const bestStorageType = detectBestStorageType();\n        console.log(`Using ${bestStorageType} storage for namespace: ${namespace}`);\n        return createStorageProvider(bestStorageType, namespace);\n    }, [\n        storage,\n        sdkReady,\n        componentConfig.storageNamespace,\n        playgroundSDK\n    ]);\n    const { loading, setLoading, infoList, setInfoList, actionSpace, actionSpaceLoading, uiContextPreview, setUiContextPreview, showScrollToBottomButton, verticalMode, replayCounter, setReplayCounter, infoListRef, currentRunningIdRef, interruptedFlagRef, clearInfoList, handleScrollToBottom } = usePlaygroundState(playgroundSDK, effectiveStorage, contextProvider);\n    const { handleRun: executeAction, handleStop, canStop } = usePlaygroundExecution(playgroundSDK, effectiveStorage, actionSpace, loading, setLoading, infoList, setInfoList, replayCounter, setReplayCounter, verticalMode, currentRunningIdRef, interruptedFlagRef);\n    useEffect(()=>{\n        if ((null == playgroundSDK ? void 0 : playgroundSDK.overrideConfig) && config) playgroundSDK.overrideConfig(config).catch((error)=>{\n            console.error('Failed to override SDK config:', error);\n        });\n    }, [\n        playgroundSDK,\n        config\n    ]);\n    const handleFormRun = useCallback(async ()=>{\n        try {\n            const value = form.getFieldsValue();\n            await executeAction(value);\n        } catch (error) {\n            message.error((null == error ? void 0 : error.message) || 'Execution failed');\n        }\n    }, [\n        form,\n        executeAction\n    ]);\n    const configAlreadySet = Object.keys(config || {}).length >= 1;\n    const runButtonEnabled = componentConfig.serverMode || !dryMode && !actionSpaceLoading && configAlreadySet;\n    const selectedType = Form.useWatch('type', form);\n    const finalShowContextPreview = showContextPreview && false !== componentConfig.showContextPreview;\n    const layout = componentConfig.layout || 'vertical';\n    const showVersionInfo = false !== componentConfig.showVersionInfo;\n    return /*#__PURE__*/ jsx(\"div\", {\n        className: `playground-container ${layout}-mode ${className}`.trim(),\n        children: /*#__PURE__*/ jsxs(Form, {\n            form: form,\n            onFinish: handleFormRun,\n            className: \"command-form\",\n            children: [\n                finalShowContextPreview && /*#__PURE__*/ jsx(\"div\", {\n                    className: \"context-preview-section\",\n                    children: /*#__PURE__*/ jsx(ContextPreview, {\n                        uiContextPreview: uiContextPreview,\n                        setUiContextPreview: setUiContextPreview,\n                        showContextPreview: finalShowContextPreview\n                    })\n                }),\n                /*#__PURE__*/ jsxs(\"div\", {\n                    className: \"middle-dialog-area\",\n                    children: [\n                        infoList.length > 1 && /*#__PURE__*/ jsx(\"div\", {\n                            className: \"clear-button-container\",\n                            children: /*#__PURE__*/ jsx(Button, {\n                                size: \"small\",\n                                icon: /*#__PURE__*/ jsx(ClearOutlined, {}),\n                                onClick: clearInfoList,\n                                type: \"text\",\n                                className: \"clear-button\"\n                            })\n                        }),\n                        /*#__PURE__*/ jsx(\"div\", {\n                            ref: infoListRef,\n                            className: \"info-list-container\",\n                            children: /*#__PURE__*/ jsx(List, {\n                                itemLayout: \"vertical\",\n                                dataSource: infoList,\n                                renderItem: (item)=>{\n                                    var _item_result;\n                                    return /*#__PURE__*/ jsx(List.Item, {\n                                        className: \"list-item\",\n                                        children: 'user' === item.type ? /*#__PURE__*/ jsx(\"div\", {\n                                            className: \"user-message-container\",\n                                            children: /*#__PURE__*/ jsx(\"div\", {\n                                                className: \"user-message-bubble\",\n                                                children: item.content\n                                            })\n                                        }) : 'progress' === item.type ? /*#__PURE__*/ jsx(\"div\", {\n                                            children: (()=>{\n                                                var _parts_, _item_result, _item_result1, _item_result2;\n                                                const parts = item.content.split(' - ');\n                                                const action = null == (_parts_ = parts[0]) ? void 0 : _parts_.trim();\n                                                const description = parts.slice(1).join(' - ').trim();\n                                                const currentIndex = infoList.findIndex((listItem)=>listItem.id === item.id);\n                                                const laterProgressExists = infoList.slice(currentIndex + 1).some((listItem)=>'progress' === listItem.type);\n                                                const isLatestProgress = !laterProgressExists;\n                                                const shouldShowLoading = loading && isLatestProgress;\n                                                return /*#__PURE__*/ jsxs(Fragment, {\n                                                    children: [\n                                                        action && /*#__PURE__*/ jsxs(\"span\", {\n                                                            className: \"progress-action-item\",\n                                                            children: [\n                                                                action,\n                                                                /*#__PURE__*/ jsx(\"span\", {\n                                                                    className: `progress-status-icon ${shouldShowLoading ? 'loading' : (null == (_item_result = item.result) ? void 0 : _item_result.error) ? 'error' : 'completed'}`,\n                                                                    children: shouldShowLoading ? /*#__PURE__*/ jsx(LoadingOutlined, {\n                                                                        spin: true\n                                                                    }) : (null == (_item_result1 = item.result) ? void 0 : _item_result1.error) ? \"\\u2717\" : \"\\u2713\"\n                                                                })\n                                                            ]\n                                                        }),\n                                                        description && /*#__PURE__*/ jsx(\"div\", {\n                                                            children: /*#__PURE__*/ jsx(\"span\", {\n                                                                className: \"progress-description\",\n                                                                children: description\n                                                            })\n                                                        }),\n                                                        (null == (_item_result2 = item.result) ? void 0 : _item_result2.error) && /*#__PURE__*/ jsx(ErrorMessage, {\n                                                            error: item.result.error\n                                                        })\n                                                    ]\n                                                });\n                                            })()\n                                        }) : 'separator' === item.type ? /*#__PURE__*/ jsxs(\"div\", {\n                                            className: \"new-conversation-separator\",\n                                            children: [\n                                                /*#__PURE__*/ jsx(\"div\", {\n                                                    className: \"separator-line\"\n                                                }),\n                                                /*#__PURE__*/ jsx(\"div\", {\n                                                    className: \"separator-text-container\",\n                                                    children: /*#__PURE__*/ jsx(Text, {\n                                                        type: \"secondary\",\n                                                        className: \"separator-text\",\n                                                        children: item.content\n                                                    })\n                                                })\n                                            ]\n                                        }) : /*#__PURE__*/ jsxs(\"div\", {\n                                            className: \"system-message-container\",\n                                            children: [\n                                                /*#__PURE__*/ jsxs(\"div\", {\n                                                    className: \"system-message-header\",\n                                                    children: [\n                                                        /*#__PURE__*/ jsx(icons, {\n                                                            component: branding.icon || avatar,\n                                                            style: {\n                                                                fontSize: 20\n                                                            }\n                                                        }),\n                                                        /*#__PURE__*/ jsx(\"span\", {\n                                                            className: \"system-message-title\",\n                                                            children: branding.title || 'Playground'\n                                                        })\n                                                    ]\n                                                }),\n                                                (item.content || item.result) && /*#__PURE__*/ jsxs(\"div\", {\n                                                    className: \"system-message-content\",\n                                                    children: [\n                                                        'result' === item.type && (null == (_item_result = item.result) ? void 0 : _item_result.error) && /*#__PURE__*/ jsxs(\"div\", {\n                                                            className: \"error-message\",\n                                                            children: [\n                                                                /*#__PURE__*/ jsx(\"div\", {\n                                                                    className: \"divider\"\n                                                                }),\n                                                                /*#__PURE__*/ jsx(ErrorMessage, {\n                                                                    error: item.result.error\n                                                                })\n                                                            ]\n                                                        }),\n                                                        'result' === item.type ? /*#__PURE__*/ jsx(PlaygroundResultView, {\n                                                            result: item.result || null,\n                                                            loading: item.loading || false,\n                                                            serverValid: true,\n                                                            serviceMode: 'Server',\n                                                            replayScriptsInfo: item.replayScriptsInfo || null,\n                                                            replayCounter: item.replayCounter || 0,\n                                                            loadingProgressText: item.loadingProgressText || '',\n                                                            verticalMode: item.verticalMode || false,\n                                                            fitMode: \"width\"\n                                                        }) : /*#__PURE__*/ jsxs(Fragment, {\n                                                            children: [\n                                                                /*#__PURE__*/ jsx(\"div\", {\n                                                                    className: \"system-message-text\",\n                                                                    children: item.content\n                                                                }),\n                                                                item.loading && item.loadingProgressText && /*#__PURE__*/ jsx(\"div\", {\n                                                                    className: \"loading-progress-text\",\n                                                                    children: /*#__PURE__*/ jsx(\"span\", {\n                                                                        children: item.loadingProgressText\n                                                                    })\n                                                                })\n                                                            ]\n                                                        })\n                                                    ]\n                                                })\n                                            ]\n                                        })\n                                    }, item.id);\n                                }\n                            })\n                        }),\n                        showScrollToBottomButton && false !== componentConfig.enableScrollToBottom && /*#__PURE__*/ jsx(Button, {\n                            className: \"scroll-to-bottom-button\",\n                            type: \"primary\",\n                            shape: \"circle\",\n                            icon: /*#__PURE__*/ jsx(ArrowDownOutlined, {}),\n                            onClick: handleScrollToBottom,\n                            size: \"large\"\n                        })\n                    ]\n                }),\n                /*#__PURE__*/ jsxs(\"div\", {\n                    className: \"bottom-input-section\",\n                    children: [\n                        componentConfig.showEnvConfigReminder ? /*#__PURE__*/ jsx(EnvConfigReminder, {}) : null,\n                        /*#__PURE__*/ jsx(PromptInput, {\n                            runButtonEnabled: runButtonEnabled,\n                            form: form,\n                            serviceMode: 'Server',\n                            selectedType: selectedType,\n                            dryMode: dryMode,\n                            stoppable: canStop,\n                            loading: loading,\n                            onRun: handleFormRun,\n                            onStop: handleStop,\n                            actionSpace: actionSpace\n                        })\n                    ]\n                }),\n                showVersionInfo && branding.version && /*#__PURE__*/ jsx(\"div\", {\n                    className: \"version-info-section\",\n                    children: /*#__PURE__*/ jsxs(\"span\", {\n                        className: \"version-text\",\n                        children: [\n                            \"Midscene.js version: \",\n                            branding.version\n                        ]\n                    })\n                })\n            ]\n        })\n    });\n}\nconst universal_playground = UniversalPlayground;\nexport { UniversalPlayground, universal_playground as default };\n","import { useCallback, useEffect, useRef, useState } from \"react\";\nimport { createStorageProvider, detectBestStorageType } from \"../component/universal-playground/providers/storage-provider.mjs\";\nimport { WELCOME_MESSAGE_TEMPLATE } from \"../utils/constants.mjs\";\nfunction usePlaygroundState(playgroundSDK, storage, contextProvider) {\n    const [loading, setLoading] = useState(false);\n    const [infoList, setInfoList] = useState([]);\n    const [actionSpace, setActionSpace] = useState([]);\n    const [actionSpaceLoading, setActionSpaceLoading] = useState(true);\n    const [uiContextPreview, setUiContextPreview] = useState();\n    const [showScrollToBottomButton, setShowScrollToBottomButton] = useState(false);\n    const [verticalMode, setVerticalMode] = useState(false);\n    const [replayCounter, setReplayCounter] = useState(0);\n    const infoListRef = useRef(null);\n    const currentRunningIdRef = useRef(null);\n    const interruptedFlagRef = useRef({});\n    const initializedRef = useRef(false);\n    useEffect(()=>{\n        const migrateFromOldNamespace = async ()=>{\n            const oldStorage = createStorageProvider(detectBestStorageType(), 'playground-default');\n            try {\n                if (null == oldStorage ? void 0 : oldStorage.loadMessages) {\n                    const oldMessages = await oldStorage.loadMessages();\n                    if (oldMessages.length > 1) {\n                        console.log('Found data in old namespace, migrating...');\n                        if (null == storage ? void 0 : storage.saveMessages) await storage.saveMessages(oldMessages);\n                        if (oldStorage.clearMessages) await oldStorage.clearMessages();\n                        return oldMessages;\n                    }\n                }\n            } catch (error) {\n                console.debug('No data found in old namespace:', error);\n            }\n            return [];\n        };\n        const initializeMessages = async ()=>{\n            const welcomeMessage = {\n                ...WELCOME_MESSAGE_TEMPLATE,\n                id: 'welcome',\n                timestamp: new Date()\n            };\n            if (null == storage ? void 0 : storage.loadMessages) try {\n                let storedMessages = await storage.loadMessages();\n                if (0 === storedMessages.length) storedMessages = await migrateFromOldNamespace();\n                const hasWelcomeMessage = storedMessages.some((msg)=>'welcome' === msg.id);\n                hasWelcomeMessage ? setInfoList(storedMessages) : setInfoList([\n                    welcomeMessage,\n                    ...storedMessages\n                ]);\n            } catch (error) {\n                console.error('Failed to load messages:', error);\n                setInfoList([\n                    welcomeMessage\n                ]);\n            }\n            else setInfoList([\n                welcomeMessage\n            ]);\n        };\n        if (storage && !initializedRef.current) {\n            initializedRef.current = true;\n            initializeMessages();\n        } else if (!storage && 0 === infoList.length) initializeMessages();\n    }, [\n        storage\n    ]);\n    useEffect(()=>{\n        if ((null == storage ? void 0 : storage.saveMessages) && infoList.length > 1) storage.saveMessages(infoList).catch((error)=>{\n            if (error instanceof DOMException && 'QuotaExceededError' === error.name) console.warn('Storage quota exceeded - some messages may not be saved persistently');\n            else console.error('Failed to save messages:', error);\n        });\n    }, [\n        infoList,\n        storage\n    ]);\n    useEffect(()=>{\n        if (!(null == contextProvider ? void 0 : contextProvider.getUIContext) || uiContextPreview) return;\n        contextProvider.getUIContext().then((context)=>setUiContextPreview(context)).catch((error)=>{\n            console.error('Failed to get UI context:', error);\n        });\n    }, [\n        contextProvider,\n        uiContextPreview\n    ]);\n    useEffect(()=>{\n        const loadActionSpace = async ()=>{\n            setActionSpaceLoading(true);\n            try {\n                var _contextProvider_getUIContext;\n                if (!playgroundSDK) return void setActionSpace([]);\n                const context = uiContextPreview || await (null == contextProvider ? void 0 : null == (_contextProvider_getUIContext = contextProvider.getUIContext) ? void 0 : _contextProvider_getUIContext.call(contextProvider));\n                const space = await playgroundSDK.getActionSpace(context);\n                setActionSpace(space || []);\n            } catch (error) {\n                console.error('Failed to load action space:', error);\n                setActionSpace([]);\n            } finally{\n                setActionSpaceLoading(false);\n            }\n        };\n        loadActionSpace();\n    }, [\n        playgroundSDK,\n        uiContextPreview,\n        contextProvider\n    ]);\n    useEffect(()=>{\n        const sizeThreshold = 750;\n        setVerticalMode(window.innerWidth < sizeThreshold);\n        const handleResize = ()=>{\n            setVerticalMode(window.innerWidth < sizeThreshold);\n        };\n        window.addEventListener('resize', handleResize);\n        return ()=>window.removeEventListener('resize', handleResize);\n    }, []);\n    const scrollToBottom = useCallback(()=>{\n        setTimeout(()=>{\n            if (infoListRef.current) infoListRef.current.scrollTop = infoListRef.current.scrollHeight;\n        }, 100);\n    }, []);\n    const checkIfScrolledToBottom = useCallback(()=>{\n        if (infoListRef.current) {\n            const { scrollTop, scrollHeight, clientHeight } = infoListRef.current;\n            const isAtBottom = scrollTop + clientHeight >= scrollHeight - 10;\n            setShowScrollToBottomButton(!isAtBottom);\n        }\n    }, []);\n    const handleScrollToBottom = useCallback(()=>{\n        if (infoListRef.current) {\n            infoListRef.current.scrollTo({\n                top: infoListRef.current.scrollHeight,\n                behavior: 'smooth'\n            });\n            setShowScrollToBottomButton(false);\n        }\n    }, []);\n    useEffect(()=>{\n        if (infoList.length > 0) scrollToBottom();\n    }, [\n        infoList,\n        scrollToBottom\n    ]);\n    useEffect(()=>{\n        const container = infoListRef.current;\n        if (container) {\n            container.addEventListener('scroll', checkIfScrolledToBottom);\n            checkIfScrolledToBottom();\n            return ()=>{\n                container.removeEventListener('scroll', checkIfScrolledToBottom);\n            };\n        }\n    }, [\n        checkIfScrolledToBottom\n    ]);\n    const clearInfoList = useCallback(async ()=>{\n        const welcomeMessage = {\n            ...WELCOME_MESSAGE_TEMPLATE,\n            id: 'welcome',\n            timestamp: new Date()\n        };\n        setInfoList([\n            welcomeMessage\n        ]);\n        if (null == storage ? void 0 : storage.clearMessages) try {\n            await storage.clearMessages();\n        } catch (error) {\n            console.error('Failed to clear stored messages:', error);\n        }\n    }, [\n        storage\n    ]);\n    const refreshContext = useCallback(async ()=>{\n        if (null == contextProvider ? void 0 : contextProvider.refreshContext) try {\n            const newContext = await contextProvider.refreshContext();\n            setUiContextPreview(newContext);\n        } catch (error) {\n            console.error('Failed to refresh context:', error);\n        }\n    }, [\n        contextProvider\n    ]);\n    return {\n        loading,\n        setLoading,\n        infoList,\n        setInfoList,\n        actionSpace,\n        actionSpaceLoading,\n        uiContextPreview,\n        setUiContextPreview,\n        showScrollToBottomButton,\n        verticalMode,\n        replayCounter,\n        setReplayCounter,\n        infoListRef,\n        currentRunningIdRef,\n        interruptedFlagRef,\n        clearInfoList,\n        refreshContext,\n        handleScrollToBottom,\n        scrollToBottom\n    };\n}\nexport { usePlaygroundState };\n","import { useCallback } from \"react\";\nimport { useEnvConfig } from \"../store/store.mjs\";\nimport { noReplayAPIs } from \"@sqaitech/playground\";\nimport { BLANK_RESULT } from \"../utils/constants.mjs\";\nimport { allScriptsFromDump } from \"../utils/replay-scripts.mjs\";\nfunction usePlaygroundExecution(playgroundSDK, storage, actionSpace, loading, setLoading, infoList, setInfoList, replayCounter, setReplayCounter, verticalMode, currentRunningIdRef, interruptedFlagRef) {\n    const { deepThink, screenshotIncluded, domIncluded } = useEnvConfig();\n    const handleRun = useCallback(async (value)=>{\n        if (!playgroundSDK) return void console.warn('PlaygroundSDK is not available');\n        const thisRunningId = Date.now();\n        const actionType = value.type;\n        const displayContent = `${value.type}: ${value.prompt || JSON.stringify(value.params)}`;\n        const userItem = {\n            id: `user-${Date.now()}`,\n            type: 'user',\n            content: displayContent,\n            timestamp: new Date()\n        };\n        setInfoList((prev)=>[\n                ...prev,\n                userItem\n            ]);\n        setLoading(true);\n        const result = {\n            ...BLANK_RESULT\n        };\n        const systemItem = {\n            id: `system-${thisRunningId}`,\n            type: 'system',\n            content: '',\n            timestamp: new Date(),\n            loading: true,\n            loadingProgressText: ''\n        };\n        setInfoList((prev)=>[\n                ...prev,\n                systemItem\n            ]);\n        try {\n            currentRunningIdRef.current = thisRunningId;\n            interruptedFlagRef.current[thisRunningId] = false;\n            if (playgroundSDK.onProgressUpdate) playgroundSDK.onProgressUpdate(()=>{});\n            if (playgroundSDK.onProgressUpdate) playgroundSDK.onProgressUpdate((tip)=>{\n                if (interruptedFlagRef.current[thisRunningId]) return;\n                setInfoList((prev)=>{\n                    const lastItem = prev[prev.length - 1];\n                    if (lastItem && 'progress' === lastItem.type && lastItem.content === tip) return prev;\n                    const progressItem = {\n                        id: `progress-${thisRunningId}-${Date.now()}`,\n                        type: 'progress',\n                        content: tip,\n                        timestamp: new Date()\n                    };\n                    return [\n                        ...prev,\n                        progressItem\n                    ];\n                });\n            });\n            result.result = await playgroundSDK.executeAction(actionType, value, {\n                requestId: thisRunningId.toString(),\n                deepThink,\n                screenshotIncluded,\n                domIncluded\n            });\n            if ('object' == typeof result.result && null !== result.result) {\n                const resultObj = result.result;\n                if (resultObj.dump) result.dump = resultObj.dump;\n                if (resultObj.reportHTML) result.reportHTML = resultObj.reportHTML;\n                if (resultObj.error) result.error = resultObj.error;\n                if (void 0 !== resultObj.result) result.result = resultObj.result;\n            }\n        } catch (e) {\n            result.error = (null == e ? void 0 : e.message) || String(e);\n            console.error('Playground execution error:', e);\n        }\n        if (interruptedFlagRef.current[thisRunningId]) return;\n        setLoading(false);\n        currentRunningIdRef.current = null;\n        let replayInfo = null;\n        let counter = replayCounter;\n        if ((null == result ? void 0 : result.dump) && !noReplayAPIs.includes(actionType)) {\n            const info = allScriptsFromDump(result.dump);\n            setReplayCounter((c)=>c + 1);\n            replayInfo = info;\n            counter = replayCounter + 1;\n        }\n        setInfoList((prev)=>prev.map((item)=>item.id === `system-${thisRunningId}` ? {\n                    ...item,\n                    content: '',\n                    loading: false,\n                    loadingProgressText: ''\n                } : item));\n        const resultItem = {\n            id: `result-${thisRunningId}`,\n            type: 'result',\n            content: 'Execution result',\n            timestamp: new Date(),\n            result: result,\n            loading: false,\n            replayScriptsInfo: replayInfo,\n            replayCounter: counter,\n            loadingProgressText: '',\n            verticalMode: verticalMode\n        };\n        setInfoList((prev)=>[\n                ...prev,\n                resultItem\n            ]);\n        if (null == storage ? void 0 : storage.saveResult) try {\n            await storage.saveResult(resultItem.id, resultItem);\n        } catch (error) {\n            console.error('Failed to save result:', error);\n        }\n        const separatorItem = {\n            id: `separator-${thisRunningId}`,\n            type: 'separator',\n            content: 'New Session',\n            timestamp: new Date()\n        };\n        setInfoList((prev)=>[\n                ...prev,\n                separatorItem\n            ]);\n    }, [\n        playgroundSDK,\n        storage,\n        actionSpace,\n        setLoading,\n        setInfoList,\n        replayCounter,\n        setReplayCounter,\n        verticalMode,\n        currentRunningIdRef,\n        interruptedFlagRef,\n        deepThink,\n        screenshotIncluded,\n        domIncluded\n    ]);\n    const handleStop = useCallback(async ()=>{\n        const thisRunningId = currentRunningIdRef.current;\n        if (thisRunningId && playgroundSDK && playgroundSDK.cancelExecution) try {\n            await playgroundSDK.cancelExecution(thisRunningId.toString());\n            interruptedFlagRef.current[thisRunningId] = true;\n            setLoading(false);\n            if (playgroundSDK.onProgressUpdate) playgroundSDK.onProgressUpdate(()=>{});\n            setInfoList((prev)=>prev.map((item)=>item.id === `system-${thisRunningId}` && item.loading ? {\n                        ...item,\n                        content: 'Operation stopped',\n                        loading: false,\n                        loadingProgressText: ''\n                    } : item));\n            const separatorItem = {\n                id: `separator-${thisRunningId}`,\n                type: 'separator',\n                content: 'New Session',\n                timestamp: new Date()\n            };\n            setInfoList((prev)=>[\n                    ...prev,\n                    separatorItem\n                ]);\n        } catch (error) {\n            console.error('Failed to stop execution:', error);\n        }\n    }, [\n        playgroundSDK,\n        currentRunningIdRef,\n        interruptedFlagRef,\n        setLoading,\n        setInfoList\n    ]);\n    const canStop = loading && !!currentRunningIdRef.current && !!playgroundSDK && !!playgroundSDK.cancelExecution;\n    return {\n        handleRun,\n        handleStop,\n        canStop\n    };\n}\nexport { usePlaygroundExecution };\n","import { InfoCircleOutlined, ReloadOutlined } from '@ant-design/icons';\r\nimport type { PlaygroundSDK } from '@sqaitech/playground';\r\nimport { Button, Spin, Tooltip } from 'antd';\r\nimport { useCallback, useEffect, useRef, useState } from 'react';\r\n\r\ninterface ScreenshotViewerProps {\r\n  playgroundSDK: PlaygroundSDK;\r\n  serverOnline: boolean;\r\n  isUserOperating?: boolean; // Whether user is currently operating\r\n}\r\n\r\nexport default function ScreenshotViewer({\r\n  playgroundSDK,\r\n  serverOnline,\r\n  isUserOperating = false,\r\n}: ScreenshotViewerProps) {\r\n  const [screenshot, setScreenshot] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [lastUpdateTime, setLastUpdateTime] = useState<number>(0);\r\n  const [interfaceInfo, setInterfaceInfo] = useState<{\r\n    type: string;\r\n    description?: string;\r\n  } | null>(null);\r\n\r\n  // Refs for managing polling\r\n  const pollingIntervalRef = useRef<NodeJS.Timeout | null>(null);\r\n  const isPollingPausedRef = useRef(false);\r\n\r\n  // Core function to fetch screenshot\r\n  const fetchScreenshot = useCallback(\r\n    async (isManual = false) => {\r\n      if (!serverOnline) return;\r\n\r\n      setLoading(true);\r\n      if (isManual) setError(null); // Clear errors on manual refresh\r\n\r\n      try {\r\n        const result = await playgroundSDK.getScreenshot();\r\n        console.log('Screenshot API response:', result); // Debug log\r\n\r\n        if (result?.screenshot) {\r\n          // Ensure screenshot is a valid string\r\n          const screenshotData = result.screenshot.toString().trim();\r\n          if (screenshotData) {\r\n            // Screenshot data is already in full data URL format from createImgBase64ByFormat\r\n            setScreenshot(screenshotData);\r\n            setError(null); // Clear any previous errors\r\n            setLastUpdateTime(Date.now());\r\n          } else {\r\n            setError('Empty screenshot data received');\r\n          }\r\n        } else {\r\n          setError('No screenshot data in response');\r\n        }\r\n      } catch (err) {\r\n        console.error('Screenshot fetch error:', err); // Debug log\r\n        setError(\r\n          err instanceof Error ? err.message : 'Failed to fetch screenshot',\r\n        );\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    },\r\n    [playgroundSDK, serverOnline],\r\n  );\r\n\r\n  // Function to fetch interface info\r\n  const fetchInterfaceInfo = useCallback(async () => {\r\n    if (!serverOnline) return;\r\n\r\n    try {\r\n      const info = await playgroundSDK.getInterfaceInfo();\r\n      if (info) {\r\n        setInterfaceInfo(info);\r\n      }\r\n    } catch (err) {\r\n      console.error('Interface info fetch error:', err);\r\n    }\r\n  }, [playgroundSDK, serverOnline]);\r\n\r\n  // Start polling\r\n  const startPolling = useCallback(() => {\r\n    if (pollingIntervalRef.current) {\r\n      clearInterval(pollingIntervalRef.current);\r\n    }\r\n\r\n    console.log('Starting screenshot polling (5s interval)');\r\n    pollingIntervalRef.current = setInterval(() => {\r\n      if (!isPollingPausedRef.current && serverOnline) {\r\n        fetchScreenshot(false);\r\n      }\r\n    }, 5000); // 5 second polling\r\n  }, [fetchScreenshot, serverOnline]);\r\n\r\n  // Stop polling\r\n  const stopPolling = useCallback(() => {\r\n    if (pollingIntervalRef.current) {\r\n      console.log('Stopping screenshot polling');\r\n      clearInterval(pollingIntervalRef.current);\r\n      pollingIntervalRef.current = null;\r\n    }\r\n  }, []);\r\n\r\n  // Pause polling (don't clear interval, just mark as paused)\r\n  const pausePolling = useCallback(() => {\r\n    console.log('Pausing screenshot polling');\r\n    isPollingPausedRef.current = true;\r\n  }, []);\r\n\r\n  // Resume polling\r\n  const resumePolling = useCallback(() => {\r\n    console.log('Resuming screenshot polling');\r\n    isPollingPausedRef.current = false;\r\n  }, []);\r\n\r\n  // Manual refresh screenshot\r\n  const handleManualRefresh = useCallback(() => {\r\n    fetchScreenshot(true);\r\n  }, [fetchScreenshot]);\r\n\r\n  // Manage server connection status changes\r\n  useEffect(() => {\r\n    if (!serverOnline) {\r\n      setScreenshot(null);\r\n      setError(null);\r\n      setInterfaceInfo(null);\r\n      stopPolling();\r\n      return;\r\n    }\r\n\r\n    // When server comes online, fetch screenshot and interface info immediately, then start polling\r\n    fetchScreenshot(false);\r\n    fetchInterfaceInfo();\r\n    startPolling();\r\n\r\n    return () => {\r\n      stopPolling();\r\n    };\r\n  }, [\r\n    serverOnline,\r\n    startPolling,\r\n    stopPolling,\r\n    fetchScreenshot,\r\n    fetchInterfaceInfo,\r\n  ]);\r\n\r\n  // Manage user operation status changes\r\n  useEffect(() => {\r\n    if (!serverOnline) return;\r\n\r\n    if (isUserOperating) {\r\n      // When user starts operating, pause polling\r\n      pausePolling();\r\n    } else {\r\n      // When user operation ends, update screenshot immediately and resume polling\r\n      resumePolling();\r\n      fetchScreenshot(false);\r\n    }\r\n  }, [\r\n    isUserOperating,\r\n    pausePolling,\r\n    resumePolling,\r\n    fetchScreenshot,\r\n    serverOnline,\r\n  ]);\r\n\r\n  // Cleanup function\r\n  useEffect(() => {\r\n    return () => {\r\n      stopPolling();\r\n    };\r\n  }, [stopPolling]);\r\n\r\n  if (!serverOnline) {\r\n    return (\r\n      <div className=\"screenshot-viewer offline\">\r\n        <div className=\"screenshot-placeholder\">\r\n          <h3> Screen Preview</h3>\r\n          <p>Start the playground server to see real-time screenshots</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (loading && !screenshot) {\r\n    return (\r\n      <div className=\"screenshot-viewer loading\">\r\n        <Spin size=\"large\" />\r\n        <p>Loading screenshot...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error && !screenshot) {\r\n    return (\r\n      <div className=\"screenshot-viewer error\">\r\n        <div className=\"screenshot-placeholder\">\r\n          <h3> Screen Preview</h3>\r\n          <p className=\"error-message\">{error}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const formatLastUpdateTime = (timestamp: number) => {\r\n    if (!timestamp) return '';\r\n    const now = Date.now();\r\n    const diff = Math.floor((now - timestamp) / 1000);\r\n\r\n    if (diff < 60) return `${diff}s ago`;\r\n    if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;\r\n    return new Date(timestamp).toLocaleTimeString();\r\n  };\r\n\r\n  return (\r\n    <div className=\"screenshot-viewer\">\r\n      <div className=\"screenshot-header\">\r\n        <div className=\"screenshot-title\">\r\n          <h3>{interfaceInfo?.type ? interfaceInfo.type : 'Device Name'}</h3>\r\n        </div>\r\n      </div>\r\n      <div className=\"screenshot-container\">\r\n        <div className=\"screenshot-overlay\">\r\n          <div className=\"device-name-overlay\">\r\n            Device Name\r\n            <Tooltip title={interfaceInfo?.description}>\r\n              <InfoCircleOutlined size={16} className=\"info-icon\" />\r\n            </Tooltip>\r\n          </div>\r\n          <div className=\"screenshot-controls\">\r\n            {lastUpdateTime > 0 && (\r\n              <span className=\"last-update-time\">\r\n                Last updated {formatLastUpdateTime(lastUpdateTime)}\r\n              </span>\r\n            )}\r\n            <Tooltip title=\"Refresh screenshot\">\r\n              <Button\r\n                icon={<ReloadOutlined />}\r\n                onClick={handleManualRefresh}\r\n                loading={loading}\r\n                size=\"small\"\r\n              />\r\n            </Tooltip>\r\n            {isUserOperating && (\r\n              <span className=\"operation-indicator\">\r\n                <Spin size=\"small\" /> Operating...\r\n              </span>\r\n            )}\r\n          </div>\r\n        </div>\r\n        <div className=\"screenshot-content\">\r\n          {screenshot ? (\r\n            <img\r\n              src={\r\n                screenshot.startsWith('data:image/')\r\n                  ? screenshot\r\n                  : `data:image/png;base64,${screenshot}`\r\n              }\r\n              alt=\"Device Screenshot\"\r\n              className=\"screenshot-image\"\r\n              onLoad={() => console.log('Screenshot image loaded successfully')}\r\n              onError={(e) => {\r\n                console.error('Screenshot image load error:', e);\r\n                console.error(\r\n                  'Screenshot data preview:',\r\n                  screenshot.substring(0, 100),\r\n                );\r\n                setError('Failed to load screenshot image');\r\n              }}\r\n            />\r\n          ) : (\r\n            <div className=\"screenshot-placeholder\">\r\n              <p>No screenshot available</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { PlaygroundSDK } from '@sqaitech/playground';\r\nimport {\r\n  Logo,\r\n  NavActions,\r\n  UniversalPlayground,\r\n  globalThemeConfig,\r\n} from '@sqaitech/visualizer';\r\nimport { ConfigProvider, Layout } from 'antd';\r\nimport { useEffect, useMemo, useState } from 'react';\r\nimport { Panel, PanelGroup, PanelResizeHandle } from 'react-resizable-panels';\r\nimport ScreenshotViewer from './components/screenshot-viewer';\r\nimport serverOfflineBackground from './icons/server-offline-background.svg';\r\nimport serverOfflineForeground from './icons/server-offline-foreground.svg';\r\n\r\nimport './App.less';\r\n\r\ndeclare const __APP_VERSION__: string;\r\ndeclare const __SERVER_URL__: string;\r\n\r\nconst { Content } = Layout;\r\n\r\nexport default function App() {\r\n  const [serverOnline, setServerOnline] = useState(false);\r\n  const [isUserOperating, setIsUserOperating] = useState(false);\r\n  const [isNarrowScreen, setIsNarrowScreen] = useState(false);\r\n\r\n  // Create PlaygroundSDK and storage provider\r\n  const playgroundSDK = useMemo(() => {\r\n    // Support environment variable for serverUrl, fallback to default\r\n    const serverUrl = __SERVER_URL__;\r\n    const sdk = new PlaygroundSDK({\r\n      type: 'remote-execution',\r\n      serverUrl,\r\n    });\r\n\r\n    console.log(' Connecting to playground server:', serverUrl);\r\n\r\n    // Set progress callback to monitor user operation status\r\n    sdk.onProgressUpdate((tip: string) => {\r\n      // When there's a progress tip, it means user is operating\r\n      setIsUserOperating(!!tip);\r\n    });\r\n\r\n    return sdk;\r\n  }, []);\r\n\r\n  // Check server status on mount\r\n  useEffect(() => {\r\n    const checkServer = async () => {\r\n      try {\r\n        const online = await playgroundSDK.checkStatus();\r\n        setServerOnline(online);\r\n      } catch (error) {\r\n        console.error('Failed to check server status:', error);\r\n        setServerOnline(false);\r\n      }\r\n    };\r\n\r\n    checkServer();\r\n\r\n    // Check server status periodically\r\n    const interval = setInterval(checkServer, 5000);\r\n    return () => clearInterval(interval);\r\n  }, [playgroundSDK]);\r\n\r\n  // Handle window resize to detect narrow screens\r\n  useEffect(() => {\r\n    const handleResize = () => {\r\n      setIsNarrowScreen(window.innerWidth <= 1024);\r\n    };\r\n\r\n    // Set initial value\r\n    handleResize();\r\n\r\n    // Add event listener\r\n    window.addEventListener('resize', handleResize);\r\n\r\n    // Cleanup\r\n    return () => window.removeEventListener('resize', handleResize);\r\n  }, []);\r\n\r\n  if (!serverOnline) {\r\n    return (\r\n      <ConfigProvider theme={globalThemeConfig()}>\r\n        <div className=\"server-offline-container\">\r\n          <div className=\"server-offline-message\">\r\n            <Logo />\r\n            <div className=\"server-offline-content\">\r\n              <div className=\"server-offline-icon\">\r\n                <img\r\n                  src={serverOfflineBackground}\r\n                  className=\"icon-background\"\r\n                  alt=\"\"\r\n                />\r\n                <img\r\n                  src={serverOfflineForeground}\r\n                  className=\"icon-foreground\"\r\n                  alt=\"\"\r\n                />\r\n              </div>\r\n              <h1>Midscene Playground</h1>\r\n              <p className=\"connection-status\">Server offline...</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </ConfigProvider>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <ConfigProvider theme={globalThemeConfig()}>\r\n      <Layout className=\"app-container playground-container\">\r\n        <Content className=\"app-content\">\r\n          <PanelGroup\r\n            autoSaveId=\"playground-layout\"\r\n            direction={isNarrowScreen ? 'vertical' : 'horizontal'}\r\n          >\r\n            {/* Left panel: UniversalPlayground */}\r\n            <Panel\r\n              defaultSize={isNarrowScreen ? 67 : 32}\r\n              maxSize={isNarrowScreen ? 85 : 60}\r\n              minSize={isNarrowScreen ? 67 : 25}\r\n              className=\"app-panel left-panel\"\r\n            >\r\n              <div className=\"panel-content left-panel-content\">\r\n                {/* Header with Logo and Config */}\r\n                <div className=\"playground-panel-header\">\r\n                  <div className=\"header-row\">\r\n                    <Logo />\r\n                    <NavActions\r\n                      showTooltipWhenEmpty={false}\r\n                      showModelName={false}\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Main playground area */}\r\n                <div className=\"playground-panel-playground\">\r\n                  <UniversalPlayground\r\n                    playgroundSDK={playgroundSDK}\r\n                    config={{\r\n                      showContextPreview: false,\r\n                      layout: 'vertical',\r\n                      showVersionInfo: true,\r\n                      enableScrollToBottom: true,\r\n                      serverMode: true,\r\n                      showEnvConfigReminder: true,\r\n                    }}\r\n                    branding={{\r\n                      title: 'Playground',\r\n                      version: __APP_VERSION__,\r\n                    }}\r\n                    className=\"playground-container\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </Panel>\r\n\r\n            <PanelResizeHandle\r\n              className={`panel-resize-handle ${isNarrowScreen ? 'vertical' : 'horizontal'}`}\r\n            />\r\n\r\n            {/* Right panel: Screenshot Viewer */}\r\n            <Panel className=\"app-panel right-panel\">\r\n              <div className=\"panel-content right-panel-content\">\r\n                <ScreenshotViewer\r\n                  playgroundSDK={playgroundSDK}\r\n                  serverOnline={serverOnline}\r\n                  isUserOperating={isUserOperating}\r\n                />\r\n              </div>\r\n            </Panel>\r\n          </PanelGroup>\r\n        </Content>\r\n      </Layout>\r\n    </ConfigProvider>\r\n  );\r\n}\r\n","import { StrictMode } from 'react';\r\nimport { createRoot } from 'react-dom/client';\r\nimport App from './App';\r\n\r\nconst container = document.getElementById('root');\r\nif (!container) {\r\n  throw new Error('Root element not found');\r\n}\r\n\r\nconst root = createRoot(container);\r\nroot.render(\r\n  <StrictMode>\r\n    <App />\r\n  </StrictMode>,\r\n);\r\n","// getDefaultExport function for compatibility with non-ESM modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};\n","var getProto = Object.getPrototypeOf ? (obj) => (Object.getPrototypeOf(obj)) : (obj) => (obj.__proto__);\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n  __webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; typeof current == 'object' && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach((key) => { def[key] = () => (value[key]) });\n\t}\n\tdef['default'] = () => (value);\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n            Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n        }\n    }\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(\n\t\tObject.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t\t__webpack_require__.f[key](chunkId, promises);\n\t\t\treturn promises;\n\t\t}, [])\n\t);\n};","// This function allow to reference chunks\n__webpack_require__.u = (chunkId) => {\n  // return url for filenames not based on template\n  \n  // return url for filenames based on template\n  return \"static/js/async/\" + chunkId + \".\" + {\"173\": \"9cf6b074\",\"212\": \"e243c338\",\"329\": \"f888b505\",\"364\": \"1821e74b\",\"544\": \"b73fa603\",\"582\": \"5dccae2d\",\"624\": \"45ee2b2c\",\"644\": \"6bdc4065\",\"659\": \"9afd03db\",\"702\": \"60261735\",\"920\": \"7d9a9aa8\",\"983\": \"8b91303f\",}[chunkId] + \".js\"\n}","// This function allow to reference chunks\n__webpack_require__.miniCssF = (chunkId) => {\n  // return url for filenames not based on template\n  \n  // return url for filenames based on template\n  return \"\" + chunkId + \".css\"\n}","__webpack_require__.g = (() => {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var inProgress = {};\n\nvar dataWebpackPrefix = \"playground:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = function (url, done, key, chunkId) {\n\tif (inProgress[url]) {\n\t\tinProgress[url].push(done);\n\t\treturn;\n\t}\n\tvar script, needAttach;\n\tif (key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor (var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif (s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) {\n\t\t\t\tscript = s;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tif (!script) {\n\t\tneedAttach = true;\n\t\t\n    script = document.createElement('script');\n    \n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\t\t\n\t\tscript.src = url;\n\t\t\n    \n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = function (prev, event) {\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns &&\n\t\t\tdoneFns.forEach(function (fn) {\n\t\t\t\treturn fn(event);\n\t\t\t});\n\t\tif (prev) return prev(event);\n\t};\n\tvar timeout = setTimeout(\n\t\tonScriptComplete.bind(null, undefined, {\n\t\t\ttype: 'timeout',\n\t\t\ttarget: script\n\t\t}),\n\t\t120000\n\t);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.nmd = (module) => {\n  module.paths = [];\n  if (!module.children) module.children = [];\n  return module;\n};","var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif (chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor (var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--)\n\t\t\tdeferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif (\n\t\t\t\t(priority & (1 === 0) || notFulfilled >= priority) &&\n\t\t\t\tObject.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))\n\t\t\t) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif (priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif (fulfilled) {\n\t\t\tdeferred.splice(i--, 1);\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};\n","__webpack_require__.p = \"/\";","__webpack_require__.b = document.baseURI || self.location.href;\n\n      // object to store loaded and loading chunks\n      // undefined = chunk not loaded, null = chunk preloaded/prefetched\n      // [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\n      var installedChunks = {\"980\": 0,};\n      \n        __webpack_require__.f.j = function (chunkId, promises) {\n          // JSONP chunk loading for javascript\nvar installedChunkData = __webpack_require__.o(installedChunks, chunkId)\n\t? installedChunks[chunkId]\n\t: undefined;\nif (installedChunkData !== 0) {\n\t// 0 means \"already installed\".\n\n\t// a Promise means \"currently loading\".\n\tif (installedChunkData) {\n\t\tpromises.push(installedChunkData[2]);\n\t} else {\n\t\tif (true) {\n\t\t\t// setup Promise in chunk cache\n\t\t\tvar promise = new Promise((resolve, reject) => (installedChunkData = installedChunks[chunkId] = [resolve, reject]));\n\t\t\tpromises.push((installedChunkData[2] = promise));\n\n\t\t\t// start chunk loading\n\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\tvar error = new Error();\n\t\t\tvar loadingEnded = function (event) {\n\t\t\t\tif (__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\tif (installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\tif (installedChunkData) {\n\t\t\t\t\t\tvar errorType =\n\t\t\t\t\t\t\tevent && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\terror.message =\n\t\t\t\t\t\t\t'Loading chunk ' +\n\t\t\t\t\t\t\tchunkId +\n\t\t\t\t\t\t\t' failed.\\n(' +\n\t\t\t\t\t\t\terrorType +\n\t\t\t\t\t\t\t': ' +\n\t\t\t\t\t\t\trealSrc +\n\t\t\t\t\t\t\t')';\n\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t} \n\t}\n}\n\n        }\n        __webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif (chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor (moduleId in moreModules) {\n\t\t\tif (__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif (runtime) var result = runtime(__webpack_require__);\n\t}\n\tif (parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor (; i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif (\n\t\t\t__webpack_require__.o(installedChunks, chunkId) &&\n\t\t\tinstalledChunks[chunkId]\n\t\t) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n};\n\nvar chunkLoadingGlobal = self[\"webpackChunkplayground\"] = self[\"webpackChunkplayground\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));\n"],"names":["UITarsModelVersion","_process_versions","SQAI_OPENAI_INIT_CONFIG_JSON","SQAI_MODEL_NAME","SQAI_DEBUG_AI_PROFILE","SQAI_DEBUG_AI_RESPONSE","SQAI_OPENAI_SOCKS_PROXY","SQAI_OPENAI_HTTP_PROXY","OPENAI_API_KEY","OPENAI_BASE_URL","SQAI_USE_VLM_UI_TARS","SQAI_USE_QWEN_VL","SQAI_USE_QWEN3_VL","SQAI_USE_DOUBAO_VISION","SQAI_USE_GEMINI","MATCH_BY_POSITION","SQAI_USE_AZURE_OPENAI","SQAI_AZURE_OPENAI_SCOPE","SQAI_AZURE_OPENAI_INIT_CONFIG_JSON","AZURE_OPENAI_ENDPOINT","AZURE_OPENAI_KEY","AZURE_OPENAI_API_VERSION","AZURE_OPENAI_DEPLOYMENT","SQAI_USE_ANTHROPIC_SDK","ANTHROPIC_API_KEY","SQAI_RUN_DIR","SQAI_OPENAI_BASE_URL","SQAI_OPENAI_API_KEY","SQAI_OPENAI_USE_AZURE","SQAI_AZURE_OPENAI_KEY","SQAI_AZURE_OPENAI_ENDPOINT","SQAI_AZURE_OPENAI_API_VERSION","SQAI_AZURE_OPENAI_DEPLOYMENT","SQAI_VL_MODE","SQAI_VQA_MODEL_NAME","SQAI_VQA_OPENAI_SOCKS_PROXY","SQAI_VQA_OPENAI_HTTP_PROXY","SQAI_VQA_OPENAI_BASE_URL","SQAI_VQA_OPENAI_API_KEY","SQAI_VQA_OPENAI_INIT_CONFIG_JSON","SQAI_VQA_OPENAI_USE_AZURE","SQAI_VQA_USE_AZURE_OPENAI","SQAI_VQA_AZURE_OPENAI_SCOPE","SQAI_VQA_AZURE_OPENAI_KEY","SQAI_VQA_AZURE_OPENAI_ENDPOINT","SQAI_VQA_AZURE_OPENAI_API_VERSION","SQAI_VQA_AZURE_OPENAI_DEPLOYMENT","SQAI_VQA_AZURE_OPENAI_INIT_CONFIG_JSON","SQAI_VQA_USE_ANTHROPIC_SDK","SQAI_VQA_ANTHROPIC_API_KEY","SQAI_VQA_VL_MODE","SQAI_PLANNING_MODEL_NAME","SQAI_PLANNING_OPENAI_SOCKS_PROXY","SQAI_PLANNING_OPENAI_HTTP_PROXY","SQAI_PLANNING_OPENAI_BASE_URL","SQAI_PLANNING_OPENAI_API_KEY","SQAI_PLANNING_OPENAI_INIT_CONFIG_JSON","SQAI_PLANNING_OPENAI_USE_AZURE","SQAI_PLANNING_USE_AZURE_OPENAI","SQAI_PLANNING_AZURE_OPENAI_SCOPE","SQAI_PLANNING_AZURE_OPENAI_KEY","SQAI_PLANNING_AZURE_OPENAI_ENDPOINT","SQAI_PLANNING_AZURE_OPENAI_API_VERSION","SQAI_PLANNING_AZURE_OPENAI_DEPLOYMENT","SQAI_PLANNING_AZURE_OPENAI_INIT_CONFIG_JSON","SQAI_PLANNING_USE_ANTHROPIC_SDK","SQAI_PLANNING_ANTHROPIC_API_KEY","SQAI_PLANNING_VL_MODE","SQAI_GROUNDING_MODEL_NAME","SQAI_GROUNDING_OPENAI_SOCKS_PROXY","SQAI_GROUNDING_OPENAI_HTTP_PROXY","SQAI_GROUNDING_OPENAI_BASE_URL","SQAI_GROUNDING_OPENAI_API_KEY","SQAI_GROUNDING_OPENAI_INIT_CONFIG_JSON","SQAI_GROUNDING_OPENAI_USE_AZURE","SQAI_GROUNDING_USE_AZURE_OPENAI","SQAI_GROUNDING_AZURE_OPENAI_SCOPE","SQAI_GROUNDING_AZURE_OPENAI_KEY","SQAI_GROUNDING_AZURE_OPENAI_ENDPOINT","SQAI_GROUNDING_AZURE_OPENAI_API_VERSION","SQAI_GROUNDING_AZURE_OPENAI_DEPLOYMENT","SQAI_GROUNDING_AZURE_OPENAI_INIT_CONFIG_JSON","SQAI_GROUNDING_USE_ANTHROPIC_SDK","SQAI_GROUNDING_ANTHROPIC_API_KEY","SQAI_GROUNDING_VL_MODE","OPENAI_USE_AZURE","BASIC_ENV_KEYS","BOOLEAN_ENV_KEYS","NUMBER_ENV_KEYS","STRING_ENV_KEYS","GLOBAL_ENV_KEYS","MODEL_ENV_KEYS","ALL_ENV_KEYS","types_UITarsModelVersion","VL_MODE_RAW_VALID_VALUES","getBasicEnvValue","key","Error","process","ifInNode","assert","condition","message","defaultRunDirName","topicPrefix","logStreams","Map","debugInstances","getDebug","topic","fullTopic","debugFn","debug","args","writeLogToFile","stream","getLogStream","topicFileName","logFile","node_path","getMidsceneRunSubDir","subdir","basePath","getMidsceneRunBaseDir","existsSync","mkdirSync","error","tmpdir","logPath","node_fs","now","Date","isoDate","isoTime","milliseconds","timezoneOffsetMinutes","hours","Math","minutes","timezoneString","localISOTime","node_util","initDebugConfig","shouldPrintTiming","debugConfig","console","_define_property","obj","value","Object","DEFAULT_MODEL_CONFIG_KEYS","DEFAULT_MODEL_CONFIG_KEYS_LEGACY","maskKey","maskChar","prefixLen","prefix","suffix","maskLength","mask","maskConfig","config","JSON","parseJson","e","createAssert","modelNameKey","provider","modelName","modelVendorFlag","parseVlModeAndUiTarsModelVersionFromRawValue","vlModeRaw","KEYS_MAP","decideOpenaiSdkConfig","keys","valueAssert","debugLog","socksProxy","httpProxy","vlMode","openaiBaseURL","openaiApiKey","openaiExtraConfig","azureOpenaiScope","azureOpenaiKey","azureOpenaiEndpoint","azureOpenaiDeployment","azureOpenaiApiVersion","azureExtraConfig","anthropicApiKey","getModelDescription","uiTarsVersion","decideModelConfigFromIntentConfig","intent","intentConfig","keysForFn","candidateModelNameFromConfig","chosenKeys","result","modelDescription","finalResult","decideModelConfigFromEnv","allEnvConfig","keysForEnv","parseVlModeAndUiTarsFromGlobalConfig","isDoubao","isQwen","isQwen3","isUiTars","isGemini","enabledModes","Boolean","ALL_INTENTS","globalModelConfigManager","modelConfigFn","intentConfigMap","i","modelConfigMap","globalConfigManager","modelConfig","envConfig","p","name","newConfig","extendMode","allConfig","Number","_this_override","savedNewConfig","overrideAIConfig","treeToList","tree","dfs","node","child","PointSchema","z","SizeSchema","RectSchema","TMultimodalPromptSchema","TUserPromptSchema","locateFieldFlagName","MidsceneLocationInput","findAllMidsceneLocatorField","zodType","requiredOnly","_zodObject__def","zodObject","field","ifMidsceneLocatorField","_actualField__def","_actualField__def1","actualField","shape","_field__def","_keyDefinitions","acc","definition","lowerKey","isMac","window","debugUtils","buildDetailedLocateParam","locatePrompt","opt","xpath","prompt","deepThink","cacheable","noReplayAPIs","parseStructuredParams","action","params","options","schema","paramObj","undefined","locatorFieldKeys","locateKey","detailedLocateParam","executeAction","activeAgent","actionType","actionSpace","a","parsedParams","pass","thought","BasePlaygroundAdapter","_context","paramsForValidation","needsStructuredParams","paramsList","excludeKeys","filtered","zodError","errorMessages","err","path","errorMsg","shapeKeys","paramValue","displayKey","formattedValue","str","isLocateField","LocalExecutionAdapter","callback","requestId","errorMessage","context","_this_agent","page","contextPage","aiConfig","originalOnTaskStartTip","tip","response","dumpString","_requestId","_this_agent_interface","type","description","agent","v4","RemoteExecutionAdapter","missingFields","_fieldDef__def","_fieldDef__def1","fieldDef","androidError","androidErrors","keyword","payload","fetch","errorText","optionalParams","optionalFields","Array","actionSpaceMethod","res","data","jsonError","encodeURIComponent","lastTip","interval","setInterval","_progress_tip","progress","clearInterval","serverUrl","PlaygroundSDK","elementColor","highlightColorForType","globalThemeConfig","Logo","param","hideLogo","jsx","sqai_logo","__webpack_require__","exports","prop","Symbol","external_zustand_namespaceObject","create","store_create","AUTO_ZOOM_KEY","BACKGROUND_VISIBLE_KEY","ELEMENTS_VISIBLE_KEY","getQueryPreference","paramName","searchParams","URLSearchParams","normalized","useBlackboardPreference","set","savedAutoZoom","localStorage","savedBackgroundVisible","savedElementsVisible","autoZoomFromQuery","elementsVisibleFromQuery","visible","enabled","CONFIG_KEY","SERVICE_MODE_KEY","TRACKING_ACTIVE_TAB_KEY","DEEP_THINK_KEY","SCREENSHOT_INCLUDED_KEY","DOM_INCLUDED_KEY","getConfigStringFromLocalStorage","configString","parseConfig","lines","line","trimmed","match","cleanLine","parsedValue","useEnvConfig","get","ifInExtension","savedServiceMode","savedForceSameTabNavigation","savedDeepThink","savedScreenshotIncluded","savedDomIncluded","serviceMode","latestConfigString","forceSameTabNavigation","screenshotIncluded","domIncluded","tab","EnvConfig","showTooltipWhenEmpty","showModelName","tooltipPlacement","mode","loadConfig","syncFromStorage","isModalOpen","setIsModalOpen","useState","tempConfigString","setTempConfigString","midsceneModelName","componentRef","useRef","showModal","useEffect","jsxs","Tooltip","SettingOutlined","Modal","Input","NavActions","showEnvConfig","githubUrl","helpUrl","className","Typography","GithubOutlined","QuestionCircleOutlined","apiMetadata","defaultMainButtons","WELCOME_MESSAGE_TEMPLATE","BLANK_RESULT","mousePointer","mouseLoading","typeStr","task","locateParamStr","locate","images","imagesStr","image","url","paramStr","_task_param","_task_param1","_task_param2","_task_param3","_task_param4","_task_param5","_task_param6","_task_param7","_task_param8","_task_param9","scrollParam","locateStr","pullParamStr","pullParam","parts","CACHE_STRATEGIES","cameraStateForRect","rect","imageWidth","imageHeight","rectWidthOnPage","cameraPaddingRatio","rectRatio","cameraWidth","left","top","IndexedDBManager","Promise","resolve","reject","request","indexedDB","event","db","keyPath","store","storeNames","operation","transaction","storeName","sortByTimestamp","results","objectStore","b","dbName","version","storeConfigs","withErrorHandling","defaultValue","onQuotaExceeded","createCleanupFunction","dbManager","maxItems","toDelete","item","MESSAGES_STORE","RESULTS_STORE","IndexedDBStorageProvider","messages","messagesToSave","msg","index","lightMessage","restoredItem","fullResult","id","compressedResult","_result_result_dump","_result_result","compressedExecutions","execution","_execution_tasks","_task_recorder","_this_compressScreenshotIfNeeded","record","screenshot","sizeKB","messageCount","resultCount","namespace","LocalStorageProvider","testKey","testData","lightMessages","messageData","DOMException","lightRecentMessages","recentMessages","retryError","stored","resultKey","storedResult","resultItem","resultKeys","keysToRemove","playgroundKeys","additionalKeysToRemove","storage_provider_MemoryStorageProvider","storage_provider_NoOpStorageProvider","_messages","_id","_result","createStorageProvider","arguments","detectBestStorageType","rectMarkForItem","themeColor","width","height","hashNumber","djb2Hash","hash","graphics","Graphics","DropShadowFilter","texts","Text","nameFontSize","blackboard","props","highlightElements","highlightIds","highlightRect","highlightPoints","size","screenshotBase64","screenWidth","screenHeight","domRef","app","useMemo","Application","appInitialed","setAppInitialed","highlightContainer","Container","elementMarkContainer","hoverElement","setHoverElement","pixiBgRef","backgroundVisible","setBackgroundVisible","elementsVisible","setElementsVisible","canvasEl","clientWidth","targetHeight","ratio","Rectangle","_props_onCanvasClick","x","y","_app_stage","img","Image","screenshotTexture","Texture","backgroundSprite","Sprite","highlightElementRects","element","content","point","pointMarkForItem","elements","bottomTipA","Checkbox","shiny_text","text","disabled","speed","style","errorMessageServerNotReady","serverLaunchTip","notReadyMessage","Alert","emptyResultTip","ContextPreview","uiContextPreview","setUiContextPreview","showContextPreview","iconForStatus","status","CheckOutlined","WarningOutlined","CloseOutlined","ClockCircleOutlined","LogoutOutlined","ArrowRightOutlined","MinusOutlined","Button","playground_demo_ui_context","EnvConfigReminder","ExclamationCircleFilled","global_perspective","player_setting","show_marker","globalTextureMap","loadTexture","Assets","texture","getTextureFromCache","cubicMouse","t","linear","sleep","ms","setTimeout","ERROR_FRAME_CANCEL","RecordingSession","mediaRecorder","MediaRecorder","_this_mediaRecorder","blob","Blob","URL","document","canvas","Player","_scripts_","statusIconElement","titleText","setTitleText","subTitleText","setSubTitleText","autoZoom","setAutoZoom","scripts","fitMode","currentImg","divContainerRef","pointerSprite","spinningPointerSprite","replayMark","setReplayMark","triggerReplay","windowContentContainer","insightMarkContainer","container","basicCameraState","animationProgress","setAnimationProgress","cancelFlag","cameraState","resizeCanvasIfNeeded","newWidth","newHeight","aspectRatio","repaintImage","scriptWidth","scriptHeight","imgToUpdate","targetWidth","sprite","mainImgLabel","spinningPointer","frame","_pointerSprite_current","_pointerSprite_current1","startTime","isCancelled","animate","currentTime","rotation","elapsedTime","updatePointer","targetX","targetY","pointer","updateCamera","state","currentWidth","effectiveWidth","newScale","canvasPaddingLeft","canvasPaddingTop","cameraAnimation","targetState","duration","currentCanvasWidth","currentCanvasHeight","currentState","startPointerLeft","startPointerTop","performance","startLeft","startTop","startScale","shouldMovePointer","pointerMoveDuration","cameraMoveDuration","nextState","mouseProgress","cameraProgress","cameraElapsedTime","progressScale","targetScale","progressWidth","progressLeft","progressTop","horizontalExceed","verticalExceed","fadeInGraphics","targetAlpha","fadeOutItem","insightElementsAnimation","searchArea","elementsToAdd","totalLength","childrenCount","elementsToAddNow","cubicBezier","p0","p1","p2","p3","t2","randomIndex","insightMarkGraphic","searchAreaGraphic","init","isRecording","setIsRecording","recorderSessionRef","playerContainer","cancelFn","cancel","timeout","requestAnimationFrame","allImages","totalDuration","updateProgress","_item_context","stop","mouseOverStatusIcon","setMouseOverStatusIcon","mouseOverSettingsIcon","setMouseOverSettingsIcon","progressString","canReplayNow","listener","statusOnClick","Spin","LoadingOutlined","CaretRightOutlined","downloadReport","DownloadOutlined","ExportOutlined","Dropdown","menu","Switch","checked","_","_e_stopPropagation","PlaygroundResultView","loading","serverValid","replayScriptsInfo","replayCounter","loadingProgressText","verticalMode","resultWrapperClassName","resultDataToShow","avatar","history_create","HISTORY_KEY","LAST_SELECTED_TYPE_KEY","useHistoryStore","getHistoryFromLocalStorage","historyString","newHistory","historyItem","currentHistory","typeHistory","stringifiedNewItem","newTypeHistory","h","stringifiedOldItem","isZodObjectSchema","_field__def1","_fieldWithRuntime__def","fieldWithRuntime","VALIDATION_CONSTANTS","desc","unwrapZodType","_actualField__def2","_actualField__def3","_actualField__def4","isOptional","hasDefault","getMidsceneLocationSchema","val","String","actionNameForType","typeWithoutAi","fullName","words","setting","ConfigSelector","showDeepThinkOption","enableTracking","showDataExtractionOptions","hideDomAndScreenshotOptions","setForceSameTabNavigation","setDeepThink","setScreenshotIncluded","setDomIncluded","configItems","buildConfigItems","items","Radio","TextArea","renderLabel","label","TextField","isRequired","marginBottom","customPlaceholder","placeholder","Form","LocateField","EnumField","_fieldSchema__def","fieldSchema","selectOptions","enumValues","Select","NumberField","defaultPlaceholder","placeholderValue","max","min","InputNumber","BooleanField","icons_close","icons_history","magnifying_glass","HistorySelector","onSelect","history","currentType","searchText","setSearchText","clearHistory","modalRef","groupedHistory","sevenDaysAgo","oneYearAgo","filteredHistory","handleClickOutside","timer","clearTimeout","renderHistoryGroup","title","Fragment","PromptInput","runButtonEnabled","form","selectedType","dryMode","stoppable","onRun","onStop","clearPromptAfterRun","hoveringSettings","setHoveringSettings","promptValue","setPromptValue","textAreaRef","modeRadioGroupRef","lastHistoryRef","lastSelectedType","addHistory","setLastSelectedType","historyForSelectedType","needsAnyInput","dataExtractionMethods","hasConfigOptions","hasDataExtraction","hasTracking","availableDropdownMethods","metadataMethods","availableMethods","finalMethods","Set","method","methodInfo","getDefaultParams","useCallback","defaultParams","extractDefaultValue","_currentField__def","currentField","scrollToSelectedItem","targetElement","selectedRadioButton","dropdownButton","containerRect","targetRect","targetLeft","containerWidth","lastHistory","timeoutId","formPromptValue","handleSelectHistory","handlePromptChange","hasSingleStructuredParam","isRunButtonEnabled","playground_utils_mjs_isRunButtonEnabled","currentParams","handleRunWithHistory","values","historyPrompt","locateValue","otherValues","_values_params","mainPart","newHistoryItem","handleKeyDown","_textAreaRef_current_resizableTextArea","textarea","selectionStart","lastNewlineIndex","isAtLastLine","handleStructuredKeyDown","renderStructuredParams","schemaKeys","isLocateFieldFlag","placeholderText","fields","sortedKeys","keyA","keyB","fieldSchemaA","fieldSchemaB","isOptionalA","isOptionalB","fieldProps","directionField","react","distanceField","otherFields","handleMouseEnter","handleMouseLeave","renderActionButton","runButton","SendOutlined","BorderOutlined","apiType","_apiMetadata_apiType","hiddenAPIs","api","groupedItems","interactionAPIs","_apiMetadata_api","extractionAPIs","validationAPIs","deviceSpecificAPIs","DownOutlined","ErrorMessage","UniversalPlayground","playgroundSDK","storage","contextProvider","componentConfig","branding","sdkReady","setSdkReady","initializeSDK","effectiveStorage","sdk","bestStorageType","setLoading","infoList","setInfoList","actionSpaceLoading","showScrollToBottomButton","setReplayCounter","infoListRef","currentRunningIdRef","interruptedFlagRef","clearInfoList","handleScrollToBottom","usePlaygroundState","setActionSpace","setActionSpaceLoading","setShowScrollToBottomButton","setVerticalMode","initializedRef","migrateFromOldNamespace","oldStorage","oldMessages","initializeMessages","welcomeMessage","storedMessages","hasWelcomeMessage","loadActionSpace","_contextProvider_getUIContext","space","handleResize","scrollToBottom","checkIfScrolledToBottom","scrollTop","scrollHeight","clientHeight","refreshContext","newContext","handleStop","canStop","usePlaygroundExecution","handleRun","thisRunningId","displayContent","userItem","prev","systemItem","lastItem","progressItem","resultObj","replayInfo","counter","info","allScriptsFromDump","dump","firstWidth","firstHeight","dimensionsSet","sdkVersion","modelBriefsSet","_task_uiContext_size","_task_uiContext","w","allScripts","generateAnimationScripts","insightCameraState","tasksIncluded","startIndex","fullPageCameraState","pointerScript","subTitle","currentCameraState","insightOnTop","taskCount","initSubTitle","errorStateFlag","_planningTask_recorder_","_planningTask_recorder","_task_uiContext_size1","_task_uiContext1","_insightTask_output","_insightTask_output1","_insightDump_taskInfo","_context_size","_context_size1","_context_size2","_context_size3","_task_recorder_","_task_uiContext_size2","_task_uiContext2","_task_uiContext_size3","_task_uiContext3","_task_recorder_1","_task_recorder1","_task_recorder_2","_task_recorder2","_task_uiContext_size4","_task_uiContext4","_task_uiContext_size5","_task_uiContext5","_task_recorder_3","_task_recorder3","_task_uiContext_size6","_task_uiContext6","_task_uiContext_size7","_task_uiContext7","_task_uiContext_size8","_task_uiContext8","_task_uiContext_size9","_task_uiContext9","planningTask","resultElement","insightTask","insightDump","insightContentLength","mergeTwoCameraState","cameraState1","cameraState2","newLeft","newTop","newRight","imgStillDuration","errorTitle","errorSubTitle","model_name","model_description","allScriptsWithoutIntermediateDoneFrame","script","modelBriefs","_list_","list","firstOneInfo","c","separatorItem","handleFormRun","configAlreadySet","finalShowContextPreview","layout","showVersionInfo","ClearOutlined","List","_item_result","_parts_","_item_result1","_item_result2","currentIndex","listItem","laterProgressExists","shouldShowLoading","icons","ArrowDownOutlined","ScreenshotViewer","serverOnline","isUserOperating","setScreenshot","setError","lastUpdateTime","setLastUpdateTime","interfaceInfo","setInterfaceInfo","pollingIntervalRef","isPollingPausedRef","fetchScreenshot","isManual","screenshotData","fetchInterfaceInfo","startPolling","stopPolling","pausePolling","resumePolling","handleManualRefresh","InfoCircleOutlined","formatLastUpdateTime","timestamp","diff","ReloadOutlined","Content","Layout","root","createRoot","StrictMode","setServerOnline","setIsUserOperating","isNarrowScreen","setIsNarrowScreen","__SERVER_URL__","checkServer","online","ConfigProvider","PanelGroup","Panel","__APP_VERSION__","PanelResizeHandle","serverOfflineForeground","App","n","globalThis","Function","self","r"],"mappings":";oDA4OsDA,EC1OlDC,6DDFJ,IAAMC,EAA+B,+BAC/BC,EAAkB,kBAElBC,EAAwB,wBACxBC,EAAyB,yBAQzBC,EAA0B,0BAC1BC,EAAyB,yBACzBC,EAAiB,iBACjBC,EAAkB,kBASlBC,EAAuB,uBACvBC,EAAmB,mBACnBC,EAAoB,oBACpBC,EAAyB,yBACzBC,EAAkB,kBAElBC,EAAoB,oBAKpBC,EAAwB,wBACxBC,EAA0B,0BAC1BC,EAAqC,qCAErCC,EAAwB,wBACxBC,EAAmB,mBACnBC,EAA2B,2BAC3BC,EAA0B,0BAC1BC,EAAyB,yBACzBC,EAAoB,oBACpBC,EAAe,eACfC,EAAuB,uBACvBC,EAAsB,sBACtBC,EAAwB,wBACxBC,EAAwB,wBACxBC,EAA6B,6BAC7BC,EAAgC,gCAChCC,EAA+B,+BAE/BC,EAAe,eACfC,EAAsB,sBACtBC,EAA8B,8BAC9BC,EAA6B,6BAC7BC,EAA2B,2BAC3BC,EAA0B,0BAC1BC,EAAmC,mCACnCC,EAA4B,4BAC5BC,EAA4B,4BAC5BC,EAA8B,8BAC9BC,EAA4B,4BAC5BC,EAAiC,iCACjCC,EAAoC,oCACpCC,EAAmC,mCACnCC,EAAyC,yCACzCC,GAA6B,6BAC7BC,GAA6B,6BAC7BC,GAAmB,mBACnBC,GAA2B,2BAC3BC,GAAmC,mCACnCC,GAAkC,kCAClCC,GAAgC,gCAChCC,GAA+B,+BAC/BC,GAAwC,wCACxCC,GAAiC,iCACjCC,GAAiC,iCACjCC,GAAmC,mCACnCC,GAAiC,iCACjCC,GAAsC,sCACtCC,GAAyC,yCACzCC,GAAwC,wCACxCC,GAA8C,8CAC9CC,GAAkC,kCAClCC,GAAkC,kCAClCC,GAAwB,wBACxBC,GAA4B,4BAC5BC,GAAoC,oCACpCC,GAAmC,mCACnCC,GAAiC,iCACjCC,GAAgC,gCAChCC,GAAyC,yCACzCC,GAAkC,kCAClCC,GAAkC,kCAClCC,GAAoC,oCACpCC,GAAkC,kCAClCC,GAAuC,uCACvCC,GAA0C,0CAC1CC,GAAyC,yCACzCC,GAA+C,+CAC/CC,GAAmC,mCACnCC,GAAmC,mCACnCC,GAAyB,yBACzBC,GAAmB,mBAInBC,GAAiB,CAxGC,kBA0GpBlF,EACAC,EACAoB,EACH,CACK8D,GAAmB,CA7FN,aArBU,uBASC,wBAJM,8BAEN,wBAiH7B,CACKC,GAAkB,CArFe,iCALH,8BA6FnC,CACKC,GAAkB,CA/GE,oBACJ,gBACO,uBACA,uBACK,4BACL,uBACG,0BAUH,uBAEG,0BAuG5B1E,EAjIyB,uBAEJ,mBAkIxB,CACK2E,GAAkB,IACjBH,MACAC,MACAC,GACN,CACKE,GAAiB,CACnBxF,EACAD,EACAyB,EACAD,EACAE,EACAtB,EACAC,EACAS,EACAC,EACAC,EACAK,EACAb,EACAC,EACAC,EACAC,EACAC,EArIsB,oBAuItBU,EACAM,EACAD,EACAE,EACAC,EACAC,EACAzB,EACAC,EACA4E,GACA7D,EACAL,EACAC,EACAC,EACAC,EACAY,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACH,CACKQ,GAAe,CAjOqB,uCAmOnCN,MACAI,MACAC,GACN,CACD,IAAIE,IACA7F,CADkDA,EAMpD,CAAC,GALoB,IAAO,CAAG,MAC7BA,EAAmB,IAAO,CAAG,MAC7BA,EAAmB,cAAiB,CAAG,iBACvCA,EAAmB,cAAiB,CAAG,iBAChCA,GAEX,IAAM8F,GAA2B,CAC7B,gBACA,SACA,UACA,WACA,cACA,qBACA,yBACH,yHE1PD,IAAMC,GAAmB,AAACC,IACtB,GAAI,CAACV,GAAe,QAAQ,CAACU,GAAM,MAAM,AAAIC,MAAM,CAAC,0BAA0B,EAAED,EAAI,kBAAkB,CAAC,EACvG,OAAOE,GAAQ,GAAG,CAACF,EAAI,AAC3B,uCDCA,IAAMG,GAAW,SAAsBD,IAAY,OAA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EACA,MAAO,CACH,IAAK,QACL,KAAM,OACV,EACA,MAAO,CACH,QAAS,EACT,KAAM,QACN,IAAK,QACT,EACA,KAAM,CACF,QAAS,EACT,KAAM,OACN,IAAK,MACT,EACA,UAAW,CACP,QAAS,EACT,KAAM,YACN,IAAK,WACT,EACA,IAAK,CACD,QAAS,EACT,KAAM,MACN,IAAK,KACT,EACA,QAAS,CACL,QAAS,GACT,aAAc,IACd,IAAK,QACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,YAAa,CACT,QAAS,GACT,KAAM,cACN,IAAK,QACL,KAAM,KACN,SAAU,CACd,EACA,MAAO,CACH,QAAS,GACT,KAAM,QACN,IAAK,QACL,KAAM,IACV,EACA,KAAM,CACF,QAAS,GACT,KAAM,QACN,IAAK,QACL,KAAM,IACV,EACA,KAAM,CACF,QAAS,GACT,KAAM,QACN,IAAK,QACL,KAAM,IACV,EACA,UAAW,CACP,QAAS,GACT,KAAM,YACN,IAAK,QACL,SAAU,CACd,EACA,WAAY,CACR,QAAS,GACT,KAAM,aACN,IAAK,QACL,SAAU,CACd,EACA,YAAa,CACT,QAAS,GACT,KAAM,cACN,IAAK,UACL,SAAU,CACd,EACA,aAAc,CACV,QAAS,GACT,KAAM,eACN,IAAK,UACL,SAAU,CACd,EACA,QAAS,CACL,QAAS,GACT,KAAM,UACN,IAAK,MACL,SAAU,CACd,EACA,SAAU,CACN,QAAS,GACT,KAAM,WACN,IAAK,MACL,SAAU,CACd,EACA,MAAO,CACH,QAAS,GACT,KAAM,QACN,IAAK,OACT,EACA,SAAU,CACN,QAAS,GACT,KAAM,WACN,IAAK,UACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,IAAK,QACT,EACA,QAAS,CACL,QAAS,GACT,KAAM,UACN,IAAK,SACT,EACA,WAAY,CACR,QAAS,GACT,KAAM,aACN,IAAK,YACT,EACA,MAAO,CACH,QAAS,GACT,KAAM,QACN,IAAK,GACT,EACA,QAAS,CACL,QAAS,GACT,aAAc,IACd,IAAK,SACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,IAAK,QACT,EACA,QAAS,CACL,QAAS,GACT,aAAc,GACd,IAAK,WACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,SAAU,CACN,QAAS,GACT,KAAM,WACN,IAAK,UACT,EACA,IAAK,CACD,QAAS,GACT,KAAM,MACN,IAAK,KACT,EACA,QAAS,CACL,QAAS,GACT,aAAc,GACd,IAAK,MACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,IAAK,MACT,EACA,QAAS,CACL,QAAS,GACT,aAAc,IACd,IAAK,OACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,UAAW,CACP,QAAS,GACT,KAAM,YACN,IAAK,WACT,EACA,QAAS,CACL,QAAS,GACT,aAAc,IACd,IAAK,YACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,QAAS,CACL,QAAS,GACT,aAAc,IACd,IAAK,UACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,QAAS,CACL,QAAS,GACT,KAAM,UACN,IAAK,SACT,EACA,WAAY,CACR,QAAS,GACT,KAAM,aACN,IAAK,YACT,EACA,QAAS,CACL,QAAS,GACT,aAAc,IACd,IAAK,aACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,QAAS,CACL,QAAS,GACT,aAAc,GACd,IAAK,YACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,UAAW,CACP,QAAS,GACT,KAAM,YACN,IAAK,WACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,IAAK,QACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,IAAK,SACT,EACA,YAAa,CACT,QAAS,GACT,KAAM,cACN,IAAK,aACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,IAAK,QACT,EACA,QAAS,CACL,QAAS,GACT,aAAc,GACd,IAAK,SACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,IAAK,QACT,EACA,cAAe,CACX,QAAS,GACT,aAAc,IACd,KAAM,gBACN,IAAK,KACL,SAAU,IACV,SAAU,CACd,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,SAAU,CACN,QAAS,GACT,KAAM,WACN,IAAK,OACL,SAAU,CACd,EACA,UAAW,CACP,QAAS,GACT,KAAM,YACN,IAAK,OACL,SAAU,CACd,EACA,YAAa,CACT,QAAS,GACT,KAAM,cACN,IAAK,aACT,EACA,eAAgB,CACZ,QAAS,IACT,KAAM,iBACN,IAAK,IACL,SAAU,CACd,EACA,UAAW,CACP,QAAS,IACT,KAAM,YACN,IAAK,IACL,SAAU,CACd,EACA,eAAgB,CACZ,QAAS,IACT,KAAM,iBACN,IAAK,IACL,SAAU,CACd,EACA,aAAc,CACV,QAAS,IACT,KAAM,eACN,IAAK,IACL,SAAU,CACd,EACA,GAAI,CACA,QAAS,IACT,KAAM,KACN,IAAK,IACT,EACA,GAAI,CACA,QAAS,IACT,KAAM,KACN,IAAK,IACT,EACA,GAAI,CACA,QAAS,IACT,KAAM,KACN,IAAK,IACT,EACA,GAAI,CACA,QAAS,IACT,KAAM,KACN,IAAK,IACT,EACA,GAAI,CACA,QAAS,IACT,KAAM,KACN,IAAK,IACT,EACA,GAAI,CACA,QAAS,IACT,KAAM,KACN,IAAK,IACT,EACA,GAAI,CACA,QAAS,IACT,KAAM,KACN,IAAK,IACT,EACA,GAAI,CACA,QAAS,IACT,KAAM,KACN,IAAK,IACT,EACA,GAAI,CACA,QAAS,IACT,KAAM,KACN,IAAK,IACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,QAAS,CACL,QAAS,IACT,KAAM,UACN,IAAK,SACT,EACA,WAAY,CACR,QAAS,IACT,KAAM,aACN,IAAK,YACT,EACA,gBAAiB,CACb,QAAS,IACT,KAAM,kBACN,IAAK,iBACT,EACA,gBAAiB,CACb,QAAS,IACT,KAAM,kBACN,IAAK,iBACT,EACA,cAAe,CACX,QAAS,IACT,KAAM,gBACN,IAAK,eACT,EACA,eAAgB,CACZ,QAAS,IACT,KAAM,iBACN,IAAK,gBACT,EACA,mBAAoB,CAChB,QAAS,IACT,KAAM,qBACN,IAAK,oBACT,EACA,UAAW,CACP,QAAS,IACT,KAAM,YACN,IAAK,WACT,EACA,eAAgB,CACZ,QAAS,IACT,KAAM,iBACN,IAAK,gBACT,EACA,UAAW,CACP,QAAS,IACT,KAAM,YACN,SAAU,IACV,IAAK,GACT,EACA,MAAO,CACH,QAAS,IACT,KAAM,QACN,SAAU,IACV,IAAK,GACT,EACA,YAAa,CACT,QAAS,IACT,KAAM,cACN,IAAK,IACL,SAAU,CACd,EACA,MAAO,CACH,QAAS,IACT,KAAM,QACN,SAAU,IACV,IAAK,GACT,EACA,MAAO,CACH,QAAS,IACT,KAAM,QACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,IACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,MAAO,CACH,QAAS,IACT,KAAM,QACN,SAAU,IACV,IAAK,GACT,EACA,UAAW,CACP,QAAS,IACT,KAAM,YACN,SAAU,IACV,IAAK,GACT,EACA,YAAa,CACT,QAAS,IACT,KAAM,cACN,SAAU,IACV,IAAK,GACT,EACA,UAAW,CACP,QAAS,IACT,KAAM,YACN,SAAU,IACV,IAAK,IACT,EACA,aAAc,CACV,QAAS,IACT,KAAM,eACN,SAAU,IACV,IAAK,GACT,EACA,MAAO,CACH,QAAS,IACT,KAAM,QACN,SAAU,IACV,IAAK,GACT,EACA,SAAU,CACN,QAAS,IACT,KAAM,WACN,IAAK,UACT,EACA,MAAO,CACH,QAAS,IACT,KAAM,QACN,IAAK,OACT,EACA,OAAQ,CACJ,QAAS,EACT,IAAK,SACL,KAAM,OACV,EACA,MAAO,CACH,QAAS,GACT,IAAK,QACL,KAAM,UACN,SAAU,CACd,EACA,MAAO,CACH,QAAS,GACT,IAAK,QACL,KAAM,YACN,SAAU,CACd,EACA,QAAS,CACL,QAAS,GACT,IAAK,UACL,KAAM,cACN,SAAU,CACd,EACA,IAAK,CACD,QAAS,GACT,IAAK,MACL,KAAM,UACN,SAAU,CACd,EACA,OAAQ,CACJ,QAAS,GACT,IAAK,QACT,EACA,WAAY,CACR,QAAS,GACT,IAAK,YACT,EACA,IAAK,CACD,QAAS,GACT,IAAK,IACL,KAAM,OACV,EACA,MAAO,CACH,QAAS,GACT,IAAK,OACT,EACA,QAAS,CACL,QAAS,GACT,IAAK,UACL,KAAM,MACV,EACA,KAAU,CACN,QAAS,GACT,IAAK,KACL,KAAM,gBACN,SAAU,CACd,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,KAAM,CACF,QAAS,GACT,IAAK,OACL,KAAM,WACN,SAAU,CACd,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,iBACN,SAAU,CACd,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,YACN,SAAU,CACd,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,iBACN,SAAU,CACd,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,eACN,SAAU,CACd,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,WACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,OACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,OACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,QACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,WACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,aACV,EACA,KAAM,CACF,QAAS,IACT,IAAK,KACL,KAAM,WACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,cACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,OACV,EACA,KAAM,CACF,QAAS,IACT,IAAK,MACT,EACA,MAAO,CACH,QAAS,IACT,IAAK,QACL,KAAM,OACV,EACA,MAAO,CACH,QAAS,IACT,IAAK,OACT,EACA,SAAU,CACN,QAAS,IACT,IAAK,UACT,EACA,KAAM,CACF,QAAS,IACT,IAAK,MACT,EACA,QAAS,CACL,QAAS,IACT,IAAK,SACT,EACA,IAAK,CACD,QAAS,GACT,IAAK,IACL,KAAM,QACV,EACA,IAAK,CACD,QAAS,GACT,IAAK,IACL,KAAM,QACV,EACA,IAAK,CACD,QAAS,GACT,IAAK,IACL,KAAM,QACV,EACA,IAAK,CACD,QAAS,GACT,IAAK,IACL,KAAM,QACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,QACV,EACA,IAAK,CACD,QAAS,GACT,IAAK,IACL,KAAM,QACV,EACA,IAAK,CACD,QAAS,GACT,IAAK,IACL,KAAM,QACV,EACA,IAAK,CACD,QAAS,GACT,IAAK,IACL,KAAM,QACV,EACA,IAAK,CACD,QAAS,GACT,IAAK,IACL,KAAM,QACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,WACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,OACV,EACA,EAAG,CACC,QAAS,IACT,IAAK,IACL,KAAM,OACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,QACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,OACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,WACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,aACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,WACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,cACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,OACV,EACA,SAAU,CACN,IAAK,WACL,KAAM,WACN,SAAU,CACd,EACA,UAAW,CACP,IAAK,YACL,KAAM,YACN,SAAU,CACd,EACA,OAAQ,CACJ,QAAS,GACT,IAAK,SACL,KAAM,SACN,SAAU,CACd,EACA,KAAM,CACF,IAAK,OACL,KAAM,OACN,SAAU,CACd,EACA,QAAS,CACL,QAAS,GACT,IAAK,UACL,KAAM,UACN,SAAU,CACd,EACA,WAAY,CACR,QAAS,IACT,IAAK,aACL,KAAM,aACN,SAAU,CACd,EACA,SAAU,CACN,QA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"}