(()=>{"use strict";function e(e){return e instanceof SVGElement}function t(e){return e instanceof Element&&(window.getComputedStyle(e).fontFamily||"").toLowerCase().indexOf("iconfont")>=0}function i(e){var i,n,l,o,r;return!!((i=e)instanceof Element&&(null==i||null==(o=i.childNodes)?void 0:o.length)===1&&(null==i?void 0:i.childNodes[0])instanceof Text)||(null==(l=i.nodeName)||null==(n=l.toLowerCase)?void 0:n.call(l))==="#text"&&!t(i)||t(e)||!!(!function(e){if(!(e instanceof HTMLElement))return!1;if(e.innerText)return!0;for(let t of["svg","button","input","textarea","select","option","img","a"])if(e.querySelectorAll(t).length>0)return!0;return!1}(r=e)&&r instanceof Element)&&"none"!==window.getComputedStyle(r).getPropertyValue("background-image")||!!t(r)||r instanceof HTMLElement&&"img"===r.tagName.toLowerCase()||r instanceof SVGElement&&"svg"===r.tagName.toLowerCase()||e instanceof HTMLElement&&"button"===e.tagName.toLowerCase()||e instanceof HTMLElement&&"a"===e.tagName.toLowerCase()||e instanceof HTMLElement&&("input"===e.tagName.toLowerCase()||"textarea"===e.tagName.toLowerCase()||"select"===e.tagName.toLowerCase()||"option"===e.tagName.toLowerCase())}let n=e=>{let t=1,i=e.previousElementSibling;for(;i;)i.nodeName.toLowerCase()===e.nodeName.toLowerCase()&&t++,i=i.previousElementSibling;return t},l=e=>"string"!=typeof e?"":e.replace(/\s+/g," ").trim(),o=(e,t,i)=>{var o;let a=e.parentNode?r(e.parentNode,t):"",s=a?`${a}/`:"/",h=e.nodeName.toLowerCase(),c=null==(o=e.textContent)?void 0:o.trim();if(t){let t=n(e);return`${s}${h}[${t}]`}if(i&&c)return`${s}${h}[normalize-space()="${l(c)}"]`;let d=n(e);return`${s}${h}[${d}]`},r=(t,i=!1,n=!1)=>{if(t.nodeType===Node.TEXT_NODE){let e=t.parentNode;if(e&&e.nodeType===Node.ELEMENT_NODE){var a;let n=r(e,i,!0),o=null==(a=t.textContent)?void 0:a.trim();return o?`${n}/text()[normalize-space()="${l(o)}"]`:`${n}/text()`}return""}if(t.nodeType!==Node.ELEMENT_NODE)return"";if(t===document.documentElement)return"/html";if(t===document.body)return"/html/body";if(e(t)){let l=t.parentNode;for(;l&&l.nodeType===Node.ELEMENT_NODE;){if(!e(l))return r(l,i,n);l=l.parentNode}return r(t.parentNode,i,n)}return o(t,i,n)},a="true"===localStorage.getItem("DEBUG");function s(...e){a&&console.log("[EventRecorder]",...e)}function h(e,t){let i=t?`${t.left}_${t.top}_${t.width}_${t.height}${void 0!==t.x?`_${t.x}`:""}${void 0!==t.y?`_${t.y}`:""}`:"no_rect",n=`${e}_${i}`,l=0;for(let e=0;e<n.length;e++)l=(l<<5)-l+n.charCodeAt(e),l&=l;return Math.abs(l).toString(36)}let c=(e,t)=>e.element===t.element,d=(e,t)=>e.element===t.element,m=e=>{for(let t=e.length-1;t>=0;t--){let i=e[t];if("click"===i.type&&i.isLabelClick)return i}};window.EventRecorder=class{isRecording=!1;eventCallback;scrollThrottleTimer=null;scrollThrottleDelay=200;inputThrottleTimer=null;inputThrottleDelay=300;lastViewportScroll=null;scrollTargets=[];sessionId;constructor(e,t){this.eventCallback=e,this.sessionId=t}createNavigationEvent(e,t){return{type:"navigation",url:e,title:t,pageInfo:{width:window.innerWidth,height:window.innerHeight},timestamp:Date.now(),hashId:`navigation_${Date.now()}`}}start(){if(this.isRecording)return void s("Recording already active, ignoring start request");this.isRecording=!0,s("Starting event recording"),this.scrollTargets=[],0===this.scrollTargets.length&&(this.scrollTargets=function(){let e=[];return document.querySelectorAll("body *").forEach(t=>{let i=window.getComputedStyle(t),n=i.overflowY,l=i.overflowX,o=("auto"===n||"scroll"===n)&&t.scrollHeight>t.clientHeight,r=("auto"===l||"scroll"===l)&&t.scrollWidth>t.clientWidth;(o||r)&&e.push(t)}),e}(),this.scrollTargets.push(document.body)),s("Added event listeners for",this.scrollTargets.length,"scroll targets"),setTimeout(()=>{let e=this.createNavigationEvent(window.location.href,document.title);this.eventCallback(e),s("Added final navigation event",e)},0),document.addEventListener("click",this.handleClick,!0),document.addEventListener("input",this.handleInput),document.addEventListener("scroll",this.handleScroll,{passive:!0}),this.scrollTargets.forEach(e=>{e.addEventListener("scroll",this.handleScroll,{passive:!0})})}stop(){if(!this.isRecording)return void s("Recording not active, ignoring stop request");this.isRecording=!1,s("Stopping event recording"),this.scrollThrottleTimer&&(clearTimeout(this.scrollThrottleTimer),this.scrollThrottleTimer=null),this.inputThrottleTimer&&(clearTimeout(this.inputThrottleTimer),this.inputThrottleTimer=null),document.removeEventListener("click",this.handleClick),document.removeEventListener("input",this.handleInput),this.scrollTargets.forEach(e=>{e.removeEventListener("scroll",this.handleScroll)}),s("Removed all event listeners")}handleClick=e=>{if(!this.isRecording)return;let t=e.target,{isLabelClick:n,labelInfo:l}=this.checkLabelClick(t),o=t.getBoundingClientRect(),r={x:Number(e.clientX.toFixed(2)),y:Number(e.clientY.toFixed(2))};console.log("isNotContainerElement",i(t)),i(t)&&(r.left=Number(o.left.toFixed(2)),r.top=Number(o.top.toFixed(2)),r.width=Number(o.width.toFixed(2)),r.height=Number(o.height.toFixed(2)));let a={type:"click",elementRect:r,pageInfo:{width:window.innerWidth,height:window.innerHeight},value:"",timestamp:Date.now(),hashId:h("click",{...r}),element:t,isLabelClick:n,labelInfo:l,isTrusted:e.isTrusted,detail:e.detail};this.eventCallback(a)};handleScroll=e=>{if(!this.isRecording)return;function t(e){return e instanceof Document}let i=e.target,n=t(i)?window.scrollX:i.scrollLeft,l=t(i)?window.scrollY:i.scrollTop,o=t(i)?{left:0,top:0,width:window.innerWidth,height:window.innerHeight}:i.getBoundingClientRect();this.scrollThrottleTimer&&clearTimeout(this.scrollThrottleTimer),this.scrollThrottleTimer=window.setTimeout(()=>{if(this.isRecording){let e={left:t(i)?0:Number(o.left.toFixed(2)),top:t(i)?0:Number(o.top.toFixed(2)),width:t(i)?window.innerWidth:Number(o.width.toFixed(2)),height:t(i)?window.innerHeight:Number(o.height.toFixed(2))},r={type:"scroll",elementRect:e,pageInfo:{width:window.innerWidth,height:window.innerHeight},value:`${n.toFixed(2)},${l.toFixed(2)}`,timestamp:Date.now(),hashId:h("scroll",{...e}),element:i};this.eventCallback(r)}this.scrollThrottleTimer=null},this.scrollThrottleDelay)};handleInput=e=>{if(!this.isRecording)return;let t=e.target;if("checkbox"===t.type)return;let i=t.getBoundingClientRect(),n={left:Number(i.left.toFixed(2)),top:Number(i.top.toFixed(2)),width:Number(i.width.toFixed(2)),height:Number(i.height.toFixed(2))};this.inputThrottleTimer&&clearTimeout(this.inputThrottleTimer),this.inputThrottleTimer=window.setTimeout(()=>{if(this.isRecording){let e={type:"input",value:"password"!==t.type?t.value:"*****",timestamp:Date.now(),hashId:h("input",{...n}),element:t,inputType:t.type||"text",elementRect:n,pageInfo:{width:window.innerWidth,height:window.innerHeight}};s("Throttled input event:",{value:e.value,timestamp:e.timestamp,target:t.tagName,inputType:t.type}),this.eventCallback(e)}this.inputThrottleTimer=null},this.inputThrottleDelay)};checkLabelClick(e){let t,i=!1;if(e)if("LABEL"===e.tagName)i=!0,t={htmlFor:e.htmlFor,textContent:e.textContent?.trim(),xpath:r(e)};else{let n=e.parentElement;for(;n;){if("LABEL"===n.tagName){i=!0,t={htmlFor:n.htmlFor,textContent:n.textContent?.trim(),xpath:r(n)};break}n=n.parentElement}}return{isLabelClick:i,labelInfo:t}}isActive(){return this.isRecording}optimizeEvent(e,t){let i=t[t.length-1];if("click"===e.type){let i=m(t);if(e.element){let{isLabelClick:n,labelInfo:l}=this.checkLabelClick(e.element);return i&&n&&"click"===i.type&&i.isLabelClick&&(i.labelInfo?.htmlFor&&e.element.id&&i.labelInfo?.htmlFor===e.element.id||l?.xpath&&i.labelInfo?.xpath&&i.labelInfo?.xpath===l?.xpath)?(s("Skip input event triggered by label click:",e.element),t):[...t,e]}}if("input"===e.type){if(i&&"click"===i.type&&i.isLabelClick&&i.labelInfo?.htmlFor===e.targetId)return s("Skipping input event - triggered by label click:",{labelHtmlFor:m(t)?.labelInfo?.htmlFor,inputId:e.targetId,element:e.element}),t;if(i&&"input"===i.type&&c(i,e)){let i=t[t.length-1],n=[...t];return n[t.length-1]={value:e.element?.value,...e},s("Merging input event:",{oldValue:i.value,newValue:e.value,oldTimestamp:i.timestamp,newTimestamp:e.timestamp,target:e.targetTagName}),n}}if("scroll"===e.type&&i&&"scroll"===i.type&&d(i,e)){let i=t[t.length-1],n=[...t];return n[t.length-1]=e,s("Replacing last scroll event with new scroll event:",{oldPosition:`${i.elementRect?.left},${i.elementRect?.top}`,newPosition:`${e.elementRect?.left},${e.elementRect?.top}`,oldTimestamp:i.timestamp,newTimestamp:e.timestamp,target:e.targetTagName}),n}return[...t,e]}}})();