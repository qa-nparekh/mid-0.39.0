(self.webpackChunkchrome_extension=self.webpackChunkchrome_extension||[]).push([["659"],{21883:function(t){"use strict";var e=Object.prototype.hasOwnProperty,r="~";function i(){}function a(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function s(t,e,i,s,n){if("function"!=typeof i)throw TypeError("The listener must be a function");var o=new a(i,s||t,n),l=r?r+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],o]:t._events[l].push(o):(t._events[l]=o,t._eventsCount++),t}function n(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(r=!1)),o.prototype.eventNames=function(){var t,i,a=[];if(0===this._eventsCount)return a;for(i in t=this._events)e.call(t,i)&&a.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(t)):a},o.prototype.listeners=function(t){var e=r?r+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var a=0,s=i.length,n=Array(s);a<s;a++)n[a]=i[a].fn;return n},o.prototype.listenerCount=function(t){var e=r?r+t:t,i=this._events[e];return i?i.fn?1:i.length:0},o.prototype.emit=function(t,e,i,a,s,n){var o=r?r+t:t;if(!this._events[o])return!1;var l,u,h=this._events[o],c=arguments.length;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),c){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,i),!0;case 4:return h.fn.call(h.context,e,i,a),!0;case 5:return h.fn.call(h.context,e,i,a,s),!0;case 6:return h.fn.call(h.context,e,i,a,s,n),!0}for(u=1,l=Array(c-1);u<c;u++)l[u-1]=arguments[u];h.fn.apply(h.context,l)}else{var d,p=h.length;for(u=0;u<p;u++)switch(h[u].once&&this.removeListener(t,h[u].fn,void 0,!0),c){case 1:h[u].fn.call(h[u].context);break;case 2:h[u].fn.call(h[u].context,e);break;case 3:h[u].fn.call(h[u].context,e,i);break;case 4:h[u].fn.call(h[u].context,e,i,a);break;default:if(!l)for(d=1,l=Array(c-1);d<c;d++)l[d-1]=arguments[d];h[u].fn.apply(h[u].context,l)}}return!0},o.prototype.on=function(t,e,r){return s(this,t,e,r,!1)},o.prototype.once=function(t,e,r){return s(this,t,e,r,!0)},o.prototype.removeListener=function(t,e,i,a){var s=r?r+t:t;if(!this._events[s])return this;if(!e)return n(this,s),this;var o=this._events[s];if(o.fn)o.fn!==e||a&&!o.once||i&&o.context!==i||n(this,s);else{for(var l=0,u=[],h=o.length;l<h;l++)(o[l].fn!==e||a&&!o[l].once||i&&o[l].context!==i)&&u.push(o[l]);u.length?this._events[s]=1===u.length?u[0]:u:n(this,s)}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&n(this,e)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,t.exports=o},23209:function(t){"use strict";t.exports=(t,e)=>(e=e||(()=>{}),t.then(t=>new Promise(t=>{t(e())}).then(()=>t),t=>new Promise(t=>{t(e())}).then(()=>{throw t})))},88464:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});let i=r(21883),a=r(26123),s=r(83991),n=()=>{},o=new a.TimeoutError;e.default=class extends i{constructor(t){var e,r,i,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=n,this._resolveIdle=n,!("number"==typeof(t=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:s.default},t)).intervalCap&&t.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!=(r=null==(e=t.intervalCap)?void 0:e.toString())?r:""}\` (${typeof t.intervalCap})`);if(void 0===t.interval||!(Number.isFinite(t.interval)&&t.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!=(a=null==(i=t.interval)?void 0:i.toString())?a:""}\` (${typeof t.interval})`);this._carryoverConcurrencyCount=t.carryoverConcurrencyCount,this._isIntervalIgnored=t.intervalCap===1/0||0===t.interval,this._intervalCap=t.intervalCap,this._interval=t.interval,this._queue=new t.queueClass,this._queueClass=t.queueClass,this.concurrency=t.concurrency,this._timeout=t.timeout,this._throwOnTimeout=!0===t.throwOnTimeout,this._isPaused=!1===t.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=n,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=n,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let t=Date.now();if(void 0===this._intervalId){let e=this._intervalEnd-t;if(!(e<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},e)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let t=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let e=this._queue.dequeue();return!!e&&(this.emit("active"),e(),t&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(t){if(!("number"==typeof t&&t>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);this._concurrency=t,this._processQueue()}async add(t,e={}){return new Promise((r,i)=>{let s=async()=>{this._pendingCount++,this._intervalCount++;try{let s=void 0===this._timeout&&void 0===e.timeout?t():a.default(Promise.resolve(t()),void 0===e.timeout?this._timeout:e.timeout,()=>{(void 0===e.throwOnTimeout?this._throwOnTimeout:e.throwOnTimeout)&&i(o)});r(await s)}catch(t){i(t)}this._next()};this._queue.enqueue(s,e),this._tryToStartAnother(),this.emit("add")})}async addAll(t,e){return Promise.all(t.map(async t=>this.add(t,e)))}start(){return this._isPaused&&(this._isPaused=!1,this._processQueue()),this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(t=>{let e=this._resolveEmpty;this._resolveEmpty=()=>{e(),t()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(t=>{let e=this._resolveIdle;this._resolveIdle=()=>{e(),t()}})}get size(){return this._queue.size}sizeBy(t){return this._queue.filter(t).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(t){this._timeout=t}}},10392:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,r){let i=0,a=t.length;for(;a>0;){let s=a/2|0,n=i+s;0>=r(t[n],e)?(i=++n,a-=s+1):a=s}return i}},83991:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});let i=r(10392);e.default=class{constructor(){this._queue=[]}enqueue(t,e){let r={priority:(e=Object.assign({priority:0},e)).priority,run:t};if(this.size&&this._queue[this.size-1].priority>=e.priority)return void this._queue.push(r);let a=i.default(this._queue,r,(t,e)=>e.priority-t.priority);this._queue.splice(a,0,r)}dequeue(){let t=this._queue.shift();return null==t?void 0:t.run}filter(t){return this._queue.filter(e=>e.priority===t.priority).map(t=>t.run)}get size(){return this._queue.length}}},32656:function(t,e,r){"use strict";let i=r(83490),a=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class s extends Error{constructor(t){super(),t instanceof Error?(this.originalError=t,{message:t}=t):(this.originalError=Error(t),this.originalError.stack=this.stack),this.name="AbortError",this.message=t}}let n=(t,e,r)=>{let i=r.retries-(e-1);return t.attemptNumber=e,t.retriesLeft=i,t},o=t=>a.includes(t),l=(t,e)=>new Promise((r,a)=>{e={onFailedAttempt:()=>{},retries:10,...e};let l=i.operation(e);l.attempt(async i=>{try{r(await t(i))}catch(t){if(!(t instanceof Error))return void a(TypeError(`Non-error was thrown: "${t}". You should only throw errors.`));if(t instanceof s)l.stop(),a(t.originalError);else if(t instanceof TypeError&&!o(t.message))l.stop(),a(t);else{n(t,i,e);try{await e.onFailedAttempt(t)}catch(t){a(t);return}l.retry(t)||a(l.mainError())}}})});t.exports=l,t.exports.default=l,t.exports.AbortError=s},26123:function(t,e,r){"use strict";let i=r(23209);class a extends Error{constructor(t){super(t),this.name="TimeoutError"}}let s=(t,e,r)=>new Promise((s,n)=>{if("number"!=typeof e||e<0)throw TypeError("Expected `milliseconds` to be a positive number");if(e===1/0)return void s(t);let o=setTimeout(()=>{if("function"==typeof r){try{s(r())}catch(t){n(t)}return}let i="string"==typeof r?r:`Promise timed out after ${e} milliseconds`,o=r instanceof Error?r:new a(i);"function"==typeof t.cancel&&t.cancel(),n(o)},e);i(t.then(s,n),()=>{clearTimeout(o)})});t.exports=s,t.exports.default=s,t.exports.TimeoutError=a},83490:function(t,e,r){t.exports=r(25630)},25630:function(t,e,r){var i=r(44264);e.operation=function(t){return new i(e.timeouts(t),{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},e.timeouts=function(t){if(t instanceof Array)return[].concat(t);var e={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in t)e[r]=t[r];if(e.minTimeout>e.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var i=[],a=0;a<e.retries;a++)i.push(this.createTimeout(a,e));return t&&t.forever&&!i.length&&i.push(this.createTimeout(a,e)),i.sort(function(t,e){return t-e}),i},e.createTimeout=function(t,e){var r=Math.round((e.randomize?Math.random()+1:1)*Math.max(e.minTimeout,1)*Math.pow(e.factor,t));return Math.min(r,e.maxTimeout)},e.wrap=function(t,r,i){if(r instanceof Array&&(i=r,r=null),!i)for(var a in i=[],t)"function"==typeof t[a]&&i.push(a);for(var s=0;s<i.length;s++){var n=i[s],o=t[n];t[n]=(function(i){var a=e.operation(r),s=Array.prototype.slice.call(arguments,1),n=s.pop();s.push(function(t){a.retry(t)||(t&&(arguments[0]=a.mainError()),n.apply(this,arguments))}),a.attempt(function(){i.apply(t,s)})}).bind(t,o),t[n].options=r}}},44264:function(t){function e(t,e){"boolean"==typeof e&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}t.exports=e,e.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},e.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},e.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=new Date().getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var r=this._timeouts.shift();if(void 0===r)if(!this._cachedTimeouts)return!1;else this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);var i=this;return this._timer=setTimeout(function(){i._attempts++,i._operationTimeoutCb&&(i._timeout=setTimeout(function(){i._operationTimeoutCb(i._attempts)},i._operationTimeout),i._options.unref&&i._timeout.unref()),i._fn(i._attempts)},r),this._options.unref&&this._timer.unref(),!0},e.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},e.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)},e.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)},e.prototype.start=e.prototype.try,e.prototype.errors=function(){return this._errors},e.prototype.attempts=function(){return this._attempts},e.prototype.mainError=function(){if(0===this._errors.length)return null;for(var t={},e=null,r=0,i=0;i<this._errors.length;i++){var a=this._errors[i],s=a.message,n=(t[s]||0)+1;t[s]=n,n>=r&&(e=a,r=n)}return e}},33569:function(t,e,r){"use strict";let i=Symbol("SemVer ANY");class a{static get ANY(){return i}constructor(t,e){if(e=s(e),t instanceof a)if(!!e.loose===t.loose)return t;else t=t.value;u("comparator",t=t.trim().split(/\s+/).join(" "),e),this.options=e,this.loose=!!e.loose,this.parse(t),this.semver===i?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(t){let e=this.options.loose?n[o.COMPARATORLOOSE]:n[o.COMPARATOR],r=t.match(e);if(!r)throw TypeError(`Invalid comparator: ${t}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new h(r[2],this.options.loose):this.semver=i}toString(){return this.value}test(t){if(u("Comparator.test",t,this.options.loose),this.semver===i||t===i)return!0;if("string"==typeof t)try{t=new h(t,this.options)}catch(t){return!1}return l(t,this.operator,this.semver,this.options)}intersects(t,e){if(!(t instanceof a))throw TypeError("a Comparator is required");return""===this.operator?""===this.value||new c(t.value,e).test(this.value):""===t.operator?""===t.value||new c(this.value,e).test(t.semver):!((e=s(e)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===t.value)||!e.includePrerelease&&(this.value.startsWith("<0.0.0")||t.value.startsWith("<0.0.0")))&&!!(this.operator.startsWith(">")&&t.operator.startsWith(">")||this.operator.startsWith("<")&&t.operator.startsWith("<")||this.semver.version===t.semver.version&&this.operator.includes("=")&&t.operator.includes("=")||l(this.semver,"<",t.semver,e)&&this.operator.startsWith(">")&&t.operator.startsWith("<")||l(this.semver,">",t.semver,e)&&this.operator.startsWith("<")&&t.operator.startsWith(">"))}}t.exports=a;let s=r(74436),{safeRe:n,t:o}=r(60124),l=r(94792),u=r(46342),h=r(52812),c=r(23701)},23701:function(t,e,r){"use strict";let i=/\s+/g;class a{constructor(t,e){if(e=n(e),t instanceof a)if(!!e.loose===t.loose&&!!e.includePrerelease===t.includePrerelease)return t;else return new a(t.raw,e);if(t instanceof o)return this.raw=t.value,this.set=[[t]],this.formatted=void 0,this;if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=t.trim().replace(i," "),this.set=this.raw.split("||").map(t=>this.parseRange(t.trim())).filter(t=>t.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let t=this.set[0];if(this.set=this.set.filter(t=>!_(t[0])),0===this.set.length)this.set=[t];else if(this.set.length>1){for(let t of this.set)if(1===t.length&&v(t[0])){this.set=[t];break}}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let t=0;t<this.set.length;t++){t>0&&(this.formatted+="||");let e=this.set[t];for(let t=0;t<e.length;t++)t>0&&(this.formatted+=" "),this.formatted+=e[t].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(t){let e=((this.options.includePrerelease&&f)|(this.options.loose&&g))+":"+t,r=s.get(e);if(r)return r;let i=this.options.loose,a=i?h[c.HYPHENRANGELOOSE]:h[c.HYPHENRANGE];l("hyphen replace",t=t.replace(a,A(this.options.includePrerelease))),l("comparator trim",t=t.replace(h[c.COMPARATORTRIM],d)),l("tilde trim",t=t.replace(h[c.TILDETRIM],p)),l("caret trim",t=t.replace(h[c.CARETTRIM],m));let n=t.split(" ").map(t=>b(t,this.options)).join(" ").split(/\s+/).map(t=>P(t,this.options));i&&(n=n.filter(t=>(l("loose invalid filter",t,this.options),!!t.match(h[c.COMPARATORLOOSE])))),l("range list",n);let u=new Map;for(let t of n.map(t=>new o(t,this.options))){if(_(t))return[t];u.set(t.value,t)}u.size>1&&u.has("")&&u.delete("");let v=[...u.values()];return s.set(e,v),v}intersects(t,e){if(!(t instanceof a))throw TypeError("a Range is required");return this.set.some(r=>y(r,e)&&t.set.some(t=>y(t,e)&&r.every(r=>t.every(t=>r.intersects(t,e)))))}test(t){if(!t)return!1;if("string"==typeof t)try{t=new u(t,this.options)}catch(t){return!1}for(let e=0;e<this.set.length;e++)if(j(this.set[e],t,this.options))return!0;return!1}}t.exports=a;let s=new(r(42821)),n=r(74436),o=r(33569),l=r(46342),u=r(52812),{safeRe:h,t:c,comparatorTrimReplace:d,tildeTrimReplace:p,caretTrimReplace:m}=r(60124),{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:g}=r(43677),_=t=>"<0.0.0-0"===t.value,v=t=>""===t.value,y=(t,e)=>{let r=!0,i=t.slice(),a=i.pop();for(;r&&i.length;)r=i.every(t=>a.intersects(t,e)),a=i.pop();return r},b=(t,e)=>(l("comp",t,e),l("caret",t=I(t,e)),l("tildes",t=E(t,e)),l("xrange",t=S(t,e)),l("stars",t=R(t,e)),t),w=t=>!t||"x"===t.toLowerCase()||"*"===t,E=(t,e)=>t.trim().split(/\s+/).map(t=>$(t,e)).join(" "),$=(t,e)=>{let r=e.loose?h[c.TILDELOOSE]:h[c.TILDE];return t.replace(r,(e,r,i,a,s)=>{let n;return l("tilde",t,e,r,i,a,s),w(r)?n="":w(i)?n=`>=${r}.0.0 <${+r+1}.0.0-0`:w(a)?n=`>=${r}.${i}.0 <${r}.${+i+1}.0-0`:s?(l("replaceTilde pr",s),n=`>=${r}.${i}.${a}-${s} <${r}.${+i+1}.0-0`):n=`>=${r}.${i}.${a} <${r}.${+i+1}.0-0`,l("tilde return",n),n})},I=(t,e)=>t.trim().split(/\s+/).map(t=>O(t,e)).join(" "),O=(t,e)=>{l("caret",t,e);let r=e.loose?h[c.CARETLOOSE]:h[c.CARET],i=e.includePrerelease?"-0":"";return t.replace(r,(e,r,a,s,n)=>{let o;return l("caret",t,e,r,a,s,n),w(r)?o="":w(a)?o=`>=${r}.0.0${i} <${+r+1}.0.0-0`:w(s)?o="0"===r?`>=${r}.${a}.0${i} <${r}.${+a+1}.0-0`:`>=${r}.${a}.0${i} <${+r+1}.0.0-0`:n?(l("replaceCaret pr",n),o="0"===r?"0"===a?`>=${r}.${a}.${s}-${n} <${r}.${a}.${+s+1}-0`:`>=${r}.${a}.${s}-${n} <${r}.${+a+1}.0-0`:`>=${r}.${a}.${s}-${n} <${+r+1}.0.0-0`):(l("no pr"),o="0"===r?"0"===a?`>=${r}.${a}.${s}${i} <${r}.${a}.${+s+1}-0`:`>=${r}.${a}.${s}${i} <${r}.${+a+1}.0-0`:`>=${r}.${a}.${s} <${+r+1}.0.0-0`),l("caret return",o),o})},S=(t,e)=>(l("replaceXRanges",t,e),t.split(/\s+/).map(t=>T(t,e)).join(" ")),T=(t,e)=>{t=t.trim();let r=e.loose?h[c.XRANGELOOSE]:h[c.XRANGE];return t.replace(r,(r,i,a,s,n,o)=>{l("xRange",t,r,i,a,s,n,o);let u=w(a),h=u||w(s),c=h||w(n);return"="===i&&c&&(i=""),o=e.includePrerelease?"-0":"",u?r=">"===i||"<"===i?"<0.0.0-0":"*":i&&c?(h&&(s=0),n=0,">"===i?(i=">=",h?(a=+a+1,s=0):s=+s+1,n=0):"<="===i&&(i="<",h?a=+a+1:s=+s+1),"<"===i&&(o="-0"),r=`${i+a}.${s}.${n}${o}`):h?r=`>=${a}.0.0${o} <${+a+1}.0.0-0`:c&&(r=`>=${a}.${s}.0${o} <${a}.${+s+1}.0-0`),l("xRange return",r),r})},R=(t,e)=>(l("replaceStars",t,e),t.trim().replace(h[c.STAR],"")),P=(t,e)=>(l("replaceGTE0",t,e),t.trim().replace(h[e.includePrerelease?c.GTE0PRE:c.GTE0],"")),A=t=>(e,r,i,a,s,n,o,l,u,h,c,d)=>(r=w(i)?"":w(a)?`>=${i}.0.0${t?"-0":""}`:w(s)?`>=${i}.${a}.0${t?"-0":""}`:n?`>=${r}`:`>=${r}${t?"-0":""}`,l=w(u)?"":w(h)?`<${+u+1}.0.0-0`:w(c)?`<${u}.${+h+1}.0-0`:d?`<=${u}.${h}.${c}-${d}`:t?`<${u}.${h}.${+c+1}-0`:`<=${l}`,`${r} ${l}`.trim()),j=(t,e,r)=>{for(let r=0;r<t.length;r++)if(!t[r].test(e))return!1;if(e.prerelease.length&&!r.includePrerelease){for(let r=0;r<t.length;r++)if(l(t[r].semver),t[r].semver!==o.ANY&&t[r].semver.prerelease.length>0){let i=t[r].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}},52812:function(t,e,r){"use strict";let i=r(46342),{MAX_LENGTH:a,MAX_SAFE_INTEGER:s}=r(43677),{safeRe:n,t:o}=r(60124),l=r(74436),{compareIdentifiers:u}=r(16847);class h{constructor(t,e){if(e=l(e),t instanceof h)if(!!e.loose===t.loose&&!!e.includePrerelease===t.includePrerelease)return t;else t=t.version;else if("string"!=typeof t)throw TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>a)throw TypeError(`version is longer than ${a} characters`);i("SemVer",t,e),this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease;let r=t.trim().match(e.loose?n[o.LOOSE]:n[o.FULL]);if(!r)throw TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>s||this.major<0)throw TypeError("Invalid major version");if(this.minor>s||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>s||this.patch<0)throw TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(t=>{if(/^[0-9]+$/.test(t)){let e=+t;if(e>=0&&e<s)return e}return t}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(i("SemVer.compare",this.version,this.options,t),!(t instanceof h)){if("string"==typeof t&&t===this.version)return 0;t=new h(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof h||(t=new h(t,this.options)),u(this.major,t.major)||u(this.minor,t.minor)||u(this.patch,t.patch)}comparePre(t){if(t instanceof h||(t=new h(t,this.options)),this.prerelease.length&&!t.prerelease.length)return -1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let e=0;do{let r=this.prerelease[e],a=t.prerelease[e];if(i("prerelease compare",e,r,a),void 0===r&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===r)return -1;else if(r===a)continue;else return u(r,a)}while(++e)}compareBuild(t){t instanceof h||(t=new h(t,this.options));let e=0;do{let r=this.build[e],a=t.build[e];if(i("build compare",e,r,a),void 0===r&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===r)return -1;else if(r===a)continue;else return u(r,a)}while(++e)}inc(t,e,r){if(t.startsWith("pre")){if(!e&&!1===r)throw Error("invalid increment argument: identifier is empty");if(e){let t=`-${e}`.match(this.options.loose?n[o.PRERELEASELOOSE]:n[o.PRERELEASE]);if(!t||t[1]!==e)throw Error(`invalid identifier: ${e}`)}}switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e,r),this.inc("pre",e,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",e,r),this.inc("pre",e,r);break;case"release":if(0===this.prerelease.length)throw Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(0!==this.minor||0!==this.patch||0===this.prerelease.length)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(0!==this.patch||0===this.prerelease.length)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{let t=+!!Number(r);if(0===this.prerelease.length)this.prerelease=[t];else{let i=this.prerelease.length;for(;--i>=0;)"number"==typeof this.prerelease[i]&&(this.prerelease[i]++,i=-2);if(-1===i){if(e===this.prerelease.join(".")&&!1===r)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(t)}}if(e){let i=[e,t];!1===r&&(i=[e]),0===u(this.prerelease[0],e)?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw Error(`invalid increment argument: ${t}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}t.exports=h},64329:function(t,e,r){"use strict";let i=r(61347);t.exports=(t,e)=>{let r=i(t.trim().replace(/^[=v]+/,""),e);return r?r.version:null}},94792:function(t,e,r){"use strict";let i=r(37543),a=r(59466),s=r(38701),n=r(84854),o=r(30253),l=r(10148);t.exports=(t,e,r,u)=>{switch(e){case"===":return"object"==typeof t&&(t=t.version),"object"==typeof r&&(r=r.version),t===r;case"!==":return"object"==typeof t&&(t=t.version),"object"==typeof r&&(r=r.version),t!==r;case"":case"=":case"==":return i(t,r,u);case"!=":return a(t,r,u);case">":return s(t,r,u);case">=":return n(t,r,u);case"<":return o(t,r,u);case"<=":return l(t,r,u);default:throw TypeError(`Invalid operator: ${e}`)}}},88854:function(t,e,r){"use strict";let i=r(52812),a=r(61347),{safeRe:s,t:n}=r(60124);t.exports=(t,e)=>{if(t instanceof i)return t;if("number"==typeof t&&(t=String(t)),"string"!=typeof t)return null;let r=null;if((e=e||{}).rtl){let i,a=e.includePrerelease?s[n.COERCERTLFULL]:s[n.COERCERTL];for(;(i=a.exec(t))&&(!r||r.index+r[0].length!==t.length);)r&&i.index+i[0].length===r.index+r[0].length||(r=i),a.lastIndex=i.index+i[1].length+i[2].length;a.lastIndex=-1}else r=t.match(e.includePrerelease?s[n.COERCEFULL]:s[n.COERCE]);if(null===r)return null;let o=r[2],l=r[3]||"0",u=r[4]||"0",h=e.includePrerelease&&r[5]?`-${r[5]}`:"",c=e.includePrerelease&&r[6]?`+${r[6]}`:"";return a(`${o}.${l}.${u}${h}${c}`,e)}},2034:function(t,e,r){"use strict";let i=r(52812);t.exports=(t,e,r)=>{let a=new i(t,r),s=new i(e,r);return a.compare(s)||a.compareBuild(s)}},68120:function(t,e,r){"use strict";let i=r(10746);t.exports=(t,e)=>i(t,e,!0)},10746:function(t,e,r){"use strict";let i=r(52812);t.exports=(t,e,r)=>new i(t,r).compare(new i(e,r))},75536:function(t,e,r){"use strict";let i=r(61347);t.exports=(t,e)=>{let r=i(t,null,!0),a=i(e,null,!0),s=r.compare(a);if(0===s)return null;let n=s>0,o=n?r:a,l=n?a:r,u=!!o.prerelease.length;if(l.prerelease.length&&!u){if(!l.patch&&!l.minor)return"major";if(0===l.compareMain(o))return l.minor&&!l.patch?"minor":"patch"}let h=u?"pre":"";return r.major!==a.major?h+"major":r.minor!==a.minor?h+"minor":r.patch!==a.patch?h+"patch":"prerelease"}},37543:function(t,e,r){"use strict";let i=r(10746);t.exports=(t,e,r)=>0===i(t,e,r)},38701:function(t,e,r){"use strict";let i=r(10746);t.exports=(t,e,r)=>i(t,e,r)>0},84854:function(t,e,r){"use strict";let i=r(10746);t.exports=(t,e,r)=>i(t,e,r)>=0},9130:function(t,e,r){"use strict";let i=r(52812);t.exports=(t,e,r,a,s)=>{"string"==typeof r&&(s=a,a=r,r=void 0);try{return new i(t instanceof i?t.version:t,r).inc(e,a,s).version}catch(t){return null}}},30253:function(t,e,r){"use strict";let i=r(10746);t.exports=(t,e,r)=>0>i(t,e,r)},10148:function(t,e,r){"use strict";let i=r(10746);t.exports=(t,e,r)=>0>=i(t,e,r)},24822:function(t,e,r){"use strict";let i=r(52812);t.exports=(t,e)=>new i(t,e).major},7291:function(t,e,r){"use strict";let i=r(52812);t.exports=(t,e)=>new i(t,e).minor},59466:function(t,e,r){"use strict";let i=r(10746);t.exports=(t,e,r)=>0!==i(t,e,r)},61347:function(t,e,r){"use strict";let i=r(52812);t.exports=(t,e,r=!1)=>{if(t instanceof i)return t;try{return new i(t,e)}catch(t){if(!r)return null;throw t}}},20024:function(t,e,r){"use strict";let i=r(52812);t.exports=(t,e)=>new i(t,e).patch},66504:function(t,e,r){"use strict";let i=r(61347);t.exports=(t,e)=>{let r=i(t,e);return r&&r.prerelease.length?r.prerelease:null}},25858:function(t,e,r){"use strict";let i=r(10746);t.exports=(t,e,r)=>i(e,t,r)},48060:function(t,e,r){"use strict";let i=r(2034);t.exports=(t,e)=>t.sort((t,r)=>i(r,t,e))},78826:function(t,e,r){"use strict";let i=r(23701);t.exports=(t,e,r)=>{try{e=new i(e,r)}catch(t){return!1}return e.test(t)}},33733:function(t,e,r){"use strict";let i=r(2034);t.exports=(t,e)=>t.sort((t,r)=>i(t,r,e))},48902:function(t,e,r){"use strict";let i=r(61347);t.exports=(t,e)=>{let r=i(t,e);return r?r.version:null}},78970:function(t,e,r){"use strict";let i=r(60124),a=r(43677),s=r(52812),n=r(16847),o=r(61347),l=r(48902),u=r(64329),h=r(9130),c=r(75536),d=r(24822),p=r(7291),m=r(20024),f=r(66504),g=r(10746),_=r(25858),v=r(68120),y=r(2034),b=r(33733),w=r(48060),E=r(38701),$=r(30253),I=r(37543),O=r(59466),S=r(84854),T=r(10148),R=r(94792),P=r(88854),A=r(33569),j=r(23701),N=r(78826),C=r(1720),x=r(19475),L=r(91053),U=r(80296),k=r(86208),D=r(73917),M=r(31888),G=r(80589),F=r(17627);t.exports={parse:o,valid:l,clean:u,inc:h,diff:c,major:d,minor:p,patch:m,prerelease:f,compare:g,rcompare:_,compareLoose:v,compareBuild:y,sort:b,rsort:w,gt:E,lt:$,eq:I,neq:O,gte:S,lte:T,cmp:R,coerce:P,Comparator:A,Range:j,satisfies:N,toComparators:C,maxSatisfying:x,minSatisfying:L,minVersion:U,validRange:k,outside:D,gtr:M,ltr:G,intersects:F,simplifyRange:r(45041),subset:r(44803),SemVer:s,re:i.re,src:i.src,tokens:i.t,SEMVER_SPEC_VERSION:a.SEMVER_SPEC_VERSION,RELEASE_TYPES:a.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers}},43677:function(t){"use strict";t.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||0x1fffffffffffff,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},46342:function(t,e,r){"use strict";var i=r(73656);t.exports="object"==typeof i&&i.env&&i.env.NODE_DEBUG&&/\bsemver\b/i.test(i.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{}},16847:function(t){"use strict";let e=/^[0-9]+$/,r=(t,r)=>{let i=e.test(t),a=e.test(r);return i&&a&&(t*=1,r*=1),t===r?0:i&&!a?-1:a&&!i?1:t<r?-1:1};t.exports={compareIdentifiers:r,rcompareIdentifiers:(t,e)=>r(e,t)}},42821:function(t){"use strict";t.exports=class{constructor(){this.max=1e3,this.map=new Map}get(t){let e=this.map.get(t);if(void 0!==e)return this.map.delete(t),this.map.set(t,e),e}delete(t){return this.map.delete(t)}set(t,e){if(!this.delete(t)&&void 0!==e){if(this.map.size>=this.max){let t=this.map.keys().next().value;this.delete(t)}this.map.set(t,e)}return this}}},74436:function(t){"use strict";let e=Object.freeze({loose:!0}),r=Object.freeze({});t.exports=t=>t?"object"!=typeof t?e:t:r},60124:function(t,e,r){"use strict";let{MAX_SAFE_COMPONENT_LENGTH:i,MAX_SAFE_BUILD_LENGTH:a,MAX_LENGTH:s}=r(43677),n=r(46342),o=(e=t.exports={}).re=[],l=e.safeRe=[],u=e.src=[],h=e.safeSrc=[],c=e.t={},d=0,p="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",s],[p,a]],f=t=>{for(let[e,r]of m)t=t.split(`${e}*`).join(`${e}{0,${r}}`).split(`${e}+`).join(`${e}{1,${r}}`);return t},g=(t,e,r)=>{let i=f(e),a=d++;n(t,a,e),c[t]=a,u[a]=e,h[a]=i,o[a]=new RegExp(e,r?"g":void 0),l[a]=new RegExp(i,r?"g":void 0)};g("NUMERICIDENTIFIER","0|[1-9]\\d*"),g("NUMERICIDENTIFIERLOOSE","\\d+"),g("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),g("MAINVERSION",`(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})`),g("MAINVERSIONLOOSE",`(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASEIDENTIFIER",`(?:${u[c.NONNUMERICIDENTIFIER]}|${u[c.NUMERICIDENTIFIER]})`),g("PRERELEASEIDENTIFIERLOOSE",`(?:${u[c.NONNUMERICIDENTIFIER]}|${u[c.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASE",`(?:-(${u[c.PRERELEASEIDENTIFIER]}(?:\\.${u[c.PRERELEASEIDENTIFIER]})*))`),g("PRERELEASELOOSE",`(?:-?(${u[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[c.PRERELEASEIDENTIFIERLOOSE]})*))`),g("BUILDIDENTIFIER",`${p}+`),g("BUILD",`(?:\\+(${u[c.BUILDIDENTIFIER]}(?:\\.${u[c.BUILDIDENTIFIER]})*))`),g("FULLPLAIN",`v?${u[c.MAINVERSION]}${u[c.PRERELEASE]}?${u[c.BUILD]}?`),g("FULL",`^${u[c.FULLPLAIN]}$`),g("LOOSEPLAIN",`[v=\\s]*${u[c.MAINVERSIONLOOSE]}${u[c.PRERELEASELOOSE]}?${u[c.BUILD]}?`),g("LOOSE",`^${u[c.LOOSEPLAIN]}$`),g("GTLT","((?:<|>)?=?)"),g("XRANGEIDENTIFIERLOOSE",`${u[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),g("XRANGEIDENTIFIER",`${u[c.NUMERICIDENTIFIER]}|x|X|\\*`),g("XRANGEPLAIN",`[v=\\s]*(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:${u[c.PRERELEASE]})?${u[c.BUILD]}?)?)?`),g("XRANGEPLAINLOOSE",`[v=\\s]*(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:${u[c.PRERELEASELOOSE]})?${u[c.BUILD]}?)?)?`),g("XRANGE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAIN]}$`),g("XRANGELOOSE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAINLOOSE]}$`),g("COERCEPLAIN",`(^|[^\\d])(\\d{1,${i}})(?:\\.(\\d{1,${i}}))?(?:\\.(\\d{1,${i}}))?`),g("COERCE",`${u[c.COERCEPLAIN]}(?:$|[^\\d])`),g("COERCEFULL",u[c.COERCEPLAIN]+`(?:${u[c.PRERELEASE]})?`+`(?:${u[c.BUILD]})?`+"(?:$|[^\\d])"),g("COERCERTL",u[c.COERCE],!0),g("COERCERTLFULL",u[c.COERCEFULL],!0),g("LONETILDE","(?:~>?)"),g("TILDETRIM",`(\\s*)${u[c.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",g("TILDE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAIN]}$`),g("TILDELOOSE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAINLOOSE]}$`),g("LONECARET","(?:\\^)"),g("CARETTRIM",`(\\s*)${u[c.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",g("CARET",`^${u[c.LONECARET]}${u[c.XRANGEPLAIN]}$`),g("CARETLOOSE",`^${u[c.LONECARET]}${u[c.XRANGEPLAINLOOSE]}$`),g("COMPARATORLOOSE",`^${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]})$|^$`),g("COMPARATOR",`^${u[c.GTLT]}\\s*(${u[c.FULLPLAIN]})$|^$`),g("COMPARATORTRIM",`(\\s*)${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]}|${u[c.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",g("HYPHENRANGE",`^\\s*(${u[c.XRANGEPLAIN]})\\s+-\\s+(${u[c.XRANGEPLAIN]})\\s*$`),g("HYPHENRANGELOOSE",`^\\s*(${u[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[c.XRANGEPLAINLOOSE]})\\s*$`),g("STAR","(<|>)?=?\\s*\\*"),g("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),g("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},31888:function(t,e,r){"use strict";let i=r(73917);t.exports=(t,e,r)=>i(t,e,">",r)},17627:function(t,e,r){"use strict";let i=r(23701);t.exports=(t,e,r)=>(t=new i(t,r),e=new i(e,r),t.intersects(e,r))},80589:function(t,e,r){"use strict";let i=r(73917);t.exports=(t,e,r)=>i(t,e,"<",r)},19475:function(t,e,r){"use strict";let i=r(52812),a=r(23701);t.exports=(t,e,r)=>{let s=null,n=null,o=null;try{o=new a(e,r)}catch(t){return null}return t.forEach(t=>{o.test(t)&&(!s||-1===n.compare(t))&&(n=new i(s=t,r))}),s}},91053:function(t,e,r){"use strict";let i=r(52812),a=r(23701);t.exports=(t,e,r)=>{let s=null,n=null,o=null;try{o=new a(e,r)}catch(t){return null}return t.forEach(t=>{o.test(t)&&(!s||1===n.compare(t))&&(n=new i(s=t,r))}),s}},80296:function(t,e,r){"use strict";let i=r(52812),a=r(23701),s=r(38701);t.exports=(t,e)=>{t=new a(t,e);let r=new i("0.0.0");if(t.test(r)||(r=new i("0.0.0-0"),t.test(r)))return r;r=null;for(let e=0;e<t.set.length;++e){let a=t.set[e],n=null;a.forEach(t=>{let e=new i(t.semver.version);switch(t.operator){case">":0===e.prerelease.length?e.patch++:e.prerelease.push(0),e.raw=e.format();case"":case">=":(!n||s(e,n))&&(n=e);break;case"<":case"<=":break;default:throw Error(`Unexpected operation: ${t.operator}`)}}),n&&(!r||s(r,n))&&(r=n)}return r&&t.test(r)?r:null}},73917:function(t,e,r){"use strict";let i=r(52812),a=r(33569),{ANY:s}=a,n=r(23701),o=r(78826),l=r(38701),u=r(30253),h=r(10148),c=r(84854);t.exports=(t,e,r,d)=>{let p,m,f,g,_;switch(t=new i(t,d),e=new n(e,d),r){case">":p=l,m=h,f=u,g=">",_=">=";break;case"<":p=u,m=c,f=l,g="<",_="<=";break;default:throw TypeError('Must provide a hilo val of "<" or ">"')}if(o(t,e,d))return!1;for(let r=0;r<e.set.length;++r){let i=e.set[r],n=null,o=null;if(i.forEach(t=>{t.semver===s&&(t=new a(">=0.0.0")),n=n||t,o=o||t,p(t.semver,n.semver,d)?n=t:f(t.semver,o.semver,d)&&(o=t)}),n.operator===g||n.operator===_||(!o.operator||o.operator===g)&&m(t,o.semver)||o.operator===_&&f(t,o.semver))return!1}return!0}},45041:function(t,e,r){"use strict";let i=r(78826),a=r(10746);t.exports=(t,e,r)=>{let s=[],n=null,o=null,l=t.sort((t,e)=>a(t,e,r));for(let t of l)i(t,e,r)?(o=t,n||(n=t)):(o&&s.push([n,o]),o=null,n=null);n&&s.push([n,null]);let u=[];for(let[t,e]of s)t===e?u.push(t):e||t!==l[0]?e?t===l[0]?u.push(`<=${e}`):u.push(`${t} - ${e}`):u.push(`>=${t}`):u.push("*");let h=u.join(" || "),c="string"==typeof e.raw?e.raw:String(e);return h.length<c.length?h:e}},44803:function(t,e,r){"use strict";let i=r(23701),a=r(33569),{ANY:s}=a,n=r(78826),o=r(10746),l=[new a(">=0.0.0-0")],u=[new a(">=0.0.0")],h=(t,e,r)=>{let i,a,h,p,m,f,g;if(t===e)return!0;if(1===t.length&&t[0].semver===s)if(1===e.length&&e[0].semver===s)return!0;else t=r.includePrerelease?l:u;if(1===e.length&&e[0].semver===s)if(r.includePrerelease)return!0;else e=u;let _=new Set;for(let e of t)">"===e.operator||">="===e.operator?i=c(i,e,r):"<"===e.operator||"<="===e.operator?a=d(a,e,r):_.add(e.semver);if(_.size>1)return null;if(i&&a&&((h=o(i.semver,a.semver,r))>0||0===h&&(">="!==i.operator||"<="!==a.operator)))return null;for(let t of _){if(i&&!n(t,String(i),r)||a&&!n(t,String(a),r))return null;for(let i of e)if(!n(t,String(i),r))return!1;return!0}let v=!!a&&!r.includePrerelease&&!!a.semver.prerelease.length&&a.semver,y=!!i&&!r.includePrerelease&&!!i.semver.prerelease.length&&i.semver;for(let t of(v&&1===v.prerelease.length&&"<"===a.operator&&0===v.prerelease[0]&&(v=!1),e)){if(g=g||">"===t.operator||">="===t.operator,f=f||"<"===t.operator||"<="===t.operator,i){if(y&&t.semver.prerelease&&t.semver.prerelease.length&&t.semver.major===y.major&&t.semver.minor===y.minor&&t.semver.patch===y.patch&&(y=!1),">"===t.operator||">="===t.operator){if((p=c(i,t,r))===t&&p!==i)return!1}else if(">="===i.operator&&!n(i.semver,String(t),r))return!1}if(a){if(v&&t.semver.prerelease&&t.semver.prerelease.length&&t.semver.major===v.major&&t.semver.minor===v.minor&&t.semver.patch===v.patch&&(v=!1),"<"===t.operator||"<="===t.operator){if((m=d(a,t,r))===t&&m!==a)return!1}else if("<="===a.operator&&!n(a.semver,String(t),r))return!1}if(!t.operator&&(a||i)&&0!==h)return!1}return(!i||!f||!!a||0===h)&&(!a||!g||!!i||0===h)&&!y&&!v&&!0},c=(t,e,r)=>{if(!t)return e;let i=o(t.semver,e.semver,r);return i>0?t:i<0||">"===e.operator&&">="===t.operator?e:t},d=(t,e,r)=>{if(!t)return e;let i=o(t.semver,e.semver,r);return i<0?t:i>0||"<"===e.operator&&"<="===t.operator?e:t};t.exports=(t,e,r={})=>{if(t===e)return!0;t=new i(t,r),e=new i(e,r);let a=!1;t:for(let i of t.set){for(let t of e.set){let e=h(i,t,r);if(a=a||null!==e,e)continue t}if(a)return!1}return!0}},1720:function(t,e,r){"use strict";let i=r(23701);t.exports=(t,e)=>new i(t,e).set.map(t=>t.map(t=>t.value).join(" ").trim().split(" "))},86208:function(t,e,r){"use strict";let i=r(23701);t.exports=(t,e)=>{try{return new i(t,e).range||"*"}catch(t){return null}}},97733:function(t,e,r){"use strict";let i,a,s;r.d(e,{wrapOpenAI:()=>tC});var n,o=r(96945);let l={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};for(var u=new Uint8Array(16),h=[],c=0;c<256;++c)h.push((c+256).toString(16).slice(1));let d=function(t,e,r){if(l.randomUUID&&!e&&!t)return l.randomUUID();var i=(t=t||{}).random||(t.rng||function(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(u)})();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e){r=r||0;for(var a=0;a<16;++a)e[r+a]=i[a];return e}return function(t,e=0){return(h[t[e+0]]+h[t[e+1]]+h[t[e+2]]+h[t[e+3]]+"-"+h[t[e+4]]+h[t[e+5]]+"-"+h[t[e+6]]+h[t[e+7]]+"-"+h[t[e+8]]+h[t[e+9]]+"-"+h[t[e+10]]+h[t[e+11]]+h[t[e+12]]+h[t[e+13]]+h[t[e+14]]+h[t[e+15]]).toLowerCase()}(i)};var p=r(32656),m=r(88464);let f=(...t)=>fetch(...t),g=Symbol.for("ls:fetch_implementation"),_=()=>globalThis[g]??f,v=[400,401,403,404,405,406,407,408],y=[409];class b{constructor(t){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=t.maxConcurrency??1/0,this.maxRetries=t.maxRetries??6,"default"in m?this.queue=new m.default({concurrency:this.maxConcurrency}):this.queue=new m({concurrency:this.maxConcurrency}),this.onFailedResponseHook=t?.onFailedResponseHook}call(t,...e){let r=this.onFailedResponseHook;return this.queue.add(()=>p(()=>t(...e).catch(t=>{if(t instanceof Error)throw t;throw Error(t)}),{async onFailedAttempt(t){if(t.message.startsWith("Cancel")||t.message.startsWith("TimeoutError")||t.message.startsWith("AbortError")||t?.code==="ECONNABORTED")throw t;let e=t?.response,i=e?.status;if(i){if(v.includes(+i))throw t;if(y.includes(+i))return;r&&await r(e)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(t,e,...r){return t.signal?Promise.race([this.call(e,...r),new Promise((e,r)=>{t.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(e,...r)}fetch(...t){return this.call(()=>_()(...t).then(t=>t.ok?t:Promise.reject(t)))}}function w(t){return"function"==typeof t?._getType}function E(t){let e={type:t._getType(),data:{content:t.content}};return t?.additional_kwargs&&Object.keys(t.additional_kwargs).length>0&&(e.data.additional_kwargs={...t.additional_kwargs}),e}let $=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function I(t,e){if(!("string"==typeof t&&$.test(t)))throw Error(void 0!==e?`Invalid UUID for ${e}: ${t}`:`Invalid UUID: ${t}`);return t}let O={};function S(t){O[t]||(console.warn(t),O[t]=!0)}function T(t){if(!t||t.split("/").length>2||t.startsWith("/")||t.endsWith("/")||t.split(":").length>2)throw Error(`Invalid identifier format: ${t}`);let[e,r]=t.split(":"),i=r||"latest";if(e.includes("/")){let[r,a]=e.split("/",2);if(!r||!a)throw Error(`Invalid identifier format: ${t}`);return[r,a,i]}if(!e)throw Error(`Invalid identifier format: ${t}`);return["-",e,i]}r(78970);class R extends Error{constructor(t){super(t),this.name="LangSmithConflictError"}}async function P(t,e,r){let i;if(t.ok){r&&(i=await t.text());return}i=await t.text();let a=`Failed to ${e}. Received status [${t.status}]: ${t.statusText}. Server response: ${i}`;if(409===t.status)throw new R(a);throw Error(a)}var A={result:"[Circular]"},j=[],N=[];let C=new TextEncoder;function x(t){return C.encode(t)}function L(t,e,r,i){try{let i=JSON.stringify(t,e,r);return x(i)}catch(n){let s;if(!n.message?.includes("Converting circular structure to JSON"))return console.warn("[WARNING]: LangSmith received unserializable value."),x("[Unserializable]");console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),void 0===i&&(i={depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}),function t(e,r,i,a,s,n,o){if(n+=1,"object"==typeof e&&null!==e){for(l=0;l<a.length;l++)if(a[l]===e)return void U(A,e,r,s);if(void 0!==o.depthLimit&&n>o.depthLimit||void 0!==o.edgesLimit&&i+1>o.edgesLimit)return void U("[...]",e,r,s);if(a.push(e),Array.isArray(e))for(l=0;l<e.length;l++)t(e[l],l,l,a,e,n,o);else{var l,u=Object.keys(e);for(l=0;l<u.length;l++){var h=u[l];t(e[h],h,l,a,e,n,o)}}a.pop()}}(t,"",0,[],void 0,0,i);try{var a;s=0===N.length?JSON.stringify(t,e,r):JSON.stringify(t,(a=e,a=void 0!==a?a:function(t,e){return e},function(t,e){if(N.length>0)for(var r=0;r<N.length;r++){var i=N[r];if(i[1]===t&&i[0]===e){e=i[2],N.splice(r,1);break}}return a.call(this,t,e)}),r)}catch(t){return x("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==j.length;){let t=j.pop();4===t.length?Object.defineProperty(t[0],t[1],t[3]):t[0][t[1]]=t[2]}}return x(s)}}function U(t,e,r,i){var a=Object.getOwnPropertyDescriptor(i,r);void 0!==a.get?a.configurable?(Object.defineProperty(i,r,{value:t}),j.push([i,r,e,a])):N.push([e,r,t]):(i[r]=t,j.push([i,r,e]))}function k(t){let e=Z(),r=function(){let t=function(){try{if(void 0!==J&&J.env)return Object.entries(J.env).reduce((t,[e,r])=>(t[e]=String(r),t),{});return}catch(t){return}}()||{},e={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(let[i,a]of Object.entries(t))(i.startsWith("LANGCHAIN_")||i.startsWith("LANGSMITH_"))&&"string"==typeof a&&!r.includes(i)&&!i.toLowerCase().includes("key")&&!i.toLowerCase().includes("secret")&&!i.toLowerCase().includes("token")&&("LANGCHAIN_REVISION_ID"===i?e.revision_id=a:e[i]=a);return e}(),i=t.extra??{},a=i.metadata;return t.extra={...i,runtime:{...e,...i?.runtime},metadata:{...r,...r.revision_id||t.revision_id?{revision_id:t.revision_id??r.revision_id}:{},...a}},t}let D=()=>{let t=te("TRACING_SAMPLING_RATE");if(void 0===t)return;let e=parseFloat(t);if(e<0||e>1)throw Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},M=t=>{let e=t.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===e||"127.0.0.1"===e||"::1"===e};async function G(t){let e=[];for await(let r of t)e.push(r);return e}function F(t){if(void 0!==t)return t.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}let B=async t=>{if(t?.status===429){let e=1e3*parseInt(t.headers.get("retry-after")??"30",10);if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};class H{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(t){let e,r=new Promise(t=>{e=t}),i=L(t.item).length;return this.items.push({action:t.action,payload:t.item,itemPromiseResolve:e,itemPromise:r,size:i}),this.sizeBytes+=i,r}pop(t){if(t<1)throw Error("Number of bytes to pop off may not be less than 1.");let e=[],r=0;for(;r+(this.peek()?.size??0)<t&&this.items.length>0;){let t=this.items.shift();t&&(e.push(t),r+=t.size,this.sizeBytes-=t.size)}if(0===e.length&&this.items.length>0){let t=this.items.shift();e.push(t),r+=t.size,this.sizeBytes-=t.size}return[e.map(t=>({action:t.action,item:t.payload})),()=>e.forEach(t=>t.itemPromiseResolve())]}}class q{constructor(t={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new H}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:"false"===tt("LANGSMITH_TRACING_BACKGROUND")}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1});let e=q.getDefaultClientConfig();if(this.tracingSampleRate=D(),this.apiUrl=F(t.apiUrl??e.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=F(t.apiKey??e.apiKey),this.webUrl=F(t.webUrl??e.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=t.timeout_ms??9e4,this.caller=new b(t.callerOptions??{}),this.traceBatchConcurrency=t.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw Error("Trace batch concurrency must be positive.");this.batchIngestCaller=new b({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...t.callerOptions??{},onFailedResponseHook:B}),this.hideInputs=t.hideInputs??t.anonymizer??e.hideInputs,this.hideOutputs=t.hideOutputs??t.anonymizer??e.hideOutputs,this.autoBatchTracing=t.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=t.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=t.batchSizeBytesLimit,this.fetchOptions=t.fetchOptions||{},this.manualFlushMode=t.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){let t=te("API_KEY"),e=te("ENDPOINT")??"https://api.smith.langchain.com";return{apiUrl:e,apiKey:t,webUrl:void 0,hideInputs:"true"===te("HIDE_INPUTS"),hideOutputs:"true"===te("HIDE_OUTPUTS")}}getHostUrl(){if(this.webUrl)return this.webUrl;if(M(this.apiUrl))return this.webUrl="http://localhost:3000",this.webUrl;if(this.apiUrl.endsWith("/api/v1"))return this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl;if(this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api"))return this.webUrl=this.apiUrl.replace("/api",""),this.webUrl;if(this.apiUrl.split(".",1)[0].includes("dev"))return this.webUrl="https://dev.smith.langchain.com",this.webUrl;else if(this.apiUrl.split(".",1)[0].includes("eu"))return this.webUrl="https://eu.smith.langchain.com",this.webUrl;else if(this.apiUrl.split(".",1)[0].includes("beta"))return this.webUrl="https://beta.smith.langchain.com",this.webUrl;else return this.webUrl="https://smith.langchain.com",this.webUrl}get headers(){let t={"User-Agent":`langsmith-js/${z}`};return this.apiKey&&(t["x-api-key"]=`${this.apiKey}`),t}processInputs(t){return!1===this.hideInputs?t:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(t):t}processOutputs(t){return!1===this.hideOutputs?t:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(t):t}prepareRunCreateOrUpdateInputs(t){let e={...t};return void 0!==e.inputs&&(e.inputs=this.processInputs(e.inputs)),void 0!==e.outputs&&(e.outputs=this.processOutputs(e.outputs)),e}async _getResponse(t,e){let r=e?.toString()??"",i=`${this.apiUrl}${t}?${r}`,a=await this.caller.call(_(),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await P(a,`Failed to fetch ${t}`),a}async _get(t,e){return(await this._getResponse(t,e)).json()}async *_getPaginated(t,e=new URLSearchParams,r){let i=Number(e.get("offset"))||0,a=Number(e.get("limit"))||100;for(;;){e.set("offset",String(i)),e.set("limit",String(a));let s=`${this.apiUrl}${t}?${e}`,n=await this.caller.call(_(),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(n,`Failed to fetch ${t}`);let o=r?r(await n.json()):await n.json();if(0===o.length||(yield o,o.length<a))break;i+=o.length}}async *_getCursorPaginatedList(t,e=null,r="POST",i="runs"){let a=e?{...e}:{};for(;;){let e=await this.caller.call(_(),`${this.apiUrl}${t}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(a)}),s=await e.json();if(!s||!s[i])break;yield s[i];let n=s.cursors;if(!n||!n.next)break;a.cursor=n.next}}_filterForSampling(t,e=!1){if(void 0===this.tracingSampleRate)return t;if(e){let e=[];for(let r of t)this.filteredPostUuids.has(r.id)?this.filteredPostUuids.delete(r.id):e.push(r);return e}{let e=[];for(let r of t)r.id!==r.trace_id&&!this.filteredPostUuids.has(r.trace_id)||Math.random()<this.tracingSampleRate?e.push(r):this.filteredPostUuids.add(r.id);return e}}async _getBatchSizeLimitBytes(){let t=await this._ensureServerInfo();return this.batchSizeBytesLimit??t.batch_ingest_config?.size_limit_bytes??0x1400000}async _getMultiPartSupport(){let t=await this._ensureServerInfo();return t.instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue(t){let e=[];for(;this.autoBatchQueue.items.length>0;){let[r,i]=this.autoBatchQueue.pop(t);if(!r.length){i();break}let a=this._processBatch(r,i).catch(console.error);e.push(a)}return Promise.all(e)}async _processBatch(t,e){if(!t.length)return void e();try{let e={runCreates:t.filter(t=>"create"===t.action).map(t=>t.item),runUpdates:t.filter(t=>"update"===t.action).map(t=>t.item)},r=await this._ensureServerInfo();r?.batch_ingest_config?.use_multipart_endpoint?await this.multipartIngestRuns(e):await this.batchIngestRuns(e)}finally{e()}}async processRunOperation(t){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,"create"===t.action&&(t.item=k(t.item));let e=this.autoBatchQueue.push(t);if(this.manualFlushMode)return e;let r=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>r&&this.drainAutoBatchQueue(r),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(r)},this.autoBatchAggregationDelayMs)),e}async _getServerInfo(){let t=await _()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(2500),...this.fetchOptions});return await P(t,"get server info"),t.json()}async _ensureServerInfo(){return void 0===this._getServerInfoPromise&&(this._getServerInfoPromise=(async()=>{if(void 0===this._serverInfo)try{this._serverInfo=await this._getServerInfo()}catch(t){console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to batch operations and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(t=>(void 0===this._serverInfo&&(this._getServerInfoPromise=void 0),t))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){let t=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(t)}async createRun(t){if(!this._filterForSampling([t]).length)return;let e={...this.headers,"Content-Type":"application/json"},r=t.project_name;delete t.project_name;let i=this.prepareRunCreateOrUpdateInputs({session_name:r,...t,start_time:t.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==i.trace_id&&void 0!==i.dotted_order)return void this.processRunOperation({action:"create",item:i}).catch(console.error);let a=k(i),s=await this.caller.call(_(),`${this.apiUrl}/runs`,{method:"POST",headers:e,body:L(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(s,"create run",!0)}async batchIngestRuns({runCreates:t,runUpdates:e}){if(void 0===t&&void 0===e)return;let r=t?.map(t=>this.prepareRunCreateOrUpdateInputs(t))??[],i=e?.map(t=>this.prepareRunCreateOrUpdateInputs(t))??[];if(r.length>0&&i.length>0){let t=r.reduce((t,e)=>(e.id&&(t[e.id]=e),t),{}),e=[];for(let r of i)void 0!==r.id&&t[r.id]?t[r.id]={...t[r.id],...r}:e.push(r);r=Object.values(t),i=e}let a={post:this._filterForSampling(r),patch:this._filterForSampling(i,!0)};if(!a.post.length&&!a.patch.length)return;let s={post:[],patch:[]};for(let t of["post","patch"]){let e=a[t].reverse(),r=e.pop();for(;void 0!==r;)s[t].push(r),r=e.pop()}(s.post.length>0||s.patch.length>0)&&await this._postBatchIngestRuns(L(s))}async _postBatchIngestRuns(t){let e={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(_(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:e,body:t,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(r,"batch create run",!0)}async multipartIngestRuns({runCreates:t,runUpdates:e}){if(void 0===t&&void 0===e)return;let r={},i=[];for(let e of t??[]){let t=this.prepareRunCreateOrUpdateInputs(e);void 0!==t.id&&void 0!==t.attachments&&(r[t.id]=t.attachments),delete t.attachments,i.push(t)}let a=[];for(let t of e??[])a.push(this.prepareRunCreateOrUpdateInputs(t));if(void 0!==i.find(t=>void 0===t.trace_id||void 0===t.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(void 0!==a.find(t=>void 0===t.trace_id||void 0===t.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(i.length>0&&a.length>0){let t=i.reduce((t,e)=>(e.id&&(t[e.id]=e),t),{}),e=[];for(let r of a)void 0!==r.id&&t[r.id]?t[r.id]={...t[r.id],...r}:e.push(r);i=Object.values(t),a=e}if(0===i.length&&0===a.length)return;let s=[],n=[];for(let[t,e]of[["post",i],["patch",a]])for(let i of e){let{inputs:e,outputs:a,events:o,attachments:l,...u}=i,h={inputs:e,outputs:a,events:o},c=L(u);for(let[e,r]of(n.push({name:`${t}.${u.id}`,payload:new Blob([c],{type:`application/json; length=${c.length}`})}),Object.entries(h))){if(void 0===r)continue;let i=L(r);n.push({name:`${t}.${u.id}.${e}`,payload:new Blob([i],{type:`application/json; length=${i.length}`})})}if(void 0!==u.id){let t=r[u.id];if(t)for(let[e,i]of(delete r[u.id],Object.entries(t))){let t,r;if(Array.isArray(i)?[t,r]=i:(t=i.mimeType,r=i.data),e.includes(".")){console.warn(`Skipping attachment '${e}' for run ${u.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}n.push({name:`attachment.${u.id}.${e}`,payload:new Blob([r],{type:`${t}; length=${r.byteLength}`})})}}s.push(`trace=${u.trace_id},id=${u.id}`)}await this._sendMultipartRequest(n,s.join("; "))}async _sendMultipartRequest(t,e){try{let e="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),r=[];for(let i of t)r.push(new Blob([`--${e}\r
`])),r.push(new Blob([`Content-Disposition: form-data; name="${i.name}"\r
`,`Content-Type: ${i.payload.type}\r
\r
`])),r.push(i.payload),r.push(new Blob(["\r\n"]));r.push(new Blob([`--${e}--\r
`]));let i=new Blob(r),a=await i.arrayBuffer(),s=await this.batchIngestCaller.call(_(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${e}`},body:a,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(s,"ingest multipart runs",!0)}catch(t){console.warn(`${t.message.trim()}

Context: ${e}`)}}async updateRun(t,e){I(t),e.inputs&&(e.inputs=this.processInputs(e.inputs)),e.outputs&&(e.outputs=this.processOutputs(e.outputs));let r={...e,id:t};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&void 0!==r.trace_id&&void 0!==r.dotted_order)return void 0!==e.end_time&&void 0===r.parent_run_id&&this.blockOnRootRunFinalization&&!this.manualFlushMode?void await this.processRunOperation({action:"update",item:r}).catch(console.error):void this.processRunOperation({action:"update",item:r}).catch(console.error);let i={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(_(),`${this.apiUrl}/runs/${t}`,{method:"PATCH",headers:i,body:L(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(a,"update run",!0)}async readRun(t,{loadChildRuns:e}={loadChildRuns:!1}){I(t);let r=await this._get(`/runs/${t}`);return e&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:t,run:e,projectOpts:r}){if(void 0!==e){let t;t=e.session_id?e.session_id:r?.projectName?(await this.readProject({projectName:r?.projectName})).id:r?.projectId?r?.projectId:(await this.readProject({projectName:te("PROJECT")||"default"})).id;let i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${t}/r/${e.id}?poll=true`}if(void 0!==t){let e=await this.readRun(t);if(!e.app_path)throw Error(`Run ${t} has no app_path`);let r=this.getHostUrl();return`${r}${e.app_path}`}throw Error("Must provide either runId or run")}async _loadChildRuns(t){let e=await G(this.listRuns({id:t.child_run_ids})),r={},i={};for(let t of(e.sort((t,e)=>(t?.dotted_order??"").localeCompare(e?.dotted_order??"")),e)){if(null===t.parent_run_id||void 0===t.parent_run_id)throw Error(`Child run ${t.id} has no parent`);t.parent_run_id in r||(r[t.parent_run_id]=[]),r[t.parent_run_id].push(t),i[t.id]=t}for(let e in t.child_runs=r[t.id]||[],r)e!==t.id&&(i[e].child_runs=r[e]);return t}async *listRuns(t){let{projectId:e,projectName:r,parentRunId:i,traceId:a,referenceExampleId:s,startTime:n,executionOrder:o,isRoot:l,runType:u,error:h,id:c,query:d,filter:p,traceFilter:m,treeFilter:f,limit:g,select:_}=t,v=[];if(e&&(v=Array.isArray(e)?e:[e]),r){let t=Array.isArray(r)?r:[r],e=await Promise.all(t.map(t=>this.readProject({projectName:t}).then(t=>t.id)));v.push(...e)}let y={session:v.length?v:null,run_type:u,reference_example:s,query:d,filter:p,trace_filter:m,tree_filter:f,execution_order:o,parent_run:i,start_time:n?n.toISOString():null,error:h,id:c,limit:g,trace:a,select:_||["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:l},b=0;for await(let t of this._getCursorPaginatedList("/runs/query",y))if(g){if(b>=g)break;if(t.length+b>g){let e=t.slice(0,g-b);yield*e;break}b+=t.length,yield*t}else yield*t}async getRunStats({id:t,trace:e,parentRun:r,runType:i,projectNames:a,projectIds:s,referenceExampleIds:n,startTime:o,endTime:l,error:u,query:h,filter:c,traceFilter:d,treeFilter:p,isRoot:m,dataSourceType:f}){let g=s||[];a&&(g=[...s||[],...await Promise.all(a.map(t=>this.readProject({projectName:t}).then(t=>t.id)))]);let v=Object.fromEntries(Object.entries({id:t,trace:e,parent_run:r,run_type:i,session:g,reference_example:n,start_time:o,end_time:l,error:u,query:h,filter:c,trace_filter:d,tree_filter:p,is_root:m,data_source_type:f}).filter(([t,e])=>void 0!==e)),y=await this.caller.call(_(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(v),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await y.json()}async shareRun(t,{shareId:e}={}){let r={run_id:t,share_token:e||d()};I(t);let i=await this.caller.call(_(),`${this.apiUrl}/runs/${t}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await i.json();if(null===a||!("share_token"in a))throw Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(t){I(t);let e=await this.caller.call(_(),`${this.apiUrl}/runs/${t}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(e,"unshare run",!0)}async readRunSharedLink(t){I(t);let e=await this.caller.call(_(),`${this.apiUrl}/runs/${t}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await e.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(t,{runIds:e}={}){let r=new URLSearchParams({share_token:t});if(void 0!==e)for(let t of e)r.append("id",t);I(t);let i=await this.caller.call(_(),`${this.apiUrl}/public/${t}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await i.json()}async readDatasetSharedSchema(t,e){if(!t&&!e)throw Error("Either datasetId or datasetName must be given");t||(t=(await this.readDataset({datasetName:e})).id),I(t);let r=await this.caller.call(_(),`${this.apiUrl}/datasets/${t}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await r.json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async shareDataset(t,e){if(!t&&!e)throw Error("Either datasetId or datasetName must be given");t||(t=(await this.readDataset({datasetName:e})).id);let r={dataset_id:t};I(t);let i=await this.caller.call(_(),`${this.apiUrl}/datasets/${t}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await i.json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(t){I(t);let e=await this.caller.call(_(),`${this.apiUrl}/datasets/${t}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(e,"unshare dataset",!0)}async readSharedDataset(t){I(t);let e=await this.caller.call(_(),`${this.apiUrl}/public/${t}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e.json()}async listSharedExamples(t,e){let r={};e?.exampleIds&&(r.id=e.exampleIds);let i=new URLSearchParams;Object.entries(r).forEach(([t,e])=>{Array.isArray(e)?e.forEach(e=>i.append(t,e)):i.append(t,e)});let a=await this.caller.call(_(),`${this.apiUrl}/public/${t}/examples?${i.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),s=await a.json();if(!a.ok){if("detail"in s)throw Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${s.detail.join("\n")}`);throw Error(`Failed to list shared examples: ${a.status} ${a.statusText}`)}return s.map(t=>({...t,_hostUrl:this.getHostUrl()}))}async createProject({projectName:t,description:e=null,metadata:r=null,upsert:i=!1,projectExtra:a=null,referenceDatasetId:s=null}){let n=`${this.apiUrl}/sessions${i?"?upsert=true":""}`,o=a||{};r&&(o.metadata=r);let l={name:t,extra:o,description:e};null!==s&&(l.reference_dataset_id=s);let u=await this.caller.call(_(),n,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await P(u,"create project"),await u.json()}async updateProject(t,{name:e=null,description:r=null,metadata:i=null,projectExtra:a=null,endTime:s=null}){let n=`${this.apiUrl}/sessions/${t}`,o=a;i&&(o={...o||{},metadata:i});let l={name:e,extra:o,description:r,end_time:s?new Date(s).toISOString():null},u=await this.caller.call(_(),n,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await P(u,"update project"),await u.json()}async hasProject({projectId:t,projectName:e}){let r="/sessions",i=new URLSearchParams;if(void 0!==t&&void 0!==e)throw Error("Must provide either projectName or projectId, not both");if(void 0!==t)I(t),r+=`/${t}`;else if(void 0!==e)i.append("name",e);else throw Error("Must provide projectName or projectId");let a=await this.caller.call(_(),`${this.apiUrl}${r}?${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{let t=await a.json();if(!a.ok)return!1;if(Array.isArray(t))return t.length>0;return!0}catch(t){return!1}}async readProject({projectId:t,projectName:e,includeStats:r}){let i,a="/sessions",s=new URLSearchParams;if(void 0!==t&&void 0!==e)throw Error("Must provide either projectName or projectId, not both");if(void 0!==t)I(t),a+=`/${t}`;else if(void 0!==e)s.append("name",e);else throw Error("Must provide projectName or projectId");void 0!==r&&s.append("include_stats",r.toString());let n=await this._get(a,s);if(Array.isArray(n)){if(0===n.length)throw Error(`Project[id=${t}, name=${e}] not found`);i=n[0]}else i=n;return i}async getProjectUrl({projectId:t,projectName:e}){if(void 0===t&&void 0===e)throw Error("Must provide either projectName or projectId");let r=await this.readProject({projectId:t,projectName:e}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${r.id}`}async getDatasetUrl({datasetId:t,datasetName:e}){if(void 0===t&&void 0===e)throw Error("Must provide either datasetName or datasetId");let r=await this.readDataset({datasetId:t,datasetName:e}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/datasets/${r.id}`}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;let t=new URLSearchParams({limit:"1"});for await(let e of this._getPaginated("/sessions",t))return this._tenantId=e[0].tenant_id,e[0].tenant_id;throw Error("No projects found to resolve tenant.")}async *listProjects({projectIds:t,name:e,nameContains:r,referenceDatasetId:i,referenceDatasetName:a,referenceFree:s,metadata:n}={}){let o=new URLSearchParams;if(void 0!==t)for(let e of t)o.append("id",e);if(void 0!==e&&o.append("name",e),void 0!==r&&o.append("name_contains",r),void 0!==i)o.append("reference_dataset",i);else if(void 0!==a){let t=await this.readDataset({datasetName:a});o.append("reference_dataset",t.id)}for await(let t of(void 0!==s&&o.append("reference_free",s.toString()),void 0!==n&&o.append("metadata",JSON.stringify(n)),this._getPaginated("/sessions",o)))yield*t}async deleteProject({projectId:t,projectName:e}){let r;if(void 0===t&&void 0===e)throw Error("Must provide projectName or projectId");if(void 0!==t&&void 0!==e)throw Error("Must provide either projectName or projectId, not both");I(r=void 0===t?(await this.readProject({projectName:e})).id:t);let i=await this.caller.call(_(),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(i,`delete session ${r} (${e})`,!0)}async uploadCsv({csvFile:t,fileName:e,inputKeys:r,outputKeys:i,description:a,dataType:s,name:n}){let o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",t,e),r.forEach(t=>{l.append("input_keys",t)}),i.forEach(t=>{l.append("output_keys",t)}),a&&l.append("description",a),s&&l.append("data_type",s),n&&l.append("name",n);let u=await this.caller.call(_(),o,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await P(u,"upload CSV"),await u.json()}async createDataset(t,{description:e,dataType:r,inputsSchema:i,outputsSchema:a,metadata:s}={}){let n={name:t,description:e,extra:s?{metadata:s}:void 0};r&&(n.data_type=r),i&&(n.inputs_schema_definition=i),a&&(n.outputs_schema_definition=a);let o=await this.caller.call(_(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await P(o,"create dataset"),await o.json()}async readDataset({datasetId:t,datasetName:e}){let r,i="/datasets",a=new URLSearchParams({limit:"1"});if(void 0!==t&&void 0!==e)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==t)I(t),i+=`/${t}`;else if(void 0!==e)a.append("name",e);else throw Error("Must provide datasetName or datasetId");let s=await this._get(i,a);if(Array.isArray(s)){if(0===s.length)throw Error(`Dataset[id=${t}, name=${e}] not found`);r=s[0]}else r=s;return r}async hasDataset({datasetId:t,datasetName:e}){try{return await this.readDataset({datasetId:t,datasetName:e}),!0}catch(t){if(t instanceof Error&&t.message.toLocaleLowerCase().includes("not found"))return!1;throw t}}async diffDatasetVersions({datasetId:t,datasetName:e,fromVersion:r,toVersion:i}){let a=t;if(void 0===a&&void 0===e)throw Error("Must provide either datasetName or datasetId");if(void 0!==a&&void 0!==e)throw Error("Must provide either datasetName or datasetId, not both");void 0===a&&(a=(await this.readDataset({datasetName:e})).id);let s=new URLSearchParams({from_version:"string"==typeof r?r:r.toISOString(),to_version:"string"==typeof i?i:i.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,s)}async readDatasetOpenaiFinetuning({datasetId:t,datasetName:e}){if(void 0!==t);else if(void 0!==e)t=(await this.readDataset({datasetName:e})).id;else throw Error("Must provide datasetName or datasetId");let r=await this._getResponse(`/datasets/${t}/openai_ft`);return(await r.text()).trim().split("\n").map(t=>JSON.parse(t))}async *listDatasets({limit:t=100,offset:e=0,datasetIds:r,datasetName:i,datasetNameContains:a,metadata:s}={}){let n=new URLSearchParams({limit:t.toString(),offset:e.toString()});if(void 0!==r)for(let t of r)n.append("id",t);for await(let t of(void 0!==i&&n.append("name",i),void 0!==a&&n.append("name_contains",a),void 0!==s&&n.append("metadata",JSON.stringify(s)),this._getPaginated("/datasets",n)))yield*t}async updateDataset(t){let{datasetId:e,datasetName:r,...i}=t;if(!e&&!r)throw Error("Must provide either datasetName or datasetId");let a=e??(await this.readDataset({datasetName:r})).id;I(a);let s=await this.caller.call(_(),`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await P(s,"update dataset"),await s.json()}async updateDatasetTag(t){let{datasetId:e,datasetName:r,asOf:i,tag:a}=t;if(!e&&!r)throw Error("Must provide either datasetName or datasetId");let s=e??(await this.readDataset({datasetName:r})).id;I(s);let n=await this.caller.call(_(),`${this.apiUrl}/datasets/${s}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:"string"==typeof i?i:i.toISOString(),tag:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(n,"update dataset tags")}async deleteDataset({datasetId:t,datasetName:e}){let r="/datasets",i=t;if(void 0!==t&&void 0!==e)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e&&(i=(await this.readDataset({datasetName:e})).id),void 0!==i)I(i),r+=`/${i}`;else throw Error("Must provide datasetName or datasetId");let a=await this.caller.call(_(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(a,`delete ${r}`),await a.json()}async indexDataset({datasetId:t,datasetName:e,tag:r}){let i=t;if(i||e)if(i&&e)throw Error("Must provide either datasetName or datasetId, not both");else i||(i=(await this.readDataset({datasetName:e})).id);else throw Error("Must provide either datasetName or datasetId");I(i);let a=await this.caller.call(_(),`${this.apiUrl}/datasets/${i}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({tag:r}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(a,"index dataset"),await a.json()}async similarExamples(t,e,r,{filter:i}={}){let a={limit:r,inputs:t};void 0!==i&&(a.filter=i),I(e);let s=await this.caller.call(_(),`${this.apiUrl}/datasets/${e}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await P(s,"fetch similar examples"),(await s.json()).examples}async createExample(t,e,{datasetId:r,datasetName:i,createdAt:a,exampleId:s,metadata:n,split:o,sourceRunId:l}){let u=r;if(void 0===u&&void 0===i)throw Error("Must provide either datasetName or datasetId");if(void 0!==u&&void 0!==i)throw Error("Must provide either datasetName or datasetId, not both");void 0===u&&(u=(await this.readDataset({datasetName:i})).id);let h=a||new Date,c={dataset_id:u,inputs:t,outputs:e,created_at:h?.toISOString(),id:s,metadata:n,split:o,source_run_id:l},d=await this.caller.call(_(),`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await P(d,"create example"),await d.json()}async createExamples(t){let{inputs:e,outputs:r,metadata:i,sourceRunIds:a,exampleIds:s,datasetId:n,datasetName:o}=t,l=n;if(void 0===l&&void 0===o)throw Error("Must provide either datasetName or datasetId");if(void 0!==l&&void 0!==o)throw Error("Must provide either datasetName or datasetId, not both");void 0===l&&(l=(await this.readDataset({datasetName:o})).id);let u=e.map((e,n)=>({dataset_id:l,inputs:e,outputs:r?r[n]:void 0,metadata:i?i[n]:void 0,split:t.splits?t.splits[n]:void 0,id:s?s[n]:void 0,source_run_id:a?a[n]:void 0})),h=await this.caller.call(_(),`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await P(h,"create examples"),await h.json()}async createLLMExample(t,e,r){return this.createExample({input:t},{output:e},r)}async createChatExample(t,e,r){let i=t.map(t=>w(t)?E(t):t),a=w(e)?E(e):e;return this.createExample({input:i},{output:a},r)}async readExample(t){I(t);let e=`/examples/${t}`,{attachment_urls:r,...i}=await this._get(e);return r&&(i.attachments=Object.entries(r).reduce((t,[e,r])=>(t[e.slice(11)]={presigned_url:r.presigned_url,mime_type:r.mime_type},t),{})),i}async *listExamples({datasetId:t,datasetName:e,exampleIds:r,asOf:i,splits:a,inlineS3Urls:s,metadata:n,limit:o,offset:l,filter:u,includeAttachments:h}={}){let c;if(void 0!==t&&void 0!==e)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==t)c=t;else if(void 0!==e)c=(await this.readDataset({datasetName:e})).id;else throw Error("Must provide a datasetName or datasetId");let d=new URLSearchParams({dataset:c}),p=i?"string"==typeof i?i:i?.toISOString():void 0;if(p&&d.append("as_of",p),d.append("inline_s3_urls",(s??!0).toString()),void 0!==r)for(let t of r)d.append("id",t);if(void 0!==a)for(let t of a)d.append("splits",t);if(void 0!==n){let t=JSON.stringify(n);d.append("metadata",t)}void 0!==o&&d.append("limit",o.toString()),void 0!==l&&d.append("offset",l.toString()),void 0!==u&&d.append("filter",u),!0===h&&["attachment_urls","outputs","metadata"].forEach(t=>d.append("select",t));let m=0;for await(let t of this._getPaginated("/examples",d)){for(let e of t){let{attachment_urls:t,...r}=e;t&&(r.attachments=Object.entries(t).reduce((t,[e,r])=>(t[e.slice(11)]={presigned_url:r.presigned_url,mime_type:r.mime_type||void 0},t),{})),yield r,m++}if(void 0!==o&&m>=o)break}}async deleteExample(t){I(t);let e=`/examples/${t}`,r=await this.caller.call(_(),this.apiUrl+e,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(r,`delete ${e}`),await r.json()}async updateExample(t,e){I(t);let r=await this.caller.call(_(),`${this.apiUrl}/examples/${t}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await P(r,"update example"),await r.json()}async updateExamples(t){let e=await this.caller.call(_(),`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await P(e,"update examples"),await e.json()}async readDatasetVersion({datasetId:t,datasetName:e,asOf:r,tag:i}){let a;if(I(a=t||(await this.readDataset({datasetName:e})).id),r&&i||!r&&!i)throw Error("Exactly one of asOf and tag must be specified.");let s=new URLSearchParams;void 0!==r&&s.append("as_of","string"==typeof r?r:r.toISOString()),void 0!==i&&s.append("tag",i);let n=await this.caller.call(_(),`${this.apiUrl}/datasets/${a}/version?${s.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await P(n,"read dataset version"),await n.json()}async listDatasetSplits({datasetId:t,datasetName:e,asOf:r}){let i;if(void 0===t&&void 0===e)throw Error("Must provide dataset name or ID");if(void 0!==t&&void 0!==e)throw Error("Must provide either datasetName or datasetId, not both");I(i=void 0===t?(await this.readDataset({datasetName:e})).id:t);let a=new URLSearchParams,s=r?"string"==typeof r?r:r?.toISOString():void 0;return s&&a.append("as_of",s),await this._get(`/datasets/${i}/splits`,a)}async updateDatasetSplits({datasetId:t,datasetName:e,splitName:r,exampleIds:i,remove:a=!1}){let s;if(void 0===t&&void 0===e)throw Error("Must provide dataset name or ID");if(void 0!==t&&void 0!==e)throw Error("Must provide either datasetName or datasetId, not both");I(s=void 0===t?(await this.readDataset({datasetName:e})).id:t);let n={split_name:r,examples:i.map(t=>(I(t),t)),remove:a},o=await this.caller.call(_(),`${this.apiUrl}/datasets/${s}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(o,"update dataset splits",!0)}async evaluateRun(t,e,{sourceInfo:r,loadChildRuns:i,referenceExample:a}={loadChildRuns:!1}){let s;if(S("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead."),"string"==typeof t)s=await this.readRun(t,{loadChildRuns:i});else if("object"==typeof t&&"id"in t)s=t;else throw Error(`Invalid run type: ${typeof t}`);null!==s.reference_example_id&&void 0!==s.reference_example_id&&(a=await this.readExample(s.reference_example_id));let n=await e.evaluateRun(s,a),[o,l]=await this._logEvaluationFeedback(n,s,r);return l[0]}async createFeedback(t,e,{score:r,value:i,correction:a,comment:s,sourceInfo:n,feedbackSourceType:o="api",sourceRunId:l,feedbackId:u,feedbackConfig:h,projectId:c,comparativeExperimentId:p}){if(!t&&!c)throw Error("One of runId or projectId must be provided");if(t&&c)throw Error("Only one of runId or projectId can be provided");let m={type:o??"api",metadata:n??{}};void 0===l||m?.metadata===void 0||m.metadata.__run||(m.metadata.__run={run_id:l}),m?.metadata!==void 0&&m.metadata.__run?.run_id!==void 0&&I(m.metadata.__run.run_id);let f={id:u??d(),run_id:t,key:e,score:r,value:i,correction:a,comment:s,feedback_source:m,comparative_experiment_id:p,feedbackConfig:h,session_id:c},g=`${this.apiUrl}/feedback`,v=await this.caller.call(_(),g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await P(v,"create feedback",!0),f}async updateFeedback(t,{score:e,value:r,correction:i,comment:a}){let s={};null!=e&&(s.score=e),null!=r&&(s.value=r),null!=i&&(s.correction=i),null!=a&&(s.comment=a),I(t);let n=await this.caller.call(_(),`${this.apiUrl}/feedback/${t}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(n,"update feedback",!0)}async readFeedback(t){I(t);let e=`/feedback/${t}`;return await this._get(e)}async deleteFeedback(t){I(t);let e=`/feedback/${t}`,r=await this.caller.call(_(),this.apiUrl+e,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(r,`delete ${e}`),await r.json()}async *listFeedback({runIds:t,feedbackKeys:e,feedbackSourceTypes:r}={}){let i=new URLSearchParams;if(t&&i.append("run",t.join(",")),e)for(let t of e)i.append("key",t);if(r)for(let t of r)i.append("source",t);for await(let t of this._getPaginated("/feedback",i))yield*t}async createPresignedFeedbackToken(t,e,{expiration:r,feedbackConfig:i}={}){let a={run_id:t,feedback_key:e,feedback_config:i};r?"string"==typeof r?a.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(a.expires_in=r):a.expires_in={hours:3};let s=await this.caller.call(_(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await s.json()}async createComparativeExperiment({name:t,experimentIds:e,referenceDatasetId:r,createdAt:i,description:a,metadata:s,id:n}){if(0===e.length)throw Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:e[0]})).reference_dataset_id),null==!r)throw Error("A reference dataset is required");let o={id:n,name:t,experiment_ids:e,reference_dataset_id:r,description:a,created_at:(i??new Date)?.toISOString(),extra:{}};s&&(o.extra.metadata=s);let l=await this.caller.call(_(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await l.json()}async *listPresignedFeedbackTokens(t){I(t);let e=new URLSearchParams({run_id:t});for await(let t of this._getPaginated("/feedback/tokens",e))yield*t}_selectEvalResults(t){let e;return"results"in t?t.results:[t]}async _logEvaluationFeedback(t,e,r){let i=this._selectEvalResults(t),a=[];for(let t of i){let i=r||{};t.evaluatorInfo&&(i={...t.evaluatorInfo,...i});let s=null;t.targetRunId?s=t.targetRunId:e&&(s=e.id),a.push(await this.createFeedback(s,t.key,{score:t.score,value:t.value,comment:t.comment,correction:t.correction,sourceInfo:i,sourceRunId:t.sourceRunId,feedbackConfig:t.feedbackConfig,feedbackSourceType:"model"}))}return[i,a]}async logEvaluationFeedback(t,e,r){let[i]=await this._logEvaluationFeedback(t,e,r);return i}async *listAnnotationQueues(t={}){let{queueIds:e,name:r,nameContains:i,limit:a}=t,s=new URLSearchParams;e&&e.forEach((t,e)=>{I(t,`queueIds[${e}]`),s.append("ids",t)}),r&&s.append("name",r),i&&s.append("name_contains",i),s.append("limit",(void 0!==a?Math.min(a,100):100).toString());let n=0;for await(let t of this._getPaginated("/annotation-queues",s))if(yield*t,n++,void 0!==a&&n>=a)break}async createAnnotationQueue(t){let{name:e,description:r,queueId:i}=t,a={name:e,description:r,id:i||d()},s=await this.caller.call(_(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(a).filter(([t,e])=>void 0!==e))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await P(s,"create annotation queue"),await s.json()}async readAnnotationQueue(t){let e=await this.listAnnotationQueues({queueIds:[t]}).next();if(e.done)throw Error(`Annotation queue with ID ${t} not found`);return e.value}async updateAnnotationQueue(t,e){let{name:r,description:i}=e,a=await this.caller.call(_(),`${this.apiUrl}/annotation-queues/${I(t,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(a,"update annotation queue")}async deleteAnnotationQueue(t){let e=await this.caller.call(_(),`${this.apiUrl}/annotation-queues/${I(t,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(e,"delete annotation queue")}async addRunsToAnnotationQueue(t,e){let r=await this.caller.call(_(),`${this.apiUrl}/annotation-queues/${I(t,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e.map((t,e)=>I(t,`runIds[${e}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(t,e){let r=`/annotation-queues/${I(t,"queueId")}/run`,i=await this.caller.call(_(),`${this.apiUrl}${r}/${e}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await P(i,"get run from annotation queue"),await i.json()}async deleteRunFromAnnotationQueue(t,e){let r=await this.caller.call(_(),`${this.apiUrl}/annotation-queues/${I(t,"queueId")}/runs/${I(e,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(r,"delete run from annotation queue")}async getSizeFromAnnotationQueue(t){let e=await this.caller.call(_(),`${this.apiUrl}/annotation-queues/${I(t,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await P(e,"get size from annotation queue"),await e.json()}async _currentTenantIsOwner(t){let e=await this._getSettings();return"-"==t||e.tenant_handle===t}async _ownerConflictError(t,e){let r=await this._getSettings();return Error(`Cannot ${t} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${e}`)}async _getLatestCommitHash(t){let e=await this.caller.call(_(),`${this.apiUrl}/commits/${t}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await e.json();if(!e.ok){let t="string"==typeof r.detail?r.detail:JSON.stringify(r.detail),i=Error(`Error ${e.status}: ${e.statusText}
${t}`);throw i.statusCode=e.status,i}if(0!==r.commits.length)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(t,e){let[r,i,a]=T(t),s=await this.caller.call(_(),`${this.apiUrl}/likes/${r}/${i}`,{method:"POST",body:JSON.stringify({like:e}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await P(s,`${e?"like":"unlike"} prompt`),await s.json()}async _getPromptUrl(t){let[e,r,i]=T(t);if(await this._currentTenantIsOwner(e)){let t=await this._getSettings();return"latest"!==i?`${this.getHostUrl()}/prompts/${r}/${i.substring(0,8)}?organizationId=${t.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${t.id}`}return"latest"!==i?`${this.getHostUrl()}/hub/${e}/${r}/${i.substring(0,8)}`:`${this.getHostUrl()}/hub/${e}/${r}`}async promptExists(t){return!!await this.getPrompt(t)}async likePrompt(t){return this._likeOrUnlikePrompt(t,!0)}async unlikePrompt(t){return this._likeOrUnlikePrompt(t,!1)}async *listCommits(t){for await(let e of this._getPaginated(`/commits/${t}/`,new URLSearchParams,t=>t.commits))yield*e}async *listPrompts(t){let e=new URLSearchParams;for await(let r of(e.append("sort_field",t?.sortField??"updated_at"),e.append("sort_direction","desc"),e.append("is_archived",(!!t?.isArchived).toString()),t?.isPublic!==void 0&&e.append("is_public",t.isPublic.toString()),t?.query&&e.append("query",t.query),this._getPaginated("/repos",e,t=>t.repos)))yield*r}async getPrompt(t){let[e,r,i]=T(t),a=await this.caller.call(_(),`${this.apiUrl}/repos/${e}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(404===a.status)return null;await P(a,"get prompt");let s=await a.json();return s.repo?s.repo:null}async createPrompt(t,e){let r=await this._getSettings();if(e?.isPublic&&!r.tenant_handle)throw Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[i,a,s]=T(t);if(!await this._currentTenantIsOwner(i))throw await this._ownerConflictError("create a prompt",i);let n={repo_handle:a,...e?.description&&{description:e.description},...e?.readme&&{readme:e.readme},...e?.tags&&{tags:e.tags},is_public:!!e?.isPublic},o=await this.caller.call(_(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(o,"create prompt");let{repo:l}=await o.json();return l}async createCommit(t,e,r){if(!await this.promptExists(t))throw Error("Prompt does not exist, you must create it first.");let[i,a,s]=T(t),n=r?.parentCommitHash!=="latest"&&r?.parentCommitHash?r?.parentCommitHash:await this._getLatestCommitHash(`${i}/${a}`),o={manifest:JSON.parse(JSON.stringify(e)),parent_commit:n},l=await this.caller.call(_(),`${this.apiUrl}/commits/${i}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(l,"create commit");let u=await l.json();return this._getPromptUrl(`${i}/${a}${u.commit_hash?`:${u.commit_hash}`:""}`)}async updateExamplesMultipart(t,e=[]){if(!await this._getMultiPartSupport())throw Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");let r=new FormData;for(let t of e){let e=t.id,i=new Blob([L({...t.metadata&&{metadata:t.metadata},...t.split&&{split:t.split}})],{type:"application/json"});if(r.append(e,i),t.inputs){let i=new Blob([L(t.inputs)],{type:"application/json"});r.append(`${e}.inputs`,i)}if(t.outputs){let i=new Blob([L(t.outputs)],{type:"application/json"});r.append(`${e}.outputs`,i)}if(t.attachments)for(let[i,a]of Object.entries(t.attachments)){let t,s;Array.isArray(a)?[t,s]=a:(t=a.mimeType,s=a.data);let n=new Blob([s],{type:`${t}; length=${s.byteLength}`});r.append(`${e}.attachment.${i}`,n)}if(t.attachments_operations){let i=new Blob([L(t.attachments_operations)],{type:"application/json"});r.append(`${e}.attachments_operations`,i)}}let i=await this.caller.call(_(),`${this.apiUrl}/v1/platform/datasets/${t}/examples`,{method:"PATCH",headers:this.headers,body:r});return await i.json()}async uploadExamplesMultipart(t,e=[]){if(!await this._getMultiPartSupport())throw Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");let r=new FormData;for(let t of e){let e=(t.id??d()).toString(),i=new Blob([L({created_at:t.created_at,...t.metadata&&{metadata:t.metadata},...t.split&&{split:t.split}})],{type:"application/json"});r.append(e,i);let a=new Blob([L(t.inputs)],{type:"application/json"});if(r.append(`${e}.inputs`,a),t.outputs){let i=new Blob([L(t.outputs)],{type:"application/json"});r.append(`${e}.outputs`,i)}if(t.attachments)for(let[i,a]of Object.entries(t.attachments)){let t,s;Array.isArray(a)?[t,s]=a:(t=a.mimeType,s=a.data);let n=new Blob([s],{type:`${t}; length=${s.byteLength}`});r.append(`${e}.attachment.${i}`,n)}}let i=await this.caller.call(_(),`${this.apiUrl}/v1/platform/datasets/${t}/examples`,{method:"POST",headers:this.headers,body:r});return await i.json()}async updatePrompt(t,e){if(!await this.promptExists(t))throw Error("Prompt does not exist, you must create it first.");let[r,i]=T(t);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);let a={};if(e?.description!==void 0&&(a.description=e.description),e?.readme!==void 0&&(a.readme=e.readme),e?.tags!==void 0&&(a.tags=e.tags),e?.isPublic!==void 0&&(a.is_public=e.isPublic),e?.isArchived!==void 0&&(a.is_archived=e.isArchived),0===Object.keys(a).length)throw Error("No valid update options provided");let s=await this.caller.call(_(),`${this.apiUrl}/repos/${r}/${i}`,{method:"PATCH",body:JSON.stringify(a),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await P(s,"update prompt"),s.json()}async deletePrompt(t){if(!await this.promptExists(t))throw Error("Prompt does not exist, you must create it first.");let[e,r,i]=T(t);if(!await this._currentTenantIsOwner(e))throw await this._ownerConflictError("delete a prompt",e);let a=await this.caller.call(_(),`${this.apiUrl}/repos/${e}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await a.json()}async pullPromptCommit(t,e){let[r,i,a]=T(t),s=await this.caller.call(_(),`${this.apiUrl}/commits/${r}/${i}/${a}${e?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await P(s,"pull prompt commit");let n=await s.json();return{owner:r,repo:i,commit_hash:n.commit_hash,manifest:n.manifest,examples:n.examples}}async _pullPrompt(t,e){return JSON.stringify((await this.pullPromptCommit(t,{includeModel:e?.includeModel})).manifest)}async pushPrompt(t,e){return(await this.promptExists(t)?e&&Object.keys(e).some(t=>"object"!==t)&&await this.updatePrompt(t,{description:e?.description,readme:e?.readme,tags:e?.tags,isPublic:e?.isPublic}):await this.createPrompt(t,{description:e?.description,readme:e?.readme,tags:e?.tags,isPublic:e?.isPublic}),e?.object)?await this.createCommit(t,e?.object,{parentCommitHash:e?.parentCommitHash}):await this._getPromptUrl(t)}async clonePublicDataset(t,e={}){let{sourceApiUrl:r=this.apiUrl,datasetName:i}=e,[a,s]=this.parseTokenOrUrl(t,r),n=new q({apiUrl:a,apiKey:"placeholder"}),o=await n.readSharedDataset(s),l=i||o.name;try{if(await this.hasDataset({datasetId:l}))return void console.log(`Dataset ${l} already exists in your tenant. Skipping.`)}catch(t){}let u=await n.listSharedExamples(s),h=await this.createDataset(l,{description:o.description,dataType:o.data_type||"kv",inputsSchema:o.inputs_schema_definition??void 0,outputsSchema:o.outputs_schema_definition??void 0});try{await this.createExamples({inputs:u.map(t=>t.inputs),outputs:u.flatMap(t=>t.outputs?[t.outputs]:[]),datasetId:h.id})}catch(t){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),t}}parseTokenOrUrl(t,e,r=2,i="dataset"){try{return I(t),[e,t]}catch(t){}try{let a=new URL(t).pathname.split("/").filter(t=>""!==t);if(a.length>=r){let t=a[a.length-r];return[e,t]}throw Error(`Invalid public ${i} URL: ${t}`)}catch(e){throw Error(`Invalid public ${i} URL or token: ${t}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:t})=>t),this.batchIngestCaller.queue.onIdle()])}}let z="0.3.7";var J=r(73656);let X=()=>"undefined"!=typeof window&&void 0!==window.document,V=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,W=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Q=()=>"undefined"!=typeof Deno,Y=()=>void 0!==J&&void 0!==J.versions&&void 0!==J.versions.node&&!Q(),K=()=>i||(i=X()?"browser":Y()?"node":V()?"webworker":W()?"jsdom":Q()?"deno":"other");function Z(){return void 0===a&&(a={library:"langsmith",runtime:K(),sdk:"langsmith-js",sdk_version:z,...function(){if(void 0!==s)return s;let t={};for(let e of["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"]){let r=tt(e);void 0!==r&&(t[e]=r)}return s=t,t}()}),a}function tt(t){try{return void 0!==J?J.env?.[t]:void 0}catch(t){return}}function te(t){return tt(`LANGSMITH_${t}`)||tt(`LANGCHAIN_${t}`)}let tr=t=>void 0!==t?t:!!["TRACING_V2","TRACING"].find(t=>"true"===te(t)),ti=Symbol.for("lc:context_variables");class ta{constructor(t,e){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=t,this.tags=e}static fromHeader(t){let e=t.split(","),r={},i=[];for(let t of e){let[e,a]=t.split("="),s=decodeURIComponent(a);"langsmith-metadata"===e?r=JSON.parse(s):"langsmith-tags"===e&&(i=s.split(","))}return new ta(r,i)}toHeader(){let t=[];return this.metadata&&Object.keys(this.metadata).length>0&&t.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&t.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),t.join(",")}}class ts{constructor(t){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),tn(t))return void Object.assign(this,{...t});let e=ts.getDefaultConfig(),{metadata:r,...i}=t,a=i.client??ts.getSharedClient(),s={...r,...i?.extra?.metadata};if(i.extra={...i.extra,metadata:s},Object.assign(this,{...e,...i,client:a}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){let t=function(t,e,r=1){let i=r.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(t).toISOString().slice(0,-1)}${i}Z`.replace(/[-:.]/g,"")+e}(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+t:this.dotted_order=t}}static getDefaultConfig(){return{id:d(),run_type:"chain",project_name:te("PROJECT")??tt("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:tt("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:tt("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return ts.sharedClient||(ts.sharedClient=new q),ts.sharedClient}createChild(t){let e=this.child_execution_order+1,r=new ts({...t,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:e,child_execution_order:e});ti in this&&(r[ti]=this[ti]);let i=Symbol.for("lc:child_config"),a=t.extra?.[i]??this.extra[i];if(tu(a)){var s;let t={...a},e="object"==typeof(s=t.callbacks)&&null!=s&&Array.isArray(s.handlers)?t.callbacks.copy?.():void 0;e&&(Object.assign(e,{_parentRunId:r.id}),e.handlers?.find(to)?.updateFromRunTree?.(r),t.callbacks=e),r.extra[i]=t}let n=new Set,o=this;for(;null!=o&&!n.has(o.id);)n.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,e),o=o.parent_run;return this.child_runs.push(r),r}async end(t,e,r=Date.now(),i){this.outputs=this.outputs??t,this.error=this.error??e,this.end_time=this.end_time??r,i&&Object.keys(i).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...i}}:{metadata:i})}_convertToCreate(t,e,r=!0){let i,a,s=t.extra??{};if(s.runtime||(s.runtime={}),e)for(let[t,r]of Object.entries(e))s.runtime[t]||(s.runtime[t]=r);return r?(a=t.parent_run?.id,i=[]):(i=t.child_runs.map(t=>this._convertToCreate(t,e,r)),a=void 0),{id:t.id,name:t.name,start_time:t.start_time,end_time:t.end_time,run_type:t.run_type,reference_example_id:t.reference_example_id,extra:s,serialized:t.serialized,error:t.error,inputs:t.inputs,outputs:t.outputs,session_name:t.project_name,child_runs:i,parent_run_id:a,trace_id:t.trace_id,dotted_order:t.dotted_order,tags:t.tags,attachments:t.attachments}}async postRun(t=!0){try{let e=Z(),r=await this._convertToCreate(this,e,!0);if(await this.client.createRun(r),!t)for(let t of(S("Posting with excludeChildRuns=false is deprecated and will be removed in a future version."),this.child_runs))await t.postRun(!1)}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){try{let t={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments};await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(t,e){let r,i,a,s=t?.callbacks,n=tr();if(s){let t=s?.getParentRunId?.()??"",e=s?.handlers?.find(t=>t?.name=="langchain_tracer");r=e?.getRun?.(t),i=e?.projectName,a=e?.client,n=n||!!e}return r?new ts({name:r.name,id:r.id,trace_id:r.trace_id,dotted_order:r.dotted_order,client:a,tracingEnabled:n,project_name:i,tags:[...new Set((r?.tags??[]).concat(t?.tags??[]))],extra:{metadata:{...r?.extra?.metadata,...t?.metadata}}}).createChild(e):new ts({...e,client:a,tracingEnabled:n,project_name:i})}static fromDottedOrder(t){return this.fromHeaders({"langsmith-trace":t})}static fromHeaders(t,e){let r="get"in t&&"function"==typeof t.get?{"langsmith-trace":t.get("langsmith-trace"),baggage:t.get("baggage")}:t,i=r["langsmith-trace"];if(!i||"string"!=typeof i)return;let a=i.trim(),s=a.split(".").map(t=>{let[e,r]=t.split("Z");return{strTime:e,time:Date.parse(e+"Z"),uuid:r}}),n=s[0].uuid,o={...e,name:e?.name??"parent",run_type:e?.run_type??"chain",start_time:e?.start_time??Date.now(),id:s.at(-1)?.uuid,trace_id:n,dotted_order:a};if(r.baggage&&"string"==typeof r.baggage){let t=ta.fromHeader(r.baggage);o.metadata=t.metadata,o.tags=t.tags}return new ts(o)}toHeaders(t){let e={"langsmith-trace":this.dotted_order,baggage:new ta(this.extra?.metadata,this.tags).toHeader()};if(t)for(let[r,i]of Object.entries(e))t.set(r,i);return e}}function tn(t){return void 0!==t&&"function"==typeof t.createChild&&"function"==typeof t.postRun}function to(t){return"object"==typeof t&&null!=t&&"string"==typeof t.name&&"langchain_tracer"===t.name}function tl(t){return Array.isArray(t)&&t.some(t=>to(t))}function tu(t){return void 0!==t&&"object"==typeof t.callbacks&&(tl(t.callbacks?.handlers)||tl(t.callbacks))}Object.defineProperty(ts,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});let th=Symbol.for("ls:tracing_async_local_storage"),tc=new class{getStore(){}run(t,e){return e()}},td=new class{getInstance(){return globalThis[th]??tc}initializeGlobalInstance(t){void 0===globalThis[th]&&(globalThis[th]=t)}},tp=Symbol.for("langsmith:traceable:root");function tm(t){return"function"==typeof t&&"langsmith:traceable"in t}function tf(t){if("object"!=typeof t||null==t)return!1;let e=Object.getPrototypeOf(t);return(null===e||e===Object.prototype||null===Object.getPrototypeOf(e))&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}let tg=t=>null!=t&&"object"==typeof t&&"function"==typeof t[Symbol.asyncIterator],t_=t=>null!=t&&"object"==typeof t&&"next"in t&&"function"==typeof t.next,tv=(function*(){}).constructor,ty=t=>null!=t&&"function"==typeof t&&t instanceof tv,tb=t=>null!=t&&"object"==typeof t&&"then"in t&&"function"==typeof t.then,tw=t=>null!=t&&"object"==typeof t&&"getReader"in t&&"function"==typeof t.getReader;td.initializeGlobalInstance(new o.A);let tE=t=>{let e,r=t[0];return null==r?{}:t.length>1?{args:t}:tf(r)?r:{input:r}},t$=(t,e)=>{try{return e(t)}catch(e){return console.error("Error occurred during processInputs. Sending raw inputs:",e),t}},tI=(t,e)=>{let r;r=tf(t)?t:{outputs:t};try{return e(r)}catch(t){return console.error("Error occurred during processOutputs. Sending raw outputs:",t),r}},tO=(t,e)=>{if(!e)return[void 0,t];try{let[r,i]=e(...t);return[r,i]}catch(e){return console.error("Error occurred during extractAttachments:",e),[void 0,t]}},tS=(t,e,r,i,a)=>{if(!tr(t.tracingEnabled))return;let[s,n]=tO(e,a);t.attachments=s,t.inputs=t$(n,i);let o=r?.(...e);return null!=o&&(t.extra??={},t.extra.metadata={...o,...t.extra.metadata}),t},tT=t=>{let e={current:void 0};return new Proxy(t,{get(r,i,a){if("then"===i){let r=t[i].bind(t);return(t,i=t=>{throw t})=>r(r=>(e.current=["resolve",r],t(r)),t=>(e.current=["reject",t],i(t)))}if("catch"===i){let r=t[i].bind(t);return t=>r(r=>(e.current=["reject",r],t(r)))}return"toJSON"===i?()=>{if(!e.current)return;let[t,r]=e.current??[];return"resolve"===t?r:{error:r}}:Reflect.get(r,i,a)}})},tR=t=>{if(tw(t)){let e=[],r=new TransformStream({start:()=>void 0,transform:(t,r)=>{e.push(t),r.enqueue(t)},flush:()=>void 0}),i=t.pipeThrough(r);return Object.assign(i,{toJSON:()=>e}),i}if(tg(t)){let e={current:[]};return new Proxy(t,{get:(r,i,a)=>i===Symbol.asyncIterator?()=>{let r=t[Symbol.asyncIterator].bind(t)();return new Proxy(r,{get(t,i,a){if("next"===i||"return"===i||"throw"===i){let t=r.next.bind(r);return(...r)=>{let i=tT(t(...r));return e.current.push(i),i}}return"return"===i||"throw"===i?r.next.bind(r):Reflect.get(t,i,a)}})}:"toJSON"===i?()=>e.current.map(t=>t.toJSON()).reduce((t,e)=>(e?.value&&t.push(e.value),t),[]):Reflect.get(r,i,a)})}if(!Array.isArray(t)&&t_(t)){let e=[];return new Proxy(t,{get(r,i,a){if("next"===i||"return"===i||"throw"===i){let r=t[i]?.bind(t);return(...t)=>{let i=r?.(...t);return null!=i&&e.push(i),i}}return"toJSON"===i?()=>e.reduce((t,e)=>(e.value&&t.push(e.value),t),[]):Reflect.get(r,i,a)}})}return tb(t)?tT(t):t};function tP(t,e){let{aggregator:r,argsConfigPath:i,__finalTracedIteratorKey:a,processInputs:s,processOutputs:n,extractAttachments:l,...u}=e??{},h=s??(t=>t),c=n??(t=>t),d=l??((...t)=>[void 0,tE(t)]),p=(...s)=>{let n;try{let e;if(i){let[t,r]=i;if(t!==s.length-1||r){if(t<=s.length&&"object"==typeof s[t]&&null!==s[t])if(r){let{[r]:i,...a}=s[t];e=i,s[t]=a}else e=s[t],s.splice(t,1)}else e=s.pop()}n={name:t.name||"<lambda>",...u,...e,tags:[...new Set([...u?.tags??[],...e?.tags??[]])],metadata:{...u?.metadata,...e?.metadata}}}catch(e){console.warn(`Failed to extract runtime config from args for ${u?.name??t.name}`,e),n={name:t.name||"<lambda>",...u}}let l=td.getInstance();for(let t=0;t<s.length;t++)s[t]=tR(s[t]);let[p,m]=(()=>{let[t,...r]=s;if(tu(t))return[tS(ts.fromRunnableConfig(t,n),r,e?.getInvocationParams,h,d),r];if(tn(t)&&"callbackManager"in t&&null!=t.callbackManager)return[t,r];if(t===tp||tn(t)){let i=tS(t===tp?new ts(n):t.createChild(n),r,e?.getInvocationParams,h,d);return[i,[i,...r]]}let i=l.getStore();if(tn(i))return[tS(i.createChild(n),s,e?.getInvocationParams,h,d),s];let a=tS(new ts(n),s,e?.getInvocationParams,h,d);return void 0!==i&&ti in i&&(a[ti]=i[ti]),[a,s]})();return l.run(p,()=>{let i,s=p?.postRun();async function n(t){if(void 0!==r)try{return await r(t)}catch(t){console.error("[ERROR]: LangSmith aggregation failed: ",t)}return t}async function*l(t,e){let r=!1,i=[];try{for(;;){let{value:a,done:s}=await (e?e(()=>t.next()):t.next());if(s){r=!0;break}i.push(a),yield a}}catch(t){throw await p?.end(void 0,String(t)),t}finally{r||await p?.end(void 0,"Cancelled"),await p?.end(tI(await n(i),c)),await h()}}function u(t,e){if(tw(t)){let r=t.getReader(),i=!1,a=[];return new ReadableStream({async start(t){for(;;){let s=await (e?e(()=>r.read()):r.read());if(s.done){i=!0,await p?.end(tI(await n(a),c)),await h(),t.close();break}a.push(s.value),t.enqueue(s.value)}},cancel:async t=>(i||await p?.end(void 0,"Cancelled"),await p?.end(tI(await n(a),c)),await h(),r.cancel(t))})}let r=l(t[Symbol.asyncIterator](),e);return t[Symbol.asyncIterator]=()=>r,t}async function h(){let t=e?.on_end;t&&(p?t(p):console.warn("Can not call 'on_end' if currentRunTree is undefined")),await s,await p?.patchRun()}try{i=t(...m)}catch(t){i=Promise.reject(t)}if(tg(i)){let t=o.A.snapshot();return u(i,t)}if(!Array.isArray(i)&&"object"==typeof i&&null!=i&&void 0!==a&&tg(i[a])){let t=o.A.snapshot();return{...i,[a]:u(i[a],t)}}let d=new Promise((e,r)=>{Promise.resolve(i).then(async r=>{if(tg(r))return e(u(r,o.A.snapshot()));if(!Array.isArray(r)&&"object"==typeof r&&null!=r&&void 0!==a&&tg(r[a])){let t=o.A.snapshot();return{...r,[a]:u(r[a],t)}}if(ty(t)&&t_(r)){let t=function(t){let e=[];for(;;){let r=t.next();if(e.push(r),r.done)break}return e}(r);try{await p?.end(tI(await n(t.reduce((t,{value:e,done:r})=>(r&&void 0===e||t.push(e),t),[])),c)),await h()}catch(t){console.error("Error occurred during handleEnd:",t)}return function*(){for(let e of t){if(e.done)return e.value;yield e.value}}()}try{await p?.end(tI(r,c)),await h()}finally{return r}},async t=>{throw await p?.end(void 0,String(t)),await h(),t}).then(e,r)});return"object"!=typeof i||null===i?d:new Proxy(i,{get:(t,e,r)=>"then"===e||"catch"===e||"finally"===e?d[e].bind(d):Reflect.get(t,e,r)})})};return Object.defineProperty(p,"langsmith:traceable",{value:u}),p}let tA=t=>{if(!t||0===t.length)return{choices:[{message:{role:"assistant",content:""}}]};let e={};for(let r of t)for(let t of r.choices)void 0===e[t.index]&&(e[t.index]=[]),e[t.index].push(t);let r=t[t.length-1];return r.choices=Object.values(e).map(t=>(function(t){let e=t.slice().reverse(),r={role:"assistant",content:""};for(let t of e)if(t.delta.role){r.role=t.delta.role;break}let i={};for(let e of t)if(e.delta.content&&(r.content=r.content.concat(e.delta.content)),e.delta.function_call&&(r.function_call||(r.function_call={name:"",arguments:""}),e.delta.function_call.name&&(r.function_call.name+=e.delta.function_call.name),e.delta.function_call.arguments&&(r.function_call.arguments+=e.delta.function_call.arguments)),e.delta.tool_calls)for(let t of e.delta.tool_calls)i[e.index]||(i[e.index]=[]),i[e.index].push(t);if(Object.keys(i).length>0)for(let[t,e]of(r.tool_calls=[...Array(Object.keys(i).length)],Object.entries(i))){let i=parseInt(t);for(let t of(r.tool_calls[i]={index:i,id:e.find(t=>t.id)?.id||null,type:e.find(t=>t.type)?.type||null},e))t.function&&(r.tool_calls[i].function||(r.tool_calls[i].function={name:"",arguments:""}),t.function.name&&(r.tool_calls[i].function.name+=t.function.name),t.function.arguments&&(r.tool_calls[i].function.arguments+=t.function.arguments))}return{index:t[0].index,finish_reason:e.find(t=>t.finish_reason)||null,message:r}})(t)),r},tj=t=>{if(0===t.length)return{choices:[{text:""}]};let e=[];for(let r of t){let t=r.choices[0].text;null!=t&&e.push(t)}let r=e.join(""),i=t[t.length-1];return i.choices=[{...i.choices[0],text:r}],i};function tN(t){let e={...t},r=t.usage;if(r){let t={...r.prompt_tokens_details?.audio_tokens!==null&&{audio:r.prompt_tokens_details?.audio_tokens},...r.prompt_tokens_details?.cached_tokens!==null&&{cache_read:r.prompt_tokens_details?.cached_tokens}},i={...r.completion_tokens_details?.audio_tokens!==null&&{audio:r.completion_tokens_details?.audio_tokens},...r.completion_tokens_details?.reasoning_tokens!==null&&{reasoning:r.completion_tokens_details?.reasoning_tokens}};e.usage_metadata={input_tokens:r.prompt_tokens??0,output_tokens:r.completion_tokens??0,total_tokens:r.total_tokens??0,...Object.keys(t).length>0&&{input_token_details:t},...Object.keys(i).length>0&&{output_token_details:i}}}return delete e.usage,e}let tC=(t,e)=>{if(tm(t.chat.completions.create)||tm(t.completions.create))throw Error("This instance of OpenAI client has been already wrapped once.");let r={...t};return t.beta&&t.beta.chat&&t.beta.chat.completions&&"function"==typeof t.beta.chat.completions.parse&&(r.beta={...t.beta,chat:{...t.beta.chat,completions:{...t.beta.chat.completions,parse:tP(t.beta.chat.completions.parse.bind(t.beta.chat.completions),{name:"ChatOpenAI",run_type:"llm",aggregator:tA,argsConfigPath:[1,"langsmithExtra"],getInvocationParams:t=>{if("object"!=typeof t||null==t)return;let e=("string"==typeof t.stop?[t.stop]:t.stop)??void 0;return{ls_provider:"openai",ls_model_type:"chat",ls_model_name:t.model,ls_max_tokens:t.max_tokens??void 0,ls_temperature:t.temperature??void 0,ls_stop:e}},...e})}}}),r.chat={...t.chat,completions:{...t.chat.completions,create:tP(t.chat.completions.create.bind(t.chat.completions),{name:"ChatOpenAI",run_type:"llm",aggregator:tA,argsConfigPath:[1,"langsmithExtra"],getInvocationParams:t=>{if("object"!=typeof t||null==t)return;let e=("string"==typeof t.stop?[t.stop]:t.stop)??void 0;return{ls_provider:"openai",ls_model_type:"chat",ls_model_name:t.model,ls_max_tokens:t.max_tokens??void 0,ls_temperature:t.temperature??void 0,ls_stop:e}},processOutputs:tN,...e})}},r.completions={...t.completions,create:tP(t.completions.create.bind(t.completions),{name:"OpenAI",run_type:"llm",aggregator:tj,argsConfigPath:[1,"langsmithExtra"],getInvocationParams:t=>{if("object"!=typeof t||null==t)return;let e=("string"==typeof t.stop?[t.stop]:t.stop)??void 0;return{ls_provider:"openai",ls_model_type:"llm",ls_model_name:t.model,ls_max_tokens:t.max_tokens??void 0,ls_temperature:t.temperature??void 0,ls_stop:e}},...e})},r}}}]);
//# sourceMappingURL=659.82465281.js.map