{"version":3,"file":"chrome-extension\\page.js","sources":["webpack://@sqaitech/web/webpack/runtime/define_property_getters","webpack://@sqaitech/web/webpack/runtime/has_own_property","webpack://@sqaitech/web/webpack/runtime/make_namespace_object","webpack://@sqaitech/web/./src/chrome-extension/page.ts"],"sourcesContent":["__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n            Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n        }\n    }\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/// <reference types=\"chrome\" />\r\n\r\n/*\r\n  It is used to interact with the page tab from the chrome extension.\r\n  The page must be active when interacting with it.\r\n*/\r\n\r\nimport { limitOpenNewTabScript } from '@/web-element';\r\nimport type { ElementTreeNode, Point, Size, UIContext } from '@sqaitech/core';\r\nimport type { AbstractInterface, DeviceAction } from '@sqaitech/core/device';\r\nimport type { ElementInfo } from '@sqaitech/shared/extractor';\r\nimport { treeToList } from '@sqaitech/shared/extractor';\r\nimport { createImgBase64ByFormat } from '@sqaitech/shared/img';\r\nimport { assert } from '@sqaitech/shared/utils';\r\nimport type { Protocol as CDPTypes } from 'devtools-protocol';\r\nimport { WebPageContextParser } from '../web-element';\r\nimport {\r\n  type KeyInput,\r\n  type MouseButton,\r\n  commonWebActionsForWebPage,\r\n} from '../web-page';\r\nimport { CdpKeyboard } from './cdpInput';\r\nimport {\r\n  getHtmlElementScript,\r\n  injectStopWaterFlowAnimation,\r\n  injectWaterFlowAnimation,\r\n} from './dynamic-scripts';\r\n\r\nfunction sleep(ms: number) {\r\n  return new Promise((resolve) => setTimeout(resolve, ms));\r\n}\r\n\r\nexport default class ChromeExtensionProxyPage implements AbstractInterface {\r\n  interfaceType = 'chrome-extension-proxy';\r\n\r\n  public forceSameTabNavigation: boolean;\r\n\r\n  private viewportSize?: Size;\r\n\r\n  private activeTabId: number | null = null;\r\n\r\n  private tabIdOfDebuggerAttached: number | null = null;\r\n\r\n  private attachingDebugger: Promise<void> | null = null;\r\n\r\n  private destroyed = false;\r\n\r\n  private isMobileEmulation: boolean | null = null;\r\n\r\n  public _continueWhenFailedToAttachDebugger = false;\r\n\r\n  constructor(forceSameTabNavigation: boolean) {\r\n    this.forceSameTabNavigation = forceSameTabNavigation;\r\n  }\r\n\r\n  actionSpace(): DeviceAction[] {\r\n    return commonWebActionsForWebPage(this);\r\n  }\r\n\r\n  public async setActiveTabId(tabId: number) {\r\n    if (this.activeTabId) {\r\n      throw new Error(\r\n        `Active tab id is already set, which is ${this.activeTabId}, cannot set it to ${tabId}`,\r\n      );\r\n    }\r\n    await chrome.tabs.update(tabId, { active: true });\r\n    this.activeTabId = tabId;\r\n  }\r\n\r\n  public async getActiveTabId() {\r\n    return this.activeTabId;\r\n  }\r\n\r\n  /**\r\n   * Get a list of current tabs\r\n   * @returns {Promise<Array<{id: number, title: string, url: string}>>}\r\n   */\r\n  public async getBrowserTabList(): Promise<\r\n    { id: string; title: string; url: string; currentActiveTab: boolean }[]\r\n  > {\r\n    const tabs = await chrome.tabs.query({ currentWindow: true });\r\n    return tabs\r\n      .map((tab) => ({\r\n        id: `${tab.id}`,\r\n        title: tab.title,\r\n        url: tab.url,\r\n        currentActiveTab: tab.active,\r\n      }))\r\n      .filter((tab) => tab.id && tab.title && tab.url) as {\r\n      id: string;\r\n      title: string;\r\n      url: string;\r\n      currentActiveTab: boolean;\r\n    }[];\r\n  }\r\n\r\n  public async getTabIdOrConnectToCurrentTab() {\r\n    if (this.activeTabId) {\r\n      // alway keep on the connected tab\r\n      return this.activeTabId;\r\n    }\r\n    const tabId = await chrome.tabs\r\n      .query({ active: true, currentWindow: true })\r\n      .then((tabs) => tabs[0]?.id);\r\n    this.activeTabId = tabId || 0;\r\n    return this.activeTabId;\r\n  }\r\n\r\n  private async attachDebugger() {\r\n    assert(!this.destroyed, 'Page is destroyed');\r\n\r\n    // If already attaching, wait for it to complete\r\n    if (this.attachingDebugger) {\r\n      await this.attachingDebugger;\r\n      return;\r\n    }\r\n\r\n    // Create new attaching promise\r\n    this.attachingDebugger = (async () => {\r\n      const url = await this.url();\r\n      let error: Error | null = null;\r\n      if (url.startsWith('chrome://')) {\r\n        throw new Error(\r\n          'Cannot attach debugger to chrome:// pages, please use Midscene in a normal page with http://, https:// or file://',\r\n        );\r\n      }\r\n\r\n      try {\r\n        const currentTabId = await this.getTabIdOrConnectToCurrentTab();\r\n\r\n        if (this.tabIdOfDebuggerAttached === currentTabId) {\r\n          // already attached\r\n          return;\r\n        }\r\n        if (\r\n          this.tabIdOfDebuggerAttached &&\r\n          this.tabIdOfDebuggerAttached !== currentTabId\r\n        ) {\r\n          // detach the previous tab\r\n          console.log(\r\n            'detach the previous tab',\r\n            this.tabIdOfDebuggerAttached,\r\n            '->',\r\n            currentTabId,\r\n          );\r\n          try {\r\n            await this.detachDebugger(this.tabIdOfDebuggerAttached);\r\n          } catch (error) {\r\n            console.error('Failed to detach debugger', error);\r\n          }\r\n        }\r\n\r\n        // detach any debugger attached to the tab\r\n        console.log('attaching debugger', currentTabId);\r\n        try {\r\n          await chrome.debugger.attach({ tabId: currentTabId }, '1.3');\r\n        } catch (e) {\r\n          if (this._continueWhenFailedToAttachDebugger) {\r\n            console.warn(\r\n              'Failed to attach debugger, but the script will continue as if the debugger is attached since the _continueWhenFailedToAttachDebugger is true',\r\n              e,\r\n            );\r\n          } else {\r\n            throw e;\r\n          }\r\n        }\r\n\r\n        // wait util the debugger banner in Chrome appears\r\n        await sleep(500);\r\n\r\n        this.tabIdOfDebuggerAttached = currentTabId;\r\n\r\n        await this.enableWaterFlowAnimation();\r\n      } catch (e) {\r\n        console.error('Failed to attach debugger', e);\r\n        error = e as Error;\r\n      } finally {\r\n        this.attachingDebugger = null;\r\n      }\r\n      if (error) {\r\n        throw error;\r\n      }\r\n    })();\r\n\r\n    await this.attachingDebugger;\r\n  }\r\n\r\n  private async showMousePointer(x: number, y: number) {\r\n    // update mouse pointer while redirecting\r\n    const pointerScript = `(() => {\r\n      if(typeof window.midsceneWaterFlowAnimation !== 'undefined') {\r\n        window.midsceneWaterFlowAnimation.enable();\r\n        window.midsceneWaterFlowAnimation.showMousePointer(${x}, ${y});\r\n      } else {\r\n        console.log('midsceneWaterFlowAnimation is not defined');\r\n      }\r\n    })()`;\r\n\r\n    await this.sendCommandToDebugger('Runtime.evaluate', {\r\n      expression: `${pointerScript}`,\r\n    });\r\n  }\r\n\r\n  private async hideMousePointer() {\r\n    await this.sendCommandToDebugger('Runtime.evaluate', {\r\n      expression: `(() => {\r\n        if(typeof window.midsceneWaterFlowAnimation !== 'undefined') {\r\n          window.midsceneWaterFlowAnimation.hideMousePointer();\r\n        }\r\n      })()`,\r\n    });\r\n  }\r\n\r\n  private async detachDebugger(tabId?: number) {\r\n    const tabIdToDetach = tabId || this.tabIdOfDebuggerAttached;\r\n    console.log('detaching debugger', tabIdToDetach);\r\n    if (!tabIdToDetach) {\r\n      console.warn('No tab id to detach');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await this.disableWaterFlowAnimation(tabIdToDetach);\r\n      await sleep(200); // wait for the animation to stop\r\n    } catch (error) {\r\n      console.warn('Failed to disable water flow animation', error);\r\n    }\r\n\r\n    try {\r\n      await chrome.debugger.detach({ tabId: tabIdToDetach });\r\n    } catch (error) {\r\n      // maybe tab is closed ?\r\n      console.warn('Failed to detach debugger', error);\r\n    }\r\n    this.tabIdOfDebuggerAttached = null;\r\n  }\r\n\r\n  private async enableWaterFlowAnimation() {\r\n    // limit open page in new tab\r\n    if (this.forceSameTabNavigation) {\r\n      await chrome.debugger.sendCommand(\r\n        { tabId: this.tabIdOfDebuggerAttached! },\r\n        'Runtime.evaluate',\r\n        {\r\n          expression: limitOpenNewTabScript,\r\n        },\r\n      );\r\n    }\r\n\r\n    const script = await injectWaterFlowAnimation();\r\n    // we will call this function in sendCommandToDebugger, so we have to use the chrome.debugger.sendCommand\r\n    await chrome.debugger.sendCommand(\r\n      { tabId: this.tabIdOfDebuggerAttached! },\r\n      'Runtime.evaluate',\r\n      {\r\n        expression: script,\r\n      },\r\n    );\r\n  }\r\n\r\n  private async disableWaterFlowAnimation(tabId: number) {\r\n    const script = await injectStopWaterFlowAnimation();\r\n\r\n    await chrome.debugger.sendCommand({ tabId }, 'Runtime.evaluate', {\r\n      expression: script,\r\n    });\r\n  }\r\n\r\n  private async sendCommandToDebugger<ResponseType = any, RequestType = any>(\r\n    command: string,\r\n    params: RequestType,\r\n  ): Promise<ResponseType> {\r\n    await this.attachDebugger();\r\n\r\n    assert(this.tabIdOfDebuggerAttached, 'Debugger is not attached');\r\n\r\n    // wo don't have to await it\r\n    this.enableWaterFlowAnimation();\r\n    return (await chrome.debugger.sendCommand(\r\n      { tabId: this.tabIdOfDebuggerAttached! },\r\n      command,\r\n      params as any,\r\n    )) as ResponseType;\r\n  }\r\n\r\n  private async getPageContentByCDP() {\r\n    const script = await getHtmlElementScript();\r\n\r\n    // check tab url\r\n    await this.sendCommandToDebugger<\r\n      CDPTypes.Runtime.EvaluateResponse,\r\n      CDPTypes.Runtime.EvaluateRequest\r\n    >('Runtime.evaluate', {\r\n      expression: script,\r\n    });\r\n\r\n    const expression = () => {\r\n      (window as any).midscene_element_inspector.setNodeHashCacheListOnWindow();\r\n\r\n      const tree = (\r\n        window as any\r\n      ).midscene_element_inspector.webExtractNodeTree();\r\n\r\n      return {\r\n        tree,\r\n        size: {\r\n          width: document.documentElement.clientWidth,\r\n          height: document.documentElement.clientHeight,\r\n          dpr: window.devicePixelRatio,\r\n        },\r\n      };\r\n    };\r\n    const returnValue = await this.sendCommandToDebugger<\r\n      CDPTypes.Runtime.EvaluateResponse,\r\n      CDPTypes.Runtime.EvaluateRequest\r\n    >('Runtime.evaluate', {\r\n      expression: `(${expression.toString()})()`,\r\n      returnByValue: true,\r\n    });\r\n\r\n    if (!returnValue.result.value) {\r\n      const errorDescription =\r\n        returnValue.exceptionDetails?.exception?.description || '';\r\n      if (!errorDescription) {\r\n        console.error('returnValue from cdp', returnValue);\r\n      }\r\n      throw new Error(\r\n        `Failed to get page content from page, error: ${errorDescription}`,\r\n      );\r\n    }\r\n\r\n    return returnValue.result.value as {\r\n      tree: ElementTreeNode<ElementInfo>;\r\n      size: Size;\r\n    };\r\n  }\r\n\r\n  public async evaluateJavaScript(script: string) {\r\n    return this.sendCommandToDebugger('Runtime.evaluate', {\r\n      expression: script,\r\n    });\r\n  }\r\n\r\n  async beforeInvokeAction(): Promise<void> {\r\n    // current implementation is wait until domReadyState is complete\r\n    try {\r\n      await this.waitUntilNetworkIdle();\r\n    } catch (error) {\r\n      // console.warn('Failed to wait until network idle', error);\r\n    }\r\n  }\r\n\r\n  private async waitUntilNetworkIdle() {\r\n    const timeout = 10000;\r\n    const startTime = Date.now();\r\n    let lastReadyState = '';\r\n    while (Date.now() - startTime < timeout) {\r\n      const result = await this.sendCommandToDebugger('Runtime.evaluate', {\r\n        expression: 'document.readyState',\r\n      });\r\n      lastReadyState = result.result.value;\r\n      if (lastReadyState === 'complete') {\r\n        await new Promise((resolve) => setTimeout(resolve, 300));\r\n        return;\r\n      }\r\n      await new Promise((resolve) => setTimeout(resolve, 300));\r\n    }\r\n    throw new Error(\r\n      `Failed to wait until network idle, last readyState: ${lastReadyState}`,\r\n    );\r\n  }\r\n\r\n  // @deprecated\r\n  async getElementsInfo() {\r\n    const tree = await this.getElementsNodeTree();\r\n    return treeToList(tree);\r\n  }\r\n\r\n  async getXpathsById(id: string) {\r\n    const script = await getHtmlElementScript();\r\n\r\n    // check tab url\r\n    await this.sendCommandToDebugger<\r\n      CDPTypes.Runtime.EvaluateResponse,\r\n      CDPTypes.Runtime.EvaluateRequest\r\n    >('Runtime.evaluate', {\r\n      expression: script,\r\n    });\r\n\r\n    const result = await this.sendCommandToDebugger('Runtime.evaluate', {\r\n      expression: `window.midscene_element_inspector.getXpathsById(${JSON.stringify(id)})`,\r\n      returnByValue: true,\r\n    });\r\n    return result.result.value;\r\n  }\r\n\r\n  async getXpathsByPoint(point: Point, isOrderSensitive: boolean) {\r\n    const script = await getHtmlElementScript();\r\n\r\n    await this.sendCommandToDebugger<\r\n      CDPTypes.Runtime.EvaluateResponse,\r\n      CDPTypes.Runtime.EvaluateRequest\r\n    >('Runtime.evaluate', {\r\n      expression: script,\r\n    });\r\n\r\n    const result = await this.sendCommandToDebugger('Runtime.evaluate', {\r\n      expression: `window.midscene_element_inspector.getXpathsByPoint({left: ${point.left}, top: ${point.top}}, ${isOrderSensitive})`,\r\n      returnByValue: true,\r\n    });\r\n    return result.result.value;\r\n  }\r\n\r\n  async getElementInfoByXpath(xpath: string) {\r\n    const script = await getHtmlElementScript();\r\n\r\n    // check tab url\r\n    await this.sendCommandToDebugger<\r\n      CDPTypes.Runtime.EvaluateResponse,\r\n      CDPTypes.Runtime.EvaluateRequest\r\n    >('Runtime.evaluate', {\r\n      expression: script,\r\n    });\r\n    const result = await this.sendCommandToDebugger('Runtime.evaluate', {\r\n      expression: `window.midscene_element_inspector.getElementInfoByXpath(${JSON.stringify(xpath)})`,\r\n      returnByValue: true,\r\n    });\r\n    return result.result.value;\r\n  }\r\n\r\n  async getElementsNodeTree() {\r\n    await this.hideMousePointer();\r\n    const content = await this.getPageContentByCDP();\r\n    if (content?.size) {\r\n      this.viewportSize = content.size;\r\n    }\r\n\r\n    return content?.tree || { node: null, children: [] };\r\n  }\r\n\r\n  async getContext(): Promise<UIContext> {\r\n    return await WebPageContextParser(this, {});\r\n  }\r\n\r\n  async size() {\r\n    if (this.viewportSize) return this.viewportSize;\r\n    const content = await this.getPageContentByCDP();\r\n    return content.size;\r\n  }\r\n\r\n  async screenshotBase64() {\r\n    // screenshot by cdp\r\n    await this.hideMousePointer();\r\n    const format = 'jpeg';\r\n    const base64 = await this.sendCommandToDebugger('Page.captureScreenshot', {\r\n      format,\r\n      quality: 90,\r\n    });\r\n    return createImgBase64ByFormat(format, base64.data);\r\n  }\r\n\r\n  async url() {\r\n    const tabId = await this.getTabIdOrConnectToCurrentTab();\r\n    const url = await chrome.tabs.get(tabId).then((tab) => tab.url);\r\n    return url || '';\r\n  }\r\n\r\n  async scrollUntilTop(startingPoint?: Point) {\r\n    if (startingPoint) {\r\n      await this.mouse.move(startingPoint.left, startingPoint.top);\r\n    }\r\n    return this.mouse.wheel(0, -9999999);\r\n  }\r\n\r\n  async scrollUntilBottom(startingPoint?: Point) {\r\n    if (startingPoint) {\r\n      await this.mouse.move(startingPoint.left, startingPoint.top);\r\n    }\r\n    return this.mouse.wheel(0, 9999999);\r\n  }\r\n\r\n  async scrollUntilLeft(startingPoint?: Point) {\r\n    if (startingPoint) {\r\n      await this.mouse.move(startingPoint.left, startingPoint.top);\r\n    }\r\n    return this.mouse.wheel(-9999999, 0);\r\n  }\r\n\r\n  async scrollUntilRight(startingPoint?: Point) {\r\n    if (startingPoint) {\r\n      await this.mouse.move(startingPoint.left, startingPoint.top);\r\n    }\r\n    return this.mouse.wheel(9999999, 0);\r\n  }\r\n\r\n  async scrollUp(distance?: number, startingPoint?: Point) {\r\n    const { height } = await this.size();\r\n    const scrollDistance = distance || height * 0.7;\r\n    return this.mouse.wheel(\r\n      0,\r\n      -scrollDistance,\r\n      startingPoint?.left,\r\n      startingPoint?.top,\r\n    );\r\n  }\r\n\r\n  async scrollDown(distance?: number, startingPoint?: Point) {\r\n    const { height } = await this.size();\r\n    const scrollDistance = distance || height * 0.7;\r\n    return this.mouse.wheel(\r\n      0,\r\n      scrollDistance,\r\n      startingPoint?.left,\r\n      startingPoint?.top,\r\n    );\r\n  }\r\n\r\n  async scrollLeft(distance?: number, startingPoint?: Point) {\r\n    const { width } = await this.size();\r\n    const scrollDistance = distance || width * 0.7;\r\n    return this.mouse.wheel(\r\n      -scrollDistance,\r\n      0,\r\n      startingPoint?.left,\r\n      startingPoint?.top,\r\n    );\r\n  }\r\n\r\n  async scrollRight(distance?: number, startingPoint?: Point) {\r\n    const { width } = await this.size();\r\n    const scrollDistance = distance || width * 0.7;\r\n    return this.mouse.wheel(\r\n      scrollDistance,\r\n      0,\r\n      startingPoint?.left,\r\n      startingPoint?.top,\r\n    );\r\n  }\r\n\r\n  async clearInput(element: ElementInfo) {\r\n    if (!element) {\r\n      console.warn('No element to clear input');\r\n      return;\r\n    }\r\n\r\n    await this.mouse.click(element.center[0], element.center[1]);\r\n\r\n    await this.sendCommandToDebugger('Input.dispatchKeyEvent', {\r\n      type: 'keyDown',\r\n      commands: ['selectAll'],\r\n    });\r\n\r\n    await this.sendCommandToDebugger('Input.dispatchKeyEvent', {\r\n      type: 'keyUp',\r\n      commands: ['selectAll'],\r\n    });\r\n\r\n    await sleep(100);\r\n\r\n    await this.keyboard.press({\r\n      key: 'Backspace',\r\n    });\r\n  }\r\n\r\n  private latestMouseX = 100;\r\n  private latestMouseY = 100;\r\n\r\n  mouse = {\r\n    click: async (\r\n      x: number,\r\n      y: number,\r\n      options?: { button?: MouseButton; count?: number },\r\n    ) => {\r\n      const { button = 'left', count = 1 } = options || {};\r\n      await this.mouse.move(x, y);\r\n      // detect if the page is in mobile emulation mode\r\n      if (this.isMobileEmulation === null) {\r\n        const result = await this.sendCommandToDebugger('Runtime.evaluate', {\r\n          expression: `(() => {\r\n            return /Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent);\r\n          })()`,\r\n          returnByValue: true,\r\n        });\r\n        this.isMobileEmulation = result?.result?.value;\r\n      }\r\n\r\n      if (this.isMobileEmulation && button === 'left') {\r\n        // in mobile emulation mode, directly inject click event\r\n        const touchPoints = [{ x: Math.round(x), y: Math.round(y) }];\r\n        await this.sendCommandToDebugger('Input.dispatchTouchEvent', {\r\n          type: 'touchStart',\r\n          touchPoints,\r\n          modifiers: 0,\r\n        });\r\n\r\n        await this.sendCommandToDebugger('Input.dispatchTouchEvent', {\r\n          type: 'touchEnd',\r\n          touchPoints: [],\r\n          modifiers: 0,\r\n        });\r\n      } else {\r\n        // standard mousePressed + mouseReleased\r\n        for (let i = 0; i < count; i++) {\r\n          await this.sendCommandToDebugger('Input.dispatchMouseEvent', {\r\n            type: 'mousePressed',\r\n            x,\r\n            y,\r\n            button,\r\n            clickCount: 1,\r\n          });\r\n          await this.sendCommandToDebugger('Input.dispatchMouseEvent', {\r\n            type: 'mouseReleased',\r\n            x,\r\n            y,\r\n            button,\r\n            clickCount: 1,\r\n          });\r\n          await sleep(50);\r\n        }\r\n      }\r\n    },\r\n    wheel: async (\r\n      deltaX: number,\r\n      deltaY: number,\r\n      startX?: number,\r\n      startY?: number,\r\n    ) => {\r\n      const finalX = startX || this.latestMouseX;\r\n      const finalY = startY || this.latestMouseY;\r\n      await this.showMousePointer(finalX, finalY);\r\n      await this.sendCommandToDebugger('Input.dispatchMouseEvent', {\r\n        type: 'mouseWheel',\r\n        x: finalX,\r\n        y: finalY,\r\n        deltaX,\r\n        deltaY,\r\n      });\r\n      this.latestMouseX = finalX;\r\n      this.latestMouseY = finalY;\r\n    },\r\n    move: async (x: number, y: number) => {\r\n      await this.showMousePointer(x, y);\r\n      await this.sendCommandToDebugger('Input.dispatchMouseEvent', {\r\n        type: 'mouseMoved',\r\n        x,\r\n        y,\r\n      });\r\n      this.latestMouseX = x;\r\n      this.latestMouseY = y;\r\n    },\r\n    drag: async (\r\n      from: { x: number; y: number },\r\n      to: { x: number; y: number },\r\n    ) => {\r\n      await this.mouse.move(from.x, from.y);\r\n\r\n      await sleep(200);\r\n      await this.sendCommandToDebugger('Input.dispatchMouseEvent', {\r\n        type: 'mousePressed',\r\n        x: from.x,\r\n        y: from.y,\r\n        button: 'left',\r\n        clickCount: 1,\r\n      });\r\n\r\n      await sleep(300);\r\n\r\n      await this.sendCommandToDebugger('Input.dispatchMouseEvent', {\r\n        type: 'mouseMoved',\r\n        x: to.x,\r\n        y: to.y,\r\n      });\r\n\r\n      await sleep(500);\r\n\r\n      await this.sendCommandToDebugger('Input.dispatchMouseEvent', {\r\n        type: 'mouseReleased',\r\n        x: to.x,\r\n        y: to.y,\r\n        button: 'left',\r\n        clickCount: 1,\r\n      });\r\n\r\n      await sleep(200);\r\n\r\n      await this.mouse.move(to.x, to.y);\r\n    },\r\n  };\r\n\r\n  keyboard = {\r\n    type: async (text: string) => {\r\n      const cdpKeyboard = new CdpKeyboard({\r\n        send: this.sendCommandToDebugger.bind(this),\r\n      });\r\n      await cdpKeyboard.type(text, { delay: 0 });\r\n    },\r\n    press: async (\r\n      action:\r\n        | { key: KeyInput; command?: string }\r\n        | { key: KeyInput; command?: string }[],\r\n    ) => {\r\n      const cdpKeyboard = new CdpKeyboard({\r\n        send: this.sendCommandToDebugger.bind(this),\r\n      });\r\n      const keys = Array.isArray(action) ? action : [action];\r\n      for (const k of keys) {\r\n        const commands = k.command ? [k.command] : [];\r\n        await cdpKeyboard.down(k.key, { commands });\r\n      }\r\n      for (const k of [...keys].reverse()) {\r\n        await cdpKeyboard.up(k.key);\r\n      }\r\n    },\r\n  };\r\n\r\n  async destroy(): Promise<void> {\r\n    this.activeTabId = null;\r\n    await this.detachDebugger();\r\n    this.destroyed = true;\r\n  }\r\n\r\n  async longPress(x: number, y: number, duration?: number) {\r\n    duration = duration || 500;\r\n    const LONG_PRESS_THRESHOLD = 600;\r\n    const MIN_PRESS_THRESHOLD = 300;\r\n    if (duration > LONG_PRESS_THRESHOLD) {\r\n      duration = LONG_PRESS_THRESHOLD;\r\n    }\r\n    if (duration < MIN_PRESS_THRESHOLD) {\r\n      duration = MIN_PRESS_THRESHOLD;\r\n    }\r\n    await this.mouse.move(x, y);\r\n\r\n    if (this.isMobileEmulation === null) {\r\n      const result = await this.sendCommandToDebugger('Runtime.evaluate', {\r\n        expression: `(() => {\r\n          return /Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent);\r\n        })()`,\r\n        returnByValue: true,\r\n      });\r\n      this.isMobileEmulation = result?.result?.value;\r\n    }\r\n\r\n    if (this.isMobileEmulation) {\r\n      const touchPoints = [{ x: Math.round(x), y: Math.round(y) }];\r\n      await this.sendCommandToDebugger('Input.dispatchTouchEvent', {\r\n        type: 'touchStart',\r\n        touchPoints,\r\n        modifiers: 0,\r\n      });\r\n      await new Promise((res) => setTimeout(res, duration));\r\n      await this.sendCommandToDebugger('Input.dispatchTouchEvent', {\r\n        type: 'touchEnd',\r\n        touchPoints: [],\r\n        modifiers: 0,\r\n      });\r\n    } else {\r\n      await this.sendCommandToDebugger('Input.dispatchMouseEvent', {\r\n        type: 'mousePressed',\r\n        x,\r\n        y,\r\n        button: 'left',\r\n        clickCount: 1,\r\n      });\r\n      await new Promise((res) => setTimeout(res, duration));\r\n      await this.sendCommandToDebugger('Input.dispatchMouseEvent', {\r\n        type: 'mouseReleased',\r\n        x,\r\n        y,\r\n        button: 'left',\r\n        clickCount: 1,\r\n      });\r\n    }\r\n    this.latestMouseX = x;\r\n    this.latestMouseY = y;\r\n  }\r\n\r\n  async swipe(\r\n    from: { x: number; y: number },\r\n    to: { x: number; y: number },\r\n    duration?: number,\r\n  ) {\r\n    const LONG_PRESS_THRESHOLD = 500;\r\n    const MIN_PRESS_THRESHOLD = 150;\r\n    duration = duration || 300;\r\n    if (duration < MIN_PRESS_THRESHOLD) {\r\n      duration = MIN_PRESS_THRESHOLD;\r\n    }\r\n    if (duration > LONG_PRESS_THRESHOLD) {\r\n      duration = LONG_PRESS_THRESHOLD;\r\n    }\r\n\r\n    if (this.isMobileEmulation === null) {\r\n      const result = await this.sendCommandToDebugger('Runtime.evaluate', {\r\n        expression: `(() => {\r\n          return /Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent);\r\n        })()`,\r\n        returnByValue: true,\r\n      });\r\n      this.isMobileEmulation = result?.result?.value;\r\n    }\r\n\r\n    const steps = 30;\r\n    const delay = duration / steps;\r\n\r\n    if (this.isMobileEmulation) {\r\n      await this.sendCommandToDebugger('Input.dispatchTouchEvent', {\r\n        type: 'touchStart',\r\n        touchPoints: [{ x: Math.round(from.x), y: Math.round(from.y) }],\r\n        modifiers: 0,\r\n      });\r\n\r\n      for (let i = 1; i <= steps; i++) {\r\n        const x = from.x + (to.x - from.x) * (i / steps);\r\n        const y = from.y + (to.y - from.y) * (i / steps);\r\n        await this.sendCommandToDebugger('Input.dispatchTouchEvent', {\r\n          type: 'touchMove',\r\n          touchPoints: [{ x: Math.round(x), y: Math.round(y) }],\r\n          modifiers: 0,\r\n        });\r\n        await new Promise((res) => setTimeout(res, delay));\r\n      }\r\n\r\n      await this.sendCommandToDebugger('Input.dispatchTouchEvent', {\r\n        type: 'touchEnd',\r\n        touchPoints: [],\r\n        modifiers: 0,\r\n      });\r\n    } else {\r\n      await this.mouse.move(from.x, from.y);\r\n      await this.sendCommandToDebugger('Input.dispatchMouseEvent', {\r\n        type: 'mousePressed',\r\n        x: from.x,\r\n        y: from.y,\r\n        button: 'left',\r\n        clickCount: 1,\r\n      });\r\n\r\n      for (let i = 1; i <= steps; i++) {\r\n        const x = from.x + (to.x - from.x) * (i / steps);\r\n        const y = from.y + (to.y - from.y) * (i / steps);\r\n        await this.mouse.move(x, y);\r\n        await new Promise((res) => setTimeout(res, delay));\r\n      }\r\n\r\n      await this.sendCommandToDebugger('Input.dispatchMouseEvent', {\r\n        type: 'mouseReleased',\r\n        x: to.x,\r\n        y: to.y,\r\n        button: 'left',\r\n        clickCount: 1,\r\n      });\r\n    }\r\n\r\n    this.latestMouseX = to.x;\r\n    this.latestMouseY = to.y;\r\n  }\r\n}\r\n"],"names":["__webpack_require__","definition","key","Object","obj","prop","Symbol","sleep","ms","Promise","resolve","setTimeout","ChromeExtensionProxyPage","commonWebActionsForWebPage","tabId","Error","chrome","tabs","tab","_tabs_","assert","url","error","currentTabId","console","e","x","y","pointerScript","tabIdToDetach","limitOpenNewTabScript","script","injectWaterFlowAnimation","injectStopWaterFlowAnimation","command","params","getHtmlElementScript","expression","window","tree","document","returnValue","_returnValue_exceptionDetails_exception","errorDescription","timeout","startTime","Date","lastReadyState","result","treeToList","id","JSON","point","isOrderSensitive","xpath","content","WebPageContextParser","format","base64","createImgBase64ByFormat","startingPoint","distance","height","scrollDistance","width","element","duration","LONG_PRESS_THRESHOLD","MIN_PRESS_THRESHOLD","_result_result","touchPoints","Math","res","from","to","steps","delay","i","forceSameTabNavigation","options","button","count","deltaX","deltaY","startX","startY","finalX","finalY","text","cdpKeyboard","CdpKeyboard","action","keys","Array","k","commands"],"mappings":"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"}