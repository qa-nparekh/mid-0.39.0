{"version":3,"file":"chrome-extension\\cdpInput.js","sources":["webpack://@sqai/web/webpack/runtime/define_property_getters","webpack://@sqai/web/webpack/runtime/has_own_property","webpack://@sqai/web/webpack/runtime/make_namespace_object","webpack://@sqai/web/./src/chrome-extension/cdpInput.ts"],"sourcesContent":["__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n            Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n        }\n    }\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// From https://github.com/puppeteer/puppeteer/blob/15abcc390862fd08cc3475532f2d9a11284aee6b/packages/puppeteer-core/src/cdp/Input.ts#L55\r\n// with some modifications to fit the session type\r\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {\r\n  type KeyDefinition,\r\n  type KeyInput,\r\n  _keyDefinitions,\r\n} from '@sqai/shared/us-keyboard-layout';\r\nimport { assert } from '@sqai/shared/utils';\r\n\r\ntype KeyDescription = Required<\r\n  Pick<KeyDefinition, 'keyCode' | 'key' | 'text' | 'code' | 'location'>\r\n>;\r\n\r\n/**\r\n * @public\r\n */\r\nexport interface KeyDownOptions {\r\n  /**\r\n   * @deprecated Do not use. This is automatically handled.\r\n   */\r\n  text?: string;\r\n  /**\r\n   * @deprecated Do not use. This is automatically handled.\r\n   */\r\n  commands?: string[];\r\n}\r\n\r\n/**\r\n * @public\r\n */\r\nexport interface KeyboardTypeOptions {\r\n  /**\r\n   * Time to wait between key presses in milliseconds\r\n   * @default undefined\r\n   */\r\n  delay?: number;\r\n}\r\n\r\n/**\r\n * @public\r\n */\r\nexport type KeyPressOptions = KeyDownOptions & KeyboardTypeOptions;\r\n\r\ntype InternalCDPSession = {\r\n  send: (command: string, params: any) => Promise<void>;\r\n};\r\n\r\n/**\r\n * @internal\r\n */\r\nexport class CdpKeyboard {\r\n  #pressedKeys = new Set<string>();\r\n\r\n  #client: InternalCDPSession;\r\n\r\n  _modifiers = 0;\r\n\r\n  constructor(client: InternalCDPSession) {\r\n    this.#client = client;\r\n  }\r\n\r\n  updateClient(client: InternalCDPSession): void {\r\n    this.#client = client;\r\n  }\r\n\r\n  async down(\r\n    key: KeyInput,\r\n    options: Readonly<KeyDownOptions> = {\r\n      text: undefined,\r\n      commands: [],\r\n    },\r\n  ): Promise<void> {\r\n    const description = this.#keyDescriptionForString(key);\r\n\r\n    const autoRepeat = this.#pressedKeys.has(description.code);\r\n    this.#pressedKeys.add(description.code);\r\n    this._modifiers |= this.#modifierBit(description.key);\r\n\r\n    const text = options.text === undefined ? description.text : options.text;\r\n    await this.#client.send('Input.dispatchKeyEvent', {\r\n      type: text ? 'keyDown' : 'rawKeyDown',\r\n      modifiers: this._modifiers,\r\n      windowsVirtualKeyCode: description.keyCode,\r\n      code: description.code,\r\n      key: description.key,\r\n      text: text,\r\n      unmodifiedText: text,\r\n      autoRepeat,\r\n      location: description.location,\r\n      isKeypad: description.location === 3,\r\n      commands: options.commands,\r\n    });\r\n  }\r\n\r\n  #modifierBit(key: string): number {\r\n    if (key === 'Alt') {\r\n      return 1;\r\n    }\r\n    if (key === 'Control') {\r\n      return 2;\r\n    }\r\n    if (key === 'Meta') {\r\n      return 4;\r\n    }\r\n    if (key === 'Shift') {\r\n      return 8;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  #keyDescriptionForString(keyString: KeyInput): KeyDescription {\r\n    const shift = this._modifiers & 8;\r\n    const description = {\r\n      key: '',\r\n      keyCode: 0,\r\n      code: '',\r\n      text: '',\r\n      location: 0,\r\n    };\r\n\r\n    const definition = _keyDefinitions[keyString];\r\n\r\n    assert(definition, `Unknown key: \"${keyString}\"`);\r\n\r\n    if (definition.key) {\r\n      description.key = definition.key;\r\n    }\r\n    if (shift && definition.shiftKey) {\r\n      description.key = definition.shiftKey;\r\n    }\r\n\r\n    if (definition.keyCode) {\r\n      description.keyCode = definition.keyCode;\r\n    }\r\n    if (shift && definition.shiftKeyCode) {\r\n      description.keyCode = definition.shiftKeyCode;\r\n    }\r\n\r\n    if (definition.code) {\r\n      description.code = definition.code;\r\n    }\r\n\r\n    if (definition.location) {\r\n      description.location = definition.location;\r\n    }\r\n\r\n    if (description.key.length === 1) {\r\n      description.text = description.key;\r\n    }\r\n\r\n    if (definition.text) {\r\n      description.text = definition.text;\r\n    }\r\n    if (shift && definition.shiftText) {\r\n      description.text = definition.shiftText;\r\n    }\r\n\r\n    // if any modifiers besides shift are pressed, no text should be sent\r\n    if (this._modifiers & ~8) {\r\n      description.text = '';\r\n    }\r\n\r\n    return description;\r\n  }\r\n\r\n  async up(key: KeyInput): Promise<void> {\r\n    const description = this.#keyDescriptionForString(key);\r\n\r\n    this._modifiers &= ~this.#modifierBit(description.key);\r\n    this.#pressedKeys.delete(description.code);\r\n    await this.#client.send('Input.dispatchKeyEvent', {\r\n      type: 'keyUp',\r\n      modifiers: this._modifiers,\r\n      key: description.key,\r\n      windowsVirtualKeyCode: description.keyCode,\r\n      code: description.code,\r\n      location: description.location,\r\n    });\r\n  }\r\n\r\n  async sendCharacter(char: string): Promise<void> {\r\n    await this.#client.send('Input.insertText', { text: char });\r\n  }\r\n\r\n  private charIsKey(char: string): char is KeyInput {\r\n    return !!_keyDefinitions[char as KeyInput];\r\n  }\r\n\r\n  async type(\r\n    text: string,\r\n    options: Readonly<KeyboardTypeOptions> = {},\r\n  ): Promise<void> {\r\n    const delay = options.delay || undefined;\r\n    for (const char of text) {\r\n      if (this.charIsKey(char)) {\r\n        await this.press(char, { delay });\r\n      } else {\r\n        if (delay) {\r\n          await new Promise((f) => {\r\n            return setTimeout(f, delay);\r\n          });\r\n        }\r\n        await this.sendCharacter(char);\r\n      }\r\n    }\r\n  }\r\n\r\n  async press(\r\n    key: KeyInput | KeyInput[],\r\n    options: Readonly<KeyPressOptions> = {},\r\n  ): Promise<void> {\r\n    const { delay = null } = options;\r\n    const keys = Array.isArray(key) ? key : [key];\r\n\r\n    for (const k of keys) {\r\n      await this.down(k, options);\r\n    }\r\n\r\n    if (delay) {\r\n      await new Promise((f) => {\r\n        return setTimeout(f, options.delay);\r\n      });\r\n    }\r\n\r\n    for (const k of [...keys].reverse()) {\r\n      await this.up(k);\r\n    }\r\n  }\r\n}\r\n"],"names":["__webpack_require__","definition","key","Object","obj","prop","Symbol","_pressedKeys","_client","modifierBit","keyDescriptionForString","CdpKeyboard","client","options","undefined","description","autoRepeat","text","char","_keyDefinitions","delay","Promise","f","setTimeout","keys","Array","k","Set","keyString","shift","assert"],"mappings":"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"}