{"version":3,"file":"utils.mjs","sources":["webpack://@sqaitech/core/./src/utils.ts"],"sourcesContent":["import { execSync } from 'node:child_process';\r\nimport * as fs from 'node:fs';\r\nimport { existsSync, mkdirSync, readFileSync, writeFileSync } from 'node:fs';\r\nimport { tmpdir } from 'node:os';\r\nimport * as path from 'node:path';\r\nimport {\r\n  defaultRunDirName,\r\n  getMidsceneRunSubDir,\r\n} from '@sqaitech/shared/common';\r\nimport {\r\n  SQAI_CACHE,\r\n  SQAI_DEBUG_MODE,\r\n  globalConfigManager,\r\n} from '@sqaitech/shared/env';\r\nimport { getRunningPkgInfo } from '@sqaitech/shared/node';\r\nimport { assert, logMsg } from '@sqaitech/shared/utils';\r\nimport {\r\n  escapeScriptTag,\r\n  ifInBrowser,\r\n  ifInWorker,\r\n  uuid,\r\n} from '@sqaitech/shared/utils';\r\nimport type { Cache, Rect, ReportDumpWithAttributes } from './types';\r\n\r\nlet logEnvReady = false;\r\n\r\nexport { appendFileSync } from 'node:fs';\r\n\r\nexport const groupedActionDumpFileExt = 'web-dump.json';\r\n\r\n/**\r\n * Process cache configuration with environment variable support and backward compatibility.\r\n *\r\n * @param cache - The original cache configuration\r\n * @param cacheId - The cache ID to use as:\r\n *   1. Fallback ID when cache is true or cache object has no ID\r\n *   2. Legacy cacheId when cache is undefined (requires SQAI_CACHE env var)\r\n * @returns Processed cache configuration\r\n */\r\nexport function processCacheConfig(\r\n  cache: Cache | undefined,\r\n  cacheId: string,\r\n): Cache | undefined {\r\n  // 1. New cache object configuration (highest priority)\r\n  if (cache !== undefined) {\r\n    if (cache === false) {\r\n      return undefined; // Completely disable cache\r\n    }\r\n\r\n    if (cache === true) {\r\n      // Auto-generate ID using cacheId for CLI/YAML scenarios\r\n      // Agent will validate and reject this later if needed\r\n      return { id: cacheId };\r\n    }\r\n\r\n    // cache is object configuration\r\n    if (typeof cache === 'object' && cache !== null) {\r\n      // Auto-generate ID using cacheId when missing (for CLI/YAML scenarios)\r\n      if (!cache.id) {\r\n        return { ...cache, id: cacheId };\r\n      }\r\n      return cache;\r\n    }\r\n  }\r\n\r\n  // 2. Backward compatibility: support old cacheId (requires environment variable)\r\n  // When cache is undefined, check if legacy cacheId mode is enabled via env var\r\n  const envEnabled = globalConfigManager.getEnvConfigInBoolean(SQAI_CACHE);\r\n\r\n  if (envEnabled && cacheId) {\r\n    return { id: cacheId };\r\n  }\r\n\r\n  // 3. No cache configuration\r\n  return undefined;\r\n}\r\n\r\nconst reportInitializedMap = new Map<string, boolean>();\r\n\r\ndeclare const __DEV_REPORT_PATH__: string;\r\n\r\nexport function getReportTpl() {\r\n  if (typeof __DEV_REPORT_PATH__ === 'string' && __DEV_REPORT_PATH__) {\r\n    return fs.readFileSync(__DEV_REPORT_PATH__, 'utf-8');\r\n  }\r\n  const reportTpl = 'REPLACE_ME_WITH_REPORT_HTML';\r\n\r\n  return reportTpl;\r\n}\r\n\r\n/**\r\n * high performance, insert script before </html> in HTML file\r\n * only truncate and append, no temporary file\r\n */\r\nexport function insertScriptBeforeClosingHtml(\r\n  filePath: string,\r\n  scriptContent: string,\r\n): void {\r\n  const htmlEndTag = '</html>';\r\n  const stat = fs.statSync(filePath);\r\n\r\n  const readSize = Math.min(stat.size, 4096);\r\n  const start = Math.max(0, stat.size - readSize);\r\n  const buffer = Buffer.alloc(stat.size - start);\r\n  const fd = fs.openSync(filePath, 'r');\r\n  fs.readSync(fd, buffer, 0, buffer.length, start);\r\n  fs.closeSync(fd);\r\n\r\n  const tailStr = buffer.toString('utf8');\r\n  const htmlEndIdx = tailStr.lastIndexOf(htmlEndTag);\r\n  if (htmlEndIdx === -1) {\r\n    throw new Error(`No </html> found in fileï¼š${filePath}`);\r\n  }\r\n\r\n  // calculate the correct byte position: char position to byte position\r\n  const beforeHtmlInTail = tailStr.slice(0, htmlEndIdx);\r\n  const htmlEndPos = start + Buffer.byteLength(beforeHtmlInTail, 'utf8');\r\n\r\n  // truncate to </html> before\r\n  fs.truncateSync(filePath, htmlEndPos);\r\n  // append script and </html>\r\n  fs.appendFileSync(filePath, `${scriptContent}\\n${htmlEndTag}\\n`);\r\n}\r\n\r\nexport function reportHTMLContent(\r\n  dumpData: string | ReportDumpWithAttributes,\r\n  reportPath?: string,\r\n  appendReport?: boolean,\r\n  withTpl = true, // whether return with report template, default = true\r\n): string {\r\n  let tpl = '';\r\n  if (withTpl) {\r\n    tpl = getReportTpl();\r\n\r\n    if (!tpl) {\r\n      console.warn('reportTpl is not set, will not write report');\r\n      return '';\r\n    }\r\n  }\r\n  // if reportPath is set, it means we are in write to file mode\r\n  const writeToFile = reportPath && !ifInBrowser;\r\n  let dumpContent = '';\r\n\r\n  if (typeof dumpData === 'string') {\r\n    // do not use template string here, will cause bundle error\r\n    dumpContent =\r\n      // biome-ignore lint/style/useTemplate: <explanation>\r\n      '<script type=\"SQAI_web_dump\" type=\"application/json\">\\n' +\r\n      escapeScriptTag(dumpData) +\r\n      '\\n</script>';\r\n  } else {\r\n    const { dumpString, attributes } = dumpData;\r\n    const attributesArr = Object.keys(attributes || {}).map((key) => {\r\n      return `${key}=\"${encodeURIComponent(attributes![key])}\"`;\r\n    });\r\n\r\n    dumpContent =\r\n      // do not use template string here, will cause bundle error\r\n      // biome-ignore lint/style/useTemplate: <explanation>\r\n      '<script type=\"SQAI_web_dump\" type=\"application/json\" ' +\r\n      attributesArr.join(' ') +\r\n      '>\\n' +\r\n      escapeScriptTag(dumpString) +\r\n      '\\n</script>';\r\n  }\r\n\r\n  if (writeToFile) {\r\n    if (!appendReport) {\r\n      writeFileSync(reportPath!, tpl + dumpContent, { flag: 'w' });\r\n      return reportPath!;\r\n    }\r\n\r\n    if (!reportInitializedMap.get(reportPath!)) {\r\n      writeFileSync(reportPath!, tpl, { flag: 'w' });\r\n      reportInitializedMap.set(reportPath!, true);\r\n    }\r\n\r\n    insertScriptBeforeClosingHtml(reportPath!, dumpContent);\r\n    return reportPath!;\r\n  }\r\n\r\n  return tpl + dumpContent;\r\n}\r\n\r\nexport function writeDumpReport(\r\n  fileName: string,\r\n  dumpData: string | ReportDumpWithAttributes,\r\n  appendReport?: boolean,\r\n): string | null {\r\n  if (ifInBrowser || ifInWorker) {\r\n    console.log('will not write report in browser');\r\n    return null;\r\n  }\r\n\r\n  const reportPath = path.join(\r\n    getMidsceneRunSubDir('report'),\r\n    `${fileName}.html`,\r\n  );\r\n\r\n  reportHTMLContent(dumpData, reportPath, appendReport);\r\n\r\n  if (process.env.SQAI_DEBUG_LOG_JSON) {\r\n    const jsonPath = `${reportPath}.json`;\r\n    let data;\r\n\r\n    if (typeof dumpData === 'string') {\r\n      data = JSON.parse(dumpData) as ReportDumpWithAttributes;\r\n    } else {\r\n      data = dumpData;\r\n    }\r\n\r\n    writeFileSync(jsonPath, JSON.stringify(data, null, 2), {\r\n      flag: appendReport ? 'a' : 'w',\r\n    });\r\n\r\n    logMsg(`Midscene - dump file written: ${jsonPath}`);\r\n  }\r\n\r\n  return reportPath;\r\n}\r\n\r\nexport function writeLogFile(opts: {\r\n  fileName: string;\r\n  fileExt: string;\r\n  fileContent: string | ReportDumpWithAttributes;\r\n  type: 'dump' | 'cache' | 'report' | 'tmp';\r\n  generateReport?: boolean;\r\n  appendReport?: boolean;\r\n}) {\r\n  if (ifInBrowser || ifInWorker) {\r\n    return '/mock/report.html';\r\n  }\r\n  const { fileName, fileExt, fileContent, type = 'dump' } = opts;\r\n  const targetDir = getMidsceneRunSubDir(type);\r\n  // Ensure directory exists\r\n  if (!logEnvReady) {\r\n    assert(targetDir, 'logDir should be set before writing dump file');\r\n\r\n    // gitIgnore in the parent directory\r\n    const gitIgnorePath = path.join(targetDir, '../../.gitignore');\r\n    const gitPath = path.join(targetDir, '../../.git');\r\n    let gitIgnoreContent = '';\r\n\r\n    if (existsSync(gitPath)) {\r\n      // if the git path exists, we need to add the log folder to the git ignore file\r\n      if (existsSync(gitIgnorePath)) {\r\n        gitIgnoreContent = readFileSync(gitIgnorePath, 'utf-8');\r\n      }\r\n\r\n      // ignore the log folder\r\n      if (!gitIgnoreContent.includes(`${defaultRunDirName}/`)) {\r\n        writeFileSync(\r\n          gitIgnorePath,\r\n          `${gitIgnoreContent}\\n# Midscene.js dump files\\n${defaultRunDirName}/dump\\n${defaultRunDirName}/report\\n${defaultRunDirName}/tmp\\n${defaultRunDirName}/log\\n`,\r\n          'utf-8',\r\n        );\r\n      }\r\n    }\r\n\r\n    logEnvReady = true;\r\n  }\r\n\r\n  const filePath = path.join(targetDir, `${fileName}.${fileExt}`);\r\n\r\n  if (type !== 'dump') {\r\n    // do not write dump file any more\r\n    writeFileSync(filePath, JSON.stringify(fileContent));\r\n  }\r\n\r\n  if (opts?.generateReport) {\r\n    return writeDumpReport(fileName, fileContent, opts.appendReport);\r\n  }\r\n\r\n  return filePath;\r\n}\r\n\r\nexport function getTmpDir(): string | null {\r\n  try {\r\n    const runningPkgInfo = getRunningPkgInfo();\r\n    if (!runningPkgInfo) {\r\n      return null;\r\n    }\r\n    const { name } = runningPkgInfo;\r\n    const tmpPath = path.join(tmpdir(), name);\r\n    mkdirSync(tmpPath, { recursive: true });\r\n    return tmpPath;\r\n  } catch (e) {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function getTmpFile(fileExtWithoutDot: string): string | null {\r\n  if (ifInBrowser || ifInWorker) {\r\n    return null;\r\n  }\r\n  const tmpDir = getTmpDir();\r\n  const filename = `${uuid()}.${fileExtWithoutDot}`;\r\n  return path.join(tmpDir!, filename);\r\n}\r\n\r\nexport function overlapped(container: Rect, target: Rect) {\r\n  // container and the target have some part overlapped\r\n  return (\r\n    container.left < target.left + target.width &&\r\n    container.left + container.width > target.left &&\r\n    container.top < target.top + target.height &&\r\n    container.top + container.height > target.top\r\n  );\r\n}\r\n\r\nexport async function sleep(ms: number) {\r\n  return new Promise((resolve) => setTimeout(resolve, ms));\r\n}\r\n\r\nexport function replacerForPageObject(_key: string, value: any) {\r\n  if (value && value.constructor?.name === 'Page') {\r\n    return '[Page object]';\r\n  }\r\n  if (value && value.constructor?.name === 'Browser') {\r\n    return '[Browser object]';\r\n  }\r\n  return value;\r\n}\r\n\r\nexport function stringifyDumpData(data: any, indents?: number) {\r\n  return JSON.stringify(data, replacerForPageObject, indents);\r\n}\r\n\r\ndeclare const __VERSION__: string;\r\n\r\nexport function getVersion() {\r\n  return __VERSION__;\r\n}\r\n\r\nfunction debugLog(...message: any[]) {\r\n  // always read from process.env, and cannot be override by modelConfig, overrideAIConfig, etc.\r\n  // also avoid circular dependency\r\n  const debugMode = process.env[SQAI_DEBUG_MODE];\r\n  if (debugMode) {\r\n    console.log('[Midscene]', ...message);\r\n  }\r\n}\r\n\r\nlet lastReportedRepoUrl = '';\r\nexport function uploadTestInfoToServer({\r\n  testUrl,\r\n  serverUrl,\r\n}: { testUrl: string; serverUrl?: string }) {\r\n  let repoUrl = '';\r\n  let userEmail = '';\r\n\r\n  try {\r\n    repoUrl = execSync('git config --get remote.origin.url').toString().trim();\r\n    userEmail = execSync('git config --get user.email').toString().trim();\r\n  } catch (error) {\r\n    debugLog('Failed to get git info:', error);\r\n  }\r\n\r\n  // Only upload test info if:\r\n  // 1. Server URL is configured AND\r\n  // 2. Either:\r\n  //    - We have a repo URL that's different from last reported one (to avoid duplicate reports)\r\n  //    - OR we don't have a repo URL but have a test URL (for non-git environments)\r\n  if (\r\n    serverUrl &&\r\n    ((repoUrl && repoUrl !== lastReportedRepoUrl) || (!repoUrl && testUrl))\r\n  ) {\r\n    debugLog('Uploading test info to server', {\r\n      serverUrl,\r\n      repoUrl,\r\n      testUrl,\r\n      userEmail,\r\n    });\r\n\r\n    fetch(serverUrl, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        repo_url: repoUrl,\r\n        test_url: testUrl,\r\n        user_email: userEmail,\r\n      }),\r\n    })\r\n      .then((response) => response.json())\r\n      .then((data) => {\r\n        debugLog('Successfully uploaded test info to server:', data);\r\n      })\r\n      .catch((error) =>\r\n        debugLog('Failed to upload test info to server:', error),\r\n      );\r\n    lastReportedRepoUrl = repoUrl;\r\n  }\r\n}\r\n"],"names":["logEnvReady","groupedActionDumpFileExt","processCacheConfig","cache","cacheId","undefined","envEnabled","globalConfigManager","SQAI_CACHE","reportInitializedMap","Map","getReportTpl","reportTpl","insertScriptBeforeClosingHtml","filePath","scriptContent","htmlEndTag","stat","fs","readSize","Math","start","buffer","Buffer","fd","tailStr","htmlEndIdx","Error","beforeHtmlInTail","htmlEndPos","reportHTMLContent","dumpData","reportPath","appendReport","withTpl","tpl","console","writeToFile","ifInBrowser","dumpContent","escapeScriptTag","dumpString","attributes","attributesArr","Object","key","encodeURIComponent","writeFileSync","writeDumpReport","fileName","ifInWorker","path","getMidsceneRunSubDir","process","jsonPath","data","JSON","logMsg","writeLogFile","opts","fileExt","fileContent","type","targetDir","assert","gitIgnorePath","gitPath","gitIgnoreContent","existsSync","readFileSync","defaultRunDirName","getTmpDir","runningPkgInfo","getRunningPkgInfo","name","tmpPath","tmpdir","mkdirSync","e","getTmpFile","fileExtWithoutDot","tmpDir","filename","uuid","overlapped","container","target","sleep","ms","Promise","resolve","setTimeout","replacerForPageObject","_key","value","_value_constructor","_value_constructor1","stringifyDumpData","indents","getVersion","__VERSION__","debugLog","message","debugMode","SQAI_DEBUG_MODE","lastReportedRepoUrl","uploadTestInfoToServer","testUrl","serverUrl","repoUrl","userEmail","execSync","error","fetch","response"],"mappings":"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"}