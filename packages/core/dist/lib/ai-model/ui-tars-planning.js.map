{"version":3,"file":"ai-model\\ui-tars-planning.js","sources":["webpack://@sqaitech/core/webpack/runtime/define_property_getters","webpack://@sqaitech/core/webpack/runtime/has_own_property","webpack://@sqaitech/core/webpack/runtime/make_namespace_object","webpack://@sqaitech/core/./src/ai-model/ui-tars-planning.ts"],"sourcesContent":["__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n            Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n        }\n    }\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import type {\r\n  PlanningAIResponse,\r\n  PlanningAction,\r\n  Size,\r\n  UIContext,\r\n} from '@/types';\r\nimport { type IModelConfig, UITarsModelVersion } from '@sqaitech/shared/env';\r\nimport { resizeImgBase64 } from '@sqaitech/shared/img';\r\nimport { getDebug } from '@sqaitech/shared/logger';\r\nimport { transformHotkeyInput } from '@sqaitech/shared/us-keyboard-layout';\r\nimport { assert } from '@sqaitech/shared/utils';\r\nimport { actionParser } from '@ui-tars/action-parser';\r\nimport { AIActionType } from './common';\r\nimport type { ConversationHistory } from './conversation-history';\r\nimport { getSummary, getUiTarsPlanningPrompt } from './prompt/ui-tars-planning';\r\nimport { callAIWithStringResponse } from './service-caller/index';\r\ntype ActionType =\r\n  | 'click'\r\n  | 'drag'\r\n  | 'type'\r\n  | 'hotkey'\r\n  | 'finished'\r\n  | 'scroll'\r\n  | 'wait';\r\n\r\nconst debug = getDebug('ui-tars-planning');\r\nconst bboxSize = 10;\r\nconst pointToBbox = (\r\n  point: { x: number; y: number },\r\n  width: number,\r\n  height: number,\r\n): [number, number, number, number] => {\r\n  return [\r\n    Math.round(Math.max(point.x - bboxSize / 2, 0)),\r\n    Math.round(Math.max(point.y - bboxSize / 2, 0)),\r\n    Math.round(Math.min(point.x + bboxSize / 2, width)),\r\n    Math.round(Math.min(point.y + bboxSize / 2, height)),\r\n  ];\r\n};\r\n\r\nexport async function uiTarsPlanning(\r\n  userInstruction: string,\r\n  options: {\r\n    conversationHistory: ConversationHistory;\r\n    context: UIContext;\r\n    modelConfig: IModelConfig;\r\n  },\r\n): Promise<PlanningAIResponse> {\r\n  const { conversationHistory, context, modelConfig } = options;\r\n  const { uiTarsModelVersion } = modelConfig;\r\n  const systemPrompt = getUiTarsPlanningPrompt() + userInstruction;\r\n\r\n  const imagePayload = await resizeImageForUiTars(\r\n    context.screenshotBase64,\r\n    context.size,\r\n    uiTarsModelVersion,\r\n  );\r\n\r\n  conversationHistory.append({\r\n    role: 'user',\r\n    content: [\r\n      {\r\n        type: 'image_url',\r\n        image_url: {\r\n          url: imagePayload,\r\n        },\r\n      },\r\n    ],\r\n  });\r\n\r\n  const res = await callAIWithStringResponse(\r\n    [\r\n      {\r\n        role: 'user',\r\n        content: systemPrompt,\r\n      },\r\n      ...conversationHistory.snapshot(),\r\n    ],\r\n    AIActionType.INSPECT_ELEMENT,\r\n    modelConfig,\r\n  );\r\n  const convertedText = convertBboxToCoordinates(res.content);\r\n\r\n  const { size } = context;\r\n  const { parsed } = actionParser({\r\n    prediction: convertedText,\r\n    factor: [1000, 1000],\r\n    screenContext: {\r\n      width: size.width,\r\n      height: size.height,\r\n    },\r\n    modelVer: uiTarsModelVersion,\r\n  });\r\n\r\n  debug(\r\n    'ui-tars modelVer',\r\n    uiTarsModelVersion,\r\n    ', parsed',\r\n    JSON.stringify(parsed),\r\n  );\r\n\r\n  const transformActions: PlanningAction[] = [];\r\n  let shouldContinue = true;\r\n  parsed.forEach((action) => {\r\n    const actionType = (action.action_type || '').toLowerCase();\r\n    if (actionType === 'click') {\r\n      assert(action.action_inputs.start_box, 'start_box is required');\r\n      const point = getPoint(action.action_inputs.start_box, size);\r\n      transformActions.push({\r\n        type: 'Tap',\r\n        param: {\r\n          locate: {\r\n            prompt: action.thought || '',\r\n            bbox: pointToBbox(\r\n              { x: point[0], y: point[1] },\r\n              size.width,\r\n              size.height,\r\n            ),\r\n          },\r\n        },\r\n      });\r\n    } else if (actionType === 'drag') {\r\n      assert(action.action_inputs.start_box, 'start_box is required');\r\n      assert(action.action_inputs.end_box, 'end_box is required');\r\n      const startPoint = getPoint(action.action_inputs.start_box, size);\r\n      const endPoint = getPoint(action.action_inputs.end_box, size);\r\n      transformActions.push({\r\n        type: 'DragAndDrop',\r\n        param: {\r\n          from: {\r\n            prompt: action.thought || '',\r\n            bbox: pointToBbox(\r\n              { x: startPoint[0], y: startPoint[1] },\r\n              size.width,\r\n              size.height,\r\n            ),\r\n          },\r\n          to: {\r\n            prompt: action.thought || '',\r\n            bbox: pointToBbox(\r\n              { x: endPoint[0], y: endPoint[1] },\r\n              size.width,\r\n              size.height,\r\n            ),\r\n          },\r\n        },\r\n        thought: action.thought || '',\r\n      });\r\n    } else if (actionType === 'type') {\r\n      transformActions.push({\r\n        type: 'Input',\r\n        param: {\r\n          value: action.action_inputs.content,\r\n        },\r\n        thought: action.thought || '',\r\n      });\r\n    } else if (actionType === 'scroll') {\r\n      transformActions.push({\r\n        type: 'Scroll',\r\n        param: {\r\n          direction: action.action_inputs.direction,\r\n        },\r\n        thought: action.thought || '',\r\n      });\r\n    } else if (actionType === 'finished') {\r\n      shouldContinue = false;\r\n      transformActions.push({\r\n        type: 'Finished',\r\n        param: {},\r\n        thought: action.thought || '',\r\n      });\r\n    } else if (actionType === 'hotkey') {\r\n      if (!action.action_inputs.key) {\r\n        console.warn(\r\n          'No key found in action: hotkey. Will not perform action.',\r\n        );\r\n      } else {\r\n        const keys = transformHotkeyInput(action.action_inputs.key);\r\n\r\n        transformActions.push({\r\n          type: 'KeyboardPress',\r\n          param: {\r\n            keyName: keys,\r\n          },\r\n          thought: action.thought || '',\r\n        });\r\n      }\r\n    } else if (actionType === 'wait') {\r\n      transformActions.push({\r\n        type: 'Sleep',\r\n        param: {\r\n          timeMs: 1000,\r\n        },\r\n        thought: action.thought || '',\r\n      });\r\n    }\r\n  });\r\n\r\n  if (transformActions.length === 0) {\r\n    throw new Error(`No actions found, response: ${res.content}`, {\r\n      cause: {\r\n        prediction: res.content,\r\n        parsed,\r\n      },\r\n    });\r\n  }\r\n\r\n  debug('transformActions', JSON.stringify(transformActions, null, 2));\r\n  const log = getSummary(res.content);\r\n\r\n  conversationHistory.append({\r\n    role: 'assistant',\r\n    content: log,\r\n  });\r\n\r\n  return {\r\n    actions: transformActions,\r\n    log,\r\n    usage: res.usage,\r\n    rawResponse: JSON.stringify(res.content, undefined, 2),\r\n    more_actions_needed_by_instruction: shouldContinue,\r\n  };\r\n}\r\n\r\n/**\r\n * Converts bounding box notation to coordinate points\r\n * @param text - The text containing bbox tags to be converted\r\n * @returns The text with bbox tags replaced by coordinate points\r\n */\r\nfunction convertBboxToCoordinates(text: string): string {\r\n  // Match the four numbers after <bbox>\r\n  const pattern = /<bbox>(\\d+)\\s+(\\d+)\\s+(\\d+)\\s+(\\d+)<\\/bbox>/g;\r\n\r\n  function replaceMatch(\r\n    match: string,\r\n    x1: string,\r\n    y1: string,\r\n    x2: string,\r\n    y2: string,\r\n  ): string {\r\n    // Convert strings to numbers and calculate center point\r\n    const x1Num = Number.parseInt(x1, 10);\r\n    const y1Num = Number.parseInt(y1, 10);\r\n    const x2Num = Number.parseInt(x2, 10);\r\n    const y2Num = Number.parseInt(y2, 10);\r\n\r\n    // Use Math.floor to truncate and calculate center point\r\n    const x = Math.floor((x1Num + x2Num) / 2);\r\n    const y = Math.floor((y1Num + y2Num) / 2);\r\n\r\n    // Return formatted coordinate string\r\n    return `(${x},${y})`;\r\n  }\r\n\r\n  // Remove [EOS] and replace <bbox> coordinates\r\n  const cleanedText = text.replace(/\\[EOS\\]/g, '');\r\n  return cleanedText.replace(pattern, replaceMatch).trim();\r\n}\r\n\r\nfunction getPoint(startBox: string, size: { width: number; height: number }) {\r\n  const [x, y] = JSON.parse(startBox);\r\n  return [x * size.width, y * size.height];\r\n}\r\n\r\ninterface BaseAction {\r\n  action_type: ActionType;\r\n  action_inputs: Record<string, any>;\r\n  reflection: string | null;\r\n  thought: string | null;\r\n}\r\n\r\ninterface ClickAction extends BaseAction {\r\n  action_type: 'click';\r\n  action_inputs: {\r\n    start_box: string; // JSON string of [x, y] coordinates\r\n  };\r\n}\r\n\r\ninterface DragAction extends BaseAction {\r\n  action_type: 'drag';\r\n  action_inputs: {\r\n    start_box: string; // JSON string of [x, y] coordinates\r\n    end_box: string; // JSON string of [x, y] coordinates\r\n  };\r\n}\r\n\r\ninterface WaitAction extends BaseAction {\r\n  action_type: 'wait';\r\n  action_inputs: {\r\n    time: string; // JSON string of [x, y] coordinates\r\n  };\r\n}\r\n\r\ninterface TypeAction extends BaseAction {\r\n  action_type: 'type';\r\n  action_inputs: {\r\n    content: string;\r\n  };\r\n}\r\n\r\ninterface HotkeyAction extends BaseAction {\r\n  action_type: 'hotkey';\r\n  action_inputs: {\r\n    key: string;\r\n  };\r\n}\r\n\r\ninterface ScrollAction extends BaseAction {\r\n  action_type: 'scroll';\r\n  action_inputs: {\r\n    direction: 'up' | 'down';\r\n  };\r\n}\r\n\r\ninterface FinishedAction extends BaseAction {\r\n  action_type: 'finished';\r\n  action_inputs: Record<string, never>;\r\n}\r\n\r\nexport type Action =\r\n  | ClickAction\r\n  | DragAction\r\n  | TypeAction\r\n  | HotkeyAction\r\n  | ScrollAction\r\n  | FinishedAction\r\n  | WaitAction;\r\n\r\nexport async function resizeImageForUiTars(\r\n  imageBase64: string,\r\n  size: Size,\r\n  uiTarsVersion: UITarsModelVersion | undefined,\r\n) {\r\n  if (uiTarsVersion === UITarsModelVersion.V1_5) {\r\n    debug('ui-tars-v1.5, will check image size', size);\r\n    const currentPixels = size.width * size.height;\r\n    const maxPixels = 16384 * 28 * 28; //\r\n    if (currentPixels > maxPixels) {\r\n      const resizeFactor = Math.sqrt(maxPixels / currentPixels);\r\n      const newWidth = Math.floor(size.width * resizeFactor);\r\n      const newHeight = Math.floor(size.height * resizeFactor);\r\n      debug(\r\n        'resize image for ui-tars, new width: %s, new height: %s',\r\n        newWidth,\r\n        newHeight,\r\n      );\r\n      const resizedImage = await resizeImgBase64(imageBase64, {\r\n        width: newWidth,\r\n        height: newHeight,\r\n      });\r\n      return resizedImage;\r\n    }\r\n  }\r\n  return imageBase64;\r\n}\r\n"],"names":["__webpack_require__","definition","key","Object","obj","prop","Symbol","debug","getDebug","bboxSize","pointToBbox","point","width","height","Math","uiTarsPlanning","userInstruction","options","conversationHistory","context","modelConfig","uiTarsModelVersion","systemPrompt","getUiTarsPlanningPrompt","imagePayload","resizeImageForUiTars","res","callAIWithStringResponse","AIActionType","convertedText","convertBboxToCoordinates","size","parsed","actionParser","JSON","transformActions","shouldContinue","action","actionType","assert","getPoint","startPoint","endPoint","keys","transformHotkeyInput","console","Error","log","getSummary","undefined","text","pattern","replaceMatch","match","x1","y1","x2","y2","x1Num","Number","y1Num","x2Num","y2Num","x","y","cleanedText","startBox","imageBase64","uiTarsVersion","UITarsModelVersion","currentPixels","maxPixels","resizeFactor","newWidth","newHeight","resizedImage","resizeImgBase64"],"mappings":"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"}