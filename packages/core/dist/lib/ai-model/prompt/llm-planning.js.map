{"version":3,"file":"ai-model\\prompt\\llm-planning.js","sources":["webpack://@sqaitech/core/webpack/runtime/define_property_getters","webpack://@sqaitech/core/webpack/runtime/has_own_property","webpack://@sqaitech/core/webpack/runtime/make_namespace_object","webpack://@sqaitech/core/./src/ai-model/prompt/llm-planning.ts"],"sourcesContent":["__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n            Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n        }\n    }\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import type { DeviceAction } from '@/types';\r\nimport type { TVlModeTypes } from '@sqaitech/shared/env';\r\nimport type { ResponseFormatJSONSchema } from 'openai/resources/index';\r\nimport type { ZodObject, z } from 'zod';\r\nimport { ifMidsceneLocatorField } from '../common';\r\nimport { bboxDescription } from './common';\r\n\r\n// Note: put the log field first to trigger the CoT\r\n\r\nconst vlCurrentLog = `\"log\": string, // Log your thoughts and what the next one action (ONLY ONE!) you can do according to the screenshot and the instruction. The log should contain the following information: \"The user wants to do ... . According to the instruction and the previous logs, next step is to .... Now i am going to compose an action '{ action-type }' to do ....\". If no action should be done, log the reason. Use the same language as the user's instruction.`;\r\nconst llmCurrentLog = `\"log\": string, // Log what the next actions you can do according to the screenshot and the instruction. The typical log looks like \"Now i want to use action '{ action-type }' to do ..\". If no action should be done, log the reason. \". Use the same language as the user's instruction.`;\r\n\r\nconst commonOutputFields = `\"error\"?: string, // Error messages about unexpected situations, if any. Only think it is an error when the situation is not foreseeable according to the instruction. Use the same language as the user's instruction.\r\n  \"more_actions_needed_by_instruction\": boolean, // Consider if there is still more action(s) to do after the action in \"Log\" is done, according to the instruction. If so, set this field to true. Otherwise, set it to false.`;\r\nconst vlLocateParam = () =>\r\n  '{bbox: [number, number, number, number], prompt: string }';\r\nconst llmLocateParam = () => '{\"id\": string, \"prompt\": string}';\r\n\r\nexport const descriptionForAction = (\r\n  action: DeviceAction<any>,\r\n  locatorSchemaTypeDescription: string,\r\n) => {\r\n  const tab = '  ';\r\n  const fields: string[] = [];\r\n\r\n  // Add the action type field\r\n  fields.push(`- type: \"${action.name}\"`);\r\n\r\n  // Handle paramSchema if it exists\r\n  if (action.paramSchema) {\r\n    // Try to extract parameter information from the zod schema\r\n    // For zod object schemas, extract type information and descriptions\r\n    const shape = (action.paramSchema as ZodObject<any>).shape;\r\n\r\n    if (!shape) {\r\n      console.warn(\r\n        `action.paramSchema is not a ZodObject, may lead to unexpected behavior, action name: ${action.name}`,\r\n      );\r\n    }\r\n\r\n    const paramLines: string[] = [];\r\n\r\n    // Helper function to get type name from zod schema\r\n    const getTypeName = (field: any): string => {\r\n      // Recursively unwrap optional, nullable, and other wrapper types to get the actual inner type\r\n      const unwrapField = (f: any): any => {\r\n        if (!f._def) return f;\r\n\r\n        const typeName = f._def.typeName;\r\n\r\n        // Handle wrapper types that have innerType\r\n        if (\r\n          typeName === 'ZodOptional' ||\r\n          typeName === 'ZodNullable' ||\r\n          typeName === 'ZodDefault'\r\n        ) {\r\n          return unwrapField(f._def.innerType);\r\n        }\r\n\r\n        // Handle ZodEffects (transformations, refinements, preprocessors)\r\n        if (typeName === 'ZodEffects') {\r\n          // For ZodEffects, unwrap the schema field which contains the underlying type\r\n          if (f._def.schema) {\r\n            return unwrapField(f._def.schema);\r\n          }\r\n        }\r\n\r\n        return f;\r\n      };\r\n\r\n      const actualField = unwrapField(field);\r\n      const fieldTypeName = actualField._def?.typeName;\r\n\r\n      if (fieldTypeName === 'ZodString') return 'string';\r\n      if (fieldTypeName === 'ZodNumber') return 'number';\r\n      if (fieldTypeName === 'ZodBoolean') return 'boolean';\r\n      if (fieldTypeName === 'ZodArray') return 'array';\r\n      if (fieldTypeName === 'ZodObject') {\r\n        // Check if this is a passthrough object (like MidsceneLocation)\r\n        if (ifMidsceneLocatorField(actualField)) {\r\n          return locatorSchemaTypeDescription;\r\n        }\r\n        return 'object';\r\n      }\r\n      if (fieldTypeName === 'ZodEnum') {\r\n        const values =\r\n          (actualField._def?.values as unknown[] | undefined)\r\n            ?.map((option: unknown) => String(`'${option}'`))\r\n            .join(', ') ?? 'enum';\r\n\r\n        return `enum(${values})`;\r\n      }\r\n      // Handle ZodUnion by taking the first option (for display purposes)\r\n      if (fieldTypeName === 'ZodUnion') {\r\n        const options = actualField._def?.options as any[] | undefined;\r\n        if (options && options.length > 0) {\r\n          // For unions, list all types\r\n          const types = options.map((opt: any) => getTypeName(opt));\r\n          return types.join(' | ');\r\n        }\r\n        return 'union';\r\n      }\r\n\r\n      console.warn(\r\n        'failed to parse Zod type. This may lead to wrong params from the LLM.\\n',\r\n        actualField._def,\r\n      );\r\n      return actualField.toString();\r\n    };\r\n\r\n    // Helper function to get description from zod schema\r\n    const getDescription = (field: z.ZodTypeAny): string | null => {\r\n      // Recursively unwrap optional, nullable, and other wrapper types to get the actual inner type\r\n      const unwrapField = (f: any): any => {\r\n        if (!f._def) return f;\r\n\r\n        const typeName = f._def.typeName;\r\n\r\n        // Handle wrapper types that have innerType\r\n        if (\r\n          typeName === 'ZodOptional' ||\r\n          typeName === 'ZodNullable' ||\r\n          typeName === 'ZodDefault'\r\n        ) {\r\n          return unwrapField(f._def.innerType);\r\n        }\r\n\r\n        // Handle ZodEffects (transformations, refinements, preprocessors)\r\n        if (typeName === 'ZodEffects') {\r\n          // For ZodEffects, unwrap the schema field which contains the underlying type\r\n          if (f._def.schema) {\r\n            return unwrapField(f._def.schema);\r\n          }\r\n        }\r\n\r\n        return f;\r\n      };\r\n\r\n      // Check for direct description on the original field (wrapper may have description)\r\n      if ('description' in field) {\r\n        return field.description || null;\r\n      }\r\n\r\n      const actualField = unwrapField(field);\r\n\r\n      // Check for description on the unwrapped field\r\n      if ('description' in actualField) {\r\n        return actualField.description || null;\r\n      }\r\n\r\n      // Check for MidsceneLocation fields and add description\r\n      if (actualField._def?.typeName === 'ZodObject') {\r\n        if ('SQAI_location_field_flag' in actualField._def.shape()) {\r\n          return 'Location information for the target element';\r\n        }\r\n      }\r\n\r\n      return null;\r\n    };\r\n\r\n    for (const [key, field] of Object.entries(shape)) {\r\n      if (field && typeof field === 'object') {\r\n        // Check if field is optional\r\n        const isOptional =\r\n          typeof (field as any).isOptional === 'function' &&\r\n          (field as any).isOptional();\r\n        const keyWithOptional = isOptional ? `${key}?` : key;\r\n\r\n        // Get the type name\r\n        const typeName = getTypeName(field);\r\n\r\n        // Get description\r\n        const description = getDescription(field as z.ZodTypeAny);\r\n\r\n        // Build param line for this field\r\n        let paramLine = `${keyWithOptional}: ${typeName}`;\r\n        if (description) {\r\n          paramLine += ` // ${description}`;\r\n        }\r\n\r\n        paramLines.push(paramLine);\r\n      }\r\n    }\r\n\r\n    if (paramLines.length > 0) {\r\n      fields.push('- param:');\r\n      for (const paramLine of paramLines) {\r\n        fields.push(`  - ${paramLine}`);\r\n      }\r\n    }\r\n  }\r\n\r\n  return `- ${action.name}, ${action.description || 'No description provided'}\r\n${tab}${fields.join(`\\n${tab}`)}\r\n`.trim();\r\n};\r\n\r\nconst systemTemplateOfVLPlanning = ({\r\n  actionSpace,\r\n  vlMode,\r\n}: {\r\n  actionSpace: DeviceAction<any>[];\r\n  vlMode: TVlModeTypes | undefined;\r\n}) => {\r\n  const actionNameList = actionSpace.map((action) => action.name).join(', ');\r\n  const actionDescriptionList = actionSpace.map((action) => {\r\n    return descriptionForAction(action, vlLocateParam());\r\n  });\r\n  const actionList = actionDescriptionList.join('\\n');\r\n\r\n  return `\r\nTarget: User will give you a latest screenshot, an instruction and some previous logs indicating what have been done. Please tell what the next one action is (or null if no action should be done) to do the tasks the instruction requires. \r\n\r\nRestriction:\r\n- Don't give extra actions or plans beyond the instruction. ONLY plan for what the instruction requires. For example, don't try to submit the form if the instruction is only to fill something.\r\n- Always give ONLY ONE action in \\`log\\` field (or null if no action should be done), instead of multiple actions. Supported actions are ${actionNameList}.\r\n- Don't repeat actions in the previous logs.\r\n- Bbox is the bounding box of the element to be located. It's an array of 4 numbers, representing ${bboxDescription(vlMode)}.\r\n\r\nSupporting actions:\r\n${actionList}\r\n\r\nField description:\r\n* The \\`prompt\\` field inside the \\`locate\\` field is a short description that could be used to locate the element.\r\n\r\nReturn in JSON format:\r\n{\r\n  ${vlCurrentLog}\r\n  ${commonOutputFields}\r\n  \"action\": \r\n    {\r\n      // one of the supporting actions\r\n    } | null,\r\n  ,\r\n  \"sleep\"?: number, // The sleep time after the action, in milliseconds.\r\n}\r\n\r\nFor example, when the instruction is \"click 'Confirm' button, and click 'Yes' in popup\" and the previous log shows \"The 'Confirm' button has been clicked\", by viewing the screenshot and previous logs, you should consider: We have already clicked the 'Confirm' button, so next we should find and click 'Yes' in popup.\r\n\r\nthis and output the JSON:\r\n\r\n{\r\n  \"log\": \"The user wants to do click 'Confirm' button, and click 'Yes' in popup. According to the instruction and the previous logs, next step is to tap the 'Yes' button in the popup. Now i am going to compose an action 'Tap' to click 'Yes' in popup.\",\r\n  \"action\": {\r\n    \"type\": \"Tap\",\r\n    \"param\": {\r\n      \"locate\": {\r\n        \"bbox\": [100, 100, 200, 200],\r\n        \"prompt\": \"The 'Yes' button in popup\"\r\n      }\r\n    }\r\n  },\r\n  \"more_actions_needed_by_instruction\": false,\r\n}\r\n`;\r\n};\r\n\r\nconst systemTemplateOfLLM = ({\r\n  actionSpace,\r\n}: { actionSpace: DeviceAction<any>[] }) => {\r\n  const actionNameList = actionSpace.map((action) => action.name).join(' / ');\r\n  const actionDescriptionList = actionSpace.map((action) => {\r\n    return descriptionForAction(action, llmLocateParam());\r\n  });\r\n  const actionList = actionDescriptionList.join('\\n');\r\n\r\n  return `\r\n## Role\r\n\r\nYou are a versatile professional in software UI automation. Your outstanding contributions will impact the user experience of billions of users.\r\n\r\n## Objective\r\n\r\n- Decompose the instruction user asked into a series of actions\r\n- Locate the target element if possible\r\n- If the instruction cannot be accomplished, give a further plan.\r\n\r\n## Workflow\r\n\r\n1. Receive the screenshot, element description of screenshot(if any), user's instruction and previous logs.\r\n2. Decompose the user's task into a sequence of feasible actions, and place it in the \\`actions\\` field. There are different types of actions (${actionNameList}). The \"About the action\" section below will give you more details.\r\n3. Consider whether the user's instruction will be accomplished after the actions you composed.\r\n- If the instruction is accomplished, set \\`more_actions_needed_by_instruction\\` to false.\r\n- If more actions are needed, set \\`more_actions_needed_by_instruction\\` to true. Get ready to hand over to the next talent people like you. Carefully log what have been done in the \\`log\\` field, he or she will continue the task according to your logs.\r\n4. If the task is not feasible on this page, set \\`error\\` field to the reason.\r\n\r\n## Constraints\r\n\r\n- All the actions you composed MUST be feasible, which means all the action fields can be filled with the page context information you get. If not, don't plan this action.\r\n- Trust the \"What have been done\" field about the task (if any), don't repeat actions in it.\r\n- Respond only with valid JSON. Do not write an introduction or summary or markdown prefix like \\`\\`\\`json\\`\\`\\`.\r\n- If the screenshot and the instruction are totally irrelevant, set reason in the \\`error\\` field.\r\n\r\n## About the \\`actions\\` field\r\n\r\nThe \\`locate\\` param is commonly used in the \\`param\\` field of the action, means to locate the target element to perform the action, it conforms to the following scheme:\r\n\r\ntype LocateParam = {\r\n  \"id\": string, // the id of the element found. It should either be the id marked with a rectangle in the screenshot or the id described in the description.\r\n  \"prompt\"?: string // the description of the element to find. It can only be omitted when locate is null.\r\n} | null // If it's not on the page, the LocateParam should be null\r\n\r\n## Supported actions\r\n\r\nEach action has a \\`type\\` and corresponding \\`param\\`. To be detailed:\r\n${actionList}\r\n\r\n`.trim();\r\n};\r\n\r\nconst outputTemplate = `\r\n## Output JSON Format:\r\n\r\nThe JSON format is as follows:\r\n\r\n{\r\n  \"actions\": [\r\n    // ... some actions\r\n  ],\r\n  ${llmCurrentLog}\r\n  ${commonOutputFields}\r\n}\r\n\r\n## Examples\r\n\r\n### Example: Decompose a task\r\n\r\nWhen you received the following information:\r\n\r\n* Instruction: 'Click the language switch button, wait 1s, click \"English\"'\r\n* Logs: null\r\n* Page Context (screenshot and description) shows: There is a language switch button, and the \"English\" option is not shown in the screenshot now.\r\n\r\nBy viewing the page screenshot and description, you should consider this and output the JSON:\r\n\r\n* The user intent is: tap the switch button, sleep, and tap the 'English' option\r\n* The language switch button is shown in the screenshot, and can be located by the page description or the id marked with a rectangle. So we can plan a Tap action to do this.\r\n* Plan a Sleep action to wait for 1 second to ensure the language options are displayed.\r\n* The \"English\" option button is not shown in the screenshot now, it means it may only show after the previous actions are finished. So don't plan any action to do this.\r\n* Compose the log: The user wants to do click the language switch button, wait 1s, click \"English\". According to the instruction and the previous logs, next step is to tap the language switch button to open the language options. Now i am going to compose an action 'Tap' to click the language switch button.\r\n* The task cannot be accomplished (because the last tapping action is not finished yet), so the \\`more_actions_needed_by_instruction\\` field is true. The \\`error\\` field is null.\r\n\r\n{\r\n  \"actions\":[\r\n    {\r\n      \"thought\": \"Click the language switch button to open the language options.\",\r\n      \"type\": \"Tap\", \r\n      \"param\": {\r\n        \"locate\": { id: \"c81c4e9a33\", prompt: \"The language switch button\" }\r\n      }\r\n    },\r\n    {\r\n      \"thought\": \"Wait for 1 second to ensure the language options are displayed.\",\r\n      \"type\": \"Sleep\",\r\n      \"param\": { \"timeMs\": 1000 },\r\n    }\r\n  ],\r\n  \"error\": null,\r\n  \"more_actions_needed_by_instruction\": true,\r\n  \"log\": \"The user wants to do click the language switch button, wait 1s, click \\\"English\\\". According to the instruction and the previous logs, next step is to tap the language switch button to open the language options. Now i am going to compose an action 'Tap' to click the language switch button.\",\r\n}\r\n\r\n### Example: What NOT to do\r\nWrong output:\r\n{\r\n  \"actions\":[\r\n    {\r\n      \"thought\": \"Click the language switch button to open the language options.\",\r\n      \"type\": \"Tap\",\r\n      \"param\": {\r\n        \"locate\": { \"id\": \"c81c4e9a33\" } // WRONG: prompt is missing, this is not a valid LocateParam\r\n      }\r\n    },\r\n    {\r\n      \"thought\": \"Click the English option\",\r\n      \"type\": \"Tap\", \r\n      \"param\": {\r\n        \"locate\": null // WRONG: if the element is not on the page, you should not plan this action\r\n      }\r\n    }\r\n  ],\r\n  \"more_actions_needed_by_instruction\": false, // WRONG: should be true\r\n  \"log\": \"The user wants to do click the language switch button, wait 1s, click \\\"English\\\". According to the instruction and the previous logs, next step is to tap the language switch button to open the language options. Now i am going to compose an action 'Tap' to click the language switch button.\",\r\n}\r\n`;\r\n\r\nexport async function systemPromptToTaskPlanning({\r\n  actionSpace,\r\n  vlMode,\r\n}: {\r\n  actionSpace: DeviceAction<any>[];\r\n  vlMode: TVlModeTypes | undefined;\r\n}) {\r\n  if (vlMode) {\r\n    return systemTemplateOfVLPlanning({ actionSpace, vlMode });\r\n  }\r\n\r\n  return `${systemTemplateOfLLM({ actionSpace })}\\n\\n${outputTemplate}`;\r\n}\r\n\r\nexport const planSchema: ResponseFormatJSONSchema = {\r\n  type: 'json_schema',\r\n  json_schema: {\r\n    name: 'action_items',\r\n    strict: false,\r\n    schema: {\r\n      type: 'object',\r\n      strict: false,\r\n      properties: {\r\n        actions: {\r\n          type: 'array',\r\n          items: {\r\n            type: 'object',\r\n            strict: false,\r\n            properties: {\r\n              thought: {\r\n                type: 'string',\r\n                description:\r\n                  'Reasons for generating this task, and why this task is feasible on this page',\r\n              },\r\n              type: {\r\n                type: 'string',\r\n                description: 'Type of action',\r\n              },\r\n              param: {\r\n                anyOf: [\r\n                  { type: 'null' },\r\n                  {\r\n                    type: 'object',\r\n                    additionalProperties: true,\r\n                  },\r\n                ],\r\n                description: 'Parameter of the action',\r\n              },\r\n              locate: {\r\n                type: ['object', 'null'],\r\n                properties: {\r\n                  id: { type: 'string' },\r\n                  prompt: { type: 'string' },\r\n                },\r\n                required: ['id', 'prompt'],\r\n                additionalProperties: false,\r\n                description: 'Location information for the target element',\r\n              },\r\n            },\r\n            required: ['thought', 'type', 'param', 'locate'],\r\n            additionalProperties: false,\r\n          },\r\n          description: 'List of actions to be performed',\r\n        },\r\n        more_actions_needed_by_instruction: {\r\n          type: 'boolean',\r\n          description:\r\n            'If all the actions described in the instruction have been covered by this action and logs, set this field to false.',\r\n        },\r\n        log: {\r\n          type: 'string',\r\n          description:\r\n            'Log what these planned actions do. Do not include further actions that have not been planned.',\r\n        },\r\n        error: {\r\n          type: ['string', 'null'],\r\n          description: 'Error messages about unexpected situations',\r\n        },\r\n      },\r\n      required: [\r\n        'actions',\r\n        'more_actions_needed_by_instruction',\r\n        'log',\r\n        'error',\r\n      ],\r\n      additionalProperties: false,\r\n    },\r\n  },\r\n};\r\n"],"names":["__webpack_require__","definition","key","Object","obj","prop","Symbol","vlCurrentLog","llmCurrentLog","commonOutputFields","vlLocateParam","llmLocateParam","descriptionForAction","action","locatorSchemaTypeDescription","tab","fields","shape","console","paramLines","getTypeName","field","_actualField__def","unwrapField","f","typeName","actualField","fieldTypeName","ifMidsceneLocatorField","_actualField__def_values","values","option","String","_actualField__def2","options","types","opt","getDescription","isOptional","keyWithOptional","description","paramLine","systemTemplateOfVLPlanning","actionSpace","vlMode","actionNameList","actionDescriptionList","actionList","bboxDescription","systemTemplateOfLLM","outputTemplate","systemPromptToTaskPlanning","planSchema"],"mappings":"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"}