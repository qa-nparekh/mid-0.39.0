{"version":3,"file":"ai-model\\prompt\\yaml-generator.js","sources":["webpack://@sqaitech/core/webpack/runtime/define_property_getters","webpack://@sqaitech/core/webpack/runtime/has_own_property","webpack://@sqaitech/core/webpack/runtime/make_namespace_object","webpack://@sqaitech/core/./src/ai-model/prompt/yaml-generator.ts"],"sourcesContent":["__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n            Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n        }\n    }\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import type {\r\n  StreamingAIResponse,\r\n  StreamingCodeGenerationOptions,\r\n} from '@/types';\r\nimport { YAML_EXAMPLE_CODE } from '@sqaitech/shared/constants';\r\nimport type { IModelConfig } from '@sqaitech/shared/env';\r\nimport {\r\n  AIActionType,\r\n  type ChatCompletionMessageParam,\r\n  callAI,\r\n  callAIWithStringResponse,\r\n} from '../index';\r\n\r\n// Common interfaces for test generation (shared between YAML and Playwright)\r\nexport interface EventCounts {\r\n  navigation: number;\r\n  click: number;\r\n  input: number;\r\n  scroll: number;\r\n  total: number;\r\n}\r\n\r\nexport interface InputDescription {\r\n  description: string;\r\n  value: string;\r\n}\r\n\r\nexport interface ProcessedEvent {\r\n  type: string;\r\n  timestamp: number;\r\n  url?: string;\r\n  title?: string;\r\n  elementDescription?: string;\r\n  value?: string;\r\n  pageInfo?: any;\r\n  elementRect?: any;\r\n}\r\n\r\nexport interface EventSummary {\r\n  testName: string;\r\n  startUrl: string;\r\n  eventCounts: EventCounts;\r\n  urls: string[];\r\n  clickDescriptions: string[];\r\n  inputDescriptions: InputDescription[];\r\n  events: ProcessedEvent[];\r\n}\r\n\r\n// Common ChromeRecordedEvent interface\r\nexport interface ChromeRecordedEvent {\r\n  type: string;\r\n  timestamp: number;\r\n  url?: string;\r\n  title?: string;\r\n  elementDescription?: string;\r\n  value?: string;\r\n  pageInfo?: any;\r\n  elementRect?: any;\r\n  screenshotBefore?: string;\r\n  screenshotAfter?: string;\r\n  screenshotWithBox?: string;\r\n}\r\n\r\nexport interface YamlGenerationOptions {\r\n  testName?: string;\r\n  includeTimestamps?: boolean;\r\n  maxScreenshots?: number;\r\n  description?: string;\r\n}\r\n\r\nexport interface FilteredEvents {\r\n  navigationEvents: ChromeRecordedEvent[];\r\n  clickEvents: ChromeRecordedEvent[];\r\n  inputEvents: ChromeRecordedEvent[];\r\n  scrollEvents: ChromeRecordedEvent[];\r\n}\r\n\r\n// Common utility functions (shared between YAML and Playwright generators)\r\n\r\n/**\r\n * Get screenshots from events for LLM context\r\n */\r\nexport const getScreenshotsForLLM = (\r\n  events: ChromeRecordedEvent[],\r\n  maxScreenshots = 1,\r\n): string[] => {\r\n  // Find events with screenshots, prioritizing navigation and click events\r\n  const eventsWithScreenshots = events.filter(\r\n    (event) =>\r\n      event.screenshotBefore ||\r\n      event.screenshotAfter ||\r\n      event.screenshotWithBox,\r\n  );\r\n\r\n  // Sort them by priority (navigation first, then clicks, then others)\r\n  const sortedEvents = [...eventsWithScreenshots].sort((a, b) => {\r\n    if (a.type === 'navigation' && b.type !== 'navigation') return -1;\r\n    if (a.type !== 'navigation' && b.type === 'navigation') return 1;\r\n    if (a.type === 'click' && b.type !== 'click') return -1;\r\n    if (a.type !== 'click' && b.type === 'click') return 1;\r\n    return 0;\r\n  });\r\n\r\n  // Extract up to maxScreenshots screenshots\r\n  const screenshots: string[] = [];\r\n  for (const event of sortedEvents) {\r\n    // Prefer the most informative screenshot\r\n    const screenshot =\r\n      event.screenshotWithBox ||\r\n      event.screenshotAfter ||\r\n      event.screenshotBefore;\r\n    if (screenshot && !screenshots.includes(screenshot)) {\r\n      screenshots.push(screenshot);\r\n      if (screenshots.length >= maxScreenshots) break;\r\n    }\r\n  }\r\n\r\n  return screenshots;\r\n};\r\n\r\n/**\r\n * Filter events by type for easier processing\r\n */\r\nexport const filterEventsByType = (\r\n  events: ChromeRecordedEvent[],\r\n): FilteredEvents => {\r\n  return {\r\n    navigationEvents: events.filter((event) => event.type === 'navigation'),\r\n    clickEvents: events.filter((event) => event.type === 'click'),\r\n    inputEvents: events.filter((event) => event.type === 'input'),\r\n    scrollEvents: events.filter((event) => event.type === 'scroll'),\r\n  };\r\n};\r\n\r\n/**\r\n * Create event counts summary\r\n */\r\nexport const createEventCounts = (\r\n  filteredEvents: FilteredEvents,\r\n  totalEvents: number,\r\n): EventCounts => {\r\n  return {\r\n    navigation: filteredEvents.navigationEvents.length,\r\n    click: filteredEvents.clickEvents.length,\r\n    input: filteredEvents.inputEvents.length,\r\n    scroll: filteredEvents.scrollEvents.length,\r\n    total: totalEvents,\r\n  };\r\n};\r\n\r\n/**\r\n * Extract input descriptions from input events\r\n */\r\nexport const extractInputDescriptions = (\r\n  inputEvents: ChromeRecordedEvent[],\r\n): InputDescription[] => {\r\n  return inputEvents\r\n    .map((event) => ({\r\n      description: event.elementDescription || '',\r\n      value: event.value || '',\r\n    }))\r\n    .filter((item) => item.description && item.value);\r\n};\r\n\r\n/**\r\n * Process events for LLM consumption\r\n */\r\nexport const processEventsForLLM = (\r\n  events: ChromeRecordedEvent[],\r\n): ProcessedEvent[] => {\r\n  return events.map((event) => ({\r\n    type: event.type,\r\n    timestamp: event.timestamp,\r\n    url: event.url,\r\n    title: event.title,\r\n    elementDescription: event.elementDescription,\r\n    value: event.value,\r\n    pageInfo: event.pageInfo,\r\n    elementRect: event.elementRect,\r\n  }));\r\n};\r\n\r\n/**\r\n * Prepare comprehensive event summary for LLM\r\n */\r\nexport const prepareEventSummary = (\r\n  events: ChromeRecordedEvent[],\r\n  options: { testName?: string; maxScreenshots?: number } = {},\r\n): EventSummary => {\r\n  const filteredEvents = filterEventsByType(events);\r\n  const eventCounts = createEventCounts(filteredEvents, events.length);\r\n\r\n  // Extract useful information from events\r\n  const startUrl =\r\n    filteredEvents.navigationEvents.length > 0\r\n      ? filteredEvents.navigationEvents[0].url || ''\r\n      : '';\r\n\r\n  const clickDescriptions = filteredEvents.clickEvents\r\n    .map((event) => event.elementDescription)\r\n    .filter((desc): desc is string => Boolean(desc))\r\n    .slice(0, 10);\r\n\r\n  const inputDescriptions = extractInputDescriptions(\r\n    filteredEvents.inputEvents,\r\n  ).slice(0, 10);\r\n\r\n  const urls = filteredEvents.navigationEvents\r\n    .map((e) => e.url)\r\n    .filter((url): url is string => Boolean(url))\r\n    .slice(0, 5);\r\n\r\n  const processedEvents = processEventsForLLM(events);\r\n\r\n  return {\r\n    testName: options.testName || 'Automated test from recorded events',\r\n    startUrl,\r\n    eventCounts,\r\n    urls,\r\n    clickDescriptions,\r\n    inputDescriptions,\r\n    events: processedEvents,\r\n  };\r\n};\r\n\r\n/**\r\n * Create message content for LLM with optional screenshots\r\n */\r\nexport const createMessageContent = (\r\n  promptText: string,\r\n  screenshots: string[] = [],\r\n  includeScreenshots = true,\r\n) => {\r\n  const messageContent: any[] = [\r\n    {\r\n      type: 'text',\r\n      text: promptText,\r\n    },\r\n  ];\r\n\r\n  // Add screenshots if available and requested\r\n  if (includeScreenshots && screenshots.length > 0) {\r\n    messageContent.unshift({\r\n      type: 'text',\r\n      text: 'Here are screenshots from the recording session to help you understand the context:',\r\n    });\r\n\r\n    screenshots.forEach((screenshot) => {\r\n      messageContent.push({\r\n        type: 'image_url',\r\n        image_url: {\r\n          url: screenshot,\r\n        },\r\n      });\r\n    });\r\n  }\r\n\r\n  return messageContent;\r\n};\r\n\r\n/**\r\n * Validate events before processing\r\n */\r\nexport const validateEvents = (events: ChromeRecordedEvent[]): void => {\r\n  if (!events.length) {\r\n    throw new Error('No events provided for test generation');\r\n  }\r\n};\r\n\r\n// YAML-specific generation functions\r\n\r\n/**\r\n * Generates YAML test configuration from recorded events using AI\r\n */\r\nexport const generateYamlTest = async (\r\n  events: ChromeRecordedEvent[],\r\n  options: YamlGenerationOptions,\r\n  modelConfig: IModelConfig,\r\n): Promise<string> => {\r\n  try {\r\n    // Validate input\r\n    validateEvents(events);\r\n\r\n    // Prepare event summary using shared utilities\r\n    const summary = prepareEventSummary(events, {\r\n      testName: options.testName,\r\n      maxScreenshots: options.maxScreenshots || 3,\r\n    });\r\n\r\n    // Add YAML-specific options to summary\r\n    const yamlSummary = {\r\n      ...summary,\r\n      includeTimestamps: options.includeTimestamps || false,\r\n    };\r\n\r\n    // Get screenshots for visual context\r\n    const screenshots = getScreenshotsForLLM(\r\n      events,\r\n      options.maxScreenshots || 3,\r\n    );\r\n\r\n    // Use LLM to generate the YAML test configuration\r\n    const prompt: ChatCompletionMessageParam[] = [\r\n      {\r\n        role: 'system',\r\n        content: `You are an expert in Midscene.js YAML test generation. Generate clean, accurate YAML following these rules: ${YAML_EXAMPLE_CODE}`,\r\n      },\r\n      {\r\n        role: 'user',\r\n        content: `Generate YAML test for Midscene.js automation from recorded browser events.\r\n\r\nEvent Summary:\r\n${JSON.stringify(yamlSummary, null, 2)}\r\n\r\nConvert events:\r\n- navigation → target.url\r\n- click → aiTap with element description\r\n- input → aiInput with value and locate\r\n- scroll → aiScroll with appropriate direction\r\n- Add aiAssert for important state changes\r\n\r\nImportant: Return ONLY the raw YAML content. Do NOT wrap the response in markdown code blocks (no \\`\\`\\`yaml or \\`\\`\\`). Start directly with the YAML content.`,\r\n      },\r\n    ];\r\n\r\n    // Add screenshots if available and requested\r\n    if (screenshots.length > 0) {\r\n      prompt.push({\r\n        role: 'user',\r\n        content:\r\n          'Here are screenshots from the recording session to help you understand the context:',\r\n      });\r\n\r\n      prompt.push({\r\n        role: 'user',\r\n        content: screenshots.map((screenshot) => ({\r\n          type: 'image_url',\r\n          image_url: {\r\n            url: screenshot,\r\n          },\r\n        })),\r\n      });\r\n    }\r\n\r\n    const response = await callAIWithStringResponse(\r\n      prompt,\r\n      AIActionType.TEXT,\r\n      modelConfig,\r\n    );\r\n\r\n    if (response?.content && typeof response.content === 'string') {\r\n      return response.content;\r\n    }\r\n\r\n    throw new Error('Failed to generate YAML test configuration');\r\n  } catch (error) {\r\n    throw new Error(`Failed to generate YAML test: ${error}`);\r\n  }\r\n};\r\n\r\n/**\r\n * Generates YAML test configuration from recorded events using AI with streaming support\r\n */\r\nexport const generateYamlTestStream = async (\r\n  events: ChromeRecordedEvent[],\r\n  options: YamlGenerationOptions & StreamingCodeGenerationOptions,\r\n  modelConfig: IModelConfig,\r\n): Promise<StreamingAIResponse> => {\r\n  try {\r\n    // Validate input\r\n    validateEvents(events);\r\n\r\n    // Prepare event summary using shared utilities\r\n    const summary = prepareEventSummary(events, {\r\n      testName: options.testName,\r\n      maxScreenshots: options.maxScreenshots || 3,\r\n    });\r\n\r\n    // Add YAML-specific options to summary\r\n    const yamlSummary = {\r\n      ...summary,\r\n      includeTimestamps: options.includeTimestamps || false,\r\n    };\r\n\r\n    // Get screenshots for visual context\r\n    const screenshots = getScreenshotsForLLM(\r\n      events,\r\n      options.maxScreenshots || 3,\r\n    );\r\n\r\n    // Use LLM to generate the YAML test configuration\r\n    const prompt: ChatCompletionMessageParam[] = [\r\n      {\r\n        role: 'system',\r\n        content: `You are an expert in Midscene.js YAML test generation. Generate clean, accurate YAML following these rules: ${YAML_EXAMPLE_CODE}`,\r\n      },\r\n      {\r\n        role: 'user',\r\n        content: `Generate YAML test for Midscene.js automation from recorded browser events.\r\n\r\nEvent Summary:\r\n${JSON.stringify(yamlSummary, null, 2)}\r\n\r\nConvert events:\r\n- navigation → target.url\r\n- click → aiTap with element description\r\n- input → aiInput with value and locate\r\n- scroll → aiScroll with appropriate direction\r\n- Add aiAssert for important state changes\r\n\r\nImportant: Return ONLY the raw YAML content. Do NOT wrap the response in markdown code blocks (no \\`\\`\\`yaml or \\`\\`\\`). Start directly with the YAML content.`,\r\n      },\r\n    ];\r\n\r\n    // Add screenshots if available and requested\r\n    if (screenshots.length > 0) {\r\n      prompt.push({\r\n        role: 'user',\r\n        content:\r\n          'Here are screenshots from the recording session to help you understand the context:',\r\n      });\r\n\r\n      prompt.push({\r\n        role: 'user',\r\n        content: screenshots.map((screenshot) => ({\r\n          type: 'image_url',\r\n          image_url: {\r\n            url: screenshot,\r\n          },\r\n        })),\r\n      });\r\n    }\r\n\r\n    if (options.stream && options.onChunk) {\r\n      // Use streaming\r\n      return await callAI(prompt, AIActionType.TEXT, modelConfig, {\r\n        stream: true,\r\n        onChunk: options.onChunk,\r\n      });\r\n    } else {\r\n      // Fallback to non-streaming\r\n      const response = await callAIWithStringResponse(\r\n        prompt,\r\n        AIActionType.TEXT,\r\n        modelConfig,\r\n      );\r\n\r\n      if (response?.content && typeof response.content === 'string') {\r\n        return {\r\n          content: response.content,\r\n          usage: response.usage,\r\n          isStreamed: false,\r\n        };\r\n      }\r\n\r\n      throw new Error('Failed to generate YAML test configuration');\r\n    }\r\n  } catch (error) {\r\n    throw new Error(`Failed to generate YAML test: ${error}`);\r\n  }\r\n};\r\n"],"names":["__webpack_require__","definition","key","Object","obj","prop","Symbol","getScreenshotsForLLM","events","maxScreenshots","eventsWithScreenshots","event","sortedEvents","a","b","screenshots","screenshot","filterEventsByType","createEventCounts","filteredEvents","totalEvents","extractInputDescriptions","inputEvents","item","processEventsForLLM","prepareEventSummary","options","eventCounts","startUrl","clickDescriptions","desc","Boolean","inputDescriptions","urls","e","url","processedEvents","createMessageContent","promptText","includeScreenshots","messageContent","validateEvents","Error","generateYamlTest","modelConfig","summary","yamlSummary","prompt","YAML_EXAMPLE_CODE","JSON","response","callAIWithStringResponse","AIActionType","error","generateYamlTestStream","callAI"],"mappings":"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"}