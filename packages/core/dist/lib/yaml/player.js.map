{"version":3,"file":"yaml\\player.js","sources":["webpack://@sqaitech/core/webpack/runtime/define_property_getters","webpack://@sqaitech/core/webpack/runtime/has_own_property","webpack://@sqaitech/core/webpack/runtime/make_namespace_object","webpack://@sqaitech/core/./src/yaml/player.ts"],"sourcesContent":["__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n            Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n        }\n    }\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { existsSync, mkdirSync, writeFileSync } from 'node:fs';\r\nimport { basename, dirname, join, resolve } from 'node:path';\r\nimport { assert, ifInBrowser, ifInWorker } from '@sqaitech/shared/utils';\r\n\r\n// previous defined yaml flow, as a helper\r\ninterface MidsceneYamlFlowItemAIInput extends LocateOption {\r\n  // previous version\r\n  // aiInput: string; // value to input\r\n  // locate: TUserPrompt; // where to input\r\n  aiInput: TUserPrompt | undefined; // where to input\r\n  value: string | number; // value to input\r\n}\r\n\r\ninterface MidsceneYamlFlowItemAIKeyboardPress extends LocateOption {\r\n  // previous version\r\n  // aiKeyboardPress: string;\r\n  // locate?: TUserPrompt; // where to press, optional\r\n  aiKeyboardPress: TUserPrompt | undefined; // where to press\r\n  keyName: string; // key to press\r\n}\r\n\r\ninterface MidsceneYamlFlowItemAIScroll extends LocateOption, ScrollParam {\r\n  // previous version\r\n  // aiScroll: null;\r\n  // locate?: TUserPrompt; // which area to scroll, optional\r\n  aiScroll: TUserPrompt | undefined; // which area to scroll\r\n}\r\n\r\nimport type { Agent } from '@/agent/agent';\r\nimport type { TUserPrompt } from '@/ai-model/common';\r\nimport type {\r\n  DeviceAction,\r\n  FreeFn,\r\n  LocateOption,\r\n  MidsceneYamlFlowItemAIAction,\r\n  MidsceneYamlFlowItemAIAsk,\r\n  MidsceneYamlFlowItemAIAssert,\r\n  MidsceneYamlFlowItemAIBoolean,\r\n  MidsceneYamlFlowItemAILocate,\r\n  MidsceneYamlFlowItemAINumber,\r\n  MidsceneYamlFlowItemAIQuery,\r\n  MidsceneYamlFlowItemAIString,\r\n  MidsceneYamlFlowItemAIWaitFor,\r\n  MidsceneYamlFlowItemEvaluateJavaScript,\r\n  MidsceneYamlFlowItemLogScreenshot,\r\n  MidsceneYamlFlowItemSleep,\r\n  MidsceneYamlScript,\r\n  MidsceneYamlScriptEnv,\r\n  ScriptPlayerStatusValue,\r\n  ScriptPlayerTaskStatus,\r\n  ScrollParam,\r\n} from '@/types';\r\nimport { getMidsceneRunSubDir } from '@sqaitech/shared/common';\r\nimport { getDebug } from '@sqaitech/shared/logger';\r\nimport {\r\n  buildDetailedLocateParam,\r\n  buildDetailedLocateParamAndRestParams,\r\n} from './utils';\r\n\r\nconst debug = getDebug('yaml-player');\r\nexport class ScriptPlayer<T extends MidsceneYamlScriptEnv> {\r\n  public currentTaskIndex?: number;\r\n  public taskStatusList: ScriptPlayerTaskStatus[] = [];\r\n  public status: ScriptPlayerStatusValue = 'init';\r\n  public reportFile?: string | null;\r\n  public result: Record<string, any>;\r\n  private unnamedResultIndex = 0;\r\n  public output?: string | null;\r\n  public unstableLogContent?: string | null;\r\n  public errorInSetup?: Error;\r\n  private interfaceAgent: Agent | null = null;\r\n  public agentStatusTip?: string;\r\n  public target?: MidsceneYamlScriptEnv;\r\n  private actionSpace: DeviceAction[] = [];\r\n  private scriptPath?: string;\r\n  constructor(\r\n    private script: MidsceneYamlScript,\r\n    private setupAgent: (platform: T) => Promise<{\r\n      agent: Agent;\r\n      freeFn: FreeFn[];\r\n    }>,\r\n    public onTaskStatusChange?: (taskStatus: ScriptPlayerTaskStatus) => void,\r\n    scriptPath?: string,\r\n  ) {\r\n    this.scriptPath = scriptPath;\r\n    this.result = {};\r\n    this.target =\r\n      script.target ||\r\n      script.web ||\r\n      script.android ||\r\n      script.ios ||\r\n      script.config;\r\n\r\n    if (ifInBrowser || ifInWorker) {\r\n      this.output = undefined;\r\n      debug('output is undefined in browser or worker');\r\n    } else if (this.target?.output) {\r\n      this.output = resolve(process.cwd(), this.target.output);\r\n      debug('setting output by config.output', this.output);\r\n    } else {\r\n      const scriptName = this.scriptPath\r\n        ? basename(this.scriptPath, '.yaml').replace(/\\.(ya?ml)$/i, '')\r\n        : 'script';\r\n      this.output = join(\r\n        getMidsceneRunSubDir('output'),\r\n        `${scriptName}-${Date.now()}.json`,\r\n      );\r\n      debug('setting output by script path', this.output);\r\n    }\r\n\r\n    if (ifInBrowser || ifInWorker) {\r\n      this.unstableLogContent = undefined;\r\n    } else if (typeof this.target?.unstableLogContent === 'string') {\r\n      this.unstableLogContent = resolve(\r\n        process.cwd(),\r\n        this.target.unstableLogContent,\r\n      );\r\n    } else if (this.target?.unstableLogContent === true) {\r\n      this.unstableLogContent = join(\r\n        getMidsceneRunSubDir('output'),\r\n        'unstableLogContent.json',\r\n      );\r\n    }\r\n\r\n    this.taskStatusList = (script.tasks || []).map((task, taskIndex) => ({\r\n      ...task,\r\n      index: taskIndex,\r\n      status: 'init',\r\n      totalSteps: task.flow?.length || 0,\r\n    }));\r\n  }\r\n\r\n  private setResult(key: string | undefined, value: any) {\r\n    const keyToUse = key || this.unnamedResultIndex++;\r\n    if (this.result[keyToUse]) {\r\n      console.warn(`result key ${keyToUse} already exists, will overwrite`);\r\n    }\r\n    this.result[keyToUse] = value;\r\n\r\n    return this.flushResult();\r\n  }\r\n\r\n  private setPlayerStatus(status: ScriptPlayerStatusValue, error?: Error) {\r\n    this.status = status;\r\n    this.errorInSetup = error;\r\n  }\r\n\r\n  private notifyCurrentTaskStatusChange(taskIndex?: number) {\r\n    const taskIndexToNotify =\r\n      typeof taskIndex === 'number' ? taskIndex : this.currentTaskIndex;\r\n\r\n    if (typeof taskIndexToNotify !== 'number') {\r\n      return;\r\n    }\r\n\r\n    const taskStatus = this.taskStatusList[taskIndexToNotify];\r\n    if (this.onTaskStatusChange) {\r\n      this.onTaskStatusChange(taskStatus);\r\n    }\r\n  }\r\n\r\n  private async setTaskStatus(\r\n    index: number,\r\n    statusValue: ScriptPlayerStatusValue,\r\n    error?: Error,\r\n  ) {\r\n    this.taskStatusList[index].status = statusValue;\r\n    if (error) {\r\n      this.taskStatusList[index].error = error;\r\n    }\r\n\r\n    this.notifyCurrentTaskStatusChange(index);\r\n  }\r\n\r\n  private setTaskIndex(taskIndex: number) {\r\n    this.currentTaskIndex = taskIndex;\r\n  }\r\n\r\n  private flushResult() {\r\n    if (this.output) {\r\n      const output = resolve(process.cwd(), this.output);\r\n      const outputDir = dirname(output);\r\n      if (!existsSync(outputDir)) {\r\n        mkdirSync(outputDir, { recursive: true });\r\n      }\r\n      writeFileSync(output, JSON.stringify(this.result || {}, undefined, 2));\r\n    }\r\n  }\r\n\r\n  private flushUnstableLogContent() {\r\n    if (this.unstableLogContent) {\r\n      const content = this.interfaceAgent?._unstableLogContent();\r\n      const filePath = resolve(process.cwd(), this.unstableLogContent);\r\n      const outputDir = dirname(filePath);\r\n      if (!existsSync(outputDir)) {\r\n        mkdirSync(outputDir, { recursive: true });\r\n      }\r\n      writeFileSync(filePath, JSON.stringify(content, null, 2));\r\n    }\r\n  }\r\n\r\n  async playTask(taskStatus: ScriptPlayerTaskStatus, agent: Agent) {\r\n    const { flow } = taskStatus;\r\n    assert(flow, 'missing flow in task');\r\n\r\n    for (const flowItemIndex in flow) {\r\n      const currentStep = Number.parseInt(flowItemIndex, 10);\r\n      taskStatus.currentStep = currentStep;\r\n      const flowItem = flow[flowItemIndex];\r\n      debug(\r\n        `playing step ${flowItemIndex}, flowItem=${JSON.stringify(flowItem)}`,\r\n      );\r\n      if (\r\n        'aiAction' in (flowItem as MidsceneYamlFlowItemAIAction) ||\r\n        'ai' in (flowItem as MidsceneYamlFlowItemAIAction)\r\n      ) {\r\n        const actionTask = flowItem as MidsceneYamlFlowItemAIAction;\r\n        const prompt = actionTask.aiAction || actionTask.ai;\r\n        assert(prompt, 'missing prompt for ai (aiAction)');\r\n        await agent.aiAction(prompt, {\r\n          cacheable: actionTask.cacheable,\r\n        });\r\n      } else if ('aiAssert' in (flowItem as MidsceneYamlFlowItemAIAssert)) {\r\n        const assertTask = flowItem as MidsceneYamlFlowItemAIAssert;\r\n        const prompt = assertTask.aiAssert;\r\n        const msg = assertTask.errorMessage;\r\n        assert(prompt, 'missing prompt for aiAssert');\r\n        const { pass, thought, message } =\r\n          (await agent.aiAssert(prompt, msg, {\r\n            keepRawResponse: true,\r\n          })) || {};\r\n\r\n        this.setResult(assertTask.name, {\r\n          pass,\r\n          thought,\r\n          message,\r\n        });\r\n\r\n        if (!pass) {\r\n          throw new Error(message);\r\n        }\r\n      } else if ('aiQuery' in (flowItem as MidsceneYamlFlowItemAIQuery)) {\r\n        const queryTask = flowItem as MidsceneYamlFlowItemAIQuery;\r\n        const prompt = queryTask.aiQuery;\r\n        const options = {\r\n          domIncluded: queryTask.domIncluded,\r\n          screenshotIncluded: queryTask.screenshotIncluded,\r\n        };\r\n        assert(prompt, 'missing prompt for aiQuery');\r\n        const queryResult = await agent.aiQuery(prompt, options);\r\n        this.setResult(queryTask.name, queryResult);\r\n      } else if ('aiNumber' in (flowItem as MidsceneYamlFlowItemAINumber)) {\r\n        const numberTask = flowItem as MidsceneYamlFlowItemAINumber;\r\n        const prompt = numberTask.aiNumber;\r\n        const options = {\r\n          domIncluded: numberTask.domIncluded,\r\n          screenshotIncluded: numberTask.screenshotIncluded,\r\n        };\r\n        assert(prompt, 'missing prompt for aiNumber');\r\n        const numberResult = await agent.aiNumber(prompt, options);\r\n        this.setResult(numberTask.name, numberResult);\r\n      } else if ('aiString' in (flowItem as MidsceneYamlFlowItemAIString)) {\r\n        const stringTask = flowItem as MidsceneYamlFlowItemAIString;\r\n        const prompt = stringTask.aiString;\r\n        const options = {\r\n          domIncluded: stringTask.domIncluded,\r\n          screenshotIncluded: stringTask.screenshotIncluded,\r\n        };\r\n        assert(prompt, 'missing prompt for aiString');\r\n        const stringResult = await agent.aiString(prompt, options);\r\n        this.setResult(stringTask.name, stringResult);\r\n      } else if ('aiBoolean' in (flowItem as MidsceneYamlFlowItemAIBoolean)) {\r\n        const booleanTask = flowItem as MidsceneYamlFlowItemAIBoolean;\r\n        const prompt = booleanTask.aiBoolean;\r\n        const options = {\r\n          domIncluded: booleanTask.domIncluded,\r\n          screenshotIncluded: booleanTask.screenshotIncluded,\r\n        };\r\n        assert(prompt, 'missing prompt for aiBoolean');\r\n        const booleanResult = await agent.aiBoolean(prompt, options);\r\n        this.setResult(booleanTask.name, booleanResult);\r\n      } else if ('aiAsk' in (flowItem as MidsceneYamlFlowItemAIAsk)) {\r\n        const askTask = flowItem as MidsceneYamlFlowItemAIAsk;\r\n        const prompt = askTask.aiAsk;\r\n        assert(prompt, 'missing prompt for aiAsk');\r\n        const askResult = await agent.aiAsk(prompt);\r\n        this.setResult(askTask.name, askResult);\r\n      } else if ('aiLocate' in (flowItem as MidsceneYamlFlowItemAILocate)) {\r\n        const locateTask = flowItem as MidsceneYamlFlowItemAILocate;\r\n        const prompt = locateTask.aiLocate;\r\n        assert(prompt, 'missing prompt for aiLocate');\r\n        const locateResult = await agent.aiLocate(prompt, locateTask);\r\n        this.setResult(locateTask.name, locateResult);\r\n      } else if ('aiWaitFor' in (flowItem as MidsceneYamlFlowItemAIWaitFor)) {\r\n        const waitForTask = flowItem as MidsceneYamlFlowItemAIWaitFor;\r\n        const prompt = waitForTask.aiWaitFor;\r\n        assert(prompt, 'missing prompt for aiWaitFor');\r\n        const timeout = waitForTask.timeout;\r\n        await agent.aiWaitFor(prompt, { timeoutMs: timeout });\r\n      } else if ('sleep' in (flowItem as MidsceneYamlFlowItemSleep)) {\r\n        const sleepTask = flowItem as MidsceneYamlFlowItemSleep;\r\n        const ms = sleepTask.sleep;\r\n        let msNumber = ms;\r\n        if (typeof ms === 'string') {\r\n          msNumber = Number.parseInt(ms, 10);\r\n        }\r\n        assert(\r\n          msNumber && msNumber > 0,\r\n          `ms for sleep must be greater than 0, but got ${ms}`,\r\n        );\r\n        await new Promise((resolve) => setTimeout(resolve, msNumber));\r\n      } else if (\r\n        'javascript' in (flowItem as MidsceneYamlFlowItemEvaluateJavaScript)\r\n      ) {\r\n        const evaluateJavaScriptTask =\r\n          flowItem as MidsceneYamlFlowItemEvaluateJavaScript;\r\n\r\n        const result = await agent.evaluateJavaScript(\r\n          evaluateJavaScriptTask.javascript,\r\n        );\r\n        this.setResult(evaluateJavaScriptTask.name, result);\r\n      } else if (\r\n        'logScreenshot' in (flowItem as MidsceneYamlFlowItemLogScreenshot)\r\n      ) {\r\n        const logScreenshotTask = flowItem as MidsceneYamlFlowItemLogScreenshot;\r\n        await agent.logScreenshot(logScreenshotTask.logScreenshot, {\r\n          content: logScreenshotTask.content || '',\r\n        });\r\n      } else if ('aiInput' in (flowItem as MidsceneYamlFlowItemAIInput)) {\r\n        // may be input empty string ''\r\n        const { aiInput, ...inputTask } =\r\n          flowItem as MidsceneYamlFlowItemAIInput;\r\n\r\n        // Compatibility with previous version:\r\n        // Old format: { aiInput: string (value), locate: TUserPrompt }\r\n        // New format - 1: { aiInput: TUserPrompt, value: string | number }\r\n        // New format - 2: { aiInput: undefined, locate: TUserPrompt, value: string | number }\r\n        let locatePrompt: TUserPrompt | undefined;\r\n        let value: string | number | undefined;\r\n        if ((inputTask as any).locate) {\r\n          // Old format - aiInput is the value, locate is the prompt\r\n          value = (aiInput as string) || inputTask.value;\r\n          locatePrompt = (inputTask as any).locate;\r\n        } else {\r\n          // New format - aiInput is the prompt, value is the value\r\n          locatePrompt = aiInput || '';\r\n          value = inputTask.value;\r\n        }\r\n\r\n        await agent.callActionInActionSpace('Input', {\r\n          ...inputTask,\r\n          ...(value !== undefined ? { value: String(value) } : {}),\r\n          ...(locatePrompt\r\n            ? { locate: buildDetailedLocateParam(locatePrompt, inputTask) }\r\n            : {}),\r\n        });\r\n      } else if (\r\n        'aiKeyboardPress' in (flowItem as MidsceneYamlFlowItemAIKeyboardPress)\r\n      ) {\r\n        const { aiKeyboardPress, ...keyboardPressTask } =\r\n          flowItem as MidsceneYamlFlowItemAIKeyboardPress;\r\n\r\n        // Compatibility with previous version:\r\n        // Old format: { aiKeyboardPress: string (key), locate?: TUserPrompt }\r\n        // New format - 1: { aiKeyboardPress: TUserPrompt, keyName: string }\r\n        // New format - 2: { aiKeyboardPress: , locate?: TUserPrompt, keyName: string }\r\n        let locatePrompt: TUserPrompt | undefined;\r\n        let keyName: string | undefined;\r\n        if ((keyboardPressTask as any).locate) {\r\n          // Old format - aiKeyboardPress is the key, locate is the prompt\r\n          keyName = aiKeyboardPress as string;\r\n          locatePrompt = (keyboardPressTask as any).locate;\r\n        } else if (keyboardPressTask.keyName) {\r\n          // New format - aiKeyboardPress is the prompt, key is the key\r\n          keyName = keyboardPressTask.keyName;\r\n          locatePrompt = aiKeyboardPress;\r\n        } else {\r\n          keyName = aiKeyboardPress as string;\r\n        }\r\n\r\n        await agent.callActionInActionSpace('KeyboardPress', {\r\n          ...keyboardPressTask,\r\n          ...(keyName ? { keyName } : {}),\r\n          ...(locatePrompt\r\n            ? {\r\n                locate: buildDetailedLocateParam(\r\n                  locatePrompt,\r\n                  keyboardPressTask,\r\n                ),\r\n              }\r\n            : {}),\r\n        });\r\n      } else if ('aiScroll' in (flowItem as MidsceneYamlFlowItemAIScroll)) {\r\n        const { aiScroll, ...scrollTask } =\r\n          flowItem as MidsceneYamlFlowItemAIScroll;\r\n\r\n        // Compatibility with previous version:\r\n        // Old format: { aiScroll: null, locate?: TUserPrompt, direction, scrollType, distance? }\r\n        // New format - 1: { aiScroll: TUserPrompt, direction, scrollType, distance? }\r\n        // New format - 2: { aiScroll: undefined, locate: TUserPrompt, direction, scrollType, distance? }\r\n        let locatePrompt: TUserPrompt | undefined;\r\n        if ((scrollTask as any).locate) {\r\n          // Old format - locate is the prompt, aiScroll is null/ignored\r\n          locatePrompt = (scrollTask as any).locate;\r\n        } else {\r\n          // New format - aiScroll is the prompt, or no prompt for global scroll\r\n          locatePrompt = aiScroll;\r\n        }\r\n\r\n        await agent.callActionInActionSpace('Scroll', {\r\n          ...scrollTask,\r\n          ...(locatePrompt\r\n            ? { locate: buildDetailedLocateParam(locatePrompt, scrollTask) }\r\n            : {}),\r\n        });\r\n      } else {\r\n        // generic action, find the action in actionSpace\r\n\r\n        /* for aiTap, aiRightClick, the parameters are a flattened data for the 'locate', these are all valid data\r\n\r\n        - aiTap: 'search input box'\r\n        - aiTap: 'search input box'\r\n          deepThink: true\r\n          cacheable: false\r\n        - aiTap:\r\n          prompt: 'search input box'\r\n        - aiTap:\r\n          prompt: 'search input box'\r\n          deepThink: true\r\n          cacheable: false\r\n        */\r\n\r\n        const actionSpace = this.actionSpace;\r\n        let locatePromptShortcut: string | undefined;\r\n        const matchedAction = actionSpace.find((action) => {\r\n          const actionInterfaceAlias = action.interfaceAlias;\r\n          if (\r\n            actionInterfaceAlias &&\r\n            Object.prototype.hasOwnProperty.call(flowItem, actionInterfaceAlias)\r\n          ) {\r\n            locatePromptShortcut = flowItem[\r\n              actionInterfaceAlias as keyof typeof flowItem\r\n            ] as string;\r\n            return true;\r\n          }\r\n\r\n          const keyOfActionInActionSpace = action.name;\r\n          if (\r\n            Object.prototype.hasOwnProperty.call(\r\n              flowItem,\r\n              keyOfActionInActionSpace,\r\n            )\r\n          ) {\r\n            locatePromptShortcut = flowItem[\r\n              keyOfActionInActionSpace as keyof typeof flowItem\r\n            ] as string;\r\n            return true;\r\n          }\r\n\r\n          return false;\r\n        });\r\n\r\n        assert(\r\n          matchedAction,\r\n          `unknown flowItem in yaml: ${JSON.stringify(flowItem)}`,\r\n        );\r\n\r\n        assert(\r\n          !((flowItem as any).prompt && locatePromptShortcut),\r\n          `conflict locate prompt for item: ${JSON.stringify(flowItem)}`,\r\n        );\r\n\r\n        if (locatePromptShortcut) {\r\n          (flowItem as any).prompt = locatePromptShortcut;\r\n        }\r\n\r\n        const { locateParam, restParams } =\r\n          buildDetailedLocateParamAndRestParams(\r\n            locatePromptShortcut || '',\r\n            flowItem as LocateOption,\r\n            [\r\n              matchedAction.name,\r\n              matchedAction.interfaceAlias || '_never_mind_',\r\n            ],\r\n          );\r\n\r\n        const flowParams = {\r\n          ...restParams,\r\n          locate: locateParam,\r\n        };\r\n\r\n        debug(\r\n          `matchedAction: ${matchedAction.name}`,\r\n          `flowParams: ${JSON.stringify(flowParams, null, 2)}`,\r\n        );\r\n        await agent.callActionInActionSpace(matchedAction.name, flowParams);\r\n      }\r\n    }\r\n    this.reportFile = agent.reportFile;\r\n    await this.flushUnstableLogContent();\r\n  }\r\n\r\n  async run() {\r\n    const { target, web, android, ios, tasks } = this.script;\r\n    const webEnv = web || target;\r\n    const androidEnv = android;\r\n    const iosEnv = ios;\r\n    const platform = webEnv || androidEnv || iosEnv;\r\n\r\n    this.setPlayerStatus('running');\r\n\r\n    let agent: Agent | null = null;\r\n    let freeFn: FreeFn[] = [];\r\n    try {\r\n      const { agent: newAgent, freeFn: newFreeFn } = await this.setupAgent(\r\n        platform as T,\r\n      );\r\n      this.actionSpace = await newAgent.getActionSpace();\r\n      agent = newAgent;\r\n      const originalOnTaskStartTip = agent.onTaskStartTip;\r\n      agent.onTaskStartTip = (tip) => {\r\n        if (this.status === 'running') {\r\n          this.agentStatusTip = tip;\r\n        }\r\n        originalOnTaskStartTip?.(tip);\r\n      };\r\n      freeFn = [\r\n        ...(newFreeFn || []),\r\n        {\r\n          name: 'restore-agent-onTaskStartTip',\r\n          fn: () => {\r\n            if (agent) {\r\n              agent.onTaskStartTip = originalOnTaskStartTip;\r\n            }\r\n          },\r\n        },\r\n      ];\r\n    } catch (e) {\r\n      this.setPlayerStatus('error', e as Error);\r\n      return;\r\n    }\r\n    this.interfaceAgent = agent;\r\n\r\n    let taskIndex = 0;\r\n    this.setPlayerStatus('running');\r\n    let errorFlag = false;\r\n    while (taskIndex < tasks.length) {\r\n      const taskStatus = this.taskStatusList[taskIndex];\r\n      this.setTaskStatus(taskIndex, 'running' as any);\r\n      this.setTaskIndex(taskIndex);\r\n\r\n      try {\r\n        await this.playTask(taskStatus, this.interfaceAgent);\r\n        this.setTaskStatus(taskIndex, 'done' as any);\r\n      } catch (e) {\r\n        this.setTaskStatus(taskIndex, 'error' as any, e as Error);\r\n\r\n        if (taskStatus.continueOnError) {\r\n          // nothing more to do\r\n        } else {\r\n          this.reportFile = agent.reportFile;\r\n          errorFlag = true;\r\n          break;\r\n        }\r\n      }\r\n      this.reportFile = agent?.reportFile;\r\n      taskIndex++;\r\n    }\r\n\r\n    if (errorFlag) {\r\n      this.setPlayerStatus('error');\r\n    } else {\r\n      this.setPlayerStatus('done');\r\n    }\r\n    this.agentStatusTip = '';\r\n\r\n    // free the resources\r\n    for (const fn of freeFn) {\r\n      try {\r\n        // console.log('freeing', fn.name);\r\n        await fn.fn();\r\n        // console.log('freed', fn.name);\r\n      } catch (e) {\r\n        // console.error('error freeing', fn.name, e);\r\n      }\r\n    }\r\n  }\r\n}\r\n"],"names":["__webpack_require__","definition","key","Object","obj","prop","Symbol","debug","getDebug","ScriptPlayer","value","keyToUse","console","status","error","taskIndex","taskIndexToNotify","taskStatus","index","statusValue","output","resolve","process","outputDir","dirname","existsSync","mkdirSync","writeFileSync","JSON","undefined","_this_interfaceAgent","content","filePath","agent","flow","assert","flowItemIndex","currentStep","Number","flowItem","actionTask","prompt","assertTask","msg","pass","thought","message","Error","queryTask","options","queryResult","numberTask","numberResult","stringTask","stringResult","booleanTask","booleanResult","askTask","askResult","locateTask","locateResult","waitForTask","timeout","sleepTask","ms","msNumber","Promise","setTimeout","evaluateJavaScriptTask","result","logScreenshotTask","aiInput","inputTask","locatePrompt","String","buildDetailedLocateParam","aiKeyboardPress","keyboardPressTask","keyName","aiScroll","scrollTask","actionSpace","locatePromptShortcut","matchedAction","action","actionInterfaceAlias","keyOfActionInActionSpace","locateParam","restParams","buildDetailedLocateParamAndRestParams","flowParams","target","web","android","ios","tasks","webEnv","androidEnv","iosEnv","platform","freeFn","newAgent","newFreeFn","originalOnTaskStartTip","tip","e","errorFlag","fn","script","setupAgent","onTaskStatusChange","scriptPath","_this_target","_this_target1","_this_target2","ifInBrowser","ifInWorker","scriptName","basename","join","getMidsceneRunSubDir","Date","task","_task_flow"],"mappings":"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"}