{"version":3,"file":"adapters\\base.js","sources":["webpack://@sqai/playground/webpack/runtime/define_property_getters","webpack://@sqai/playground/webpack/runtime/has_own_property","webpack://@sqai/playground/webpack/runtime/make_namespace_object","webpack://@sqai/playground/./src/adapters/base.ts"],"sourcesContent":["__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n            Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n        }\n    }\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import type { DeviceAction } from '@sqai/core';\r\nimport { findAllMidsceneLocatorField } from '@sqai/core/ai-model';\r\nimport type { ExecutionOptions, FormValue, ValidationResult } from '../types';\r\n\r\nexport abstract class BasePlaygroundAdapter {\r\n  abstract parseStructuredParams(\r\n    action: DeviceAction<unknown>,\r\n    params: Record<string, unknown>,\r\n    options: ExecutionOptions,\r\n  ): Promise<unknown[]>;\r\n\r\n  abstract formatErrorMessage(error: any): string;\r\n\r\n  // Abstract method for execution - must be implemented by concrete adapters\r\n  abstract executeAction(\r\n    actionType: string,\r\n    value: FormValue,\r\n    options: ExecutionOptions,\r\n  ): Promise<unknown>;\r\n\r\n  // Optional method for getting action space - default implementation returns empty array\r\n  async getActionSpace(_context: any): Promise<DeviceAction<unknown>[]> {\r\n    return [];\r\n  }\r\n\r\n  // Common validation logic - can be overridden if needed\r\n  validateParams(\r\n    value: FormValue,\r\n    action: DeviceAction<unknown> | undefined,\r\n  ): ValidationResult {\r\n    if (!action?.paramSchema) {\r\n      return { valid: true };\r\n    }\r\n\r\n    const needsStructuredParams = this.actionNeedsStructuredParams(action);\r\n\r\n    if (!needsStructuredParams) {\r\n      return { valid: true };\r\n    }\r\n\r\n    if (!value.params) {\r\n      return { valid: false, errorMessage: 'Parameters are required' };\r\n    }\r\n\r\n    try {\r\n      const paramsForValidation = this.prepareParamsForValidation(\r\n        value.params,\r\n        action,\r\n      );\r\n      action.paramSchema.parse(paramsForValidation);\r\n      return { valid: true };\r\n    } catch (error: unknown) {\r\n      return this.handleValidationError(error);\r\n    }\r\n  }\r\n\r\n  // Common display content creation logic - can be overridden if needed\r\n  createDisplayContent(\r\n    value: FormValue,\r\n    needsStructuredParams: boolean,\r\n    action: DeviceAction<unknown> | undefined,\r\n  ): string {\r\n    if (!needsStructuredParams || !value.params || !action?.paramSchema) {\r\n      return value.prompt || '';\r\n    }\r\n\r\n    const paramsList = this.buildParamsDisplayList(value.params, action);\r\n    return paramsList.join('\\n') || value.prompt || '';\r\n  }\r\n\r\n  // Helper method for basic error message formatting\r\n  protected formatBasicErrorMessage(error: any): string {\r\n    return error?.message || 'Unknown error';\r\n  }\r\n\r\n  // Helper method for parsing structured params base logic\r\n  protected getSchemaKeys(action: DeviceAction<unknown>): string[] {\r\n    if (!action?.paramSchema || !('shape' in action.paramSchema)) {\r\n      return [];\r\n    }\r\n\r\n    const schema = action.paramSchema;\r\n    return schema && 'shape' in schema\r\n      ? Object.keys((schema as { shape: Record<string, unknown> }).shape)\r\n      : [];\r\n  }\r\n\r\n  // Helper method for filtering valid params\r\n  protected filterValidParams(\r\n    params: Record<string, unknown>,\r\n    excludeKeys: string[] = [],\r\n  ): Record<string, unknown> {\r\n    const filtered: Record<string, unknown> = {};\r\n\r\n    Object.keys(params).forEach((key) => {\r\n      if (\r\n        !excludeKeys.includes(key) &&\r\n        params[key] !== undefined &&\r\n        params[key] !== null &&\r\n        params[key] !== ''\r\n      ) {\r\n        filtered[key] = params[key];\r\n      }\r\n    });\r\n\r\n    return filtered;\r\n  }\r\n\r\n  // Check if action needs structured parameters\r\n  protected actionNeedsStructuredParams(\r\n    action: DeviceAction<unknown>,\r\n  ): boolean {\r\n    if (\r\n      typeof action.paramSchema === 'object' &&\r\n      'shape' in action.paramSchema\r\n    ) {\r\n      const shape =\r\n        (action.paramSchema as { shape: Record<string, unknown> }).shape || {};\r\n      return Object.keys(shape).length > 0;\r\n    }\r\n    return true; // If paramSchema exists but not in expected format, assume it needs params\r\n  }\r\n\r\n  // Prepare parameters for validation by converting string locate fields\r\n  protected prepareParamsForValidation(\r\n    params: Record<string, unknown>,\r\n    action: DeviceAction<unknown>,\r\n  ): Record<string, unknown> {\r\n    const paramsForValidation = { ...params };\r\n\r\n    if (action.paramSchema) {\r\n      const locatorFieldKeys = findAllMidsceneLocatorField(action.paramSchema);\r\n      locatorFieldKeys.forEach((key: string) => {\r\n        if (typeof paramsForValidation[key] === 'string') {\r\n          paramsForValidation[key] = {\r\n            midscene_location_field_flag: true,\r\n            prompt: paramsForValidation[key],\r\n            center: [0, 0], // dummy values for validation\r\n            rect: { left: 0, top: 0, width: 0, height: 0 },\r\n          };\r\n        }\r\n      });\r\n    }\r\n\r\n    return paramsForValidation;\r\n  }\r\n\r\n  // Handle validation errors with proper error message extraction\r\n  protected handleValidationError(error: unknown): ValidationResult {\r\n    const zodError = error as {\r\n      errors?: Array<{ path: string[]; message: string }>;\r\n    };\r\n\r\n    if (zodError.errors && zodError.errors.length > 0) {\r\n      const errorMessages = zodError.errors\r\n        .filter((err) => {\r\n          const path = err.path.join('.');\r\n          return (\r\n            !path.includes('center') &&\r\n            !path.includes('rect') &&\r\n            !path.includes('midscene_location_field_flag')\r\n          );\r\n        })\r\n        .map((err) => {\r\n          const field = err.path.join('.');\r\n          return `${field}: ${err.message}`;\r\n        });\r\n\r\n      if (errorMessages.length > 0) {\r\n        return {\r\n          valid: false,\r\n          errorMessage: `Validation error: ${errorMessages.join(', ')}`,\r\n        };\r\n      }\r\n    }\r\n\r\n    const errorMsg =\r\n      error instanceof Error ? error.message : 'Unknown validation error';\r\n\r\n    return {\r\n      valid: false,\r\n      errorMessage: `Parameter validation failed: ${errorMsg}`,\r\n    };\r\n  }\r\n\r\n  // Build display list for parameters\r\n  protected buildParamsDisplayList(\r\n    params: Record<string, unknown>,\r\n    action: DeviceAction<unknown>,\r\n  ): string[] {\r\n    const paramsList: string[] = [];\r\n    const schema = action.paramSchema;\r\n\r\n    if (!(schema && 'shape' in schema)) {\r\n      return paramsList;\r\n    }\r\n\r\n    const locatorFieldKeys = findAllMidsceneLocatorField(schema);\r\n    const shapeKeys = Object.keys(\r\n      (schema as { shape: Record<string, unknown> }).shape,\r\n    );\r\n\r\n    shapeKeys.forEach((key) => {\r\n      const paramValue = params[key];\r\n      if (this.isValidParamValue(paramValue)) {\r\n        const displayKey = this.capitalizeFirstLetter(key);\r\n        const formattedValue = this.formatParamValue(\r\n          key,\r\n          paramValue,\r\n          locatorFieldKeys.includes(key),\r\n        );\r\n        paramsList.push(`${displayKey}: ${formattedValue}`);\r\n      }\r\n    });\r\n\r\n    return paramsList;\r\n  }\r\n\r\n  // Check if parameter value is valid for display\r\n  protected isValidParamValue(value: unknown): boolean {\r\n    return value !== undefined && value !== null && value !== '';\r\n  }\r\n\r\n  // Capitalize first letter of a string\r\n  protected capitalizeFirstLetter(str: string): string {\r\n    return str.charAt(0).toUpperCase() + str.slice(1);\r\n  }\r\n\r\n  // Format parameter value for display\r\n  protected formatParamValue(\r\n    key: string,\r\n    value: unknown,\r\n    isLocateField: boolean,\r\n  ): string {\r\n    if (isLocateField || typeof value === 'string') {\r\n      return `\"${value}\"`;\r\n    }\r\n\r\n    if (typeof value === 'number') {\r\n      // Special handling for distance in scroll\r\n      return key === 'distance' ? `${value}px` : `${value}`;\r\n    }\r\n\r\n    return `${value}`;\r\n  }\r\n}\r\n"],"names":["__webpack_require__","definition","key","Object","obj","prop","Symbol","BasePlaygroundAdapter","_context","value","action","needsStructuredParams","paramsForValidation","error","paramsList","schema","params","excludeKeys","filtered","undefined","shape","locatorFieldKeys","findAllMidsceneLocatorField","zodError","errorMessages","err","path","field","errorMsg","Error","shapeKeys","paramValue","displayKey","formattedValue","str","isLocateField"],"mappings":"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"}