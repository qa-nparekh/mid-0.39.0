{"version":3,"file":"adapters\\remote-execution.js","sources":["webpack://@sqaitech/playground/webpack/runtime/define_property_getters","webpack://@sqaitech/playground/webpack/runtime/has_own_property","webpack://@sqaitech/playground/webpack/runtime/make_namespace_object","webpack://@sqaitech/playground/./src/adapters/remote-execution.ts"],"sourcesContent":["__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n            Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n        }\n    }\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import type { DeviceAction } from '@sqaitech/core';\r\nimport { parseStructuredParams } from '../common';\r\nimport type { ExecutionOptions, FormValue, ValidationResult } from '../types';\r\nimport { BasePlaygroundAdapter } from './base';\r\n\r\nexport class RemoteExecutionAdapter extends BasePlaygroundAdapter {\r\n  private serverUrl?: string;\r\n  private progressPolling = new Map<string, NodeJS.Timeout>();\r\n  private progressCallback?: (tip: string) => void;\r\n  private _id?: string;\r\n\r\n  constructor(serverUrl: string) {\r\n    super();\r\n    this.serverUrl = serverUrl;\r\n  }\r\n\r\n  // Get adapter ID (cached after first status check for remote)\r\n  get id(): string | undefined {\r\n    return this._id;\r\n  }\r\n\r\n  // Override validateParams for remote execution\r\n  // Since schemas from server are JSON-serialized and lack .parse() method\r\n  validateParams(\r\n    value: FormValue,\r\n    action: DeviceAction<unknown> | undefined,\r\n  ): ValidationResult {\r\n    if (!action?.paramSchema) {\r\n      return { valid: true };\r\n    }\r\n\r\n    const needsStructuredParams = this.actionNeedsStructuredParams(action);\r\n\r\n    if (!needsStructuredParams) {\r\n      return { valid: true };\r\n    }\r\n\r\n    if (!value.params) {\r\n      return { valid: false, errorMessage: 'Parameters are required' };\r\n    }\r\n\r\n    // For remote execution, perform basic validation without .parse()\r\n    // Check if required fields are present\r\n    if (action.paramSchema && typeof action.paramSchema === 'object') {\r\n      const schema = action.paramSchema as any;\r\n      if (schema.shape || schema.type === 'ZodObject') {\r\n        const shape = schema.shape || {};\r\n        const missingFields = Object.keys(shape).filter((key) => {\r\n          const fieldDef = shape[key];\r\n          // Check if field is required (not optional)\r\n          const isOptional =\r\n            fieldDef?.isOptional ||\r\n            fieldDef?._def?.innerType || // ZodOptional\r\n            fieldDef?._def?.typeName === 'ZodOptional';\r\n          return (\r\n            !isOptional &&\r\n            (value.params![key] === undefined || value.params![key] === '')\r\n          );\r\n        });\r\n\r\n        if (missingFields.length > 0) {\r\n          return {\r\n            valid: false,\r\n            errorMessage: `Missing required parameters: ${missingFields.join(', ')}`,\r\n          };\r\n        }\r\n      }\r\n    }\r\n\r\n    return { valid: true };\r\n  }\r\n\r\n  async parseStructuredParams(\r\n    action: DeviceAction<unknown>,\r\n    params: Record<string, unknown>,\r\n    options: ExecutionOptions,\r\n  ): Promise<unknown[]> {\r\n    // Use shared implementation from common.ts\r\n    return await parseStructuredParams(action, params, options);\r\n  }\r\n\r\n  formatErrorMessage(error: any): string {\r\n    const message = error?.message || '';\r\n\r\n    // Handle Android-specific errors\r\n    const androidErrors = [\r\n      {\r\n        keyword: 'adb',\r\n        message:\r\n          'ADB connection error. Please ensure device is connected and USB debugging is enabled.',\r\n      },\r\n      {\r\n        keyword: 'UIAutomator',\r\n        message:\r\n          'UIAutomator error. Please ensure the UIAutomator server is running on the device.',\r\n      },\r\n    ];\r\n\r\n    const androidError = androidErrors.find(({ keyword }) =>\r\n      message.includes(keyword),\r\n    );\r\n    if (androidError) {\r\n      return androidError.message;\r\n    }\r\n\r\n    return this.formatBasicErrorMessage(error);\r\n  }\r\n\r\n  // Remote execution adapter - simplified interface\r\n  async executeAction(\r\n    actionType: string,\r\n    value: FormValue,\r\n    options: ExecutionOptions,\r\n  ): Promise<unknown> {\r\n    // If serverUrl is provided, use server-side execution\r\n    if (this.serverUrl && typeof window !== 'undefined') {\r\n      return this.executeViaServer(actionType, value, options);\r\n    }\r\n\r\n    throw new Error(\r\n      'Remote execution adapter requires server URL for execution',\r\n    );\r\n  }\r\n\r\n  // Remote execution via server - uses same endpoint as requestPlaygroundServer\r\n  private async executeViaServer(\r\n    actionType: string,\r\n    value: FormValue,\r\n    options: ExecutionOptions,\r\n  ): Promise<unknown> {\r\n    const payload: Record<string, unknown> = {\r\n      type: actionType,\r\n      prompt: value.prompt,\r\n      ...this.buildOptionalPayloadParams(options, value),\r\n    };\r\n\r\n    // Add context only if it exists (server can handle single agent case without context)\r\n    if (options.context) {\r\n      payload.context = options.context;\r\n    }\r\n\r\n    // Start progress polling if callback is set and requestId exists\r\n    if (options.requestId && this.progressCallback) {\r\n      this.startProgressPolling(options.requestId, this.progressCallback);\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`${this.serverUrl}/execute`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify(payload),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorText = await response.text().catch(() => 'Unknown error');\r\n        throw new Error(\r\n          `Server request failed (${response.status}): ${errorText}`,\r\n        );\r\n      }\r\n\r\n      const result = await response.json();\r\n\r\n      // Stop progress polling when execution completes\r\n      if (options.requestId) {\r\n        this.stopProgressPolling(options.requestId);\r\n      }\r\n\r\n      return result;\r\n    } catch (error) {\r\n      // Stop progress polling on error\r\n      if (options.requestId) {\r\n        this.stopProgressPolling(options.requestId);\r\n      }\r\n      console.error('Execute via server failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Helper method to build optional payload parameters\r\n  private buildOptionalPayloadParams(\r\n    options: ExecutionOptions,\r\n    value: FormValue,\r\n  ): Record<string, unknown> {\r\n    const optionalParams: Record<string, unknown> = {};\r\n\r\n    // Add optional parameters only if they have meaningful values\r\n    const optionalFields = [\r\n      { key: 'requestId', value: options.requestId },\r\n      { key: 'deepThink', value: options.deepThink },\r\n      { key: 'screenshotIncluded', value: options.screenshotIncluded },\r\n      { key: 'domIncluded', value: options.domIncluded },\r\n      { key: 'params', value: value.params },\r\n    ] as const;\r\n\r\n    optionalFields.forEach(({ key, value }) => {\r\n      if (value !== undefined && value !== null && value !== '') {\r\n        optionalParams[key] = value;\r\n      }\r\n    });\r\n\r\n    return optionalParams;\r\n  }\r\n\r\n  // Get action space from server with fallback\r\n  async getActionSpace(context?: unknown): Promise<DeviceAction<unknown>[]> {\r\n    // Try server first if available\r\n    if (this.serverUrl && typeof window !== 'undefined') {\r\n      try {\r\n        const response = await fetch(`${this.serverUrl}/action-space`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify({ context }),\r\n        });\r\n\r\n        if (!response.ok) {\r\n          throw new Error(`Failed to get action space: ${response.statusText}`);\r\n        }\r\n\r\n        const result = await response.json();\r\n        return Array.isArray(result) ? result : [];\r\n      } catch (error) {\r\n        console.error('Failed to get action space from server:', error);\r\n        // Fall through to context fallback\r\n      }\r\n    }\r\n\r\n    // Fallback: try context.actionSpace if available\r\n    if (context && typeof context === 'object' && 'actionSpace' in context) {\r\n      try {\r\n        const actionSpaceMethod = (\r\n          context as { actionSpace: () => Promise<DeviceAction<unknown>[]> }\r\n        ).actionSpace;\r\n        const result = await actionSpaceMethod();\r\n        return Array.isArray(result) ? result : [];\r\n      } catch (error) {\r\n        console.error('Failed to get action space from context:', error);\r\n      }\r\n    }\r\n\r\n    return [];\r\n  }\r\n\r\n  // Uses base implementation for validateParams and createDisplayContent\r\n\r\n  // Server communication methods\r\n  async checkStatus(): Promise<boolean> {\r\n    if (!this.serverUrl) {\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const res = await fetch(`${this.serverUrl}/status`);\r\n      if (res.status === 200) {\r\n        // Try to extract id from response\r\n        try {\r\n          const data = await res.json();\r\n          if (data.id && typeof data.id === 'string') {\r\n            this._id = data.id;\r\n          }\r\n        } catch (jsonError) {\r\n          // If JSON parsing fails, id remains undefined but status is still OK\r\n          console.debug('Failed to parse status response:', jsonError);\r\n        }\r\n        return true;\r\n      }\r\n      return false;\r\n    } catch (error) {\r\n      console.warn('Server status check failed:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async overrideConfig(aiConfig: Record<string, unknown>): Promise<void> {\r\n    if (!this.serverUrl) {\r\n      throw new Error('Server URL not configured');\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`${this.serverUrl}/config`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ aiConfig }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(\r\n          `Failed to override server config: ${response.statusText}`,\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to override server config:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async getTaskProgress(requestId: string): Promise<{ tip?: string }> {\r\n    if (!this.serverUrl) {\r\n      return { tip: undefined };\r\n    }\r\n\r\n    if (!requestId?.trim()) {\r\n      console.warn('Invalid requestId provided for task progress');\r\n      return { tip: undefined };\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(\r\n        `${this.serverUrl}/task-progress/${encodeURIComponent(requestId)}`,\r\n      );\r\n\r\n      if (!response.ok) {\r\n        console.warn(`Task progress request failed: ${response.statusText}`);\r\n        return { tip: undefined };\r\n      }\r\n\r\n      return await response.json();\r\n    } catch (error) {\r\n      console.error('Failed to poll task progress:', error);\r\n      return { tip: undefined };\r\n    }\r\n  }\r\n\r\n  // Cancel task\r\n  async cancelTask(\r\n    requestId: string,\r\n  ): Promise<{ error?: string; success?: boolean }> {\r\n    // Stop progress polling\r\n    this.stopProgressPolling(requestId);\r\n\r\n    if (!this.serverUrl) {\r\n      return { error: 'No server URL configured' };\r\n    }\r\n\r\n    if (!requestId?.trim()) {\r\n      return { error: 'Invalid request ID' };\r\n    }\r\n\r\n    try {\r\n      const res = await fetch(\r\n        `${this.serverUrl}/cancel/${encodeURIComponent(requestId)}`,\r\n        {\r\n          method: 'POST',\r\n        },\r\n      );\r\n\r\n      if (!res.ok) {\r\n        return { error: `Cancel request failed: ${res.statusText}` };\r\n      }\r\n\r\n      const result = await res.json();\r\n      return { success: true, ...result };\r\n    } catch (error) {\r\n      console.error('Failed to cancel task:', error);\r\n      return { error: 'Failed to cancel task' };\r\n    }\r\n  }\r\n\r\n  // Progress callback management\r\n  setProgressCallback(callback: (tip: string) => void): void {\r\n    this.progressCallback = callback;\r\n  }\r\n\r\n  // Start progress polling\r\n  private startProgressPolling(\r\n    requestId: string,\r\n    callback: (tip: string) => void,\r\n  ): void {\r\n    // Don't start multiple polling for the same request\r\n    if (this.progressPolling.has(requestId)) {\r\n      return;\r\n    }\r\n\r\n    let lastTip = '';\r\n    const interval = setInterval(async () => {\r\n      try {\r\n        const progress = await this.getTaskProgress(requestId);\r\n        if (progress?.tip?.trim?.() && progress.tip !== lastTip) {\r\n          lastTip = progress.tip;\r\n          callback(progress.tip);\r\n        }\r\n      } catch (error) {\r\n        // Silently ignore progress polling errors to avoid spam\r\n        console.debug('Progress polling error:', error);\r\n      }\r\n    }, 500); // Poll every 500ms\r\n\r\n    this.progressPolling.set(requestId, interval);\r\n  }\r\n\r\n  // Stop progress polling\r\n  private stopProgressPolling(requestId: string): void {\r\n    const interval = this.progressPolling.get(requestId);\r\n    if (interval) {\r\n      clearInterval(interval);\r\n      this.progressPolling.delete(requestId);\r\n    }\r\n  }\r\n\r\n  // Get screenshot from server\r\n  async getScreenshot(): Promise<{\r\n    screenshot: string;\r\n    timestamp: number;\r\n  } | null> {\r\n    if (!this.serverUrl) {\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`${this.serverUrl}/screenshot`);\r\n\r\n      if (!response.ok) {\r\n        console.warn(`Screenshot request failed: ${response.statusText}`);\r\n        return null;\r\n      }\r\n\r\n      return await response.json();\r\n    } catch (error) {\r\n      console.error('Failed to get screenshot:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Get interface information from server\r\n  async getInterfaceInfo(): Promise<{\r\n    type: string;\r\n    description?: string;\r\n  } | null> {\r\n    if (!this.serverUrl) {\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`${this.serverUrl}/interface-info`);\r\n\r\n      if (!response.ok) {\r\n        console.warn(`Interface info request failed: ${response.statusText}`);\r\n        return null;\r\n      }\r\n\r\n      return await response.json();\r\n    } catch (error) {\r\n      console.error('Failed to get interface info:', error);\r\n      return null;\r\n    }\r\n  }\r\n}\r\n"],"names":["__webpack_require__","definition","key","Object","obj","prop","Symbol","RemoteExecutionAdapter","BasePlaygroundAdapter","value","action","needsStructuredParams","schema","shape","missingFields","_fieldDef__def","_fieldDef__def1","fieldDef","isOptional","undefined","params","options","parseStructuredParams","error","message","androidErrors","androidError","keyword","actionType","window","Error","payload","response","fetch","JSON","errorText","result","console","optionalParams","optionalFields","context","Array","actionSpaceMethod","res","data","jsonError","aiConfig","requestId","encodeURIComponent","callback","lastTip","interval","setInterval","_progress_tip","progress","clearInterval","serverUrl","Map"],"mappings":"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"}